


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.3">
    
    
      
        <title>目标检测概述 - 深度学习与CV</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6e35a1a6.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#41" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="深度学习与CV" class="md-header-nav__button md-logo" aria-label="深度学习与CV">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            深度学习与CV
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              目标检测概述
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="深度学习与CV" class="md-nav__button md-logo" aria-label="深度学习与CV">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    深度学习与CV
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      课程介绍
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="课程介绍" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        课程介绍
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/section1/" title="深度学习" class="md-nav__link">
      深度学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/section2/" title="计算机视觉（CV）" class="md-nav__link">
      计算机视觉（CV）
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      tensorflow入门
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="tensorflow入门" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        tensorflow入门
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tensorFlow/section1/" title="tensorflow和keras简介" class="md-nav__link">
      tensorflow和keras简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tensorFlow/section2/" title="快速入门模型" class="md-nav__link">
      快速入门模型
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      深度神经网络
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="深度神经网络" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        深度神经网络
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deeplearning/section1/" title="神经网络简介" class="md-nav__link">
      神经网络简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deeplearning/section2/" title="常见的损失函数" class="md-nav__link">
      常见的损失函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deeplearning/section3/" title="深度学习的优化方法" class="md-nav__link">
      深度学习的优化方法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deeplearning/section4/" title="深度学习的正则化" class="md-nav__link">
      深度学习的正则化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deeplearning/section5/" title="神经网络案例" class="md-nav__link">
      神经网络案例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deeplearning/section6/" title="卷积神经网络CNN" class="md-nav__link">
      卷积神经网络CNN
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      图像分类
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="图像分类" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        图像分类
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageClassification/section1/" title="图像分类简介" class="md-nav__link">
      图像分类简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageClassification/section2/" title="AlexNet" class="md-nav__link">
      AlexNet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageClassification/section3/" title="VGG" class="md-nav__link">
      VGG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageClassification/section4/" title="GoogLeNet" class="md-nav__link">
      GoogLeNet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageClassification/section5/" title="ResNet" class="md-nav__link">
      ResNet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageClassification/section6/" title="图像增强方法" class="md-nav__link">
      图像增强方法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageClassification/section7/" title="模型微调" class="md-nav__link">
      模型微调
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      目标检测
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="目标检测" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        目标检测
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        目标检测概述
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="目标检测概述" class="md-nav__link md-nav__link--active">
      目标检测概述
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 目标检测
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2.常用的开源数据集
  </a>
  
    <nav class="md-nav" aria-label="2.常用的开源数据集">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-pascal-voc" class="md-nav__link">
    2.1 PASCAL VOC数据集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-ms-coco" class="md-nav__link">
    2.2 MS COCO数据集
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3.常用的评价指标
  </a>
  
    <nav class="md-nav" aria-label="3.常用的评价指标">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-iou" class="md-nav__link">
    3.1 IOU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-mapmean-average-precision" class="md-nav__link">
    3.2 mAP（Mean Average Precision）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4nms" class="md-nav__link">
    4.NMS（非极大值抑制）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5.目标检测方法分类
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02.RCNN/" title="RCNN系列网络" class="md-nav__link">
      RCNN系列网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03.RCNN-demo/" title="Faster RCNN案例" class="md-nav__link">
      Faster RCNN案例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04.yolo/" title="YOLO系列算法" class="md-nav__link">
      YOLO系列算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../05.yolo-demo/" title="YOLOV3案例" class="md-nav__link">
      YOLOV3案例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../06.ssd/" title="SSD算法" class="md-nav__link">
      SSD算法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      目标分割
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="目标分割" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        目标分割
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageSegmentation/section1/" title="目标分割介绍" class="md-nav__link">
      目标分割介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageSegmentation/section2/" title="语义分割：FCN和UNet" class="md-nav__link">
      语义分割：FCN和UNet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageSegmentation/section3/" title="UNet案例" class="md-nav__link">
      UNet案例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../imageSegmentation/section4/" title="实例分割：Mask RCNN" class="md-nav__link">
      实例分割：Mask RCNN
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 目标检测
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2.常用的开源数据集
  </a>
  
    <nav class="md-nav" aria-label="2.常用的开源数据集">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-pascal-voc" class="md-nav__link">
    2.1 PASCAL VOC数据集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-ms-coco" class="md-nav__link">
    2.2 MS COCO数据集
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3.常用的评价指标
  </a>
  
    <nav class="md-nav" aria-label="3.常用的评价指标">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-iou" class="md-nav__link">
    3.1 IOU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-mapmean-average-precision" class="md-nav__link">
    3.2 mAP（Mean Average Precision）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4nms" class="md-nav__link">
    4.NMS（非极大值抑制）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5.目标检测方法分类
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="41">4.1 目标检测概述<a class="headerlink" href="#41" title="Permanent link">&para;</a></h1>
<p><strong>学习目标</strong></p>
<ul>
<li>了解目标检测的任务</li>
<li>知道目标检测的常用数据集</li>
<li>知道目标检测算法的评价指标</li>
<li>掌握非极大值NMS算法的应用</li>
<li>了解常用的目标检测算法分类</li>
</ul>
<hr />
<h2 id="1">1. 目标检测<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>目标检测（Object Detection）的任务是找出图像中所有感兴趣的目标，并确定它们的类别和位置。</p>
<p><img alt="image-20200914093505930" src="../assets/image-20200914093505930.png" /></p>
<p>目标检测中能检测出来的物体取决于当前任务（数据集）需要检测的物体有哪些。假设我们的目标检测模型定位是检测动物（牛、羊、猪、狗、猫五种结果），那么模型对任何一张图片输出结果不会输出鸭子、书籍等其它类型结果。</p>
<p>目标检测的位置信息一般由两种格式（以图片左上角为原点(0,0)）：</p>
<p>1、极坐标表示：(xmin, ymin, xmax, ymax)</p>
<ul>
<li>xmin,ymin:x,y坐标的最小值</li>
<li>xmin,ymin:x,y坐标的最大值</li>
</ul>
<p>2、中心点坐标：(x_center, y_center, w, h)</p>
<ul>
<li>x_center, y_center:目标检测框的中心点坐标</li>
<li>w,h:目标检测框的宽、高</li>
</ul>
<p>假设在下面的图像中进行检测，：</p>
<p><img alt="image-20200914094311588" src="../assets/image-20200914094311588.png" /></p>
<p>那目标检测结果的中心点表示形式如下所示：</p>
<p><img alt="image-20200914094547279" src="../assets/image-20200914094547279.png" /></p>
<h2 id="2">2.常用的开源数据集<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p>经典的目标检测数据集有两种，<strong>PASCAL VOC数据集</strong> 和 <strong>MS COCO数据集</strong>。</p>
<h3 id="21-pascal-voc">2.1 <strong>PASCAL VOC数据集</strong><a class="headerlink" href="#21-pascal-voc" title="Permanent link">&para;</a></h3>
<p>PASCAL VOC是目标检测领域的经典数据集。PASCAL VOC包含约10,000张带有边界框的图片用于训练和验证。PASCAL VOC数据集是目标检测问题的一个基准数据集，很多模型都是在此数据集上得到的，常用的是VOC2007和VOC2012两个版本数据，共20个类别，分别是：</p>
<p><img alt="image-20200914100347923" src="../assets/image-20200914100347923.png" /></p>
<p>也就是：</p>
<p>1.人:   人</p>
<p>2.动物:   鸟，猫，牛，狗，马，羊</p>
<p>3.交通工具:  飞机，自行车，船，公共汽车，汽车，摩托车，火车</p>
<p>4.室内:   瓶子，椅子，餐桌，盆栽，沙发，电视/显示器</p>
<p><strong>下载地址</strong>：<a href="https://pjreddie.com/projects/pascal-voc-dataset-mirror/">https://pjreddie.com/projects/pascal-voc-dataset-mirror/</a></p>
<p>整个数据的目录结构如下所示：</p>
<p><img alt="image-20200914102806446" src="../assets/image-20200914102806446.png" /></p>
<p>其中：</p>
<ol>
<li>
<p>JPEGImages存放图片文件</p>
</li>
<li>
<p>Annotations下存放的是xml文件,描述了图片信息，如下图所示，需要关注的就是节点下的数据,尤其是bndbox下的数据.xmin,ymin构成了boundingbox的左上角,xmax,ymax构成了boundingbox的右下角，也就是图像中的目标位置信息</p>
</li>
</ol>
<p><img alt="image-20200914102923655" src="../assets/image-20200914102923655.png" /></p>
<ol>
<li>
<p>ImageSets包含以下4个文件夹：</p>
</li>
<li>
<p>Action下存放的是人的动作（例如running、jumping等等）</p>
</li>
<li>Layout下存放的是具有人体部位的数据（人的head、hand、feet等等）</li>
<li>Segmentation下存放的是可用于分割的数据。</li>
<li>Main下存放的是图像物体识别的数据，总共分为20类，这是进行目标检测的重点。该文件夹中的数据对负样本文件进行了描述。</li>
</ol>
<p><img alt="image-20200914104312679" src="../assets/image-20200914104312679.png" /></p>
<h3 id="22-ms-coco">2.2 <strong>MS COCO数据集</strong><a class="headerlink" href="#22-ms-coco" title="Permanent link">&para;</a></h3>
<p>MS COCO的全称是Microsoft Common Objects in Context，微软于2014年出资标注的Microsoft COCO数据集，与ImageNet竞赛一样，被视为是计算机视觉领域最受关注和最权威的比赛之一。        </p>
<p>COCO数据集是一个大型的、丰富的物体检测，分割和字幕数据集。这个数据集以场景理解为目标，主要从复杂的日常场景中截取，图像中的目标通过精确的分割进行位置的标定。图像包括91类目标，328,000影像和2,500,000个label。目前为止目标检测的最大数据集，提供的类别有80 类，有超过33 万张图片，其中20 万张有标注，整个数据集中个体的数目超过150 万个。</p>
<p>图像示例：</p>
<p><img alt="image-20200914105227481" src="../assets/image-20200914105227481.png" /></p>
<p>coco数据集的标签文件标记了每个segmentation+bounding box的精确坐标，其精度均为小数点后两位一个目标的标签示意如下：</p>
<p>{"segmentation":[[392.87, 275.77, 402.24, 284.2, 382.54, 342.36, 375.99, 356.43, 372.23, 357.37, 372.23, 397.7, 383.48, 419.27,407.87, 439.91, 427.57, 389.25, 447.26, 346.11, 447.26, 328.29, 468.84, 290.77,472.59, 266.38], [429.44,465.23, 453.83, 473.67, 636.73, 474.61, 636.73, 392.07, 571.07, 364.88, 546.69,363.0]], "area": 28458.996150000003, "iscrowd": 0,"image_id": 503837, <strong>"bbox": [372.23, 266.38, 264.5,208.23]</strong>, "category_id": 4, "id": 151109}, </p>
<h2 id="3">3.常用的评价指标<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31-iou">3.1 IOU<a class="headerlink" href="#31-iou" title="Permanent link">&para;</a></h3>
<p>在目标检测算法中，IoU（intersection over union，交并比）是目标检测算法中用来评价2个矩形框之间相似度的指标：</p>
<p><strong>IoU = 两个矩形框相交的面积 / 两个矩形框相并的面积</strong>，</p>
<p>如下图所示：</p>
<p><img alt="image-20200914115238275" src="../assets/image-20200914115238275.png" /></p>
<p>通过一个例子看下在目标检测中的应用：</p>
<p><img alt="image-20200914120919909" src="../assets/image-20200914120919909.png" /></p>
<p>其中上图蓝色框框为检测结果，红色框框为真实标注。</p>
<p>那我们就可以通过预测结果与真实结果之间的交并比来衡量两者之间的相似度。一般情况下对于检测框的判定都会存在一个阈值，也就是<code>IoU</code>的阈值，一般可以设置当<code>IoU</code>的值大于<code>0.5</code>的时候，则可认为检测到目标物体。</p>
<p>实现方法：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="c1"># 定义方法计算IOU</span>
<span class="k">def</span> <span class="nf">Iou</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span> <span class="n">box2</span><span class="p">,</span> <span class="n">wh</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c1"># 判断bbox的表示形式</span>
    <span class="k">if</span> <span class="n">wh</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="c1"># 使用极坐标形式表示：直接获取两个bbox的坐标</span>
        <span class="n">xmin1</span><span class="p">,</span> <span class="n">ymin1</span><span class="p">,</span> <span class="n">xmax1</span><span class="p">,</span> <span class="n">ymax1</span> <span class="o">=</span> <span class="n">box1</span>
        <span class="n">xmin2</span><span class="p">,</span> <span class="n">ymin2</span><span class="p">,</span> <span class="n">xmax2</span><span class="p">,</span> <span class="n">ymax2</span> <span class="o">=</span> <span class="n">box2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 使用中心点形式表示： 获取两个两个bbox的极坐标表示形式</span>
        <span class="c1"># 第一个框左上角坐标</span>
        <span class="n">xmin1</span><span class="p">,</span> <span class="n">ymin1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">box1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="c1"># 第一个框右下角坐标</span>
        <span class="n">xmax1</span><span class="p">,</span> <span class="n">ymax1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">box1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">box1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="c1"># 第二个框左上角坐标</span>
        <span class="n">xmin2</span><span class="p">,</span> <span class="n">ymin2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">box2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">box2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="c1"># 第二个框右下角坐标</span>
        <span class="n">xmax2</span><span class="p">,</span> <span class="n">ymax2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">box2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">box2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="c1"># 获取矩形框交集对应的左上角和右下角的坐标（intersection）</span>
    <span class="n">xx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">xmin1</span><span class="p">,</span> <span class="n">xmin2</span><span class="p">])</span>
    <span class="n">yy1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ymin1</span><span class="p">,</span> <span class="n">ymin2</span><span class="p">])</span>
    <span class="n">xx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">xmax1</span><span class="p">,</span> <span class="n">xmax2</span><span class="p">])</span>
    <span class="n">yy2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ymax1</span><span class="p">,</span> <span class="n">ymax2</span><span class="p">])</span>
    <span class="c1"># 计算两个矩形框面积</span>
    <span class="n">area1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax1</span><span class="o">-</span><span class="n">xmin1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymax1</span><span class="o">-</span><span class="n">ymin1</span><span class="p">)</span> 
    <span class="n">area2</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax2</span><span class="o">-</span><span class="n">xmin2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymax2</span><span class="o">-</span><span class="n">ymin2</span><span class="p">)</span>
    <span class="c1">#计算交集面积</span>
    <span class="n">inter_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">xx2</span><span class="o">-</span><span class="n">xx1</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yy2</span><span class="o">-</span><span class="n">yy1</span><span class="p">]))</span>
    <span class="c1">#计算交并比</span>
    <span class="n">iou</span> <span class="o">=</span> <span class="n">inter_area</span> <span class="o">/</span> <span class="p">(</span><span class="n">area1</span><span class="o">+</span><span class="n">area2</span><span class="o">-</span><span class="n">inter_area</span><span class="o">+</span><span class="mf">1e-6</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">iou</span>
</code></pre></div>

<p>假设我们检测结果如下所示，并展示在图像上：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="kn">as</span> <span class="nn">patches</span>
<span class="c1"># 真实框与预测框</span>
<span class="n">True_bbox</span><span class="p">,</span> <span class="n">predict_bbox</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">398</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">355</span><span class="p">,</span> <span class="mi">398</span><span class="p">]</span>
<span class="c1"># bbox是bounding box的缩写</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;dog.jpeg&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="c1"># 将边界框(左上x, 左上y, 右下x, 右下y)格式转换成matplotlib格式：((左上x, 左上y), 宽, 高)</span>
<span class="c1"># 真实框绘制</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">True_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">True_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">width</span><span class="o">=</span><span class="n">True_bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">True_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">True_bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">True_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">fill</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># 预测框绘制</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">predict_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">predict_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">width</span><span class="o">=</span><span class="n">predict_bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">predict_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">predict_bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">predict_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">fill</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<p><img alt="image-20200914115751685" src="../assets/image-20200914115751685.png" /></p>
<p>计算IoU：</p>
<div class="highlight"><pre><span></span><code><span class="n">Iou</span><span class="p">(</span><span class="n">True_bbox</span><span class="p">,</span><span class="n">predict_bbox</span><span class="p">)</span>
</code></pre></div>

<p>结果为：</p>
<div class="highlight"><pre><span></span><code>0.5114435907762924
</code></pre></div>

<h3 id="32-mapmean-average-precision">3.2 mAP（<em>Mean Average Precision</em>）<a class="headerlink" href="#32-mapmean-average-precision" title="Permanent link">&para;</a></h3>
<p>目标检测问题中的每个图片都可能包含一些不同类别的物体，需要评估模型的物体分类和定位性能。因此，用于图像分类问题的标准指标precision不能直接应用于此。 在目标检测中，mAP是主要的衡量指标。</p>
<p>mAP是多个分类任务的AP的平均值，而AP（average precision）是PR曲线下的面积，所以在介绍mAP之前我们要先得到PR曲线。</p>
<p><strong>TP、FP、FN、TN</strong></p>
<ul>
<li>True Positive (TP): IoU&gt;<img alt="[公式]" src="https://www.zhihu.com/equation?tex=IOU_%7Bthreshold%7D" /> (<img alt="[公式]" src="https://www.zhihu.com/equation?tex=IOU_%7Bthreshold%7D" /> 一般取 0.5 ) 的检测框数量（同一 Ground Truth 只计算一次）</li>
<li>False Positive (FP): IoU&lt;=<img alt="[公式]" src="https://www.zhihu.com/equation?tex=IOU_%7Bthreshold%7D" /> 的检测框数量，或者是检测到同一个 GT 的多余检测框的数量</li>
<li>False Negative (FN): 没有检测到的 GT 的数量</li>
<li>True Negative (TN): 在 mAP 评价指标中不会使用到</li>
</ul>
<p><strong>查准率、查全率</strong></p>
<ul>
<li>查准率（Precision）: TP/(TP + FP)</li>
<li>查全率（Recall）: TP/(TP + FN)</li>
</ul>
<p>二者绘制的曲线称为 P-R 曲线</p>
<p><img alt="image-20200914122231984" src="../assets/image-20200914122231984.png" /></p>
<p>先定义两个公式，一个是 Precision，一个是 Recall，与上面的公式相同，扩展开来，用另外一种形式进行展示，其中 <code>all detctions</code> 代表所有预测框的数量， <code>all ground truths</code> 代表所有 GT 的数量。</p>
<p><img alt="image-20200914122349985" src="../assets/image-20200914122349985.png" /></p>
<p>AP 是计算某一类 P-R 曲线下的面积，mAP 则是计算所有类别 P-R 曲线下面积的平均值。</p>
<p>假设我们有 7 张图片（Images1-Image7），这些图片有 15 个目标（绿色的框，GT 的数量，上文提及的 <code>all ground truths</code>）以及 24 个预测边框（红色的框，A-Y 编号表示，并且有一个置信度值）：</p>
<p><img alt="image-20200914122425148" src="../assets/image-20200914122425148.png" /></p>
<p>根据上图以及说明，我们可以列出以下表格，其中 Images 代表图片的编号，Detections 代表预测边框的编号，Confidences 代表预测边框的置信度，TP or FP 代表预测的边框是标记为 TP 还是 FP（认为预测边框与 GT 的 IOU 值大于等于 0.3 就标记为 TP；若一个 GT 有多个预测边框，则认为 IOU 最大且大于等于 0.3 的预测框标记为 TP，其他的标记为 FP，即一个 GT 只能有一个预测框标记为 TP），这里的 0.3 是随机取的一个值。</p>
<p><img alt="image-20200914122449679" src="../assets/image-20200914122449679.png" /></p>
<p>通过上表，我们可以绘制出 P-R 曲线（因为 AP 就是 P-R 曲线下面的面积），但是在此之前我们需要计算出 P-R 曲线上各个点的坐标，根据置信度从大到小排序所有的预测框，然后就可以计算 Precision 和 Recall 的值，见下表。（需要记住一个叫累加的概念，就是下图的 ACC TP 和 ACC FP）</p>
<p><img alt="image-20200914122515653" src="../assets/image-20200914122515653.png" /></p>
<ul>
<li>
<p>标号为 1 的 Precision 和 Recall 的计算方式：Precision=TP/(TP+FP)=1/(1+0)=1，Recall=TP/(TP+FN)=TP/(<code>all ground truths</code>)=1/15=0.0666 （<code>all ground truths 上面有定义过了</code>）</p>
</li>
<li>
<p>标号 2：Precision=TP/(TP+FP)=1/(1+1)=0.5，Recall=TP/(TP+FN)=TP/(<code>all ground truths</code>)=1/15=0.0666</p>
</li>
<li>
<p>标号 3：Precision=TP/(TP+FP)=2/(2+1)=0.6666，Recall=TP/(TP+FN)=TP/(<code>all ground truths</code>)=2/15=0.1333</p>
</li>
<li>其他的依次类推</li>
</ul>
<p>然后就可以绘制出 P-R 曲线</p>
<p><img alt="image-20200914122624577" src="../assets/image-20200914122624577.png" /></p>
<p>得到 P-R 曲线就可以计算 AP（P-R 曲线下的面积），要计算 P-R 下方的面积，有两种方法：</p>
<ul>
<li>在VOC2010以前，只需要选取当Recall &gt;= 0, 0.1, 0.2, ..., 1共11个点时的Precision最大值，然后AP就是这11个Precision的平均值，取 11 个点 [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1] 的插值所得 </li>
</ul>
<p><img alt="image-20200914122647838" src="../assets/image-20200914122647838.png" /></p>
<p>得到一个类别的 AP 结果如下：</p>
<p><img alt="image-20200914122709622" src="../assets/image-20200914122709622.png" /></p>
<p>要计算 mAP，就把所有类别的 AP 计算出来，然后求取平均即可。</p>
<ul>
<li>在VOC2010及以后，需要针对每一个不同的Recall值（包括0和1），选取其大于等于这些Recall值时的Precision最大值，如下图所示：</li>
</ul>
<p><img alt="image-20200925140322034" src="../assets/image-20200925140322034.png" /></p>
<p>然后计算PR曲线下面积作为AP值：</p>
<p><img alt="image-20200925140412765" src="../assets/image-20200925140412765.png" /></p>
<p>计算方法如下所示：</p>
<p><img alt="image-20200914133335315" src="../assets/image-20200914133335315.png" /></p>
<h2 id="4nms">4.NMS（非极大值抑制）<a class="headerlink" href="#4nms" title="Permanent link">&para;</a></h2>
<p>非极大值抑制（Non-Maximum Suppression，NMS），顾名思义就是抑制不是极大值的元素。例如在行人检测中，滑动窗口经提取特征，经分类器分类识别后，每个窗口都会得到一个分数。但是滑动窗口会导致很多窗口与其他窗口存在包含或者大部分交叉的情况。这时就需要用到NMS来选取那些邻域里分数最高（是行人的概率最大），并且抑制那些分数低的窗口。 NMS在计算机视觉领域有着非常重要的应用，如视频目标跟踪、数据挖掘、3D重建、目标识别以及纹理分析等 。</p>
<p>在目标检测中，NMS的目的就是要去除冗余的检测框,保留最好的一个，如下图所示：</p>
<p><img alt="image-20200914134143565" src="../assets/image-20200914134143565.png" /></p>
<p>NMS的原理是对于预测框的列表B及其对应的置信度S,选择具有最大score的检测框M,将其从B集合中移除并加入到最终的检测结果D中.通常将B中剩余检测框中与M的IoU大于阈值Nt的框从B中移除.重复这个过程,直到B为空。</p>
<p>使用流程如下图所示：</p>
<ul>
<li>首先是检测出一系列的检测框</li>
<li>将检测框按照类别进行分类</li>
<li>对同一类别的检测框应用NMS获取最终的检测结果</li>
</ul>
<p><img alt="image-20200914134436423" src="../assets/image-20200914134436423.png" /></p>
<p>通过一个例子看些NMS的使用方法，假设定位车辆，算法就找出了一系列的矩形框，我们需要判别哪些矩形框是没用的，需要使用NMS的方法来实现。</p>
<p><img alt="image-20200914134640279" src="../assets/image-20200914134640279.png" /></p>
<p>假设现在检测窗口有：A、B、C、D、E 5个候选框，接下来进行迭代计算：</p>
<ul>
<li>第一轮：因为B是得分最高的，与B的IoU＞0.5删除。A，CDE中现在与B计算IoU，DE结果＞0.5，剔除DE，B作为一个预测结果，有个检测框留下B，放入集合</li>
<li>第二轮：A的得分最高，与A计算IoU，C的结果＞0.5，剔除C，A作为一个结果</li>
</ul>
<p>最终结果为在这个5个中检测出了两个目标为A和B。</p>
<p>单类别的NMS的实现方法如下所示：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">nms</span><span class="p">(</span><span class="n">bboxes</span><span class="p">,</span> <span class="n">confidence_score</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;非极大抑制过程</span>
<span class="sd">    :param bboxes: 同类别候选框坐标</span>
<span class="sd">    :param confidence: 同类别候选框分数</span>
<span class="sd">    :param threshold: iou阈值</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1、传入无候选框返回空</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="c1"># 强转数组</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">confidence_score</span><span class="p">)</span>

    <span class="c1"># 取出n个的极坐标点</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="c1"># 2、对候选框进行NMS筛选</span>
    <span class="c1"># 返回的框坐标和分数</span>
    <span class="n">picked_boxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">picked_score</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># 对置信度进行排序, 获取排序后的下标序号, argsort默认从小到大排序</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
    <span class="n">areas</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">order</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># 将当前置信度最大的框加入返回值列表中</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#保留该类剩余box中得分最高的一个</span>
        <span class="n">picked_boxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bboxes</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">picked_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confidence_score</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="c1"># 获取当前置信度最大的候选框与其他任意候选框的相交面积</span>
        <span class="n">x11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="n">order</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">y11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">y1</span><span class="p">[</span><span class="n">order</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">x22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">x2</span><span class="p">[</span><span class="n">order</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">y22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">y2</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">y2</span><span class="p">[</span><span class="n">order</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="c1"># 计算相交的面积,不重叠时面积为0</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">x22</span> <span class="o">-</span> <span class="n">x11</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y22</span> <span class="o">-</span> <span class="n">y11</span><span class="p">)</span>
        <span class="n">intersection</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span>

        <span class="c1"># 利用相交的面积和两个框自身的面积计算框的交并比</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">intersection</span> <span class="o">/</span> <span class="p">(</span><span class="n">areas</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">areas</span><span class="p">[</span><span class="n">order</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">intersection</span><span class="p">)</span>
        <span class="c1"># 保留IoU小于阈值的box</span>
        <span class="n">keep_boxes_indics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="c1"># 保留剩余的框</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="n">keep_boxes_indics</span><span class="p">]</span>
    <span class="c1"># 返回NMS后的框及分类结果   </span>
    <span class="k">return</span> <span class="n">picked_boxes</span><span class="p">,</span> <span class="n">picked_score</span>
</code></pre></div>

<p>假设有检测结果如下：</p>
<div class="highlight"><pre><span></span><code><span class="n">bounding</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">187</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">317</span><span class="p">),</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">282</span><span class="p">),</span> <span class="p">(</span><span class="mi">246</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">368</span><span class="p">,</span> <span class="mi">304</span><span class="p">)]</span>
<span class="n">confidence_score</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">picked_boxes</span><span class="p">,</span> <span class="n">picked_score</span> <span class="o">=</span> <span class="n">nms</span><span class="p">(</span><span class="n">bounding</span><span class="p">,</span> <span class="n">confidence_score</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;阈值threshold为:&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;NMS后得到的bbox是：&#39;</span><span class="p">,</span> <span class="n">picked_boxes</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;NMS后得到的bbox的confidences是：&#39;</span><span class="p">,</span> <span class="n">picked_score</span><span class="p">)</span>
</code></pre></div>

<p>返回结果：</p>
<div class="highlight"><pre><span></span><code><span class="err">阈值</span><span class="n">threshold为</span><span class="p">:</span> <span class="mf">0.3</span>
<span class="n">NMS后得到的bbox是</span><span class="err">：</span> <span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mi">187</span><span class="p">,</span>  <span class="mi">82</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">317</span><span class="p">])]</span>
<span class="n">NMS后得到的bbox的confidences是</span><span class="err">：</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">]</span>
</code></pre></div>

<h2 id="5">5.目标检测方法分类<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<p>目标检测算法主要分为two-stage（两阶段）和one-stage（单阶段）两类：</p>
<ul>
<li>two-stage的算法</li>
</ul>
<p>先由算法生成一系列作为样本的候选框，再通过卷积神经网络进行样本分类。如下图所示，主要通过一个卷积神经网络来完成目标检测过程，其提取的是CNN卷积特征，进行候选区域的筛选和目标检测两部分。网络的准确度高、速度相对较慢。</p>
<p><img alt="image-20200914142042315" src="../assets/image-20200914142042315.png" /></p>
<p>two-stages算法的代表是RCNN系列：R-CNN到Faster R-CNN网络</p>
<ul>
<li>One-stage的算法</li>
</ul>
<p>直接通过主干网络给出目标的类别和位置信息，没有使用候选区域的筛选网路，这种算法速度快，但是精度相对Two-stage目标检测网络降低了很多。</p>
<p><img alt="image-20200914142707258" src="../assets/image-20200914142707258.png" /></p>
<p>one-stage算法的代表是： YOLO系列：YOLOv1、YOLOv2、YOLOv3、  SSD等</p>
<hr />
<p><strong>总结</strong></p>
<ul>
<li>了解目标检测的任务</li>
</ul>
<p>找出图像中所有感兴趣的目标，并确定它们的类别和位置</p>
<ul>
<li>知道目标检测的常用数据集</li>
</ul>
<p><strong>PASCAL VOC数据集</strong> 和 <strong>MS COCO数据集</strong></p>
<ul>
<li>知道目标检测算法的评价指标</li>
</ul>
<p>IOU和mAP</p>
<ul>
<li>掌握非极大值NMS算法的应用</li>
</ul>
<p>要去除冗余的检测框,保留最好的一个</p>
<ul>
<li>了解常用的目标检测算法分类</li>
</ul>
<p>two-stage（两阶段）和one-stage（单阶段）</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../imageClassification/section7/" title="模型微调" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                模型微调
              </div>
            </div>
          </a>
        
        
          <a href="../02.RCNN/" title="RCNN系列网络" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                RCNN系列网络
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.a45f732b.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.c03f0417.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>