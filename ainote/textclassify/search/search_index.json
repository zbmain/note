{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u4ec0\u4e48\u662f\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7cfb\u7edf \u53c8\u79f0\u4e3a\u4e2d\u6587\u6807\u7b7e\u5316\u7cfb\u7edf, \u9488\u5bf9\u4e00\u6bb5\u4e2d\u6587\u6587\u672c, \u6839\u636e\u5176\u5185\u5bb9, \u6253\u4e0a\u4e00\u4e2a\u6216\u591a\u4e2a\u5408\u9002\u7684\u6807\u7b7e\u7684\u7cfb\u7edf. \u4e3e\u4e2a\u6817\u5b50: \u4e3e\u4f8b\u6587\u672c: \"\u6211\u6700\u559c\u6b22\u7684\u6b4c\u624b\u662f\u5468\u6770\u4f26\uff0c\u56e0\u4e3a\u4ed6\u7684\u4e03\u91cc\u9999\u5f88\u597d\u542c\uff0c\u96e8\u4e0b\u6574\u591c\uff0c\u6211\u7684\u7231\u6ea2\u51fa\u5c31\u50cf\u96e8\u6c34\u3002\" \u6587\u672c\u6807\u7b7e: \"\u97f3\u4e50\" \u7cfb\u7edf\u7684\u91cd\u8981\u6027 \u4ece\u7cfb\u7edf\u672c\u8eab\u89d2\u5ea6: \u7cfb\u7edf\u5185\u5305\u542b\u5f88\u591aNLP\u57fa\u7840\u4efb\u52a1\u7684\u5904\u7406\uff0c\u6bd4\u5982\u5206\u8bcd\u4efb\u52a1\uff0c\u547d\u540d\u5b9e\u4f53\u8bc6\u522b\u4efb\u52a1\u7b49\uff0c\u53c8\u662f\u673a\u5668\u7ffb\u8bd1\uff0c\u6587\u672c\u751f\u6210\u5de5\u4f5c\u7684\u57fa\u7840\u3002\u56e0\u6b64\uff0c\u667a\u80fd\u6587\u672c\u5206\u7c7b\u4efb\u52a1\u662f\u5b66\u4e60NLP\u7684\u5fc5\u7ecf\u4e4b\u8def\u3002 \u4ece\u804c\u4e1a\u53d1\u5c55\u89d2\u5ea6: \u5bf9\u6587\u672c\u5206\u7c7b\u6280\u672f\u7684\u8981\u6c42\u90fd\u662f\u666e\u904d\u5b58\u5728\u7684\uff0c\u4e5f\u662f\u4f60\u5c06\u6765\u5728\u804c\u573a\u6740\u622e\u7684\u6709\u529b\u6b66\u5668\u3002\u5982\u679c\u5927\u5bb6\u80fd\u591f\u8ba4\u771f\u5b66\u4e60\u4ece\u800c\u7cbe\u901a\u8fd9\u6837\u4e00\u4e2a\u7cfb\u7edf\uff0c\u5728\u5e02\u9762\u4e0a\u627e\u5230\u4e00\u4efd\u76f8\u5173\u7684\u5de5\u4f5c\u8fd8\u662f\u975e\u5e38\u5bb9\u6613\u7684\u3002 \u7cfb\u7edf\u7684\u5e94\u7528\u573a\u666f \u8fd9\u662f\u4e00\u6b3e\u516c\u53f8\u5185\u90e8\u4f7f\u7528\u7684\u4ea7\u54c1\uff0c\u652f\u6301\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf, \u5546\u54c1\u753b\u50cf\u7b49. \u4ee5\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u4e3a\u4f8b, \u57fa\u4e8e\u7528\u6237\u7684\u5174\u8da3\u7231\u597d\u8fdb\u884c\u63a8\u8350, \u9700\u8981\u6839\u636e\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u6253\u4e0a\u4e00\u4e2a\u6216\u591a\u4e2a\u6807\u7b7e, \u901a\u8fc7\u6807\u7b7e\u5339\u914d, \u6765\u5b8c\u6210\u57fa\u4e8e\u5174\u8da3\u7684\u63a8\u8350\u5de5\u4f5c. \u81ea\u4e3b\u6784\u5efa\u7cfb\u7edf\u7684\u4f18\u52bf \u6211\u4eec\u8fd9\u91cc\u66f4\u4e13\u6ce8\u4e8e\u6cdb\u5a31\u4e50\u5782\u76f4\u9886\u57df\u7684\u7cbe\u7ec6\u5206\u7c7b, \u66f4\u597d\u7684\u628a\u63e1\u8be5\u9886\u57df\u7684\u7528\u6237\u9700\u6c42\u3002 \u6807\u7b7e\u8fed\u4ee3\u901f\u5ea6\u66f4\u5feb\uff0c\u6ee1\u8db3\u6cdb\u5a31\u4e50\u9886\u57df\u591a\u53d8\u7684\u6807\u7b7e\u60c5\u51b5\u3002 \u7bc7\u7ae0\u76ee\u5f55\u7b80\u4ecb \u7b2c\u4e00\u7ae0: \u6574\u4f53\u7cfb\u7edf\u642d\u5efa \u4e3b\u8981\u8bb2\u89e3\u642d\u5efa\u7cfb\u7edf\u7684\u670d\u52a1\u6846\u67b6\uff0c\u4ee5\u53ca\u5b9e\u73b0\u8be5\u7cfb\u7edf\u7684\u6838\u5fc3\u6b65\u9aa4\u3002 \u7b2c\u4e8c\u7ae0: \u6784\u5efa\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31 \u4e3b\u8981\u6784\u5efa\u7528\u4e8e\u67e5\u8be2\u7684\u77e5\u8bc6\u56fe\u8c31\uff0c\u8fd9\u5f20\u56fe\u8c31\u4f1a\u88ab\u7b2c\u4e00\u7ae0\u4e2d\u63d0\u53ca\u7684\u67d0\u4e00\u4e2a\u6838\u5fc3\u6b65\u9aa4\u6240\u8c03\u7528\u3002 \u7b2c\u4e09\u7ae0: \u7279\u5f81\u5de5\u7a0b\u4e0efasttext\u6a21\u578b\u8bad\u7ec3 \u4e3b\u8981\u8bb2\u89e3AI\u6a21\u578b\u7684\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u4f53\u73b0\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7684\u201c\u667a\u80fd\u201d\uff0c\u4e5f\u662f\u6211\u4eec\u6574\u4e2a\u9879\u76ee\u7684\u91cd\u4e2d\u4e4b\u91cd\uff0c\u6700\u540e\u5c01\u88c5\u7684\u6a21\u578b\u4e5f\u4f1a\u88ab\u7b2c\u4e00\u7ae0\u4e2d\u63d0\u53ca\u7684\u67d0\u4e00\u4e2a\u6838\u5fc3\u6b65\u9aa4\u6240\u8c03\u7528\u3002 \u7b2c\u56db\u7ae0: \u591a\u6a21\u578b\u8bad\u7ec3\u4e0e\u9884\u6d4b \u4e3b\u8981\u5bf9\u6a21\u578b\u8bad\u7ec3\u548c\u9884\u6d4b\u90e8\u5206\u7684\u4f18\u5316\uff0c\u4e3b\u8981\u8bb2\u5982\u4f55\u6709\u6548\u5229\u7528CPU\u8d44\u6e90\uff0c\u5feb\u901f\u8fdb\u884c\u591a\u6a21\u578b\u8bad\u7ec3\u3002\u548c\u5229\u7528\u591a\u7ebf\u7a0b\u63d0\u5347\u9884\u6d4b\u6027\u80fd\u8981\u6c42\u3002 \u7b2c\u4e94\u7ae0: \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u4e3b\u8981\u5c06\u6211\u4eec\u7cfb\u7edf\u7684\u5404\u4e2a\u90e8\u5206\u90fd\u8fde\u63a5\u8d77\u6765\uff0c\u5e76\u6d4b\u8bd5\u8fd0\u884c\uff0c\u5b8c\u6210\u6700\u540e\u4e00\u6bb5\u65c5\u7a0b\u3002","title":"\u521d\u8bc6\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7cfb\u7edf"},{"location":"#_1","text":"\u53c8\u79f0\u4e3a\u4e2d\u6587\u6807\u7b7e\u5316\u7cfb\u7edf, \u9488\u5bf9\u4e00\u6bb5\u4e2d\u6587\u6587\u672c, \u6839\u636e\u5176\u5185\u5bb9, \u6253\u4e0a\u4e00\u4e2a\u6216\u591a\u4e2a\u5408\u9002\u7684\u6807\u7b7e\u7684\u7cfb\u7edf. \u4e3e\u4e2a\u6817\u5b50: \u4e3e\u4f8b\u6587\u672c: \"\u6211\u6700\u559c\u6b22\u7684\u6b4c\u624b\u662f\u5468\u6770\u4f26\uff0c\u56e0\u4e3a\u4ed6\u7684\u4e03\u91cc\u9999\u5f88\u597d\u542c\uff0c\u96e8\u4e0b\u6574\u591c\uff0c\u6211\u7684\u7231\u6ea2\u51fa\u5c31\u50cf\u96e8\u6c34\u3002\" \u6587\u672c\u6807\u7b7e: \"\u97f3\u4e50\"","title":"\u4ec0\u4e48\u662f\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7cfb\u7edf"},{"location":"#_2","text":"\u4ece\u7cfb\u7edf\u672c\u8eab\u89d2\u5ea6: \u7cfb\u7edf\u5185\u5305\u542b\u5f88\u591aNLP\u57fa\u7840\u4efb\u52a1\u7684\u5904\u7406\uff0c\u6bd4\u5982\u5206\u8bcd\u4efb\u52a1\uff0c\u547d\u540d\u5b9e\u4f53\u8bc6\u522b\u4efb\u52a1\u7b49\uff0c\u53c8\u662f\u673a\u5668\u7ffb\u8bd1\uff0c\u6587\u672c\u751f\u6210\u5de5\u4f5c\u7684\u57fa\u7840\u3002\u56e0\u6b64\uff0c\u667a\u80fd\u6587\u672c\u5206\u7c7b\u4efb\u52a1\u662f\u5b66\u4e60NLP\u7684\u5fc5\u7ecf\u4e4b\u8def\u3002 \u4ece\u804c\u4e1a\u53d1\u5c55\u89d2\u5ea6: \u5bf9\u6587\u672c\u5206\u7c7b\u6280\u672f\u7684\u8981\u6c42\u90fd\u662f\u666e\u904d\u5b58\u5728\u7684\uff0c\u4e5f\u662f\u4f60\u5c06\u6765\u5728\u804c\u573a\u6740\u622e\u7684\u6709\u529b\u6b66\u5668\u3002\u5982\u679c\u5927\u5bb6\u80fd\u591f\u8ba4\u771f\u5b66\u4e60\u4ece\u800c\u7cbe\u901a\u8fd9\u6837\u4e00\u4e2a\u7cfb\u7edf\uff0c\u5728\u5e02\u9762\u4e0a\u627e\u5230\u4e00\u4efd\u76f8\u5173\u7684\u5de5\u4f5c\u8fd8\u662f\u975e\u5e38\u5bb9\u6613\u7684\u3002","title":"\u7cfb\u7edf\u7684\u91cd\u8981\u6027"},{"location":"#_3","text":"\u8fd9\u662f\u4e00\u6b3e\u516c\u53f8\u5185\u90e8\u4f7f\u7528\u7684\u4ea7\u54c1\uff0c\u652f\u6301\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf, \u5546\u54c1\u753b\u50cf\u7b49. \u4ee5\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u4e3a\u4f8b, \u57fa\u4e8e\u7528\u6237\u7684\u5174\u8da3\u7231\u597d\u8fdb\u884c\u63a8\u8350, \u9700\u8981\u6839\u636e\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u6253\u4e0a\u4e00\u4e2a\u6216\u591a\u4e2a\u6807\u7b7e, \u901a\u8fc7\u6807\u7b7e\u5339\u914d, \u6765\u5b8c\u6210\u57fa\u4e8e\u5174\u8da3\u7684\u63a8\u8350\u5de5\u4f5c.","title":"\u7cfb\u7edf\u7684\u5e94\u7528\u573a\u666f"},{"location":"#_4","text":"\u6211\u4eec\u8fd9\u91cc\u66f4\u4e13\u6ce8\u4e8e\u6cdb\u5a31\u4e50\u5782\u76f4\u9886\u57df\u7684\u7cbe\u7ec6\u5206\u7c7b, \u66f4\u597d\u7684\u628a\u63e1\u8be5\u9886\u57df\u7684\u7528\u6237\u9700\u6c42\u3002 \u6807\u7b7e\u8fed\u4ee3\u901f\u5ea6\u66f4\u5feb\uff0c\u6ee1\u8db3\u6cdb\u5a31\u4e50\u9886\u57df\u591a\u53d8\u7684\u6807\u7b7e\u60c5\u51b5\u3002","title":"\u81ea\u4e3b\u6784\u5efa\u7cfb\u7edf\u7684\u4f18\u52bf"},{"location":"#_5","text":"\u7b2c\u4e00\u7ae0: \u6574\u4f53\u7cfb\u7edf\u642d\u5efa \u4e3b\u8981\u8bb2\u89e3\u642d\u5efa\u7cfb\u7edf\u7684\u670d\u52a1\u6846\u67b6\uff0c\u4ee5\u53ca\u5b9e\u73b0\u8be5\u7cfb\u7edf\u7684\u6838\u5fc3\u6b65\u9aa4\u3002 \u7b2c\u4e8c\u7ae0: \u6784\u5efa\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31 \u4e3b\u8981\u6784\u5efa\u7528\u4e8e\u67e5\u8be2\u7684\u77e5\u8bc6\u56fe\u8c31\uff0c\u8fd9\u5f20\u56fe\u8c31\u4f1a\u88ab\u7b2c\u4e00\u7ae0\u4e2d\u63d0\u53ca\u7684\u67d0\u4e00\u4e2a\u6838\u5fc3\u6b65\u9aa4\u6240\u8c03\u7528\u3002 \u7b2c\u4e09\u7ae0: \u7279\u5f81\u5de5\u7a0b\u4e0efasttext\u6a21\u578b\u8bad\u7ec3 \u4e3b\u8981\u8bb2\u89e3AI\u6a21\u578b\u7684\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u4f53\u73b0\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7684\u201c\u667a\u80fd\u201d\uff0c\u4e5f\u662f\u6211\u4eec\u6574\u4e2a\u9879\u76ee\u7684\u91cd\u4e2d\u4e4b\u91cd\uff0c\u6700\u540e\u5c01\u88c5\u7684\u6a21\u578b\u4e5f\u4f1a\u88ab\u7b2c\u4e00\u7ae0\u4e2d\u63d0\u53ca\u7684\u67d0\u4e00\u4e2a\u6838\u5fc3\u6b65\u9aa4\u6240\u8c03\u7528\u3002 \u7b2c\u56db\u7ae0: \u591a\u6a21\u578b\u8bad\u7ec3\u4e0e\u9884\u6d4b \u4e3b\u8981\u5bf9\u6a21\u578b\u8bad\u7ec3\u548c\u9884\u6d4b\u90e8\u5206\u7684\u4f18\u5316\uff0c\u4e3b\u8981\u8bb2\u5982\u4f55\u6709\u6548\u5229\u7528CPU\u8d44\u6e90\uff0c\u5feb\u901f\u8fdb\u884c\u591a\u6a21\u578b\u8bad\u7ec3\u3002\u548c\u5229\u7528\u591a\u7ebf\u7a0b\u63d0\u5347\u9884\u6d4b\u6027\u80fd\u8981\u6c42\u3002 \u7b2c\u4e94\u7ae0: \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u4e3b\u8981\u5c06\u6211\u4eec\u7cfb\u7edf\u7684\u5404\u4e2a\u90e8\u5206\u90fd\u8fde\u63a5\u8d77\u6765\uff0c\u5e76\u6d4b\u8bd5\u8fd0\u884c\uff0c\u5b8c\u6210\u6700\u540e\u4e00\u6bb5\u65c5\u7a0b\u3002","title":"\u7bc7\u7ae0\u76ee\u5f55\u7b80\u4ecb"},{"location":"1/","text":"\u672c\u7ae0\u5bfc\u5b66 \u5b66\u4e60\u76ee\u6807 \u638c\u63e1\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7cfb\u7edf\u5bf9\u5916\u670d\u52a1\u7684\u642d\u5efa\u53ca\u5176\u5185\u90e8\u5904\u7406\u73af\u8282,\u5e76\u5728\u670d\u52a1\u5668\u4e2d\u5b9e\u73b0\u5b83\u4eec. \u5f15\u5bfc\u5206\u6790 \u7cfb\u7edf\u8f93\u5165\u4e3a: \u6587\u7ae0, \u8bc4\u8bba, \u63cf\u8ff0\u7b49\u5177\u4f53\u7684\u975e\u7ed3\u6784\u5316\u6587\u672c. \u7cfb\u7edf\u8f93\u51fa\u4e3a: \u8be5\u6587\u672c\u6d89\u53ca\u7684\u4e3b\u8981\u6807\u7b7e,\u4e3b\u8981\u6807\u7b7e\u9884\u6d4b\u6982\u7387\u4ee5\u53ca\u5173\u8054\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868. \u667a\u80fd\u6587\u672c\u5206\u7c7b\u6574\u4f53\u7cfb\u7edf\u642d\u5efa\u7684\u516d\u4e2a\u73af\u8282: \u672c\u7ae0\u5c0f\u8282: 1.1 \u540e\u7aef\u670d\u52a1\u642d\u5efa \u5b66\u4e60\u6784\u5efa\u8d77\u5bf9\u5916\u63d0\u4f9brestAPI\u7684\u670d\u52a1\u6846\u67b6\uff0c\u4f7f\u6210\u679c\u80fd\u88ab\u975e\u6280\u672f\u4eba\u5458\u8c03\u7528. 1.2 \u8f93\u5165\u9884\u5904\u7406 \u5b66\u4e60\u5bf9\u8f93\u5165\u7684\u6587\u672c\u505a\u957f\u5ea6\u9a8c\u8bc1, \u5206\u8bcd, \u53bb\u505c\u7528\u8bcd\u7b49\u5904\u7406\u64cd\u4f5c. 1.3 \u56fe\u8c31\u5339\u914d \u5b66\u4e60\u4f7f\u7528\u8f93\u5165\u6587\u672c\u4e2d\u7684\u8bcd\u6c47\u8fdb\u5165\u5230\u56fe\u8c31\u4e2d\u8fdb\u884c\u5339\u914d, \u627e\u51fa\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. 1.4 \u5339\u914d\u6b67\u4e49\u5224\u65ad \u5b66\u4e60\u4f7f\u7528\u6a21\u578b\u5bf9\u6240\u6709\u4e0d\u786e\u5b9a\u7684\u6807\u7b7e\u8fdb\u884c\u5224\u65ad, \u627e\u51fa\u6700\u5408\u9002\u7684\u6807\u7b7e. 1.5 \u6982\u7387\u8c03\u6574 \u5b66\u4e60\u8c03\u6574\u6807\u7b7e\u7684\u6982\u7387, \u6ee1\u8db3\u968f\u7740\u76f8\u5173\u8bcd\u6c47\u589e\u591a, \u6982\u7387\u9010\u6e10\u589e\u5927. 1.6 \u6982\u7387\u6807\u7b7e\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5b66\u4e60\u5bf9\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406, \u5e76\u68c0\u7d22\u5339\u914d\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868. 1.1 \u540e\u7aef\u670d\u52a1\u642d\u5efa \u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528. \u5b66\u4e60\u5982\u4f55\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6. \u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo. \u540e\u7aef\u670d\u52a1\u7684\u4e3b\u8981\u4f5c\u7528: \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282, \u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684restAPI, \u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528. \u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1,\u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001. \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6: \u6587\u4ef6\u5df2\u7ecf\u5b58\u653e\u5728/data/django-uwsgi\u76ee\u5f55\u4e0b. \u5728\u670d\u52a1\u5668\u4e2d\u8fdb\u884c\u6587\u4ef6\u67e5\u770b. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6: nginx: \u7528\u4e8e\u8d1f\u8f7d\u5747\u8861, \u589e\u5f3a\u670d\u52a1\u7684\u5065\u58ee\u6027. supervisor: \u7528\u4e8edjango\u670d\u52a1\u7684\u5b88\u62a4\u548c\u76d1\u63a7, \u5f53\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u65f6\u81ea\u52a8\u91cd\u542f. neo4j: \u56fe\u6570\u636e\u5e93, \u7528\u4e8e\u5b58\u50a8\u548c\u67e5\u8be2\u6570\u636e. \u7ec4\u4ef6\u5b89\u88c5\u8fc7\u7a0b: \u8bf7\u53c2\u8003\u9644\u5f55\u90e8\u5206\u7684\u73af\u5883\u5b89\u88c5\u90e8\u7f72\u624b\u518c. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001: cd /data/django-uwsgi # \u542f\u52a8\u56fe\u6570\u636e\u5e93 neo4j start # \u67e5\u770b\u72b6\u6001 neo4j status \u4ee3\u7801\u5b9e\u73b0(\u89c6\u9891\u6f14\u793a): \u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u7684\u7ec8\u7aef\u4e2d\u8fd0\u884c. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1,\u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001: # \u4f7f\u7528supervisord\u542f\u52a8\u4e3b\u670d\u52a1 # -c\u662f\u8bfb\u53d6\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7684\u610f\u601d # supervisord.conf\u662f\u5728\u5de5\u7a0b\u4e3b\u76ee\u5f55\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6 # \u91cc\u9762\u5305\u542b\u4e86\u76d1\u63a7\u548c\u5b88\u62a4django\u4ee5\u53canginx\u8fdb\u7a0b\u7684\u5185\u5bb9 supervisord -c supervisord.conf # \u67e5\u770b\u6240\u6709\u76d1\u63a7\u548c\u5b88\u62a4\u8fdb\u7a0b\u7684\u72b6\u6001 supervisorctl status all \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u7684\u7ec8\u7aef\u4e2d\u8fd0\u884c. \u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u6587\u4ef6\u5e76\u53d1\u9001\u8bf7\u6c42. \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6: urls.py, \u4f4d\u4e8e/data/django-uwsgi/api/\u76ee\u5f55\u4e0b, \u7528\u4e8e\u5c06\u524d\u7aef\u7684\u8bf7\u6c42url\u8f6c\u53d1\u5230views\u51fd\u6570\u4e2d. views.py, \u4f4d\u4e8e/data/django-uwsgi/api/\u76ee\u5f55\u4e0b, \u7528\u4e8e\u63a5\u6536\u6765\u81ea\u524d\u7aef\u8bf7\u6c42\u7684\u6570\u636e, \u5e76\u4f20\u7ed9api.py\u4e2d\u7684\u51fd\u6570\u6267\u884c, \u5e76\u83b7\u5f97\u7ed3\u679c, \u5c01\u88c5\u6210\u54cd\u5e94\u4f53\u8fd4\u56de. api.py, \u4f4d\u4e8e/data/django-uwsgi/text_labeled/\u76ee\u5f55\u4e0b, \u7528\u4e8e\u6267\u884c\u4e3b\u8981\u7684\u903b\u8f91\u5904\u7406\u90e8\u5206, \u5e76\u8fd4\u56de\u7ed3\u679c\u7ed9views.py\u4e2d\u7684\u51fd\u6570. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9: # \u7f16\u5199urls.py\u6587\u4ef6 from django.conf.urls import url from django.contrib import admin from . import views urlpatterns = [ url(r'^admin/', admin.site.urls), # \u5b9a\u4e49\u8def\u5f84api/get_label, \u524d\u7aef\u5c06\u8bf7\u6c42\u8be5\u8def\u5f84 # \u8bf7\u6c42\u540e, \u8be5\u6761\u8bed\u53e5\u5c06\u5176\u8f6c\u53d1\u5230views\u4e2d\u7684get_label\u51fd\u6570\u4e0a # get_label\u51fd\u6570\u5c06\u5728views.py\u4e2d\u5b9e\u73b0 # views\u5373\u662f\u540c\u76ee\u5f55\u4e0b\u7684views.py\u6587\u4ef6 url(r'^api/get_label[/]?$', views.get_label) ] \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/api/urls.py\u6587\u4ef6\u4e2d. # \u7f16\u5199views.py\u6587\u4ef6 # \u9996\u5148\u5bfc\u5165django\u670d\u52a1\u5fc5\u5907\u7684\u5de5\u5177\u5305 from django.http import HttpResponse from rest_framework import viewsets from rest_framework.response import Response from rest_framework.decorators import api_view from rest_framework.permissions import IsAuthenticated from rest_framework.decorators import authentication_classes from rest_framework.decorators import permission_classes import json # \u4ecetext_labeled\u6587\u4ef6\u4e2d\u5bfc\u5165\u4e86api.py\u6587\u4ef6 from text_labeled import api # \u8be5\u88c5\u9970\u5668\u7528\u4e8e\u4fdd\u8bc1\u51fd\u6570\u80fd\u591f\u63a5\u6536POST\u8bf7\u6c42 @api_view(['POST']) def get_label(request): \"\"\"\u83b7\u53d6\u6807\u7b7e\u63a5\u53e3, \u53c2\u6570request\u662f\u8bf7\u6c42\u4f53, \u5305\u542b\u524d\u7aef\u4f20\u6765\u7684\u6570\u636e\"\"\" # \u901a\u8fc7\u8bf7\u6c42\u4f53\u63a5\u6536\u524d\u7aef\u4f20\u6765\u7684\u6570\u636etext # request.POST >>> {\"text\": \"xxxx\"} text = request.POST.get(\"text\") # \u8c03\u7528text_labeled/api.py\u6587\u4ef6\u4e2d\u7684label\u51fd\u6570\u8fdb\u884c\u5904\u7406 result = api.label(text) # \u8fd4\u56dejson\u683c\u5f0f\u7684\u7ed3\u679c\uff0c\u5e76\u4f7f\u7528HttpResponse\u8fdb\u884c\u5c01\u88c5 return HttpResponse(json.dumps(result, ensure_ascii=False)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/api/views.py\u6587\u4ef6\u4e2d. # \u7f16\u5199api.py\u6587\u4ef6 def label(text): label = \"\u563b\u54c8\u97f3\u4e50\" return label \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u6587\u4ef6\u4e2d. \u91cd\u542f\u670d\u52a1: # \u670d\u52a1\u6587\u4ef6\u6539\u53d8\u540e, \u9700\u8981\u91cd\u65b0\u542f\u52a8\u624d\u80fd\u751f\u6548 supervisorctl restart all \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u7684\u7ec8\u7aef\u4e2d. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u811a\u672ctest.py, \u5e76\u53d1\u9001\u8bf7\u6c42: # \u7f16\u5199test.py # \u5bfc\u5165\u53d1\u9001\u8bf7\u6c42\u7684\u5de5\u5177\u5305 import requests def test(): url = \"http://127.0.0.1:8087/api/get_label\" data = {\"text\": \"\u6211\u62bd\u7740\u5dee\u4e0d\u591a\u7684\u70df,\u53c8\u8fc7\u4e86\u5dee\u4e0d\u591a\u7684\u4e00\u5929\uff01\"} # \u4f7f\u7528requests\u53d1\u9001post\u8bf7\u6c42 res = requests.post(url, data=data) print(res.text) if __name__ == \"__main__\": test() \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/test.py\u6587\u4ef6\u4e2d. \u6700\u7ec8\u8fd0\u884c\u7ed3\u679c: \"\u563b\u54c8\u97f3\u4e50\" \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528: \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282,\u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684restAPI\uff0c\u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6, \u5728/data/django-uwsgi\u76ee\u5f55\u4e0b. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6, \u5982: nginx, supervisor, neo4j. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001. \u4f7f\u7528neo4j start\u548cneo4j status. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1, \u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001. \u4f7f\u7528supervisord -c supervisord.conf \u548c supervisorctl status all. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6. urls.py, views.py, api.py. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9. urls\u4e2d\u52a0\u4e86\u4e00\u884c\u8f6c\u53d1\u4ee3\u7801, views.py\u4e2d\u5b9e\u73b0\u4e86get_label\u51fd\u6570, api.py\u4e2d\u5b9e\u73b0\u4e86label\u51fd\u6570. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u6587\u4ef6\u5e76\u53d1\u9001\u8bf7\u6c42. \u5728test.py\u6587\u4ef6\u4e2d\u5b9e\u73b0test\u51fd\u6570, \u4f7f\u7528requests\u53d1\u9001\u4e86post\u8bf7\u6c42, \u5e76\u83b7\u5f97\u4e86\"\u563b\u54c8\u97f3\u4e50\"\u7684\u7ed3\u679c. 1.2 \u8f93\u5165\u9884\u5904\u7406 \u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2. \u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027,\u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d,\u540c\u65f6\u4e3a\u4e0b\u4e00\u6b65\u5904\u7406\u505a\u5fc5\u8981\u7684\u51c6\u5907. \u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u957f\u5ea6\u9650\u5236. \u7b2c\u4e8c\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u7b2c\u4e09\u6b65:\u5bf9\u5206\u8bcd\u7ed3\u679c\u8fdb\u884c\u53bb\u505c\u7528\u8bcd\u5904\u7406. \u5b9e\u73b0\u8f93\u5165\u9884\u5904\u7406\u4e09\u6b65\u66f2\u7684\u4ee3\u7801\u5206\u6790: # \u4ee3\u7801\u9996\u5148\u5f15\u5165\u4e09\u4e2a\u5fc5\u5907\u7684package,\u5206\u522b\u662fos\u4e3b\u8981\u7528\u4e8e\u64cd\u4f5c\u6587\u4ef6\u8def\u5f84\uff0c # jieba\u7528\u4e8e\u5206\u8bcd\u5904\u7406,fileinput\u7528\u4e8e\u4ece\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\u5230\u5185\u5b58. import os import jieba import fileinput # \u5b9a\u4e49\u4e86\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84,\u548c\u505c\u7528\u8bcd\u5178\u8def\u5f84\uff0c\u5373\u5728\u8be5\u4ee3\u7801\u6587\u4ef6\u8def\u5f84\u4e0b\u5e94\u6709userdict.txt\u548cstopdict.txt\u6587\u4ef6 userdict_path = os.path.join(os.path.dirname(__file__), \"userdict.txt\") stopdict_path = os.path.join(os.path.dirname(__file__), \"stopdict.txt\") # \u52a0\u8f7d\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178 jieba.load_userdict(userdict_path) # \u5b9a\u4e49\u8f93\u5165\u6587\u672c\u6700\u5927\u957f\u5ea6\u9650\u5236\u4e3a200 MAX_LIMIT = 200 def handle_cn_text(text: str): \"\"\"\u7528\u4e8e\u5b8c\u6210\u9884\u5904\u7406\u7684\u4e3b\u8981\u6d41\u7a0b, \u4ee5\u539f\u59cb\u6587\u672c\u4e3a\u8f93\u5165\uff0c\u4ee5\u5206\u8bcd\u548c\u53bb\u505c\u7528\u8bcd\u540e\u7684\u8bcd\u6c47\u5217\u8868\u4e3a\u8f93\u51fa.\"\"\" # \u5bf9\u8f93\u5165\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u9a8c if not text: return [] # \u4f7f\u7528jieba\u7684cut\u65b9\u6cd5\u5bf9\u4f7f\u7528\u6700\u5927\u9650\u5236\u8fdb\u884c\u5207\u7247\u7684\u8f93\u5165\u6587\u672c\u8fdb\u884c\u5206\u8bcd word_list = jieba.cut(text[:MAX_LIMIT]) def _load_stop_dict(): \"\"\"\u7528\u4e8e\u4ece\u6587\u4ef6\u4e2d\u52a0\u8f7d\u505c\u7528\u8bcd\u8bcd\u8868\"\"\" # \u4f7f\u7528fileinput\u52a0\u8f7d\u505c\u7528\u8bcd\u8868\u81f3\u5185\u5b58,\u4f7f\u7528\u5b57\u7b26\u4e32\u7684strip()\u65b9\u6cd5\u53bb\u9664\u4e24\u7aef\u7a7a\u767d\u7b26 stop_word_set = set(map(lambda x: x.strip(), fileinput.FileInput(stopdict_path))) return stop_word_set # \u8c03\u7528_load_stop_dict()\u51fd\u6570 stop_word_set = _load_stop_dict() # \u4f7f\u7528\u9ad8\u9636\u51fd\u6570filter\u8fdb\u884c\u5faa\u73af\u8fc7\u6ee4\u64cd\u4f5c\u751f\u6210\u6700\u7ec8\u7ed3\u679c word_list = list(filter(lambda x: x not in stop_word_set and len(x)>1, word_list)) return word_list \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: \"\u6211\u7684\u773c\u775b\u5f88\u5927\u5f88\u5927,\u53ef\u4ee5\u88c5\u5f97\u4e0b\u5929\u7a7a\uff0c\u88c5\u5f97\u4e0b\u9ad8\u5c71\uff0c\u88c5\u5f97\u4e0b\u5927\u6d77\uff0c\u88c5\u5f97\u4e0b\u6574\u4e2a\u4e16\u754c\uff1b\u6211\u7684\u773c\u775b\u53c8\u5f88\u5c0f\u5f88\u5c0f\uff0c\u6709\u5fc3\u4e8b\u65f6\uff0c\u5c31\u8fde\u4e24\u884c\u773c\u6cea\uff0c\u4e5f\u88c5\u4e0d\u4e0b.\" \u8f93\u51fa\u6548\u679c: ['\u773c\u775b', '\u5f88\u5927', '\u5f88\u5927', '\u88c5\u5f97', '\u5929\u7a7a', '\u88c5\u5f97', '\u9ad8\u5c71', '\u88c5\u5f97', '\u5927\u6d77', '\u88c5\u5f97', '\u6574\u4e2a', '\u4e16\u754c', '\u773c\u775b', '\u5f88\u5c0f', '\u5f88\u5c0f', '\u5fc3\u4e8b', '\u4e24\u884c', '\u773c\u6cea', '\u88c5\u4e0d\u4e0b'] \u4e3b\u8981\u6ce8\u91ca: # \u5b9a\u4e49\u4e86\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84,\u548c\u505c\u7528\u8bcd\u5178\u8def\u5f84 # \u52a0\u8f7d\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178 # \u5b9a\u4e49\u8f93\u5165\u6587\u672c\u6700\u5927\u957f\u5ea6\u9650\u5236\u4e3a200 \"\"\"\u7528\u4e8e\u5b8c\u6210\u9884\u5904\u7406\u7684\u4e3b\u8981\u6d41\u7a0b, \u4ee5\u539f\u59cb\u6587\u672c\u4e3a\u8f93\u5165\uff0c\u4ee5\u5206\u8bcd\u548c\u53bb\u505c\u7528\u8bcd\u540e\u7684\u8bcd\u6c47\u5217\u8868\u4e3a\u8f93\u51fa.\"\"\" # \u5bf9\u8f93\u5165\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u9a8c # \u4f7f\u7528jieba\u7684cut\u65b9\u6cd5\u5bf9\u4f7f\u7528\u6700\u5927\u9650\u5236\u8fdb\u884c\u5207\u7247\u7684\u8f93\u5165\u6587\u672c\u8fdb\u884c\u5206\u8bcd \"\"\"\u7528\u4e8e\u4ece\u6587\u4ef6\u4e2d\u52a0\u8f7d\u505c\u7528\u8bcd\u8bcd\u8868\"\"\" # \u4f7f\u7528fileinput\u52a0\u8f7d\u505c\u7528\u8bcd\u8868\u81f3\u5185\u5b58,\u4f7f\u7528\u5b57\u7b26\u4e32\u7684strip()\u65b9\u6cd5\u53bb\u9664\u4e24\u7aef\u7a7a\u767d\u7b26 # \u8c03\u7528_load_stop_dict()\u51fd\u6570 # \u4f7f\u7528\u9ad8\u9636\u51fd\u6570filter\u8fdb\u884c\u5faa\u73af\u8fc7\u6ee4\u64cd\u4f5c\u751f\u6210\u6700\u7ec8\u7ed3\u679c \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027, \u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d, \u5e76\u4e3a\u4e0b\u4e00\u6b65\u5904\u7406\u505a\u6570\u636e\u51c6\u5907. \u5b66\u4e60\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5bf9\u8f93\u5165\u8fdb\u884c\u957f\u5ea6\u9650\u5236. \u7b2c\u4e8c\u6b65: \u5bf9\u8f93\u5165\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u7b2c\u4e09\u6b65: \u5bf9\u5206\u8bcd\u5217\u8868\u8fdb\u884c\u53bb\u505c\u7528\u8bcd\u5904\u7406. \u5b9e\u73b0\u4e86\u8f93\u5165\u9884\u5904\u7406\u4e09\u6b65\u66f2\u7684\u8fc7\u7a0b: \u521b\u5efahandle_cn_text\u51fd\u6570\u6765\u5b9e\u73b0. \u4f7f\u7528\u5207\u7247\u65b9\u6cd5\u8fdb\u884c\u957f\u5ea6\u9650\u5236, \u6700\u5927\u957f\u5ea6\u9650\u5236\u4e3a200. \u4f7f\u7528jieba\u5206\u8bcd\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u4f7f\u7528\u9ad8\u9636\u51fd\u6570filter\u8fdb\u884c\u5faa\u73af\u8fc7\u6ee4\u64cd\u4f5c. 1.3 \u56fe\u8c31\u5339\u914d \u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31. \u4e86\u89e3\u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31: \u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31\u5206\u6790: \u56fe\u8c31\u7531\u8282\u70b9\u548c\u5173\u7cfb(\u8fb9)\u7ec4\u6210. \u84dd\u8272\u8282\u70b9\u4ee3\u8868\u6807\u7b7e,\u6a58\u8272\u8282\u70b9\u4ee3\u8868\u8bcd\u6c47. \u5728\u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u5b58\u5728\u7740\u4e0d\u540c\u7c7b\u578b\u7684\u8fb9. \u84dd\u8272\u8282\u70b9(\u6807\u7b7e\u8282\u70b9)\u4e4b\u95f4\u7684\u8fb9\u8868\u793a\u5305\u542b\u5173\u7cfb,\u6ca1\u6709\u6743\u91cd\u503c. \u84dd\u8272\u8282\u70b9\u4e0e\u6a58\u8272\u8282\u70b9(\u8bcd\u6c47\u8282\u70b9)\u4e4b\u95f4\u7684\u8fb9\u8868\u793a\u96b6\u5c5e\u5173\u7cfb,\u6709\u6743\u91cd\u503c\uff0c\u4ee3\u8868\u8be5\u8bcd\u6c47\u5c5e\u4e8e\u8be5\u6807\u7b7e\u7684\u6982\u7387. \u6240\u6709\u7684\u8282\u70b9\u4e0e\u8fb9\u7ec4\u6210\u4e86\u4e00\u4e2a\u6811\u7ed3\u6784,\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u56fe\u8c31. \u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b,\u5373\u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u8bcd\u6c47\u4e0e\u8bcd\u6c47\u8282\u70b9\u8fdb\u884c\u5339\u914d\uff0c\u76f8\u540c\u5219\u8fd4\u56de\u8be5\u6807\u7b7e\u8282\u70b9\u540d\u79f0\u548c\u8fb9\u4e0a\u7684\u6743\u91cd. \u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u901a\u8fc7\u5339\u914d\u8bcd\u6c47\u53ec\u56de\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u638c\u63e1\u5b9e\u73b0\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b: \u6ce8\u610f: \u6211\u4eec\u5e76\u6ca1\u6709\u6784\u5efa\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31,\u5b83\u5c06\u5728\u7b2c\u4e8c\u7ae0\u4e2d\u6784\u5efa\uff0c\u6211\u4eec\u5148\u5047\u8bbe\u56fe\u8c31\u5df2\u7ecf\u5b58\u5728. \u5b9e\u73b0\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u9996\u5148\u5bfc\u5165\u64cd\u4f5c\u56fe\u6570\u636e\u5e93neo4j\u7684\u5fc5\u5907\u5b98\u65b9\u5de5\u5177neo4j-driver, # \u4ecesettings.py\u914d\u7f6e\u6587\u4ef6\u4e2d\u5bfc\u5165\u6570\u636e\u5e93\u914d\u7f6eNEO4J_CONFIG from neo4j.v1 import GraphDatabase from settings import NEO4J_CONFIG # \u5bfc\u5165\u7528\u4e8e\u6241\u5e73\u5316\u5217\u8868\u7684chain\u65b9\u6cd5 from itertools import chain def get_index_map_label(word_list): \"\"\" \u7528\u4e8e\u83b7\u53d6\u6bcf\u4e2a\u8bcd\u6c47\u5728\u56fe\u8c31\u4e2d\u5bf9\u5e94\u7684\u7c7b\u522b\u6807\u7b7e \u8be5\u51fd\u6570\u4ee5\u8bcd\u6c47\u5217\u8868\u4e3a\u8f93\u5165, \u4ee5\u8bcd\u6c47\u51fa\u73b0\u5728\u8bcd\u6c47\u5217\u8868 \u4e2d\u7684\u7d22\u5f15\u548c\u5bf9\u5e94\u7684[\u6807\u7b7e, \u6743\u91cd]\u5217\u8868\u4e3a\u8f93\u51fa. \"\"\" # \u5bf9word_list\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u9a8c if not word_list: return [] # \u4f7f\u7528GraphDatabase\u5f00\u542f\u4e00\u4e2adriver. _driver = GraphDatabase.driver(**NEO4J_CONFIG) # \u5f00\u542fneo4j\u7684\u4e00\u4e2asession with _driver.session() as session: def _f(index, word): \"\"\"\u4ee5\u8bcd\u6c47\u5217\u8868\u4e2d\u4e00\u7ec4\u8bcd\u7d22\u5f15\u548c\u8bcd\u4f5c\u4e3a\u8f93\u5165, \u8fd4\u56de\u8be5\u7d22\u5f15\u548c\u8bcd\u5bf9\u5e94\u7684\u6807\u7b7e\u5217\u8868.\"\"\" # \u8fdb\u884c\u8f93\u5165\u7684\u5408\u6cd5\u6027\u5224\u65ad if not word: return [] # \u5efa\u7acbcypher\u8bed\u53e5, \u5b83\u5339\u914d\u4e00\u6761\u56fe\u4e2d\u7684\u8def\u5f84, \u8be5\u8def\u5f84\u4ee5\u4e00\u4e2a\u8bcd\u6c47\u4e3a\u5f00\u7aef\u901a\u8fc7\u4e00\u6761\u8fb9\u8fde\u63a5\u4e00\u4e2aLabel\u8282\u70b9, # \u8fd4\u56de\u6807\u7b7e\u7684title\u5c5e\u6027,\u548c\u8fb9\u7684\u6743\u91cd, \u8fd9\u6b63\u662f\u6211\u4eec\u56fe\u8c31\u6784\u5efa\u65f6\u5b9a\u4e49\u7684\u8fde\u63a5\u6a21\u5f0f. cypher = \"MATCH(a:Vocabulary{name:%r})-[r:Related]-(b:Label) \\ RETURN b.title, r.weight\" % (word) record = session.run(cypher) result = list(map(lambda x: [x[0], x[1]], record)) if not result: return [] return [str(index), result] # \u5c06word_list\u7684\u7d22\u5f15\u548c\u8bcd\u6c47\u4f5c\u4e3a\u8f93\u5165\u4f20\u7ed9_f()\u51fd\u6570,\u5e76\u5c06\u8fd4\u56de\u7ed3\u679c\u505achain\u64cd\u4f5c index_map_label = list( chain(*map(lambda x: _f(x[0], x[1]), enumerate(word_list)))) return index_map_label \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: ['\u773c\u775b', '\u5f88\u5927', '\u5f88\u5927', '\u88c5\u5f97', '\u5929\u7a7a', '\u88c5\u5f97', '\u9ad8\u5c71', '\u88c5\u5f97', '\u5927\u6d77', '\u88c5\u5f97', '\u6574\u4e2a', '\u4e16\u754c', '\u773c\u775b', '\u5f88\u5c0f', '\u5f88\u5c0f', '\u5fc3\u4e8b', '\u4e24\u884c', '\u773c\u6cea', '\u88c5\u4e0d\u4e0b'] \u8f93\u51fa\u6548\u679c: [] # \u56e0\u4e3a\u6211\u4eec\u56fe\u8c31\u8fd8\u6ca1\u6709\u6784\u5efa, \u56e0\u6b64\u6682\u65f6\u4f1a\u8fd4\u56de\u4e00\u4e2a\u7a7a\u5217\u8868, \u5b9e\u9645\u4e0a\u5e94\u8be5\u8fd4\u56de\u7c7b\u4f3c\u7ed3\u6784: [\"0\", [[\"\u7f8e\u5986\", 0.654], [\"\u60c5\u611f\u6545\u4e8b\":0.765]]] \u4e3b\u8981\u6ce8\u91ca: # \u4ecesettings.py\u914d\u7f6e\u6587\u4ef6\u4e2d\u5bfc\u5165\u6570\u636e\u5e93\u914d\u7f6eNEO4J_CONFIG \"\"\" \u7528\u4e8e\u83b7\u53d6\u6bcf\u4e2a\u8bcd\u6c47\u5728\u56fe\u8c31\u4e2d\u5bf9\u5e94\u7684\u7c7b\u522b\u6807\u7b7e \u8be5\u51fd\u6570\u4ee5\u8bcd\u6c47\u5217\u8868\u4e3a\u8f93\u5165, \u4ee5\u8bcd\u6c47\u51fa\u73b0\u5728\u8bcd\u6c47\u5217\u8868 \u4e2d\u7684\u7d22\u5f15\u548c\u5bf9\u5e94\u7684[\u6807\u7b7e, \u6743\u91cd]\u5217\u8868\u4e3a\u8f93\u51fa. \"\"\" # \u5bf9word_list\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u9a8c # \u4f7f\u7528GraphDatabase\u5f00\u542f\u4e00\u4e2adriver. # \u5f00\u542fneo4j\u7684\u4e00\u4e2asession \"\"\"\u4ee5\u8bcd\u6c47\u5217\u8868\u4e2d\u4e00\u7ec4\u8bcd\u7d22\u5f15\u548c\u8bcd\u4f5c\u4e3a\u8f93\u5165, \u8fd4\u56de\u8be5\u7d22\u5f15\u548c\u8bcd\u5bf9\u5e94\u7684\u6807\u7b7e\u5217\u8868.\"\"\" # \u8fdb\u884c\u8f93\u5165\u7684\u5408\u6cd5\u6027\u5224\u65ad # \u5efa\u7acbcypher\u8bed\u53e5, \u5b83\u5339\u914d\u4e00\u6761\u56fe\u4e2d\u7684\u8def\u5f84, \u8be5\u8def\u5f84\u4ee5\u4e00\u4e2a\u8bcd\u6c47\u4e3a\u5f00\u7aef\u901a\u8fc7\u4e00\u6761\u8fb9\u8fde\u63a5\u4e00\u4e2aLabel\u8282\u70b9, # \u8fd4\u56de\u6807\u7b7e\u7684title\u5c5e\u6027,\u548c\u8fb9\u7684\u6743\u91cd, \u8fd9\u6b63\u662f\u6211\u4eec\u56fe\u8c31\u6784\u5efa\u65f6\u5b9a\u4e49\u7684\u8fde\u63a5\u6a21\u5f0f. # \u5c06word_list\u7684\u7d22\u5f15\u548c\u8bcd\u6c47\u4f5c\u4e3a\u8f93\u5165\u4f20\u7ed9_f()\u51fd\u6570,\u5e76\u5c06\u8fd4\u56de\u7ed3\u679c\u505achain\u64cd\u4f5c \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31: \u5b83\u662f\u7531\u6807\u7b7e\u8282\u70b9\u548c\u8bcd\u6c47\u8282\u70b9\u4ee5\u53ca\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\u7ec4\u6210\u7684\u4e00\u5f20\u6811\u72b6\u56fe. \u5b66\u4e60\u4e86\u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u901a\u8fc7\u5339\u914d\u8bcd\u6c47\u53ec\u56de\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b: \u521b\u5efa\u4e86get_index_map_label\u51fd\u6570\u6765\u5b9e\u73b0. \u4f7f\u7528neo4j\u7684driver\u5f00\u542f\u4e86\u4e00\u4e2asession. \u521b\u5efa\u4e86\u4e00\u6761cypher\u8bed\u53e5, \u5b83\u5339\u914d\u8bcd\u6c47\u8282\u70b9\u5230\u6807\u7b7e\u8282\u70b9\u7684\u8def\u5f84,\u8fd4\u56de\u6807\u7b7e\u7684title\u5c5e\u6027\u548c\u8fb9\u7684weight\u5c5e\u6027. 1.4 \u5339\u914d\u6b67\u4e49\u5224\u65ad \u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49. \u4e86\u89e3\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d, \u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e, \u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49. \u4e3e\u4e2a\u6817\u5b50: \"\u95ea\u73b0\"\u4e00\u8bcd\u5339\u914d\u5230\u4e24\u4e2a\u6807\u7b7e, LOL\u548c\u738b\u8005\u519c\u836f, \u8bf4\u660e\u8fd9\u4e2a\u8bcd\u6c47\u5728\u53e5\u5b50\u4e2d\u5177\u6709\u6b67\u4e49\uff0c\u9700\u8981\u8fdb\u884c\u66f4\u6df1\u5c42\u6b21\u7684\u5224\u65ad. \u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u4f5c\u7528: \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6,\u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387. \u638c\u63e1\u5b9e\u73b0\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b \u6ce8\u610f: \u51fd\u6570\u4e2d\u4f1a\u8c03\u7528\u591a\u6a21\u578b\u9884\u6d4b\u51fd\u6570, \u6211\u4eec\u4f1a\u5728\u7b2c\u4e09,\u56db\u7ae0\u4e2d\u5b9e\u73b0, \u8fd9\u91cc\u6211\u4eec\u4f1a\u7f16\u5199\u4e00\u4e2a\u7a7a\u58f3\u51fd\u6570\u6682\u65f6\u5145\u5f53. def request_model_serve(word_list, label_list): return [[\"\u60c5\u611f\u6545\u4e8b\", 0.865]] \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py\u4e2d. \u5b9e\u73b0\u5339\u914d\u6b67\u4e49\u5224\u65ad\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u591a\u6a21\u578b\u9884\u6d4b\u51fd\u6570 from model_train.multithread_predict import request_model_serve def weight_update(word_list, index_map_label): \"\"\"\u8be5\u51fd\u6570\u5c06\u5206\u8bcd\u5217\u8868\u548c\u5177\u6709\u521d\u59cb\u6982\u7387\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u5165,\u5c06\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u51fa\"\"\" # \u9996\u5148\u5c06\u5217\u8868\u8f6c\u5316\u4e3a\u5b57\u5178\u7684\u5f62\u5f0f # index_map_label >>> [\"1\", [[\"\u7f8e\u98df\", 0.735], [\"\u97f3\u4e50\", 0.654]], \"2\", [[\"\u7f8e\u5986\", 0.734]] >>> # {\"1\": [[\"\u7f8e\u98df\", 0.735],[\"\u97f3\u4e50\", 0.654]], \"2\": [[\"\u7f8e\u5986\", 0.734]]} index_map_label = dict(zip(index_map_label[::2], index_map_label[1::2])) for k, v in index_map_label.items(): # v\u7684\u957f\u5ea6\u5927\u4e8e1\u8bf4\u660e\u5b58\u5728\u6b67\u4e49\u73b0\u8c61 if len(v) > 1: # \u83b7\u53d6\u5bf9\u5e94\u7684\u6807\u7b7e\u4f5c\u4e3a\u53c2\u6570,\u5373\u901a\u77e5\u670d\u52a1\u5e94\u8be5\u8c03\u7528\u54ea\u4e9b\u6a21\u578b\u8fdb\u884c\u9884\u6d4b. label_list = list(map(lambda x: x[0], v)) # \u901a\u8fc7request_model_serve\u51fd\u6570\u83b7\u5f97\u6807\u7b7e\u6700\u65b0\u7684\u9884\u6d4b\u6982\u7387,\u5e76\u4f7f\u7528\u5b57\u5178\u65b9\u5f0f\u66f4\u65b0. # v >>> [[\"\u7f8e\u98df\": 0.954]] v = request_model_serve(word_list, label_list) index_map_label.update({k:v}) # \u5c06\u5b57\u5178\u8f6c\u5316\u4e3a\u5217\u8868\u5f62\u5f0f index_map_label_ = list(chain(*map(lambda x: [x[0], x[1]], index_map_label.items()))) return index_map_label_ \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # word_list ['\u773c\u775b', '\u5f88\u5927', '\u5f88\u5927', '\u88c5\u5f97', '\u5929\u7a7a', '\u88c5\u5f97', '\u9ad8\u5c71', '\u88c5\u5f97', '\u5927\u6d77', '\u88c5\u5f97', '\u6574\u4e2a', '\u4e16\u754c', '\u773c\u775b', '\u5f88\u5c0f', '\u5f88\u5c0f', '\u5fc3\u4e8b', '\u4e24\u884c', '\u773c\u6cea', '\u88c5\u4e0d\u4e0b'] # index_map_label [\"0\", [[\"\u7f8e\u5986\", 0.654], [\"\u60c5\u611f\u6545\u4e8b\", 0.765]]] \u8f93\u51fa\u6548\u679c: [\"0\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.865]]] \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u591a\u6a21\u578b\u9884\u6d4b\u51fd\u6570 \"\"\"\u8be5\u51fd\u6570\u5c06\u5206\u8bcd\u5217\u8868\u548c\u5177\u6709\u521d\u59cb\u6982\u7387\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u5165,\u5c06\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u51fa\"\"\" # \u9996\u5148\u5c06\u5217\u8868\u8f6c\u5316\u4e3a\u5b57\u5178\u7684\u5f62\u5f0f # index_map_label >>> [\"1\", [[\"\u7f8e\u98df\", 0.735], [\"\u97f3\u4e50\", 0.654]], \"2\", [[\"\u7f8e\u5986\", 0.734]] >>> # {\"1\": [[\"\u7f8e\u98df\", 0.735],[\"\u97f3\u4e50\", 0.654]], \"2\": [[\"\u7f8e\u5986\", 0.734]]} # v\u7684\u957f\u5ea6\u5927\u4e8e1\u8bf4\u660e\u5b58\u5728\u6b67\u4e49\u73b0\u8c61 # \u83b7\u53d6\u5bf9\u5e94\u7684\u6807\u7b7e\u4f5c\u4e3a\u53c2\u6570,\u5373\u901a\u77e5\u670d\u52a1\u5e94\u8be5\u8c03\u7528\u54ea\u4e9b\u6a21\u578b\u8fdb\u884c\u9884\u6d4b. # \u901a\u8fc7request_model_serve\u51fd\u6570\u83b7\u5f97\u6807\u7b7e\u6700\u65b0\u7684\u9884\u6d4b\u6982\u7387,\u5e76\u4f7f\u7528\u5b57\u5178\u65b9\u5f0f\u66f4\u65b0. # v >>> [[\"\u7f8e\u98df\": 0.954]] # \u5c06\u5b57\u5178\u8f6c\u5316\u4e3a\u5217\u8868\u5f62\u5f0f \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d,\u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e\uff0c\u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49. \u5b66\u4e60\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6,\u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b: \u521b\u5efa\u4e86weight_update\u51fd\u6570\u6765\u5b9e\u73b0. \u901a\u8fc7\u68c0\u6d4b\u5339\u914d\u5230\u7684\u6807\u7b7e\u6570\u91cf\u8fdb\u884c\u6b67\u4e49\u5224\u65ad. \u901a\u8fc7\u8c03\u7528\u591a\u6a21\u578b\u9884\u6d4b\u670d\u52a1\u51fd\u6570request_model_serve\u6765\u66f4\u65b0\u6982\u7387. 1.5 \u6982\u7387\u8c03\u6574 \u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574. \u4e86\u89e3\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u6982\u7387\u8c03\u6574\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574: \u5f53\u53e5\u5b50\u4e2d\u7684\u591a\u4e2a\u8bcd\u90fd\u6307\u5411\u540c\u4e00\u6807\u7b7e\u65f6, \u8fd9\u4e2a\u6807\u7b7e\u6982\u7387\u5c06\u6210\u4e3a\u6240\u6709\u7684\u6982\u7387\u4e4b\u548c. \u4e3e\u4e2a\u6817\u5b50: \u6211\u7231\u82f9\u679c\uff01 -------> [[\"\u6c34\u679c\", 0.654], [\"\u7535\u5f71\", 0.654], [\"\u516c\u53f8\", 0.654]] # \u51fa\u73b0\u4e86\u4e00\u6b21\u82f9\u679c, \u53ef\u80fd\u662f\u5728\u8bf4\u6c34\u679c\uff0c\u7535\u5f71\uff0c\u6216\u8005\u516c\u53f8, \u4ed6\u4eec\u7684\u6982\u7387\u57fa\u672c\u4e0a\u662f\u76f8\u540c\u7684. \u8fd9\u53e5\u8bdd\u6253\u4e0a\u4ec0\u4e48\u6807\u7b7e\u4e0d\u80fd\u786e\u5b9a. \u6211\u7231\u82f9\u679c\uff0c\u6a58\u5b50\uff0c\u9999\u8549! --------> [[\"\u6c34\u679c\", 0.654], [\"\u7535\u5f71\", 0.654], [\"\u516c\u53f8\", 0.654], [\"\u6c34\u679c\", 0.654], [\"\u6c34\u679c\", 0.654]] # \u5168\u53e5\u5171\u51fa\u73b0\u4e86\u4e09\u6b21\u6709\u5173\u6c34\u679c\u7684\u8bcd\uff0c\u5982\u679c\u6c34\u679c\u7684\u6982\u7387\u662f\u82f9\u679c\uff0c\u6a58\u5b50\uff0c\u9999\u8549\u4e3a\u6c34\u679c\u7684\u6982\u7387\u548c\uff0c\u8fd9\u6837\u5c31\u5927\u4e8e\u4e86\u7535\u5f71\u6216\u8005\u516c\u53f8\u7684\u6982\u7387. \u57fa\u672c\u4e0a\u53ef\u4ee5\u6253\u4e0a\u4e00\u4e2a\u786e\u5b9a\u7684\u6807\u7b7e\u4e86. \u6982\u7387\u8c03\u6574\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a,\u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0. \u5b9e\u73b0\u6982\u7387\u8c03\u6574\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u53ef\u4ee5\u8fdb\u884c\u6241\u5e73\u5316\u64cd\u4f5c\u7684reduce # \u5bfc\u5165\u8fdb\u884c\u5408\u5e76\u64cd\u4f5c\u7684pandas from functools import reduce import pandas as pd def control_increase(index_map_label_): \"\"\"\u4ee5\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6743\u91cd\u5217\u8868\u4e3a\u8f93\u5165, \u4ee5\u6807\u7b7e\u5f52\u5e76\u540e\u7684\u7ed3\u679c\u4e3a\u8f93\u51fa\"\"\" if not index_map_label_: return [] # index_map_label_ >>> # [\"2\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.765]], \"3\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.876], [\"\u660e\u661f\", 0.765]]] # \u5c06index_map_label_\u5947\u6570\u9879\u5373[label, score]\u53d6\u51fa\u653e\u5728\u5b57\u5178\u4e2d # k\u7684\u6570\u636e\u7ed3\u6784\u5f62\u5f0f: # [{'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.765}, {'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.876}, # {'label': '\u660e\u661f', 'score': 0.765}] k = list(map(lambda x: {\"label\": x[0], \"score\": x[1]}, reduce( lambda z, y: z + y, index_map_label_[1::2]))) # \u4f7f\u7528pandas\u4e2d\u7684groupby\u65b9\u6cd5\u8fdb\u884c\u5408\u5e76\u5206\u503c df = pd.DataFrame(k) df_ = df.groupby(by=['label'])['score'].sum() return df_ \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: [\"2\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.765]], \"3\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.876], [\"\u660e\u661f\", 0.765]]] \u8f93\u51fa\u6548\u679c: label \u60c5\u611f\u6545\u4e8b 1.641 \u660e\u661f 0.765 Name: score, dtype: float64 \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u4ee5\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6743\u91cd\u5143\u7ec4\u5217\u8868\u4e3a\u8f93\u5165, \u4ee5\u6807\u7b7e\u5f52\u5e76\u540e\u7684\u7ed3\u679c\u4e3a\u8f93\u51fa\"\"\" # index_map_label_ >>> # [\"2\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.765]], \"3\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.876], [\"\u660e\u661f\", 0.765]]] # \u5c06index_map_label_\u5947\u6570\u9879\u5373[label, score]\u53d6\u51fa\u653e\u5728\u5b57\u5178\u4e2d # k\u7684\u6570\u636e\u7ed3\u6784\u5f62\u5f0f: # [{'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.765}, {'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.876}, # {'label': '\u660e\u661f', 'score': 0.765}] # \u4f7f\u7528pandas\u4e2d\u7684groupby\u65b9\u6cd5\u8fdb\u884c\u5408\u5e76\u5206\u503c \u5c0f\u8282\u603b\u7ed3: \u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574: \u5f53\u53e5\u5b50\u4e2d\u7684\u591a\u4e2a\u8bcd\u90fd\u6307\u5411\u540c\u4e00\u6807\u7b7e\u65f6, \u8fd9\u4e2a\u6807\u7b7e\u6982\u7387\u5c06\u6210\u4e3a\u6240\u6709\u7684\u6982\u7387\u4e4b\u548c. \u5b66\u4e60\u4e86\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a,\u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u8c03\u6574\u7684\u8fc7\u7a0b: \u521b\u5efacontrol_increase\u51fd\u6570\u6765\u5b9e\u73b0. \u4f7f\u7528\u4e86pandas\u4e2d\u7684groupby\u65b9\u6cd5\u8fdb\u884c\u5408\u5e76\u6c42\u548c. 1.6 \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u4e86\u89e3\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316: \u5bf9\u8d85\u8fc71\u7684\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\u3002 \u4ec0\u4e48\u662f\u7236\u6807\u7b7e\u68c0\u7d22: \u5728\u6807\u7b7e\u6811\u4e2d\u627e\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u6240\u6709\u7236\u8282\u70b9\u3002 \u6982\u7387\u5f52\u4e00\u5316\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185. \u7236\u6807\u7b7e\u68c0\u7d22\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868,\u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c. \u5b9e\u73b0\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import numpy as np def father_label_and_normalized(df_): \"\"\" \u4ee5\u6982\u7387\u8c03\u6574\u540e\u7684DataFrame\u5bf9\u8c61\u4e3a\u8f93\u5165, \u4ee5\u6574\u4e2a\u7cfb\u7edf\u7684\u6700\u7ec8\u7ed3\u679c\u4e3a\u8f93\u51fa \u8f93\u5165\u6837\u5f0f\u4e3a:DataFrame<[[\u201cLOL\u201d, 1.465]]> \u8f93\u51fa\u6837\u5f0f\u4e3a:[{\u201clabel\u201d: \u201cLOL\u201d, \u201cscore\u201d: \u201c0.811\u201d, \u201crelated\u201d:[\u201c\u6e38\u620f\u201d]}] \"\"\" def _sigmoid(x): y = 1.0 / (1.0 + np.exp(-x)) return round(y, 3) def _sg(pair): \"\"\"\u83b7\u5f97\u5355\u4e2a\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u548c\u5f52\u4e00\u5316\u6982\u7387\"\"\" # \u4f7f\u7528GraphDatabase\u5f00\u542f\u4e00\u4e2adriver. _driver = GraphDatabase.driver(**NEO4J_CONFIG) with _driver.session() as session: # \u901a\u8fc7\u5173\u7cfb\u67e5\u8be2\u83b7\u5f97\u4ece\u8be5\u6807\u7b7e\u8282\u70b9\u76f4\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u7684\u5176\u4ed6Label\u8282\u70b9\u7684title\u5c5e\u6027 cypher = \"MATCH(a:Label{title:%r})<-[r:Contain*1..3]-(b:Label) \\ WHERE b.title<>'\u6cdb\u5a31\u4e50' RETURN b.title\" % pair[0] record = session.run(cypher) result = list(map(lambda x: x[0], record)) return {\"label\": pair[0], \"score\": _sigmoid(pair[1]), \"related\": result} # \u904d\u5386\u6240\u6709\u7684\u6807\u7b7e return list(map(_sg, df_.to_dict().items())) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: label \u60c5\u611f\u6545\u4e8b 1.641 \u660e\u661f 0.765 Name: score, dtype: float64 \u8f93\u51fa\u6548\u679c: # \u56e0\u4e3a\u6ca1\u6709\u6784\u5efa\u56fe\u8c31\uff0c\u6240\u4ee5related\u5339\u914d\u4e0d\u5230\u4efb\u4f55\u7236\u6807\u7b7e [{'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.838, 'related': []}, {'label': '\u660e\u661f', 'score': 0.682, 'related': []}] \u4e3b\u8981\u6ce8\u91ca \"\"\" \u4ee5\u6982\u7387\u8c03\u6574\u540e\u7684DataFrame\u5bf9\u8c61\u4e3a\u8f93\u5165, \u4ee5\u6574\u4e2a\u7cfb\u7edf\u7684\u6700\u7ec8\u7ed3\u679c\u4e3a\u8f93\u51fa \u8f93\u5165\u6837\u5f0f\u4e3a:DataFrame<[[\u201cLOL\u201d, 1.465]]> \u8f93\u51fa\u6837\u5f0f\u4e3a:[{\u201clabel\u201d: \u201cLOL\u201d, \u201cscore\u201d: \u201c0.811\u201d, \u201crelated\u201d:[\u201c\u6e38\u620f\u201d]}] \"\"\" \"\"\"\u83b7\u5f97\u5355\u4e2a\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u548c\u5f52\u4e00\u5316\u6982\u7387\"\"\" # \u4f7f\u7528GraphDatabase\u5f00\u542f\u4e00\u4e2adriver # \u901a\u8fc7\u5173\u7cfb\u67e5\u8be2\u83b7\u5f97\u4ece\u8be5\u6807\u7b7e\u8282\u70b9\u76f4\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u7684\u5176\u4ed6Label\u8282\u70b9\u7684title\u5c5e\u6027 # \u904d\u5386\u6240\u6709\u7684\u6807\u7b7e \u5c0f\u8282\u603b\u7ed3: \u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316: \u5bf9\u8d85\u8fc71\u7684\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\u3002 \u4ec0\u4e48\u662f\u7236\u6807\u7b7e\u68c0\u7d22: \u5728\u6807\u7b7e\u6811\u4e2d\u627e\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u6240\u6709\u7236\u8282\u70b9\u3002 \u5b66\u4e60\u4e86\u6982\u7387\u5f52\u4e00\u5316\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185. \u5b66\u4e60\u4e86\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868,\u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b: \u521b\u5efafather_label_and_normalized\u51fd\u6570\u6765\u5b9e\u73b0. \u4f7f\u7528sigmoid\u51fd\u6570\u6765\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406. \u901a\u8fc7\u521b\u5efacypher\u8bed\u53e5\u5339\u914d\u6807\u7b7e\u56fe\u8c31\u4e2d\u7684\u6240\u6709\u7236\u8282\u70b9\u6765\u83b7\u5f97\u7236\u6807\u7b7e\u5217\u8868. \u672c\u7ae0\u603b\u7ed3 \u7b2c1\u5c0f\u8282: \u540e\u7aef\u670d\u52a1\u642d\u5efa \u5b66\u4e60\u4e86\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528: \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282,\u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684restAPI\uff0c\u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u56db\u6b65\u66f2. \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6, \u5728\u7cfb\u7edf\u7684/data/jango-uwsgi\u76ee\u5f55. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6, \u5982: nginx, supervisor, neo4j\u7b49, \u5177\u4f53\u5b89\u88c5\u8fc7\u7a0b\u8be6\u89c1\u5b89\u88c5\u624b\u518c. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1,\u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2. \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u6587\u4ef6\u5e76\u53d1\u9001\u8bf7\u6c42. \u7b2c2\u5c0f\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5b66\u4e60\u4e86\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027, \u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2. \u7b2c\u4e00\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u957f\u5ea6\u9650\u5236. \u7b2c\u4e8c\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u7b2c\u4e09\u6b65:\u5bf9\u5206\u8bcd\u7ed3\u679c\u8fdb\u884c\u53bb\u505c\u7528\u8bcd\u5904\u7406. \u7b2c3\u5c0f\u8282: \u56fe\u8c31\u5339\u914d \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31: \u5b83\u662f\u7531\u6807\u7b7e\u8282\u70b9\u548c\u8bcd\u6c47\u8282\u70b9\u4ee5\u53ca\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\u7ec4\u6210\u7684\u4e00\u5f20\u6811\u72b6\u56fe. \u5b66\u4e60\u4e86\u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u901a\u8fc7\u5339\u914d\u8bcd\u6c47\u53ec\u56de\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b. \u7b2c4\u5c0f\u8282: \u5339\u914d\u6b67\u4e49\u5224\u65ad \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d, \u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e\uff0c\u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49. \u5b66\u4e60\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6, \u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b. \u7b2c5\u5c0f\u8282: \u6982\u7387\u8c03\u6574 \u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574: \u6982\u7387: \u662f\u6307\u8f93\u5165\u6587\u672c\u5c5e\u4e8e\u67d0\u4e2a\u6807\u7b7e\u7684\u6982\u7387. \u8c03\u6574: \u662f\u6307\u540c\u7c7b\u522b\u7684\u6982\u7387\u76f8\u52a0. \u5b66\u4e60\u4e86\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a, \u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b. \u7b2c6\u5c0f\u8282: \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316: \u5bf9\u8d85\u8fc71\u7684\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\u3002 \u4ec0\u4e48\u7236\u6807\u7b7e\u68c0\u7d22: \u5728\u6807\u7b7e\u6811\u4e2d\u627e\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u6240\u6709\u7236\u8282\u70b9\u3002 \u5b66\u4e60\u4e86\u6982\u7387\u5f52\u4e00\u5316\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185. \u5b66\u4e60\u4e86\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868, \u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b.","title":"\u7b2c\u4e00\u7ae0:\u6574\u4f53\u7cfb\u7edf\u642d\u5efa"},{"location":"1/#_1","text":"\u5b66\u4e60\u76ee\u6807 \u638c\u63e1\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7cfb\u7edf\u5bf9\u5916\u670d\u52a1\u7684\u642d\u5efa\u53ca\u5176\u5185\u90e8\u5904\u7406\u73af\u8282,\u5e76\u5728\u670d\u52a1\u5668\u4e2d\u5b9e\u73b0\u5b83\u4eec. \u5f15\u5bfc\u5206\u6790 \u7cfb\u7edf\u8f93\u5165\u4e3a: \u6587\u7ae0, \u8bc4\u8bba, \u63cf\u8ff0\u7b49\u5177\u4f53\u7684\u975e\u7ed3\u6784\u5316\u6587\u672c. \u7cfb\u7edf\u8f93\u51fa\u4e3a: \u8be5\u6587\u672c\u6d89\u53ca\u7684\u4e3b\u8981\u6807\u7b7e,\u4e3b\u8981\u6807\u7b7e\u9884\u6d4b\u6982\u7387\u4ee5\u53ca\u5173\u8054\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868. \u667a\u80fd\u6587\u672c\u5206\u7c7b\u6574\u4f53\u7cfb\u7edf\u642d\u5efa\u7684\u516d\u4e2a\u73af\u8282: \u672c\u7ae0\u5c0f\u8282: 1.1 \u540e\u7aef\u670d\u52a1\u642d\u5efa \u5b66\u4e60\u6784\u5efa\u8d77\u5bf9\u5916\u63d0\u4f9brestAPI\u7684\u670d\u52a1\u6846\u67b6\uff0c\u4f7f\u6210\u679c\u80fd\u88ab\u975e\u6280\u672f\u4eba\u5458\u8c03\u7528. 1.2 \u8f93\u5165\u9884\u5904\u7406 \u5b66\u4e60\u5bf9\u8f93\u5165\u7684\u6587\u672c\u505a\u957f\u5ea6\u9a8c\u8bc1, \u5206\u8bcd, \u53bb\u505c\u7528\u8bcd\u7b49\u5904\u7406\u64cd\u4f5c. 1.3 \u56fe\u8c31\u5339\u914d \u5b66\u4e60\u4f7f\u7528\u8f93\u5165\u6587\u672c\u4e2d\u7684\u8bcd\u6c47\u8fdb\u5165\u5230\u56fe\u8c31\u4e2d\u8fdb\u884c\u5339\u914d, \u627e\u51fa\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. 1.4 \u5339\u914d\u6b67\u4e49\u5224\u65ad \u5b66\u4e60\u4f7f\u7528\u6a21\u578b\u5bf9\u6240\u6709\u4e0d\u786e\u5b9a\u7684\u6807\u7b7e\u8fdb\u884c\u5224\u65ad, \u627e\u51fa\u6700\u5408\u9002\u7684\u6807\u7b7e. 1.5 \u6982\u7387\u8c03\u6574 \u5b66\u4e60\u8c03\u6574\u6807\u7b7e\u7684\u6982\u7387, \u6ee1\u8db3\u968f\u7740\u76f8\u5173\u8bcd\u6c47\u589e\u591a, \u6982\u7387\u9010\u6e10\u589e\u5927. 1.6 \u6982\u7387\u6807\u7b7e\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5b66\u4e60\u5bf9\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406, \u5e76\u68c0\u7d22\u5339\u914d\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868.","title":"\u672c\u7ae0\u5bfc\u5b66"},{"location":"1/#11","text":"\u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528. \u5b66\u4e60\u5982\u4f55\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6. \u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo. \u540e\u7aef\u670d\u52a1\u7684\u4e3b\u8981\u4f5c\u7528: \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282, \u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684restAPI, \u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528. \u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1,\u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001. \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6: \u6587\u4ef6\u5df2\u7ecf\u5b58\u653e\u5728/data/django-uwsgi\u76ee\u5f55\u4e0b. \u5728\u670d\u52a1\u5668\u4e2d\u8fdb\u884c\u6587\u4ef6\u67e5\u770b. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6: nginx: \u7528\u4e8e\u8d1f\u8f7d\u5747\u8861, \u589e\u5f3a\u670d\u52a1\u7684\u5065\u58ee\u6027. supervisor: \u7528\u4e8edjango\u670d\u52a1\u7684\u5b88\u62a4\u548c\u76d1\u63a7, \u5f53\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u65f6\u81ea\u52a8\u91cd\u542f. neo4j: \u56fe\u6570\u636e\u5e93, \u7528\u4e8e\u5b58\u50a8\u548c\u67e5\u8be2\u6570\u636e. \u7ec4\u4ef6\u5b89\u88c5\u8fc7\u7a0b: \u8bf7\u53c2\u8003\u9644\u5f55\u90e8\u5206\u7684\u73af\u5883\u5b89\u88c5\u90e8\u7f72\u624b\u518c. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001: cd /data/django-uwsgi # \u542f\u52a8\u56fe\u6570\u636e\u5e93 neo4j start # \u67e5\u770b\u72b6\u6001 neo4j status \u4ee3\u7801\u5b9e\u73b0(\u89c6\u9891\u6f14\u793a): \u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u7684\u7ec8\u7aef\u4e2d\u8fd0\u884c. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1,\u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001: # \u4f7f\u7528supervisord\u542f\u52a8\u4e3b\u670d\u52a1 # -c\u662f\u8bfb\u53d6\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7684\u610f\u601d # supervisord.conf\u662f\u5728\u5de5\u7a0b\u4e3b\u76ee\u5f55\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6 # \u91cc\u9762\u5305\u542b\u4e86\u76d1\u63a7\u548c\u5b88\u62a4django\u4ee5\u53canginx\u8fdb\u7a0b\u7684\u5185\u5bb9 supervisord -c supervisord.conf # \u67e5\u770b\u6240\u6709\u76d1\u63a7\u548c\u5b88\u62a4\u8fdb\u7a0b\u7684\u72b6\u6001 supervisorctl status all \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u7684\u7ec8\u7aef\u4e2d\u8fd0\u884c. \u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u6587\u4ef6\u5e76\u53d1\u9001\u8bf7\u6c42. \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6: urls.py, \u4f4d\u4e8e/data/django-uwsgi/api/\u76ee\u5f55\u4e0b, \u7528\u4e8e\u5c06\u524d\u7aef\u7684\u8bf7\u6c42url\u8f6c\u53d1\u5230views\u51fd\u6570\u4e2d. views.py, \u4f4d\u4e8e/data/django-uwsgi/api/\u76ee\u5f55\u4e0b, \u7528\u4e8e\u63a5\u6536\u6765\u81ea\u524d\u7aef\u8bf7\u6c42\u7684\u6570\u636e, \u5e76\u4f20\u7ed9api.py\u4e2d\u7684\u51fd\u6570\u6267\u884c, \u5e76\u83b7\u5f97\u7ed3\u679c, \u5c01\u88c5\u6210\u54cd\u5e94\u4f53\u8fd4\u56de. api.py, \u4f4d\u4e8e/data/django-uwsgi/text_labeled/\u76ee\u5f55\u4e0b, \u7528\u4e8e\u6267\u884c\u4e3b\u8981\u7684\u903b\u8f91\u5904\u7406\u90e8\u5206, \u5e76\u8fd4\u56de\u7ed3\u679c\u7ed9views.py\u4e2d\u7684\u51fd\u6570. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9: # \u7f16\u5199urls.py\u6587\u4ef6 from django.conf.urls import url from django.contrib import admin from . import views urlpatterns = [ url(r'^admin/', admin.site.urls), # \u5b9a\u4e49\u8def\u5f84api/get_label, \u524d\u7aef\u5c06\u8bf7\u6c42\u8be5\u8def\u5f84 # \u8bf7\u6c42\u540e, \u8be5\u6761\u8bed\u53e5\u5c06\u5176\u8f6c\u53d1\u5230views\u4e2d\u7684get_label\u51fd\u6570\u4e0a # get_label\u51fd\u6570\u5c06\u5728views.py\u4e2d\u5b9e\u73b0 # views\u5373\u662f\u540c\u76ee\u5f55\u4e0b\u7684views.py\u6587\u4ef6 url(r'^api/get_label[/]?$', views.get_label) ] \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/api/urls.py\u6587\u4ef6\u4e2d. # \u7f16\u5199views.py\u6587\u4ef6 # \u9996\u5148\u5bfc\u5165django\u670d\u52a1\u5fc5\u5907\u7684\u5de5\u5177\u5305 from django.http import HttpResponse from rest_framework import viewsets from rest_framework.response import Response from rest_framework.decorators import api_view from rest_framework.permissions import IsAuthenticated from rest_framework.decorators import authentication_classes from rest_framework.decorators import permission_classes import json # \u4ecetext_labeled\u6587\u4ef6\u4e2d\u5bfc\u5165\u4e86api.py\u6587\u4ef6 from text_labeled import api # \u8be5\u88c5\u9970\u5668\u7528\u4e8e\u4fdd\u8bc1\u51fd\u6570\u80fd\u591f\u63a5\u6536POST\u8bf7\u6c42 @api_view(['POST']) def get_label(request): \"\"\"\u83b7\u53d6\u6807\u7b7e\u63a5\u53e3, \u53c2\u6570request\u662f\u8bf7\u6c42\u4f53, \u5305\u542b\u524d\u7aef\u4f20\u6765\u7684\u6570\u636e\"\"\" # \u901a\u8fc7\u8bf7\u6c42\u4f53\u63a5\u6536\u524d\u7aef\u4f20\u6765\u7684\u6570\u636etext # request.POST >>> {\"text\": \"xxxx\"} text = request.POST.get(\"text\") # \u8c03\u7528text_labeled/api.py\u6587\u4ef6\u4e2d\u7684label\u51fd\u6570\u8fdb\u884c\u5904\u7406 result = api.label(text) # \u8fd4\u56dejson\u683c\u5f0f\u7684\u7ed3\u679c\uff0c\u5e76\u4f7f\u7528HttpResponse\u8fdb\u884c\u5c01\u88c5 return HttpResponse(json.dumps(result, ensure_ascii=False)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/api/views.py\u6587\u4ef6\u4e2d. # \u7f16\u5199api.py\u6587\u4ef6 def label(text): label = \"\u563b\u54c8\u97f3\u4e50\" return label \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u6587\u4ef6\u4e2d. \u91cd\u542f\u670d\u52a1: # \u670d\u52a1\u6587\u4ef6\u6539\u53d8\u540e, \u9700\u8981\u91cd\u65b0\u542f\u52a8\u624d\u80fd\u751f\u6548 supervisorctl restart all \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u7684\u7ec8\u7aef\u4e2d. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u811a\u672ctest.py, \u5e76\u53d1\u9001\u8bf7\u6c42: # \u7f16\u5199test.py # \u5bfc\u5165\u53d1\u9001\u8bf7\u6c42\u7684\u5de5\u5177\u5305 import requests def test(): url = \"http://127.0.0.1:8087/api/get_label\" data = {\"text\": \"\u6211\u62bd\u7740\u5dee\u4e0d\u591a\u7684\u70df,\u53c8\u8fc7\u4e86\u5dee\u4e0d\u591a\u7684\u4e00\u5929\uff01\"} # \u4f7f\u7528requests\u53d1\u9001post\u8bf7\u6c42 res = requests.post(url, data=data) print(res.text) if __name__ == \"__main__\": test() \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/test.py\u6587\u4ef6\u4e2d. \u6700\u7ec8\u8fd0\u884c\u7ed3\u679c: \"\u563b\u54c8\u97f3\u4e50\" \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528: \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282,\u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684restAPI\uff0c\u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6, \u5728/data/django-uwsgi\u76ee\u5f55\u4e0b. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6, \u5982: nginx, supervisor, neo4j. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001. \u4f7f\u7528neo4j start\u548cneo4j status. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1, \u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001. \u4f7f\u7528supervisord -c supervisord.conf \u548c supervisorctl status all. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6. urls.py, views.py, api.py. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9. urls\u4e2d\u52a0\u4e86\u4e00\u884c\u8f6c\u53d1\u4ee3\u7801, views.py\u4e2d\u5b9e\u73b0\u4e86get_label\u51fd\u6570, api.py\u4e2d\u5b9e\u73b0\u4e86label\u51fd\u6570. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u6587\u4ef6\u5e76\u53d1\u9001\u8bf7\u6c42. \u5728test.py\u6587\u4ef6\u4e2d\u5b9e\u73b0test\u51fd\u6570, \u4f7f\u7528requests\u53d1\u9001\u4e86post\u8bf7\u6c42, \u5e76\u83b7\u5f97\u4e86\"\u563b\u54c8\u97f3\u4e50\"\u7684\u7ed3\u679c.","title":"1.1 \u540e\u7aef\u670d\u52a1\u642d\u5efa"},{"location":"1/#12","text":"\u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2. \u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027,\u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d,\u540c\u65f6\u4e3a\u4e0b\u4e00\u6b65\u5904\u7406\u505a\u5fc5\u8981\u7684\u51c6\u5907. \u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u957f\u5ea6\u9650\u5236. \u7b2c\u4e8c\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u7b2c\u4e09\u6b65:\u5bf9\u5206\u8bcd\u7ed3\u679c\u8fdb\u884c\u53bb\u505c\u7528\u8bcd\u5904\u7406. \u5b9e\u73b0\u8f93\u5165\u9884\u5904\u7406\u4e09\u6b65\u66f2\u7684\u4ee3\u7801\u5206\u6790: # \u4ee3\u7801\u9996\u5148\u5f15\u5165\u4e09\u4e2a\u5fc5\u5907\u7684package,\u5206\u522b\u662fos\u4e3b\u8981\u7528\u4e8e\u64cd\u4f5c\u6587\u4ef6\u8def\u5f84\uff0c # jieba\u7528\u4e8e\u5206\u8bcd\u5904\u7406,fileinput\u7528\u4e8e\u4ece\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\u5230\u5185\u5b58. import os import jieba import fileinput # \u5b9a\u4e49\u4e86\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84,\u548c\u505c\u7528\u8bcd\u5178\u8def\u5f84\uff0c\u5373\u5728\u8be5\u4ee3\u7801\u6587\u4ef6\u8def\u5f84\u4e0b\u5e94\u6709userdict.txt\u548cstopdict.txt\u6587\u4ef6 userdict_path = os.path.join(os.path.dirname(__file__), \"userdict.txt\") stopdict_path = os.path.join(os.path.dirname(__file__), \"stopdict.txt\") # \u52a0\u8f7d\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178 jieba.load_userdict(userdict_path) # \u5b9a\u4e49\u8f93\u5165\u6587\u672c\u6700\u5927\u957f\u5ea6\u9650\u5236\u4e3a200 MAX_LIMIT = 200 def handle_cn_text(text: str): \"\"\"\u7528\u4e8e\u5b8c\u6210\u9884\u5904\u7406\u7684\u4e3b\u8981\u6d41\u7a0b, \u4ee5\u539f\u59cb\u6587\u672c\u4e3a\u8f93\u5165\uff0c\u4ee5\u5206\u8bcd\u548c\u53bb\u505c\u7528\u8bcd\u540e\u7684\u8bcd\u6c47\u5217\u8868\u4e3a\u8f93\u51fa.\"\"\" # \u5bf9\u8f93\u5165\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u9a8c if not text: return [] # \u4f7f\u7528jieba\u7684cut\u65b9\u6cd5\u5bf9\u4f7f\u7528\u6700\u5927\u9650\u5236\u8fdb\u884c\u5207\u7247\u7684\u8f93\u5165\u6587\u672c\u8fdb\u884c\u5206\u8bcd word_list = jieba.cut(text[:MAX_LIMIT]) def _load_stop_dict(): \"\"\"\u7528\u4e8e\u4ece\u6587\u4ef6\u4e2d\u52a0\u8f7d\u505c\u7528\u8bcd\u8bcd\u8868\"\"\" # \u4f7f\u7528fileinput\u52a0\u8f7d\u505c\u7528\u8bcd\u8868\u81f3\u5185\u5b58,\u4f7f\u7528\u5b57\u7b26\u4e32\u7684strip()\u65b9\u6cd5\u53bb\u9664\u4e24\u7aef\u7a7a\u767d\u7b26 stop_word_set = set(map(lambda x: x.strip(), fileinput.FileInput(stopdict_path))) return stop_word_set # \u8c03\u7528_load_stop_dict()\u51fd\u6570 stop_word_set = _load_stop_dict() # \u4f7f\u7528\u9ad8\u9636\u51fd\u6570filter\u8fdb\u884c\u5faa\u73af\u8fc7\u6ee4\u64cd\u4f5c\u751f\u6210\u6700\u7ec8\u7ed3\u679c word_list = list(filter(lambda x: x not in stop_word_set and len(x)>1, word_list)) return word_list \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: \"\u6211\u7684\u773c\u775b\u5f88\u5927\u5f88\u5927,\u53ef\u4ee5\u88c5\u5f97\u4e0b\u5929\u7a7a\uff0c\u88c5\u5f97\u4e0b\u9ad8\u5c71\uff0c\u88c5\u5f97\u4e0b\u5927\u6d77\uff0c\u88c5\u5f97\u4e0b\u6574\u4e2a\u4e16\u754c\uff1b\u6211\u7684\u773c\u775b\u53c8\u5f88\u5c0f\u5f88\u5c0f\uff0c\u6709\u5fc3\u4e8b\u65f6\uff0c\u5c31\u8fde\u4e24\u884c\u773c\u6cea\uff0c\u4e5f\u88c5\u4e0d\u4e0b.\" \u8f93\u51fa\u6548\u679c: ['\u773c\u775b', '\u5f88\u5927', '\u5f88\u5927', '\u88c5\u5f97', '\u5929\u7a7a', '\u88c5\u5f97', '\u9ad8\u5c71', '\u88c5\u5f97', '\u5927\u6d77', '\u88c5\u5f97', '\u6574\u4e2a', '\u4e16\u754c', '\u773c\u775b', '\u5f88\u5c0f', '\u5f88\u5c0f', '\u5fc3\u4e8b', '\u4e24\u884c', '\u773c\u6cea', '\u88c5\u4e0d\u4e0b'] \u4e3b\u8981\u6ce8\u91ca: # \u5b9a\u4e49\u4e86\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84,\u548c\u505c\u7528\u8bcd\u5178\u8def\u5f84 # \u52a0\u8f7d\u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178 # \u5b9a\u4e49\u8f93\u5165\u6587\u672c\u6700\u5927\u957f\u5ea6\u9650\u5236\u4e3a200 \"\"\"\u7528\u4e8e\u5b8c\u6210\u9884\u5904\u7406\u7684\u4e3b\u8981\u6d41\u7a0b, \u4ee5\u539f\u59cb\u6587\u672c\u4e3a\u8f93\u5165\uff0c\u4ee5\u5206\u8bcd\u548c\u53bb\u505c\u7528\u8bcd\u540e\u7684\u8bcd\u6c47\u5217\u8868\u4e3a\u8f93\u51fa.\"\"\" # \u5bf9\u8f93\u5165\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u9a8c # \u4f7f\u7528jieba\u7684cut\u65b9\u6cd5\u5bf9\u4f7f\u7528\u6700\u5927\u9650\u5236\u8fdb\u884c\u5207\u7247\u7684\u8f93\u5165\u6587\u672c\u8fdb\u884c\u5206\u8bcd \"\"\"\u7528\u4e8e\u4ece\u6587\u4ef6\u4e2d\u52a0\u8f7d\u505c\u7528\u8bcd\u8bcd\u8868\"\"\" # \u4f7f\u7528fileinput\u52a0\u8f7d\u505c\u7528\u8bcd\u8868\u81f3\u5185\u5b58,\u4f7f\u7528\u5b57\u7b26\u4e32\u7684strip()\u65b9\u6cd5\u53bb\u9664\u4e24\u7aef\u7a7a\u767d\u7b26 # \u8c03\u7528_load_stop_dict()\u51fd\u6570 # \u4f7f\u7528\u9ad8\u9636\u51fd\u6570filter\u8fdb\u884c\u5faa\u73af\u8fc7\u6ee4\u64cd\u4f5c\u751f\u6210\u6700\u7ec8\u7ed3\u679c \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027, \u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d, \u5e76\u4e3a\u4e0b\u4e00\u6b65\u5904\u7406\u505a\u6570\u636e\u51c6\u5907. \u5b66\u4e60\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5bf9\u8f93\u5165\u8fdb\u884c\u957f\u5ea6\u9650\u5236. \u7b2c\u4e8c\u6b65: \u5bf9\u8f93\u5165\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u7b2c\u4e09\u6b65: \u5bf9\u5206\u8bcd\u5217\u8868\u8fdb\u884c\u53bb\u505c\u7528\u8bcd\u5904\u7406. \u5b9e\u73b0\u4e86\u8f93\u5165\u9884\u5904\u7406\u4e09\u6b65\u66f2\u7684\u8fc7\u7a0b: \u521b\u5efahandle_cn_text\u51fd\u6570\u6765\u5b9e\u73b0. \u4f7f\u7528\u5207\u7247\u65b9\u6cd5\u8fdb\u884c\u957f\u5ea6\u9650\u5236, \u6700\u5927\u957f\u5ea6\u9650\u5236\u4e3a200. \u4f7f\u7528jieba\u5206\u8bcd\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u4f7f\u7528\u9ad8\u9636\u51fd\u6570filter\u8fdb\u884c\u5faa\u73af\u8fc7\u6ee4\u64cd\u4f5c.","title":"1.2 \u8f93\u5165\u9884\u5904\u7406"},{"location":"1/#13","text":"\u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31. \u4e86\u89e3\u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31:","title":"1.3 \u56fe\u8c31\u5339\u914d"},{"location":"1/#14","text":"\u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49. \u4e86\u89e3\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d, \u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e, \u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49. \u4e3e\u4e2a\u6817\u5b50: \"\u95ea\u73b0\"\u4e00\u8bcd\u5339\u914d\u5230\u4e24\u4e2a\u6807\u7b7e, LOL\u548c\u738b\u8005\u519c\u836f, \u8bf4\u660e\u8fd9\u4e2a\u8bcd\u6c47\u5728\u53e5\u5b50\u4e2d\u5177\u6709\u6b67\u4e49\uff0c\u9700\u8981\u8fdb\u884c\u66f4\u6df1\u5c42\u6b21\u7684\u5224\u65ad. \u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u4f5c\u7528: \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6,\u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387. \u638c\u63e1\u5b9e\u73b0\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b \u6ce8\u610f: \u51fd\u6570\u4e2d\u4f1a\u8c03\u7528\u591a\u6a21\u578b\u9884\u6d4b\u51fd\u6570, \u6211\u4eec\u4f1a\u5728\u7b2c\u4e09,\u56db\u7ae0\u4e2d\u5b9e\u73b0, \u8fd9\u91cc\u6211\u4eec\u4f1a\u7f16\u5199\u4e00\u4e2a\u7a7a\u58f3\u51fd\u6570\u6682\u65f6\u5145\u5f53. def request_model_serve(word_list, label_list): return [[\"\u60c5\u611f\u6545\u4e8b\", 0.865]] \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py\u4e2d. \u5b9e\u73b0\u5339\u914d\u6b67\u4e49\u5224\u65ad\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u591a\u6a21\u578b\u9884\u6d4b\u51fd\u6570 from model_train.multithread_predict import request_model_serve def weight_update(word_list, index_map_label): \"\"\"\u8be5\u51fd\u6570\u5c06\u5206\u8bcd\u5217\u8868\u548c\u5177\u6709\u521d\u59cb\u6982\u7387\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u5165,\u5c06\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u51fa\"\"\" # \u9996\u5148\u5c06\u5217\u8868\u8f6c\u5316\u4e3a\u5b57\u5178\u7684\u5f62\u5f0f # index_map_label >>> [\"1\", [[\"\u7f8e\u98df\", 0.735], [\"\u97f3\u4e50\", 0.654]], \"2\", [[\"\u7f8e\u5986\", 0.734]] >>> # {\"1\": [[\"\u7f8e\u98df\", 0.735],[\"\u97f3\u4e50\", 0.654]], \"2\": [[\"\u7f8e\u5986\", 0.734]]} index_map_label = dict(zip(index_map_label[::2], index_map_label[1::2])) for k, v in index_map_label.items(): # v\u7684\u957f\u5ea6\u5927\u4e8e1\u8bf4\u660e\u5b58\u5728\u6b67\u4e49\u73b0\u8c61 if len(v) > 1: # \u83b7\u53d6\u5bf9\u5e94\u7684\u6807\u7b7e\u4f5c\u4e3a\u53c2\u6570,\u5373\u901a\u77e5\u670d\u52a1\u5e94\u8be5\u8c03\u7528\u54ea\u4e9b\u6a21\u578b\u8fdb\u884c\u9884\u6d4b. label_list = list(map(lambda x: x[0], v)) # \u901a\u8fc7request_model_serve\u51fd\u6570\u83b7\u5f97\u6807\u7b7e\u6700\u65b0\u7684\u9884\u6d4b\u6982\u7387,\u5e76\u4f7f\u7528\u5b57\u5178\u65b9\u5f0f\u66f4\u65b0. # v >>> [[\"\u7f8e\u98df\": 0.954]] v = request_model_serve(word_list, label_list) index_map_label.update({k:v}) # \u5c06\u5b57\u5178\u8f6c\u5316\u4e3a\u5217\u8868\u5f62\u5f0f index_map_label_ = list(chain(*map(lambda x: [x[0], x[1]], index_map_label.items()))) return index_map_label_ \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # word_list ['\u773c\u775b', '\u5f88\u5927', '\u5f88\u5927', '\u88c5\u5f97', '\u5929\u7a7a', '\u88c5\u5f97', '\u9ad8\u5c71', '\u88c5\u5f97', '\u5927\u6d77', '\u88c5\u5f97', '\u6574\u4e2a', '\u4e16\u754c', '\u773c\u775b', '\u5f88\u5c0f', '\u5f88\u5c0f', '\u5fc3\u4e8b', '\u4e24\u884c', '\u773c\u6cea', '\u88c5\u4e0d\u4e0b'] # index_map_label [\"0\", [[\"\u7f8e\u5986\", 0.654], [\"\u60c5\u611f\u6545\u4e8b\", 0.765]]] \u8f93\u51fa\u6548\u679c: [\"0\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.865]]] \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u591a\u6a21\u578b\u9884\u6d4b\u51fd\u6570 \"\"\"\u8be5\u51fd\u6570\u5c06\u5206\u8bcd\u5217\u8868\u548c\u5177\u6709\u521d\u59cb\u6982\u7387\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u5165,\u5c06\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6982\u7387\u5217\u8868\u4f5c\u4e3a\u8f93\u51fa\"\"\" # \u9996\u5148\u5c06\u5217\u8868\u8f6c\u5316\u4e3a\u5b57\u5178\u7684\u5f62\u5f0f # index_map_label >>> [\"1\", [[\"\u7f8e\u98df\", 0.735], [\"\u97f3\u4e50\", 0.654]], \"2\", [[\"\u7f8e\u5986\", 0.734]] >>> # {\"1\": [[\"\u7f8e\u98df\", 0.735],[\"\u97f3\u4e50\", 0.654]], \"2\": [[\"\u7f8e\u5986\", 0.734]]} # v\u7684\u957f\u5ea6\u5927\u4e8e1\u8bf4\u660e\u5b58\u5728\u6b67\u4e49\u73b0\u8c61 # \u83b7\u53d6\u5bf9\u5e94\u7684\u6807\u7b7e\u4f5c\u4e3a\u53c2\u6570,\u5373\u901a\u77e5\u670d\u52a1\u5e94\u8be5\u8c03\u7528\u54ea\u4e9b\u6a21\u578b\u8fdb\u884c\u9884\u6d4b. # \u901a\u8fc7request_model_serve\u51fd\u6570\u83b7\u5f97\u6807\u7b7e\u6700\u65b0\u7684\u9884\u6d4b\u6982\u7387,\u5e76\u4f7f\u7528\u5b57\u5178\u65b9\u5f0f\u66f4\u65b0. # v >>> [[\"\u7f8e\u98df\": 0.954]] # \u5c06\u5b57\u5178\u8f6c\u5316\u4e3a\u5217\u8868\u5f62\u5f0f \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d,\u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e\uff0c\u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49. \u5b66\u4e60\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6,\u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b: \u521b\u5efa\u4e86weight_update\u51fd\u6570\u6765\u5b9e\u73b0. \u901a\u8fc7\u68c0\u6d4b\u5339\u914d\u5230\u7684\u6807\u7b7e\u6570\u91cf\u8fdb\u884c\u6b67\u4e49\u5224\u65ad. \u901a\u8fc7\u8c03\u7528\u591a\u6a21\u578b\u9884\u6d4b\u670d\u52a1\u51fd\u6570request_model_serve\u6765\u66f4\u65b0\u6982\u7387.","title":"1.4 \u5339\u914d\u6b67\u4e49\u5224\u65ad"},{"location":"1/#15","text":"\u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574. \u4e86\u89e3\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u6982\u7387\u8c03\u6574\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574: \u5f53\u53e5\u5b50\u4e2d\u7684\u591a\u4e2a\u8bcd\u90fd\u6307\u5411\u540c\u4e00\u6807\u7b7e\u65f6, \u8fd9\u4e2a\u6807\u7b7e\u6982\u7387\u5c06\u6210\u4e3a\u6240\u6709\u7684\u6982\u7387\u4e4b\u548c. \u4e3e\u4e2a\u6817\u5b50: \u6211\u7231\u82f9\u679c\uff01 -------> [[\"\u6c34\u679c\", 0.654], [\"\u7535\u5f71\", 0.654], [\"\u516c\u53f8\", 0.654]] # \u51fa\u73b0\u4e86\u4e00\u6b21\u82f9\u679c, \u53ef\u80fd\u662f\u5728\u8bf4\u6c34\u679c\uff0c\u7535\u5f71\uff0c\u6216\u8005\u516c\u53f8, \u4ed6\u4eec\u7684\u6982\u7387\u57fa\u672c\u4e0a\u662f\u76f8\u540c\u7684. \u8fd9\u53e5\u8bdd\u6253\u4e0a\u4ec0\u4e48\u6807\u7b7e\u4e0d\u80fd\u786e\u5b9a. \u6211\u7231\u82f9\u679c\uff0c\u6a58\u5b50\uff0c\u9999\u8549! --------> [[\"\u6c34\u679c\", 0.654], [\"\u7535\u5f71\", 0.654], [\"\u516c\u53f8\", 0.654], [\"\u6c34\u679c\", 0.654], [\"\u6c34\u679c\", 0.654]] # \u5168\u53e5\u5171\u51fa\u73b0\u4e86\u4e09\u6b21\u6709\u5173\u6c34\u679c\u7684\u8bcd\uff0c\u5982\u679c\u6c34\u679c\u7684\u6982\u7387\u662f\u82f9\u679c\uff0c\u6a58\u5b50\uff0c\u9999\u8549\u4e3a\u6c34\u679c\u7684\u6982\u7387\u548c\uff0c\u8fd9\u6837\u5c31\u5927\u4e8e\u4e86\u7535\u5f71\u6216\u8005\u516c\u53f8\u7684\u6982\u7387. \u57fa\u672c\u4e0a\u53ef\u4ee5\u6253\u4e0a\u4e00\u4e2a\u786e\u5b9a\u7684\u6807\u7b7e\u4e86. \u6982\u7387\u8c03\u6574\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a,\u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0. \u5b9e\u73b0\u6982\u7387\u8c03\u6574\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u53ef\u4ee5\u8fdb\u884c\u6241\u5e73\u5316\u64cd\u4f5c\u7684reduce # \u5bfc\u5165\u8fdb\u884c\u5408\u5e76\u64cd\u4f5c\u7684pandas from functools import reduce import pandas as pd def control_increase(index_map_label_): \"\"\"\u4ee5\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6743\u91cd\u5217\u8868\u4e3a\u8f93\u5165, \u4ee5\u6807\u7b7e\u5f52\u5e76\u540e\u7684\u7ed3\u679c\u4e3a\u8f93\u51fa\"\"\" if not index_map_label_: return [] # index_map_label_ >>> # [\"2\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.765]], \"3\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.876], [\"\u660e\u661f\", 0.765]]] # \u5c06index_map_label_\u5947\u6570\u9879\u5373[label, score]\u53d6\u51fa\u653e\u5728\u5b57\u5178\u4e2d # k\u7684\u6570\u636e\u7ed3\u6784\u5f62\u5f0f: # [{'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.765}, {'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.876}, # {'label': '\u660e\u661f', 'score': 0.765}] k = list(map(lambda x: {\"label\": x[0], \"score\": x[1]}, reduce( lambda z, y: z + y, index_map_label_[1::2]))) # \u4f7f\u7528pandas\u4e2d\u7684groupby\u65b9\u6cd5\u8fdb\u884c\u5408\u5e76\u5206\u503c df = pd.DataFrame(k) df_ = df.groupby(by=['label'])['score'].sum() return df_ \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: [\"2\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.765]], \"3\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.876], [\"\u660e\u661f\", 0.765]]] \u8f93\u51fa\u6548\u679c: label \u60c5\u611f\u6545\u4e8b 1.641 \u660e\u661f 0.765 Name: score, dtype: float64 \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u4ee5\u6a21\u578b\u9884\u6d4b\u540e\u7684\u6807\u7b7e-\u6743\u91cd\u5143\u7ec4\u5217\u8868\u4e3a\u8f93\u5165, \u4ee5\u6807\u7b7e\u5f52\u5e76\u540e\u7684\u7ed3\u679c\u4e3a\u8f93\u51fa\"\"\" # index_map_label_ >>> # [\"2\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.765]], \"3\", [[\"\u60c5\u611f\u6545\u4e8b\", 0.876], [\"\u660e\u661f\", 0.765]]] # \u5c06index_map_label_\u5947\u6570\u9879\u5373[label, score]\u53d6\u51fa\u653e\u5728\u5b57\u5178\u4e2d # k\u7684\u6570\u636e\u7ed3\u6784\u5f62\u5f0f: # [{'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.765}, {'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.876}, # {'label': '\u660e\u661f', 'score': 0.765}] # \u4f7f\u7528pandas\u4e2d\u7684groupby\u65b9\u6cd5\u8fdb\u884c\u5408\u5e76\u5206\u503c \u5c0f\u8282\u603b\u7ed3: \u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574: \u5f53\u53e5\u5b50\u4e2d\u7684\u591a\u4e2a\u8bcd\u90fd\u6307\u5411\u540c\u4e00\u6807\u7b7e\u65f6, \u8fd9\u4e2a\u6807\u7b7e\u6982\u7387\u5c06\u6210\u4e3a\u6240\u6709\u7684\u6982\u7387\u4e4b\u548c. \u5b66\u4e60\u4e86\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a,\u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u8c03\u6574\u7684\u8fc7\u7a0b: \u521b\u5efacontrol_increase\u51fd\u6570\u6765\u5b9e\u73b0. \u4f7f\u7528\u4e86pandas\u4e2d\u7684groupby\u65b9\u6cd5\u8fdb\u884c\u5408\u5e76\u6c42\u548c.","title":"1.5 \u6982\u7387\u8c03\u6574"},{"location":"1/#16","text":"\u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u4e86\u89e3\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528. \u638c\u63e1\u5b9e\u73b0\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b. \u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316: \u5bf9\u8d85\u8fc71\u7684\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\u3002 \u4ec0\u4e48\u662f\u7236\u6807\u7b7e\u68c0\u7d22: \u5728\u6807\u7b7e\u6811\u4e2d\u627e\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u6240\u6709\u7236\u8282\u70b9\u3002 \u6982\u7387\u5f52\u4e00\u5316\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185. \u7236\u6807\u7b7e\u68c0\u7d22\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868,\u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c. \u5b9e\u73b0\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import numpy as np def father_label_and_normalized(df_): \"\"\" \u4ee5\u6982\u7387\u8c03\u6574\u540e\u7684DataFrame\u5bf9\u8c61\u4e3a\u8f93\u5165, \u4ee5\u6574\u4e2a\u7cfb\u7edf\u7684\u6700\u7ec8\u7ed3\u679c\u4e3a\u8f93\u51fa \u8f93\u5165\u6837\u5f0f\u4e3a:DataFrame<[[\u201cLOL\u201d, 1.465]]> \u8f93\u51fa\u6837\u5f0f\u4e3a:[{\u201clabel\u201d: \u201cLOL\u201d, \u201cscore\u201d: \u201c0.811\u201d, \u201crelated\u201d:[\u201c\u6e38\u620f\u201d]}] \"\"\" def _sigmoid(x): y = 1.0 / (1.0 + np.exp(-x)) return round(y, 3) def _sg(pair): \"\"\"\u83b7\u5f97\u5355\u4e2a\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u548c\u5f52\u4e00\u5316\u6982\u7387\"\"\" # \u4f7f\u7528GraphDatabase\u5f00\u542f\u4e00\u4e2adriver. _driver = GraphDatabase.driver(**NEO4J_CONFIG) with _driver.session() as session: # \u901a\u8fc7\u5173\u7cfb\u67e5\u8be2\u83b7\u5f97\u4ece\u8be5\u6807\u7b7e\u8282\u70b9\u76f4\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u7684\u5176\u4ed6Label\u8282\u70b9\u7684title\u5c5e\u6027 cypher = \"MATCH(a:Label{title:%r})<-[r:Contain*1..3]-(b:Label) \\ WHERE b.title<>'\u6cdb\u5a31\u4e50' RETURN b.title\" % pair[0] record = session.run(cypher) result = list(map(lambda x: x[0], record)) return {\"label\": pair[0], \"score\": _sigmoid(pair[1]), \"related\": result} # \u904d\u5386\u6240\u6709\u7684\u6807\u7b7e return list(map(_sg, df_.to_dict().items())) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/api.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: label \u60c5\u611f\u6545\u4e8b 1.641 \u660e\u661f 0.765 Name: score, dtype: float64 \u8f93\u51fa\u6548\u679c: # \u56e0\u4e3a\u6ca1\u6709\u6784\u5efa\u56fe\u8c31\uff0c\u6240\u4ee5related\u5339\u914d\u4e0d\u5230\u4efb\u4f55\u7236\u6807\u7b7e [{'label': '\u60c5\u611f\u6545\u4e8b', 'score': 0.838, 'related': []}, {'label': '\u660e\u661f', 'score': 0.682, 'related': []}] \u4e3b\u8981\u6ce8\u91ca \"\"\" \u4ee5\u6982\u7387\u8c03\u6574\u540e\u7684DataFrame\u5bf9\u8c61\u4e3a\u8f93\u5165, \u4ee5\u6574\u4e2a\u7cfb\u7edf\u7684\u6700\u7ec8\u7ed3\u679c\u4e3a\u8f93\u51fa \u8f93\u5165\u6837\u5f0f\u4e3a:DataFrame<[[\u201cLOL\u201d, 1.465]]> \u8f93\u51fa\u6837\u5f0f\u4e3a:[{\u201clabel\u201d: \u201cLOL\u201d, \u201cscore\u201d: \u201c0.811\u201d, \u201crelated\u201d:[\u201c\u6e38\u620f\u201d]}] \"\"\" \"\"\"\u83b7\u5f97\u5355\u4e2a\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u548c\u5f52\u4e00\u5316\u6982\u7387\"\"\" # \u4f7f\u7528GraphDatabase\u5f00\u542f\u4e00\u4e2adriver # \u901a\u8fc7\u5173\u7cfb\u67e5\u8be2\u83b7\u5f97\u4ece\u8be5\u6807\u7b7e\u8282\u70b9\u76f4\u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u7684\u5176\u4ed6Label\u8282\u70b9\u7684title\u5c5e\u6027 # \u904d\u5386\u6240\u6709\u7684\u6807\u7b7e \u5c0f\u8282\u603b\u7ed3: \u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316: \u5bf9\u8d85\u8fc71\u7684\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\u3002 \u4ec0\u4e48\u662f\u7236\u6807\u7b7e\u68c0\u7d22: \u5728\u6807\u7b7e\u6811\u4e2d\u627e\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u6240\u6709\u7236\u8282\u70b9\u3002 \u5b66\u4e60\u4e86\u6982\u7387\u5f52\u4e00\u5316\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185. \u5b66\u4e60\u4e86\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868,\u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b: \u521b\u5efafather_label_and_normalized\u51fd\u6570\u6765\u5b9e\u73b0. \u4f7f\u7528sigmoid\u51fd\u6570\u6765\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406. \u901a\u8fc7\u521b\u5efacypher\u8bed\u53e5\u5339\u914d\u6807\u7b7e\u56fe\u8c31\u4e2d\u7684\u6240\u6709\u7236\u8282\u70b9\u6765\u83b7\u5f97\u7236\u6807\u7b7e\u5217\u8868.","title":"1.6 \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22"},{"location":"1/#_3","text":"\u7b2c1\u5c0f\u8282: \u540e\u7aef\u670d\u52a1\u642d\u5efa \u5b66\u4e60\u4e86\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528: \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282,\u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684restAPI\uff0c\u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u56db\u6b65\u66f2. \u7b2c\u4e00\u6b65: \u62f7\u8d1d\u670d\u52a1\u6846\u67b6\u7684\u57fa\u672c\u6587\u4ef6, \u5728\u7cfb\u7edf\u7684/data/jango-uwsgi\u76ee\u5f55. \u7b2c\u4e8c\u6b65: \u5b89\u88c5\u5fc5\u5907\u7684\u7ec4\u4ef6, \u5982: nginx, supervisor, neo4j\u7b49, \u5177\u4f53\u5b89\u88c5\u8fc7\u7a0b\u8be6\u89c1\u5b89\u88c5\u624b\u518c. \u7b2c\u4e09\u6b65: \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u6570\u636e\u5e93\u72b6\u6001. \u7b2c\u56db\u6b65: \u4f7f\u7528supervisor\u542f\u52a8\u4e3b\u670d\u52a1,\u5e76\u67e5\u770b\u670d\u52a1\u72b6\u6001. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2. \u7b2c\u4e00\u6b65: \u8ba4\u8bc6\u4e09\u4e2apython\u6587\u4ef6. \u7b2c\u4e8c\u6b65: \u7f16\u5199\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u5185\u5bb9. \u7b2c\u4e09\u6b65: \u7f16\u5199\u6d4b\u8bd5\u6587\u4ef6\u5e76\u53d1\u9001\u8bf7\u6c42. \u7b2c2\u5c0f\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5b66\u4e60\u4e86\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027, \u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2. \u7b2c\u4e00\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u957f\u5ea6\u9650\u5236. \u7b2c\u4e8c\u6b65:\u5bf9\u8f93\u5165\u8fdb\u884c\u5206\u8bcd\u5904\u7406. \u7b2c\u4e09\u6b65:\u5bf9\u5206\u8bcd\u7ed3\u679c\u8fdb\u884c\u53bb\u505c\u7528\u8bcd\u5904\u7406. \u7b2c3\u5c0f\u8282: \u56fe\u8c31\u5339\u914d \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31: \u5b83\u662f\u7531\u6807\u7b7e\u8282\u70b9\u548c\u8bcd\u6c47\u8282\u70b9\u4ee5\u53ca\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\u7ec4\u6210\u7684\u4e00\u5f20\u6811\u72b6\u56fe. \u5b66\u4e60\u4e86\u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u901a\u8fc7\u5339\u914d\u8bcd\u6c47\u53ec\u56de\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b. \u7b2c4\u5c0f\u8282: \u5339\u914d\u6b67\u4e49\u5224\u65ad \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d, \u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e\uff0c\u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49. \u5b66\u4e60\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6, \u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b. \u7b2c5\u5c0f\u8282: \u6982\u7387\u8c03\u6574 \u4ec0\u4e48\u662f\u6982\u7387\u8c03\u6574: \u6982\u7387: \u662f\u6307\u8f93\u5165\u6587\u672c\u5c5e\u4e8e\u67d0\u4e2a\u6807\u7b7e\u7684\u6982\u7387. \u8c03\u6574: \u662f\u6307\u540c\u7c7b\u522b\u7684\u6982\u7387\u76f8\u52a0. \u5b66\u4e60\u4e86\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a, \u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b. \u7b2c6\u5c0f\u8282: \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u4ec0\u4e48\u662f\u6982\u7387\u5f52\u4e00\u5316: \u5bf9\u8d85\u8fc71\u7684\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\u3002 \u4ec0\u4e48\u7236\u6807\u7b7e\u68c0\u7d22: \u5728\u6807\u7b7e\u6811\u4e2d\u627e\u5230\u67d0\u4e2a\u6807\u7b7e\u7684\u6240\u6709\u7236\u8282\u70b9\u3002 \u5b66\u4e60\u4e86\u6982\u7387\u5f52\u4e00\u5316\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185. \u5b66\u4e60\u4e86\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868, \u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b.","title":"\u672c\u7ae0\u603b\u7ed3"},{"location":"2/","text":"\u672c\u7ae0\u5bfc\u5b66 \u5b66\u4e60\u76ee\u6807: \u4f7f\u7528\u56fe\u6570\u636e\u5e93neo4j\u6784\u5efa\u8d77\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31,\u7528\u4e8e\u57fa\u4e8e\u8bcd\u6c47\u7684\u6807\u7b7e\u5339\u914d\u5de5\u4f5c. \u5f15\u5bfc\u5206\u6790: \u56fe\u4e2d\u7684\u84dd\u8272\u8282\u70b9\u4ee3\u8868\u6807\u7b7e,\u56e0\u4e3a\u7ed9\u6587\u672c\u6253\u4e0a\u4ec0\u4e48\u6807\u7b7e\u662f\u548c\u4e1a\u52a1\u7d27\u5bc6\u76f8\u8fde\u7684\uff0c\u56e0\u6b64\u5b83\u662f\u6211\u4eec\u6839\u636e\u4e1a\u52a1\u8bbe\u8ba1\u7684\uff0c\u8bbe\u8ba1\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u56fe\u6570\u636e\u5e93\u8bed\u8a00cypher\u5728\u56fe\u6570\u636e\u5e93\u4e2d\u6784\u5efa\u5b83. \u56fe\u4e2d\u7684\u6a58\u8272\u8282\u70b9\u4ee3\u8868\u8bcd\u6c47,\u8bcd\u6c47\u4e00\u822c\u662f\u6307\u4e0e\u8fde\u63a5\u6807\u7b7e\u76f8\u5173\u7684\u540d\u8bcd\uff0c\u8fd9\u4e9b\u540d\u8bcd\u6765\u81ea\u4e8e\u6240\u8c13\u7684\u539f\u59cb\u6570\u636e\uff0c\u6211\u4eec\u8fd9\u91cc\u7684\u539f\u59cb\u662f\u7531\u516c\u53f8\u5185\u90e8\u7684\u4eba\u5458\u63d0\u4f9b\u7684.\u5728\u6709\u4e86\u539f\u59cb\u6570\u636e\u540e\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u4ece\u4e2d\u8fdb\u884c\u83b7\u53d6\u8bcd\u6c47\u96c6\uff0c\u6700\u540e\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u3002 \u6784\u5efa\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31\u7684\u4e94\u4e2a\u6b65\u9aa4: \u672c\u7ae0\u5c0f\u8282: 2.1 \u8bbe\u8ba1\u6807\u7b7e\u6811 \u5b66\u4e60\u8bbe\u8ba1\u4e00\u9897\u548c\u4e1a\u52a1\u6709\u5f88\u5927\u7684\u5173\u8054\u7684\u6807\u7b7e\u6811, \u5e94\u9075\u5faa\u4e00\u4e9b\u8bbe\u8ba1\u539f\u5219, \u4fdd\u8bc1\u6807\u7b7e\u6811\u7684\u5408\u7406\u6027. 2.2 \u6784\u5efa\u6807\u7b7e\u6811 \u5b66\u4e60\u6839\u636e\u8bbe\u8ba1\u7684\u6807\u7b7e\u6811,\u5728neo4j\u4e2d\u5b58\u50a8\u8fd9\u4e2a\u7ed3\u6784. 2.3 \u83b7\u53d6\u539f\u59cb\u6570\u636e \u5b66\u4e60\u539f\u59cb\u6570\u636e\u6709\u5173\u7684\u5185\u5bb9,\u8ba9\u5927\u5bb6\u6211\u5bf9\u6211\u4eec\u7684\u6570\u636e\u6709\u6df1\u523b\u7684\u7406\u89e3. 2.4 \u83b7\u53d6\u8bcd\u6c47\u96c6 \u5b66\u4e60\u6839\u636e\u539f\u59cb\u6570\u636e, \u8fdb\u884c\u4e00\u4e9b\u62bd\u53d6\u5de5\u4f5c, \u83b7\u5f97\u51c6\u5907\u5bfc\u5165\u56fe\u8c31\u7684\u8bcd\u6c47\u96c6. 2.5 \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31 \u5b66\u4e60\u6839\u636e\u83b7\u5f97\u7684\u8bcd\u6c47\u96c6,\u4f7f\u7528cypher\u8bed\u53e5\u5c06\u8bcd\u6c47\u5bfc\u5165\u5230\u56fe\u8c31\u5f53\u4e2d. 2.1 \u8bbe\u8ba1\u6807\u7b7e\u6811 \u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u8bbe\u8ba1\u6807\u7b7e\u6811\u7684\u539f\u56e0. \u638c\u63e1\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u8bbe\u8ba1\u6807\u7b7e\u6811\u7684\u539f\u56e0: \u6839\u636e\u4e1a\u52a1\u9700\u6c42, \u5bf9\u6587\u672c\u5206\u7c7b\u7684\u76ee\u6807\u8fdb\u884c\u660e\u786e, \u4fdd\u8bc1\u5206\u7c7b\u7ed3\u679c\u5bf9\u4e1a\u52a1\u6709\u76ca. \u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8. \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219: \u4e1a\u52a1\u5bfc\u5411\u539f\u5219: \u5c31\u662f\u8bf4\u6807\u7b7e\u8bbe\u8ba1\u5fc5\u987b\u4e0e\u516c\u53f8\u4e1a\u52a1\u5f3a\u76f8\u5173, \u660e\u786e\u4ea7\u54c1\u957f\u671f\u7a33\u5b9a\u9700\u6c42, \u5c3d\u91cf\u51cf\u5c11\u6807\u7b7e\u53d8\u52a8,\u8fd9\u9700\u8981\u6211\u4eec\u53bb\u4e86\u89e3\u81ea\u5df1\u516c\u53f8\u7684\u4ea7\u54c1\uff0c\u4e0d\u8981\u4e00\u5473\u53bb\u8ffd\u6c42\u5927\u800c\u5168. \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219: \u8981\u8bb0\u4f4f\u6211\u4eec\u7684\u6807\u7b7e\u4f53\u7cfb\u5c31\u50cf\u6a21\u578b\u4e00\u6837,\u662f\u4e0d\u65ad\u8fed\u4ee3\u7684\uff0c\u6240\u4ee5\u521d\u671f\u8bbe\u8ba1\u8981\u9075\u5faa\u6700\u5c0f\u53ef\u884c\u5316. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e: # \u4e00\u7ea7\u6807\u7b7e: {\"\u6cdb\u5a31\u4e50\": [\"\u660e\u661f\", \"\u7f8e\u5986\", \"\u65f6\u5c1a\", \"\u5f71\u89c6\", \"\u97f3\u4e50\", \"\u6e38\u620f\", \"\u7f8e\u98df\"]} # \u4e8c\u7ea7\u6807\u7b7e: { \"\u6e38\u620f\":[ \"LOL\", \"\u738b\u8005\u519c\u836f\", \"\u5403\u9e21\" ], \"\u5f71\u89c6\":[ \"\u559c\u5267\", \"\u7efc\u827a\", \"\u79d1\u5e7b\", \"\u6050\u6016\" ], \"\u97f3\u4e50\":[ \"\u6447\u6eda\u4e50\", \"\u6c11\u8c23\", \"Rap\", \"\u6d41\u884c\u4e50\" ] } \u7b2c\u4e09\u6b65: \u6807\u7b7e\u5b58\u50a8: # \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784: LABEL_STRUCTURE = [ { \"\u6cdb\u5a31\u4e50\":[ \"\u660e\u661f\", \"\u65f6\u5c1a\", \"\u6e38\u620f\", \"\u5f71\u89c6\", \"\u97f3\u4e50\", \"\u7f8e\u5986\" ] }, { \"\u6e38\u620f\":[ \"LOL\", \"\u738b\u8005\u519c\u836f\", \"\u5403\u9e21\" ], \"\u5f71\u89c6\":[ \"\u559c\u5267\", \"\u7efc\u827a\", \"\u79d1\u5e7b\", \"\u6050\u6016\" ], \"\u97f3\u4e50\":[ \"\u6447\u6eda\u4e50\", \"\u6c11\u8c23\", \"Rap\", \"\u6d41\u884c\u4e50\" ] } ] \u5c06LABEL_STRUCTURE\u4f5c\u4e3a\u914d\u7f6e\u9879\u5199\u5165\u5230/data/django-uwsgi/text_labeled/settings.py\u4e4b\u4e2d. \u5c0f\u8282\u603b\u7ed3: \u8bbe\u8ba1\u6807\u7b7e\u6811\u7684\u539f\u56e0: \u6839\u636e\u4e1a\u52a1\u9700\u6c42, \u5bf9\u6587\u672c\u5206\u7c7b\u7684\u76ee\u6807\u8fdb\u884c\u660e\u786e, \u4fdd\u8bc1\u5206\u7c7b\u7ed3\u679c\u5bf9\u4e1a\u52a1\u6709\u76ca. \u5b66\u4e60\u4e86\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8. \u5b66\u4e60\u4e86\u660e\u786e\u8bbe\u8ba1\u539f\u5219: \u4e1a\u52a1\u5bfc\u5411\u539f\u5219 \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219 \u5b66\u4e60\u4e86\u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u5b66\u4e60\u4e86\u6807\u7b7e\u5b58\u50a8: \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784. \u5e76\u5c06\u8be5\u7ed3\u6784\u5b58\u50a8\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d. 2.2 \u6784\u5efa\u6807\u7b7e\u6811 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5728\u56fe\u6570\u636e\u4e2d\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2. \u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6570\u636e\u5e93\u4e2d\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9, \u4ee5\u514d\u91cd\u590d\u521b\u5efa. \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868(LABEL_STRUCTURE)\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178. \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue,\u6839\u636ekey, MERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9. \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868,\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb. \u6807\u7b7e\u7ed3\u6784\u5217\u8868: LABEL_STRUCTURE = [ { \"\u6cdb\u5a31\u4e50\":[ \"\u660e\u661f\", \"\u65f6\u5c1a\", \"\u6e38\u620f\", \"\u5f71\u89c6\", \"\u97f3\u4e50\", \"\u7f8e\u5986\" ] }, { \"\u6e38\u620f\":[ \"LOL\", \"\u738b\u8005\u519c\u836f\", \"\u5403\u9e21\" ], \"\u5f71\u89c6\":[ \"\u559c\u5267\", \"\u7efc\u827a\", \"\u79d1\u5e7b\", \"\u6050\u6016\" ], \"\u97f3\u4e50\":[ \"\u6447\u6eda\u4e50\", \"\u6c11\u8c23\", \"Rap\", \"\u6d41\u884c\u4e50\" ] } ] \u6784\u5efa\u6807\u7b7e\u6811\u7684\u4ee3\u7801\u5206\u6790: # \u56e0\u4e3a\u6211\u4eec\u9700\u8981\u5bfc\u5165settings.py\u4e2d\u7684\u914d\u7f6e\u4fe1\u606f # \u6240\u4ee5\u9700\u8981\u5c06\u4e0a\u4e00\u7ea7\u8def\u5f84\u5bfc\u5165\u5230\u7cfb\u7edf\u8def\u5f84\u4e2d import sys sys.path.append('../') from neo4j.v1 import GraphDatabase from settings import NEO4J_CONFIG, LABEL_STRUCTURE def create_label_node_and_rel(): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u6807\u7b7e\u6811\u7684\u8282\u70b9\u548c\u8fb9\"\"\" _driver = GraphDatabase.driver(**NEO4J_CONFIG) with _driver.session() as session: # \u5220\u9664\u6240\u6709Label\u8282\u70b9\u4ee5\u53ca\u76f8\u5173\u8054\u7684\u8fb9 cypher = \"MATCH(a:Label) DETACH DELETE a\" session.run(cypher) def _create_node_rel(l: dict): \"\"\"\u6839\u636e\u6807\u7b7e\u6811\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178\u53bb\u521b\u5efa\u8282\u70b9\u548c\u5173\u7cfb\"\"\" if not l: return # \u904d\u5386\u5b57\u5178\u4e2d\u7684k,v\u5373\u7236\u5b50\u6807\u7b7e for k, v in l.items(): # MERGE\u4e00\u4e2a\u7236\u6807\u7b7e\u8282\u70b9 cypher = \"MERGE(a:Label{title:%r})\" % (k) session.run(cypher) def __c(word): \"\"\"\u7528\u4e8e\u521b\u5efa\u5b50\u6807\u7b7e\u8282\u70b9\u4ee5\u53ca\u4e0e\u7236\u6807\u7b7e\u4e4b\u95f4\u7684\u5173\u7cfb\"\"\" cypher = \"CREATE(a:Label{title:%r}) \\ SET a.name=%r WITH a \\ MATCH(b:Label{title:%r}) \\ MERGE(b)-[r:Contain]-(a)\" % (word, word, k) session.run(cypher) # \u904d\u5386\u5b50\u6807\u7b7e\u5217\u8868 list(map(__c, v)) # \u904d\u5386\u6807\u7b7e\u6811\u5217\u8868 list(map(_create_node_rel, LABEL_STRUCTURE)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/create_graph/build.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: \u8bfb\u53d6\u914d\u7f6e\u7684\u6807\u7b7e\u7ed3\u6784\u5217\u8868LABEL_STRUCTURE \u8f93\u51fa\u6548\u679c: \u5728neo4j\u53ef\u89c6\u5316\u9875\u9762\u4e2d\u67e5\u770b: http://0.0.0.0:7474 \u4e3b\u8981\u6ce8\u91ca: # \u56e0\u4e3a\u6211\u4eec\u9700\u8981\u5bfc\u5165settings.py\u4e2d\u7684\u914d\u7f6e\u4fe1\u606f # \u6240\u4ee5\u9700\u8981\u5c06\u4e0a\u4e00\u7ea7\u8def\u5f84\u5bfc\u5165\u5230\u7cfb\u7edf\u8def\u5f84\u4e2d \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u6807\u7b7e\u6811\u7684\u8282\u70b9\u548c\u8fb9\"\"\" # \u5220\u9664\u6240\u6709Label\u8282\u70b9\u4ee5\u53ca\u76f8\u5173\u8054\u7684\u8fb9 \"\"\"\u6839\u636e\u6807\u7b7e\u6811\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178\u53bb\u521b\u5efa\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u904d\u5386\u5b57\u5178\u4e2d\u7684k,v\u5373\u7236\u5b50\u6807\u7b7e # MERGE\u4e00\u4e2a\u7236\u6807\u7b7e\u8282\u70b9 \"\"\"\u7528\u4e8e\u521b\u5efa\u5b50\u6807\u7b7e\u8282\u70b9\u4ee5\u53ca\u4e0e\u7236\u6807\u7b7e\u4e4b\u95f4\u7684\u5173\u7cfb\"\"\" # \u904d\u5386\u5b50\u6807\u7b7e\u5217\u8868 # \u904d\u5386\u6807\u7b7e\u6811\u5217\u8868 \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6570\u636e\u5e93\u4e2d\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9, \u4ee5\u514d\u91cd\u590d\u521b\u5efa. \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868(LABEL_STRUCTURE)\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178. \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue,\u6839\u636ekey, MERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9. \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868,\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb. 2.3 \u83b7\u53d6\u539f\u59cb\u6570\u636e \u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u539f\u59cb\u6570\u636e\u7684\u6765\u6e90\u53ca\u5176\u6837\u5f0f. \u638c\u63e1\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027. \u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546,\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599. \u539f\u59cb\u6570\u636e\u6837\u5f0f: # \u660e\u661f \u73a9\u7b11\u5f52\u73a9\u7b11\uff0c\u8c08\u5230\u5f55\u5236\u611f\u53d7\u548c\u8bc4\u9009\u6807\u51c6\u65f6\uff0c\u6c88\u817e\u81ea\u7206\u81ea\u5df1\u662f\u6700\u5fc3\u8f6f\u7684\u89c2\u5bdf\u5458\uff0c\u7ed9\u7684yes\u6700\u591a\uff0c\u201c\u53ef\u80fd\u662f\u5e74\u7eaa\u5927\u4e86\uff0c\u7279\u522b\u5bb9\u6613\u88ab\u9009\u624b\u611f\u67d3\uff0c\u4e4b\u524d\u4e00\u4e2a\u6b4c\u624b\u521a\u5f00\u53e3\uff0c\u6211\u5c31\u5fcd\u4e0d\u4f4f\u60f3\u54ed\u201d\u3002 \u76f8\u5bf9\u800c\u8a00\uff0c\u91d1\u661f\u7b97\u662f\u6bd4\u8f83\u4e25\u683c\u7684\u68a6\u60f3\u89c2\u5bdf\u5458\uff0c\u5979\u5fc3\u76ee\u4e2d\u7684\u201c\u8fbe\u4eba\u201d\u8981\u5728\u81ea\u5df1\u7684\u666e\u901a\u751f\u6d3b\u4e4b\u5916\uff0c\u6709\u7740\u4e0e\u4f17\u4e0d\u540c\u4e14\u8db3\u591f\u6781\u81f4\u7684\u957f\u5904\uff0c\u201c\u6211\u5bf9\u6bcf\u4e2a\u8282\u76ee\u670940\u79d2\u7684\u5fcd\u8010\u671f\uff0c\u5982\u679c\u5728\u8fd9\u4e4b\u540e\u6ca1\u6709\u6253\u52a8\u6211\u7684\u4e1c\u897f\uff0c\u6211\u5c31\u4f1a\u6309no\u3002\u201d \u4f5c\u4e3a\u56e2\u5185\u6700\u5e74\u8f7b\u7684\u6210\u5458\uff0c\u6d3b\u6cfc\u7684\u6768\u5e42\u8868\u73b0\u51fa\u4e86\u9c9c\u660e\u7684\u201c\u56e2\u5ba0\u5c5e\u6027\u201d\u3002\u4e0d\u4ec5\u4eb2\u5207\u5730\u79f0\u547c\u6c88\u817e\u4e3a\u201c\u4e8c\u8205\u201d\u3001\u91d1\u661f\u4e3a\u201c\u91d1\u59e8\u201d\uff0c\u8fd8\u548c\u53e3\u4e2d\u7684\u201c\u6211\u54e5\u201d\u8521\u56fd\u5e86\u5171\u4eab\u6697\u53f7\u3002\u8282\u76ee\u5f55\u5236\u4e0b\u6765\uff0c\u6768\u5e42\u8c26\u865a\u8868\u793a\uff0c\u81ea\u5df1\u5728\u300a\u8fbe\u4eba\u79c0\u300b\u7684\u821e\u53f0\u4e0a\u89c1\u8bc6\u4e86\u5f88\u591a\u9707\u64bc\u7684\u8868\u6f14\uff0c\u662f\u4e00\u6b21\u957f\u89c1\u8bc6\u7684\u65c5\u7a0b\u3002\u81f3\u4e8e\u8bc4\u5224\u6807\u51c6\uff0c\u6768\u5e42\u5766\u8a00\uff0c\u81ea\u5df1\u5bf9\u4e8e\u4e00\u4e9b\u4e13\u4e1a\u8868\u6f14\u6ca1\u6709\u592a\u591a\u89c1\u89e3\uff0c\u4e3b\u8981\u5c0a\u5d07\u5185\u5fc3\u505a\u9009\u62e9\u3002 # \u65f6\u5c1a \u91c7\u8bbf\u4e2d\u5979\u66fe\u63d0\u5230\u5e0c\u671b\u5927\u5bb6\u5305\u5bb9\u5979\u5584\u5f85\u5979\uff0c\u4e0d\u7ba1\u662f\u5979\u9970\u6f14\u7684\u89d2\u8272\u8fd8\u662f\u5979\u672c\u4eba\u3002\u5979\u4e3a\u89d2\u8272\u53d1\u58f0\uff0c\u4e3a\u6821\u56ed\u9738\u51cc\u53d1\u58f0\uff0c\u540c\u6837\u4e3a\u81ea\u5df1\u53d1\u58f0\uff0c\u5e0c\u671b\u89c2\u4f17\u5bf9\u4e8e\u5979\u8fd9\u4e2a\u65b0\u4eba\u6f14\u5458\uff0c\u80fd\u5728\u7ed9\u4e88\u4e25\u683c\u7684\u8981\u6c42\u540c\u65f6\u66f4\u7ed9\u4e88\u60c5\u611f\u7684\u5305\u5bb9\u3002\u800c\u9762\u5bf9\u4e00\u4e9bdiss\u548c\u5632\u8bbd\u5979\u7684\u8a00\u8bed\uff0c\u5979\u4e5f\u8868\u793a\u4e0d\u4f1a\u56e0\u6b64\u800c\u6539\u53d8\uff0c\u800c\u662f\u4f1a\u9009\u62e9\u575a\u6301\u81ea\u6211\uff0c\u4e0d\u5fd8\u521d\u5fc3\uff0c\u505a\u81ea\u5df1\u3002\u5979\u66fe\u8bf4\u8fc7\u201c\u4eba\u751f\u672c\u65e0\u610f\u4e49\uff0c\u4eba\u7684\u5b58\u5728\u5c31\u662f\u4e3a\u4e86\u521b\u9020\u610f\u4e49\u3002\u201d\u5e74\u9f84\u867d\u5c0f\uff0c\u5374\u662f\u4e2a\u6709\u4e3b\u89c1\u6709\u81ea\u6211\u575a\u6301\u7684\u5973\u5b69\u3002 \u575a\u5b9a\u5982\u521d \u4e0a\u8863\uff1aHollister \u88e4\u5b50\uff1aHollister \u978b\uff1aMizuno \u8033\u73af\uff1aInch Edition \u8033\u5939\uff1aThing In Thing \u9752\u6625\u5c11\u5973\u6301\u5200\u51fa\u884c\uff0c\u5200\u97e7\u950b\u5229\u5374\u4e0d\u654c\u5979\u773c\u4e2d\u7684\u575a\u5b9a\u4e0e\u7099\u70ed\u3002\u8ba9\u6211\u4eec\u770b\u5230\u4e86\u4e00\u4e2a\u4e0d\u523020\u5c81\u7684\u5c11\u5973\u8d85\u51fa\u5e38\u4eba\u7684\u6210\u719f\uff0c\u548c\u5e74\u8f7b\u5145\u6ee1\u6d3b\u529b\u7684\u5c0f\u6027\u611f\u3002 \u7c89\u8272\u5957\u88c5\uff1aIsabel Marant \u978b\u5b50\uff1aStuart Weitzman \u8033\u73af\uff1aAtelier Swarovski # \u5f71\u89c6 \u7535\u5f71\u6709\u65e0\u9650\u7684\u53ef\u80fd\u6027\uff0c\u539f\u58f0\u97f3\u4e50\u4e5f\u80fd\u7ed9\u7535\u5f71\u521b\u4f5c\u63d0\u4f9b\u7075\u611f\uff0c\u7535\u5f71\u548c\u97f3\u4e50\u7684\u5173\u7cfb\u662f\u5f00\u653e\u7684\u3002\u4e3a\u53d1\u51fa\u8fd9\u6837\u7684\u8baf\u53f7\uff0cFIRST\u5f71\u5c55\u4eca\u5e74\u4e0eMOO\u97f3\u4e50\u643a\u624b\u5408\u4f5c\uff0c\u5728\u7535\u5f71\u8282\u671f\u95f4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7535\u5f71\u548c\u97f3\u4e50\u4ea4\u53c9\u7684\u573a\u666f\u3002 MOO\u97f3\u4e50\u96b6\u5c5e\u4e8e\u817e\u8baf\u97f3\u4e50\u5a31\u4e50\u96c6\u56e2\uff0c\u521b\u7acb\u4ee5\u6765\u53d7\u5230\u4e0d\u5c11\u6df1\u5ea6\u97f3\u4e50\u7231\u597d\u8005\u7684\u9752\u7750\u3002\u4ee5\u5929\u7136\u7684\u66f2\u5e93\u4f18\u52bf\u4e3a\u4f9d\u6258\uff0cMOO\u97f3\u4e50\u81f4\u529b\u4e8e\u878d\u5408\u5148\u950b\u4e0e\u7ecf\u5178\uff0c\u62d3\u5c55\u5f53\u4ee3\u6d41\u884c\u97f3\u4e50\u7684\u8fb9\u754c\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u7eaf\u7cb9\u7684\u6c89\u6d78\u5f0f\u97f3\u4e50\u4f53\u9a8c\uff0c\u81f4\u529b\u4e8e\u6210\u4e3a\u4e00\u4e2a\u5f15\u9886\u5f53\u4ee3\u9752\u5e74\u4eba\u53d1\u73b0\u3001\u63a2\u7d22\u65b0\u9c9c\u6d41\u884c\u4e50\u7684\u65b0\u4e00\u4ee3\u6f6e\u6d41\u97f3\u4e50APP\u3002 \u4f5c\u4e3aFIRST\u5f71\u5c55\u97f3\u4e50\u5e73\u53f0\u5408\u4f5c\u4f19\u4f34\uff0cMOO\u97f3\u4e50\u8d5e\u52a9\u4e86\u573a\u5916\u5956\u201c\u5148\u950b\u97f3\u4e50\u7a81\u7834\u5956\u201d\uff0c\u8fd9\u4e5f\u662fFIRST\u9996\u6b21\u8bbe\u7acb\u7535\u5f71\u97f3\u4e50\u65b9\u5411\u7684\u4e13\u9879\u5956\u3002\u4e3a\u300a\u6625\u6f6e\u300b\u914d\u4e50\u7684\u97f3\u4e50\u4eba\u534a\u91ce\u559c\u5f18\u83b7\u5f97\u4e86\u8fd9\u4e00\u5956\u9879\uff0cMOO\u97f3\u4e50\u4ea7\u54c1\u8d1f\u8d23\u4eba\u738b\u5b9d\u534e\u4e3a\u4ed6\u9881\u5956\uff0c\u79f0\u8d5e\u201c\u8fd9\u662f\u5148\u950b\u7684\u97f3\u4e50\u201d\u3002 \u534a\u91ce\u559c\u5f18\u7684\u4f5c\u54c1\u7ecf\u5e38\u51fa\u73b0\u5728\u4faf\u5b5d\u8d24\u548c\u8d3e\u6a1f\u67ef\u5bfc\u6f14\u7684\u7535\u5f71\u91cc\uff0c\u300a\u620f\u68a6\u4eba\u751f\u300b\u300a\u6d77\u4e0a\u82b1\u300b\u300a\u5c71\u6cb3\u6545\u4eba\u300b\u4e2d\u7684\u914d\u4e50\u90fd\u4f53\u73b0\u4e86\u4ed6\u6210\u719f\u7684\u97f3\u4e50\u601d\u7ef4\u548c\u5bf9\u5f71\u50cf\u72ec\u7acb\u3001\u7acb\u4f53\u7684\u7406\u89e3\u3002\u300a\u6625\u6f6e\u300b\u5bfc\u6f14\u6768\u8354\u94a0\u66fe\u8fd9\u6837\u63cf\u8ff0\u4ed6\u4eec\u7684\u521b\u4f5c\u8fc7\u7a0b\uff1a\u201c\u4ed6\u9694\u7a7a\u5bf9\u8bdd\uff0c\u89c6\u9891\u4f20\u9001\uff0c\u53cd\u8986\u4fee\u6539\u4f60\u7684\u65cb\u5f8b\uff0c\u300a\u6625\u68a6\u300b\u300a\u6625\u6f6e\u300b\u90fd\u7559\u6709\u4ed6\u8c31\u5199\u7684\u4e50\u7ae0\u3002\u201d\u300a\u6625\u6f6e\u300b\u540c\u65f6\u5c06\u5728\u5ba3\u53d1\u9636\u6bb5\u5f97\u5230MOO\u548cQQ\u97f3\u4e50\u7684\u63a8\u5e7f\u8d44\u6e90\uff0c\u7b49\u5f85\u65e9\u65e5\u4e0e\u89c2\u4f17\u89c1\u9762\u3002 # \u7f8e\u5986 \u6021\u4e3d\u4e1d\u5c14\u4f18\u60a6\u6d3b\u989c\u773c\u5507\u629a\u7eb9\u7cbe\u534e\u971c\u775b\u91c7\u4e0a\u5e02 9\u5468\u6de1\u7eb9,\u773c\u8bc1\u4e3a\u5b9e\uff0c\u65b0\u4e00\u7ebf\u5973\u6027\u751f\u6d3b\u771f\u76f8\u4ee3\u8868papi\u9171\u5e26\u4f60\u4e00\u540c\u89c1\u8bc1 2018\u5e745\u670810\u65e5,\u6021\u4e3d\u4e1d\u5c14\u4e8e\u5317\u4eac\u865e\u793e\u6f14\u827a\u7a7a\u95f4\u4e3e\u529e\u5168\u65b0\u4f18\u60a6\u6d3b\u989c\u773c\u5507\u629a\u7eb9\u7cbe\u534e\u971c\u65b0\u54c1\u53d1\u5e03\u4f1a.\u54c1\u724c\u603b\u76d1\u4e0a\u7530\u5178\u53f2\u5148\u751f\u4eb2\u4e34\u73b0\u573a\uff0c\u66f4\u643a\u624b\u77e5\u540d\u539f\u521b\u89c6\u9891\u8fbe\u4ebapapi\u9171\u4f5c\u4e3a\u7279\u9080\u771f\u76f8\u89c1\u8bc1\u4eba\uff0c\u63ed\u6653\u300a\u65b0\u4e00\u7ebf\u5973\u6027\u751f\u6d3b\u771f\u76f8\u300b\u767d\u76ae\u4e66\uff0c\u76db\u9080\u6765\u81ea\u5168\u56fd\u5404\u5730\u7684\u4e3b\u6d41\u65f6\u5c1a\u7f8e\u5986\u5a92\u4f53\u3001\u4f17\u591a\u77e5\u540d\u7f8e\u5986\u535a\u4e3b\u53ca\u62a4\u80a4\u8fbe\u4eba\u5171\u540c\u52a0\u5165\u201c9\u5468\u6de1\u7eb9\uff0c\u773c\u8bc1\u4e3a\u5b9e\u201d\u7684\u89c1\u8bc1\u4eba\u884c\u5217\u4e2d\u6765\u3002 \u9996\u5148\u6620\u5165\u773c\u5e18\u7684\u662f\u4e00\u4e2a\u6570\u5b57\u201c9\u201d\u9020\u578b\u7684\u901a\u9053,\u7f6e\u8eab\u5176\u4e2d\uff0c\u4e00\u6761\u6761\u5173\u4e8e\u62a4\u80a4\u7684\u201c\u771f\u76f8\u201d\u5f39\u5e55\u88ad\u6765\uff1a\u201c\u4e2d\u5e74\u5c11\u5973\u9009\u8d2d\u62a4\u80a4\u54c1\u6709\u591a\u6311\u5254\u201d\u3001\u201c\u731c\u731c\u4f60\u7684\u8870\u8001\u4e34\u754c\u70b9\u5728\u51e0\u70b9\u201d\u7b49\u95ee\u9898\u8ba9\u6765\u5bbe\u4f1a\u5fc3\u4e00\u7b11\u7684\u540c\u65f6\uff0c\u4ea6\u5f15\u53d1\u4e86\u62a4\u80a4\u771f\u76f8\u7684\u8bf8\u591a\u601d\u8003.\u6021\u4e3d\u4e1d\u5c14\u59cb\u7ec8\u81f4\u529b\u4e8e\u4e9a\u6d32\u5973\u6027\u4e4b\u7f8e\uff0c\u672c\u6b21\u8054\u5408\u4e2d\u56fd\u9886\u5148\u7684\u793e\u4f1a\u5316\u5546\u4e1a\u8d44\u8baf\u63d0\u4f9b\u673a\u6784Kantar Media CIC\uff0c\u5c06\u591a\u5e74\u6765\u5bf9\u4e2d\u56fd\u5973\u6027\u7684\u5173\u6ce8\u6c47\u805a\u4e3a\u4e00\u672c\u72ec\u5177\u89c1\u89e3\u4e0e\u6d1e\u5bdf\u529b\u7684\u300a\u65b0\u4e00\u7ebf\u5973\u6027\u751f\u6d3b\u771f\u76f8\u300b\u767d\u76ae\u4e66\uff0c\u901a\u8fc7\u5927\u6570\u636e\u7834\u89e3\u65b0\u4e00\u7ebf\u5973\u6027\u7684\u76b1\u7eb9\u79d8\u5bc6\uff0c\u4ece\u793e\u4f1a\u70ed\u70b9\u3001\u751f\u6d3b\u65b9\u5f0f\u548c\u62a4\u80a4\u4e60\u60ef\u4e09\u4e2a\u65b9\u9762\u5524\u8d77\u5927\u5bb6\u5bf9\u76b1\u7eb9\u7684\u8ba4\u77e5\u53ca\u91cd\u89c6\u3002 \u6021\u4e3d\u4e1d\u5c14\u54c1\u724c\u603b\u76d1\u4e0a\u7530\u5178\u53f2\u5148\u751f\u8868\u793a\uff1a \u201c\u81ea2017\u5e74\u5728\u4e2d\u56fd\u5f00\u5c55\u54c1\u724c\u9769\u65b0\u4ee5\u6765,\u6021\u4e3d\u4e1d\u5c14\u4ece\u672a\u505c\u4e0b\u811a\u6b65\uff0c\u4e0d\u65ad\u5411\u524d.\u6211\u4eec\u59cb\u7ec8\u5173\u6ce8\u4e9a\u6d32\u5973\u6027\u4e4b\u7f8e\uff0c\u81f4\u529b\u4e8e\u4e3a\u6d88\u8d39\u8005\u63d0\u4f9b\u6301\u7eed\u521b\u65b0\u7684\u4ea7\u54c1\u548c\u4ef7\u503c\u4f53\u9a8c\u3002\u5728\u8fd9\u6837\u7684\u54c1\u724c\u613f\u666f\u4e0b\uff0c\u6021\u4e3d\u4e1d\u5c14\u5c06\u76ee\u5149\u805a\u7126\u4e8e\u5f53\u4e0b\u4e2d\u56fd\u65b0\u4e00\u7ebf\u5973\u6027\u7684\u751f\u6d3b\u3002\u6211\u4eec\u53d1\u73b0\u5c3d\u7ba1\u5927\u90e8\u5206\u4e2d\u56fd\u5973\u6027\u5341\u5206\u6ce8\u91cd\u6297\u8001\u5316\u95ee\u9898\uff0c\u4f46\u5374\u666e\u904d\u8ba4\u4e3a\u62a4\u80a4\u4ea7\u54c1\u6548\u679c\u4e0d\u5c3d\u4eba\u610f\u3002\u4e3a\u6ee1\u8db3\u5e7f\u5927\u4e2d\u56fd\u6d88\u8d39\u8005\u5bf9\u4e8e\u629a\u7eb9\u7684\u62a4\u80a4\u8bc9\u6c42\uff0c\u6b64\u6b21\u5168\u65b0\u63a8\u51fa\u4e86\u529f\u6548\u8ba4\u8bc1\u7684\u6021\u4e3d\u4e1d\u5c14\u4f18\u60a6\u6d3b\u989c\u773c\u5507\u629a\u7eb9\u7cbe\u534e\u971c\uff0c\u4e0d\u4ec5\u662f\u54c1\u724c\u4ef7\u503c\u7684\u6709\u529b\u8bc1\u660e\uff0c\u66f4\u6807\u5fd7\u7740\u6021\u4e3d\u4e1d\u5c14\u53c8\u4e00\u6b21\u7684\u521b\u65b0\u4e0e\u7a81\u7834\u3002\u6211\u4eec\u671f\u5f85\u8fd9\u6b3e\u4ea7\u54c1\u8ba9\u66f4\u591a\u4e2d\u56fd\u5973\u6027\u7efd\u653e\u81ea\u4fe1\u4e0e\u5065\u5eb7\u7684\u5149\u8292\uff0c\u6210\u5c31\u79ef\u6781\u5411\u4e0a\u4e0e\u81ea\u4fe1\u575a\u5f3a\u7684\u9b45\u529b\u4eba\u751f\uff0c\u9047\u89c1\u66f4\u597d\u7684\u81ea\u5df1\u3002 \u201c \u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027: \u6587\u7ae0\u4e3a\u77ed\u6587,\u5728\u51e0\u767e\u81f3\u51e0\u5343\u5b57\u4e0d\u7b49. \u5185\u5bb9\u56f4\u7ed5\u660e\u786e\u7684\u4e3b\u9898\u5c55\u5f00,\u5176\u4e2d\u6d89\u730e\u5f88\u591a\u76f8\u5173\u547d\u540d\u5b9e\u4f53. \u5b8c\u6574\u53e5\u5b50\u4f7f\u7528\u53e5\u53f7\u5206\u5272,\u5c0f\u6bb5\u4f7f\u7528\u6362\u884c\u7b26\u5206\u5272. \u539f\u59cb\u8bed\u6599\u5b58\u653e\u7684\u4f4d\u7f6e: \u5b58\u653e\u5728/data/django-uwsgi/text_labeled/create_graph/\u76ee\u5f55\u4e0b. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546,\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6837\u5f0f. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027: \u6587\u7ae0\u4e3a\u77ed\u6587,\u5728\u51e0\u767e\u81f3\u51e0\u5343\u5b57\u4e0d\u7b49. \u5185\u5bb9\u56f4\u7ed5\u660e\u786e\u7684\u4e3b\u9898\u5c55\u5f00,\u5176\u4e2d\u6d89\u730e\u5f88\u591a\u76f8\u5173\u547d\u540d\u5b9e\u4f53. \u5b8c\u6574\u53e5\u5b50\u4f7f\u7528\u53e5\u53f7\u5206\u5272,\u5c0f\u6bb5\u4f7f\u7528\u6362\u884c\u7b26\u5206\u5272. 2.4 \u83b7\u53d6\u8bcd\u6c47\u96c6 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4. \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u548cuserdict.txt\u4e4b\u4e2d. \u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import os import jieba # \u4f7f\u7528jieba\u4e2d\u7684\u8bcd\u6027\u6807\u6ce8\u529f\u80fd import jieba.posseg as pseg # jieba\u4e2d\u9884\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u7c7b\u578b,\u5206\u522b\u8868\u793a: \u4eba\u540d\uff0c\u540d\u8bcd\uff0c\u5730\u540d\uff0c\u673a\u6784\u56e2\u4f53\u540d\uff0c\u5176\u4ed6\u4e13\u6709\u540d\u8bcd n_e = [\"nr\", \"n\", \"ns\", \"nt\", \"nz\"] # \u5199\u5165csv\u7684\u8def\u5f84 csv_path = \"./labels\" # \u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84 userdict_path = \"../userdict.txt\" def get_vocabulary(article_path, csv_name): \"\"\"\u51fd\u6570\u5c06\u8bfb\u53d6\u6587\u7ae0\u8def\u5f84\u4e0b\u7684\u6240\u6709\u6587\u7ae0\u6587\u672c,\u5e76\u8f6c\u5316\u4e3a\u8bcd\u6c47\u5199\u5165\u8bcd\u6c47csv\u6587\u4ef6\"\"\" if not os.path.exists(article_path): return if not os.path.exists(csv_path): os.mkdir(csv_path) def _get_n_list(text): \"\"\"\u7528\u4e8e\u83b7\u53d6\u540d\u8bcd\u5217\u8868\"\"\" # \u4f7f\u7528jieba\u7684\u8bcd\u6027\u6807\u6ce8\u65b9\u6cd5\u5207\u5206\u6587\u672c,\u83b7\u5f97\u5177\u6709\u8bcd\u6027\u5c5e\u6027flag\u548c\u8bcd\u6c47\u5c5e\u6027word\u7684\u5bf9\u8c61, # \u4ece\u800c\u5224\u65adflag\u662f\u5426\u5728\u6211\u4eec\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u5217\u8868\u4e2d,\u6765\u8fd4\u56de\u5bf9\u5e94\u7684\u8bcd\u6c47 r = [] for g in pseg.lcut(text): if g.flag in n_e: r.append(g.word) return r with open(os.path.join(csv_path, csv_name), \"a\") as u: for article in os.listdir(article_path): with open(os.path.join(article_path, article), \"r\") as f: text = f.read() # \u53ea\u83b7\u53d6\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e2\u7684\u540d\u8bcd n_list = list(filter(lambda x: len(x)>=2, set(_get_n_list(text)))) list(map(lambda x: u.write(x + \"\\n\"), n_list)) with open(os.path.join(csv_path, csv_name), \"r\") as o: word = o.read() with open(userdict_path, \"a\") as f: f.write(word) return \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/create_graph/get_vocab.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u539f\u59cb\u6587\u7ae0\u8def\u5f84 article_path = \"./fashion\" # \u751f\u6210\u7684csv\u6587\u4ef6\u540d\u5b57(\u8be5\u6587\u4ef6\u5728./labels\u76ee\u5f55\u4e0b) csv_name = \"\u65f6\u5c1a.csv\" \u8f93\u51fa\u6548\u679c: # \u65f6\u5c1a.csv \u798f\u5229 \u5fc3\u60c5 \u5f20\u626c \u8170\u8eab T\u6064 \u95f2\u6687 \u589e\u8272 \u7f8e\u989c \u4e0a\u6d77 \u5168\u8eab \u4e2a\u4eba \u9020\u578b \u65f6\u523b \u5370\u8c61\u6d3e \u84dd\u8272 \u9774\u5b50 \u4e3b\u8981\u6ce8\u91ca: # \u4f7f\u7528jieba\u4e2d\u7684\u8bcd\u6027\u6807\u6ce8\u529f\u80fd # jieba\u4e2d\u9884\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u7c7b\u578b,\u5206\u522b\u8868\u793a: \u4eba\u540d\uff0c\u540d\u8bcd\uff0c\u5730\u540d\uff0c\u673a\u6784\u56e2\u4f53\u540d\uff0c\u5176\u4ed6\u4e13\u6709\u540d\u8bcd # \u5199\u5165csv\u7684\u8def\u5f84 # \u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84 \"\"\"\u51fd\u6570\u5c06\u8bfb\u53d6path\u8def\u5f84\u4e0b\u7684\u6240\u6709\u6587\u7ae0\u6587\u672c,\u5e76\u8f6c\u5316\u4e3a\u8bcd\u6c47\u5199\u5165\u8bcd\u6c47csv\u6587\u4ef6\"\"\" \"\"\"\u7528\u4e8e\u83b7\u53d6\u540d\u8bcd\u5217\u8868\"\"\" # \u4f7f\u7528jieba\u7684\u8bcd\u6027\u6807\u6ce8\u65b9\u6cd5\u5207\u5206\u6587\u672c,\u83b7\u5f97\u5177\u6709\u8bcd\u6027\u5c5e\u6027flag\u548c\u8bcd\u6c47\u5c5e\u6027word\u7684\u5bf9\u8c61, # \u4ece\u800c\u5224\u65adflag\u662f\u5426\u5728\u6211\u4eec\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u5217\u8868\u4e2d,\u6765\u8fd4\u56de\u5bf9\u5e94\u7684\u8bcd\u6c47 # \u53ea\u83b7\u53d6\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e2\u7684\u540d\u8bcd \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4. \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u548cuserdict.txt\u4e4b\u4e2d. 2.5 \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65: \u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6. \u7b2c\u4e09\u6b65: \u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u53bb\u521b\u5efa\u8282\u70b9\uff0c\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb. \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790\uff1a import os import random import fileinput csv_path = \"./labels\" def create_vocabulary_node_and_rel(): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u8bcd\u6c47\u8282\u70b9\u548c\u5173\u7cfb\"\"\" _driver = GraphDatabase.driver(**NEO4J_CONFIG) with _driver.session() as session: # \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 cypher = \"MATCH(a:Vocabulary) DETACH DELETE a\" session.run(cypher) def _create_v_and_r(csv): \"\"\"\u8bfb\u53d6\u5355\u4e2acsv\u6587\u4ef6,\u5e76\u5199\u5165\u6570\u636e\u5e93\u521b\u5efa\u8282\u70b9\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb\"\"\" path = os.path.join(csv_path, csv) # \u4f7f\u7528fileinput\u7684FileInput\u65b9\u6cd5\u4ece\u6301\u4e45\u5316\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e, # \u5e76\u8fdb\u884cstrip()\u64cd\u4f5c\u53bb\u6389\u4e24\u4fa7\u7a7a\u767d\u7b26, \u518d\u901a\u8fc7set\u6765\u53bb\u91cd. word_list = list( set(map(lambda x: x.strip(), fileinput.FileInput(path)))) def __create_node(word): \"\"\"\u521b\u5efacsv\u4e2d\u5355\u4e2a\u8bcd\u6c47\u7684\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u5b9a\u4e49\u8bcd\u6c47\u7684\u521d\u59cb\u5316\u6743\u91cd,\u5373\u8bcd\u6c47\u5c5e\u4e8e\u67d0\u4e2a\u6807\u7b7e\u7684\u521d\u59cb\u6982\u7387\uff0c # \u56e0\u4e3a\u8bcd\u6c47\u672c\u8eab\u6765\u81ea\u8be5\u7c7b\u578b\u6587\u7ae0\uff0c\u56e0\u6b64\u521d\u59cb\u6982\u7387\u5b9a\u4e49\u57280.5-1\u4e4b\u95f4\u7684\u968f\u673a\u6570 weight = round(random.uniform(0.5, 1), 3) # \u4f7f\u7528cypher\u8bed\u53e5\u521b\u5efa\u8bcd\u6c47\u8282\u70b9,\u7136\u540e\u5339\u914d\u8fd9\u4e2acsv\u6587\u4ef6\u540d\u5b57\u81f3\u540e\u56db\u4f4d\u5373\u7c7b\u522b\u540d\uff0c # \u5728\u4e24\u8005\u4e4b\u95f4MERGE\u4e00\u6761\u6709\u6743\u91cd\u7684\u8fb9 cypher = \"CREATE(a:Vocabulary{name:%r}) WITH a \\ MATCH(b:Label{title:%r}) \\ MERGE(a)-[r:Related{weight:%f}]-(b)\" % (word, csv[:-4], weight) session.run(cypher) # \u904d\u5386\u8bcd\u6c47\u5217\u8868 list(map(__create_node, word_list)) # \u904d\u5386\u6807\u7b7e\u5217\u8868 label_list = os.listdir(csv_path) list(map(_create_v_and_r, label_list)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/create_graph/build.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u8bcd\u6c47\u96c6csv\u6587\u4ef6\u8def\u5f84 csv_path = \"./labels\" \u8f93\u51fa\u6548\u679c: \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u8bcd\u6c47\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \"\"\"\u8bfb\u53d6\u5355\u4e2acsv\u6587\u4ef6,\u5e76\u5199\u5165\u6570\u636e\u5e93\u521b\u5efa\u8282\u70b9\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb\"\"\" # \u4f7f\u7528fileinput\u7684FileInput\u65b9\u6cd5\u4ece\u6301\u4e45\u5316\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e, # \u5e76\u8fdb\u884cstrip()\u64cd\u4f5c\u53bb\u6389\u4e24\u4fa7\u7a7a\u767d\u7b26, \u518d\u901a\u8fc7set\u6765\u53bb\u91cd. \"\"\"\u521b\u5efacsv\u4e2d\u5355\u4e2a\u8bcd\u6c47\u7684\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u5b9a\u4e49\u8bcd\u6c47\u7684\u521d\u59cb\u5316\u6743\u91cd,\u5373\u8bcd\u6c47\u5c5e\u4e8e\u67d0\u4e2a\u6807\u7b7e\u7684\u521d\u59cb\u6982\u7387\uff0c # \u56e0\u4e3a\u8bcd\u6c47\u672c\u8eab\u6765\u81ea\u8be5\u7c7b\u578b\u6587\u7ae0\uff0c\u56e0\u6b64\u521d\u59cb\u6982\u7387\u5b9a\u4e49\u57280.5-1\u4e4b\u95f4\u7684\u968f\u673a\u6570 # \u4f7f\u7528cypher\u8bed\u53e5\u521b\u5efa\u8bcd\u6c47\u8282\u70b9,\u7136\u540e\u5339\u914d\u8fd9\u4e2acsv\u6587\u4ef6\u540d\u5b57\u81f3\u540e\u56db\u4f4d\u5373\u7c7b\u522b\u540d\uff0c # \u5728\u4e24\u8005\u4e4b\u95f4MERGE\u4e00\u6761\u6709\u6743\u91cd\u7684\u8fb9 # \u904d\u5386\u8bcd\u6c47\u5217\u8868 # \u904d\u5386\u6807\u7b7e\u5217\u8868 \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65: \u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6. \u7b2c\u4e09\u6b65: \u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u521b\u5efa\u8282\u70b9\uff0c\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb. \u672c\u7ae0\u603b\u7ed3 \u7b2c1\u5c0f\u8282: \u8bbe\u8ba1\u6807\u7b7e\u6811 \u5b66\u4e60\u4e86\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8. \u5b66\u4e60\u4e86\u660e\u786e\u8bbe\u8ba1\u539f\u5219: \u4e1a\u52a1\u5bfc\u5411\u539f\u5219 \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219 \u5b66\u4e60\u4e86\u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u5b66\u4e60\u4e86\u6807\u7b7e\u5b58\u50a8: \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784. \u7b2c2\u5c0f\u8282: \u6784\u5efa\u6807\u7b7e\u6811 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9. \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178. \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue,\u6839\u636ekey\uff0cMERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9. \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868,\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb. \u7b2c3\u5c0f\u8282: \u83b7\u53d6\u539f\u59cb\u6570\u636e \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546,\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6837\u5f0f. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027. \u7b2c4\u5c0f\u8282: \u83b7\u53d6\u8bcd\u6c47\u96c6 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4. \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u4e4b\u4e2d. \u7b2c5\u5c0f\u8282: \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65,\u5220\u9664\u6240\u6709\u4e0e\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65,\u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6. \u7b2c\u4e09\u6b65,\u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u521b\u5efa\u8282\u70b9, \u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb.","title":"\u7b2c\u4e8c\u7ae0:\u6784\u5efa\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31"},{"location":"2/#_1","text":"\u5b66\u4e60\u76ee\u6807: \u4f7f\u7528\u56fe\u6570\u636e\u5e93neo4j\u6784\u5efa\u8d77\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31,\u7528\u4e8e\u57fa\u4e8e\u8bcd\u6c47\u7684\u6807\u7b7e\u5339\u914d\u5de5\u4f5c. \u5f15\u5bfc\u5206\u6790: \u56fe\u4e2d\u7684\u84dd\u8272\u8282\u70b9\u4ee3\u8868\u6807\u7b7e,\u56e0\u4e3a\u7ed9\u6587\u672c\u6253\u4e0a\u4ec0\u4e48\u6807\u7b7e\u662f\u548c\u4e1a\u52a1\u7d27\u5bc6\u76f8\u8fde\u7684\uff0c\u56e0\u6b64\u5b83\u662f\u6211\u4eec\u6839\u636e\u4e1a\u52a1\u8bbe\u8ba1\u7684\uff0c\u8bbe\u8ba1\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u56fe\u6570\u636e\u5e93\u8bed\u8a00cypher\u5728\u56fe\u6570\u636e\u5e93\u4e2d\u6784\u5efa\u5b83. \u56fe\u4e2d\u7684\u6a58\u8272\u8282\u70b9\u4ee3\u8868\u8bcd\u6c47,\u8bcd\u6c47\u4e00\u822c\u662f\u6307\u4e0e\u8fde\u63a5\u6807\u7b7e\u76f8\u5173\u7684\u540d\u8bcd\uff0c\u8fd9\u4e9b\u540d\u8bcd\u6765\u81ea\u4e8e\u6240\u8c13\u7684\u539f\u59cb\u6570\u636e\uff0c\u6211\u4eec\u8fd9\u91cc\u7684\u539f\u59cb\u662f\u7531\u516c\u53f8\u5185\u90e8\u7684\u4eba\u5458\u63d0\u4f9b\u7684.\u5728\u6709\u4e86\u539f\u59cb\u6570\u636e\u540e\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u4ece\u4e2d\u8fdb\u884c\u83b7\u53d6\u8bcd\u6c47\u96c6\uff0c\u6700\u540e\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u3002 \u6784\u5efa\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31\u7684\u4e94\u4e2a\u6b65\u9aa4: \u672c\u7ae0\u5c0f\u8282: 2.1 \u8bbe\u8ba1\u6807\u7b7e\u6811 \u5b66\u4e60\u8bbe\u8ba1\u4e00\u9897\u548c\u4e1a\u52a1\u6709\u5f88\u5927\u7684\u5173\u8054\u7684\u6807\u7b7e\u6811, \u5e94\u9075\u5faa\u4e00\u4e9b\u8bbe\u8ba1\u539f\u5219, \u4fdd\u8bc1\u6807\u7b7e\u6811\u7684\u5408\u7406\u6027. 2.2 \u6784\u5efa\u6807\u7b7e\u6811 \u5b66\u4e60\u6839\u636e\u8bbe\u8ba1\u7684\u6807\u7b7e\u6811,\u5728neo4j\u4e2d\u5b58\u50a8\u8fd9\u4e2a\u7ed3\u6784. 2.3 \u83b7\u53d6\u539f\u59cb\u6570\u636e \u5b66\u4e60\u539f\u59cb\u6570\u636e\u6709\u5173\u7684\u5185\u5bb9,\u8ba9\u5927\u5bb6\u6211\u5bf9\u6211\u4eec\u7684\u6570\u636e\u6709\u6df1\u523b\u7684\u7406\u89e3. 2.4 \u83b7\u53d6\u8bcd\u6c47\u96c6 \u5b66\u4e60\u6839\u636e\u539f\u59cb\u6570\u636e, \u8fdb\u884c\u4e00\u4e9b\u62bd\u53d6\u5de5\u4f5c, \u83b7\u5f97\u51c6\u5907\u5bfc\u5165\u56fe\u8c31\u7684\u8bcd\u6c47\u96c6. 2.5 \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31 \u5b66\u4e60\u6839\u636e\u83b7\u5f97\u7684\u8bcd\u6c47\u96c6,\u4f7f\u7528cypher\u8bed\u53e5\u5c06\u8bcd\u6c47\u5bfc\u5165\u5230\u56fe\u8c31\u5f53\u4e2d.","title":"\u672c\u7ae0\u5bfc\u5b66"},{"location":"2/#21","text":"\u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u8bbe\u8ba1\u6807\u7b7e\u6811\u7684\u539f\u56e0. \u638c\u63e1\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u8bbe\u8ba1\u6807\u7b7e\u6811\u7684\u539f\u56e0: \u6839\u636e\u4e1a\u52a1\u9700\u6c42, \u5bf9\u6587\u672c\u5206\u7c7b\u7684\u76ee\u6807\u8fdb\u884c\u660e\u786e, \u4fdd\u8bc1\u5206\u7c7b\u7ed3\u679c\u5bf9\u4e1a\u52a1\u6709\u76ca. \u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8. \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219: \u4e1a\u52a1\u5bfc\u5411\u539f\u5219: \u5c31\u662f\u8bf4\u6807\u7b7e\u8bbe\u8ba1\u5fc5\u987b\u4e0e\u516c\u53f8\u4e1a\u52a1\u5f3a\u76f8\u5173, \u660e\u786e\u4ea7\u54c1\u957f\u671f\u7a33\u5b9a\u9700\u6c42, \u5c3d\u91cf\u51cf\u5c11\u6807\u7b7e\u53d8\u52a8,\u8fd9\u9700\u8981\u6211\u4eec\u53bb\u4e86\u89e3\u81ea\u5df1\u516c\u53f8\u7684\u4ea7\u54c1\uff0c\u4e0d\u8981\u4e00\u5473\u53bb\u8ffd\u6c42\u5927\u800c\u5168. \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219: \u8981\u8bb0\u4f4f\u6211\u4eec\u7684\u6807\u7b7e\u4f53\u7cfb\u5c31\u50cf\u6a21\u578b\u4e00\u6837,\u662f\u4e0d\u65ad\u8fed\u4ee3\u7684\uff0c\u6240\u4ee5\u521d\u671f\u8bbe\u8ba1\u8981\u9075\u5faa\u6700\u5c0f\u53ef\u884c\u5316. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e: # \u4e00\u7ea7\u6807\u7b7e: {\"\u6cdb\u5a31\u4e50\": [\"\u660e\u661f\", \"\u7f8e\u5986\", \"\u65f6\u5c1a\", \"\u5f71\u89c6\", \"\u97f3\u4e50\", \"\u6e38\u620f\", \"\u7f8e\u98df\"]} # \u4e8c\u7ea7\u6807\u7b7e: { \"\u6e38\u620f\":[ \"LOL\", \"\u738b\u8005\u519c\u836f\", \"\u5403\u9e21\" ], \"\u5f71\u89c6\":[ \"\u559c\u5267\", \"\u7efc\u827a\", \"\u79d1\u5e7b\", \"\u6050\u6016\" ], \"\u97f3\u4e50\":[ \"\u6447\u6eda\u4e50\", \"\u6c11\u8c23\", \"Rap\", \"\u6d41\u884c\u4e50\" ] } \u7b2c\u4e09\u6b65: \u6807\u7b7e\u5b58\u50a8: # \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784: LABEL_STRUCTURE = [ { \"\u6cdb\u5a31\u4e50\":[ \"\u660e\u661f\", \"\u65f6\u5c1a\", \"\u6e38\u620f\", \"\u5f71\u89c6\", \"\u97f3\u4e50\", \"\u7f8e\u5986\" ] }, { \"\u6e38\u620f\":[ \"LOL\", \"\u738b\u8005\u519c\u836f\", \"\u5403\u9e21\" ], \"\u5f71\u89c6\":[ \"\u559c\u5267\", \"\u7efc\u827a\", \"\u79d1\u5e7b\", \"\u6050\u6016\" ], \"\u97f3\u4e50\":[ \"\u6447\u6eda\u4e50\", \"\u6c11\u8c23\", \"Rap\", \"\u6d41\u884c\u4e50\" ] } ] \u5c06LABEL_STRUCTURE\u4f5c\u4e3a\u914d\u7f6e\u9879\u5199\u5165\u5230/data/django-uwsgi/text_labeled/settings.py\u4e4b\u4e2d. \u5c0f\u8282\u603b\u7ed3: \u8bbe\u8ba1\u6807\u7b7e\u6811\u7684\u539f\u56e0: \u6839\u636e\u4e1a\u52a1\u9700\u6c42, \u5bf9\u6587\u672c\u5206\u7c7b\u7684\u76ee\u6807\u8fdb\u884c\u660e\u786e, \u4fdd\u8bc1\u5206\u7c7b\u7ed3\u679c\u5bf9\u4e1a\u52a1\u6709\u76ca. \u5b66\u4e60\u4e86\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8. \u5b66\u4e60\u4e86\u660e\u786e\u8bbe\u8ba1\u539f\u5219: \u4e1a\u52a1\u5bfc\u5411\u539f\u5219 \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219 \u5b66\u4e60\u4e86\u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u5b66\u4e60\u4e86\u6807\u7b7e\u5b58\u50a8: \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784. \u5e76\u5c06\u8be5\u7ed3\u6784\u5b58\u50a8\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d.","title":"2.1 \u8bbe\u8ba1\u6807\u7b7e\u6811"},{"location":"2/#22","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5728\u56fe\u6570\u636e\u4e2d\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2. \u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6570\u636e\u5e93\u4e2d\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9, \u4ee5\u514d\u91cd\u590d\u521b\u5efa. \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868(LABEL_STRUCTURE)\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178. \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue,\u6839\u636ekey, MERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9. \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868,\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb. \u6807\u7b7e\u7ed3\u6784\u5217\u8868: LABEL_STRUCTURE = [ { \"\u6cdb\u5a31\u4e50\":[ \"\u660e\u661f\", \"\u65f6\u5c1a\", \"\u6e38\u620f\", \"\u5f71\u89c6\", \"\u97f3\u4e50\", \"\u7f8e\u5986\" ] }, { \"\u6e38\u620f\":[ \"LOL\", \"\u738b\u8005\u519c\u836f\", \"\u5403\u9e21\" ], \"\u5f71\u89c6\":[ \"\u559c\u5267\", \"\u7efc\u827a\", \"\u79d1\u5e7b\", \"\u6050\u6016\" ], \"\u97f3\u4e50\":[ \"\u6447\u6eda\u4e50\", \"\u6c11\u8c23\", \"Rap\", \"\u6d41\u884c\u4e50\" ] } ] \u6784\u5efa\u6807\u7b7e\u6811\u7684\u4ee3\u7801\u5206\u6790: # \u56e0\u4e3a\u6211\u4eec\u9700\u8981\u5bfc\u5165settings.py\u4e2d\u7684\u914d\u7f6e\u4fe1\u606f # \u6240\u4ee5\u9700\u8981\u5c06\u4e0a\u4e00\u7ea7\u8def\u5f84\u5bfc\u5165\u5230\u7cfb\u7edf\u8def\u5f84\u4e2d import sys sys.path.append('../') from neo4j.v1 import GraphDatabase from settings import NEO4J_CONFIG, LABEL_STRUCTURE def create_label_node_and_rel(): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u6807\u7b7e\u6811\u7684\u8282\u70b9\u548c\u8fb9\"\"\" _driver = GraphDatabase.driver(**NEO4J_CONFIG) with _driver.session() as session: # \u5220\u9664\u6240\u6709Label\u8282\u70b9\u4ee5\u53ca\u76f8\u5173\u8054\u7684\u8fb9 cypher = \"MATCH(a:Label) DETACH DELETE a\" session.run(cypher) def _create_node_rel(l: dict): \"\"\"\u6839\u636e\u6807\u7b7e\u6811\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178\u53bb\u521b\u5efa\u8282\u70b9\u548c\u5173\u7cfb\"\"\" if not l: return # \u904d\u5386\u5b57\u5178\u4e2d\u7684k,v\u5373\u7236\u5b50\u6807\u7b7e for k, v in l.items(): # MERGE\u4e00\u4e2a\u7236\u6807\u7b7e\u8282\u70b9 cypher = \"MERGE(a:Label{title:%r})\" % (k) session.run(cypher) def __c(word): \"\"\"\u7528\u4e8e\u521b\u5efa\u5b50\u6807\u7b7e\u8282\u70b9\u4ee5\u53ca\u4e0e\u7236\u6807\u7b7e\u4e4b\u95f4\u7684\u5173\u7cfb\"\"\" cypher = \"CREATE(a:Label{title:%r}) \\ SET a.name=%r WITH a \\ MATCH(b:Label{title:%r}) \\ MERGE(b)-[r:Contain]-(a)\" % (word, word, k) session.run(cypher) # \u904d\u5386\u5b50\u6807\u7b7e\u5217\u8868 list(map(__c, v)) # \u904d\u5386\u6807\u7b7e\u6811\u5217\u8868 list(map(_create_node_rel, LABEL_STRUCTURE)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/create_graph/build.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: \u8bfb\u53d6\u914d\u7f6e\u7684\u6807\u7b7e\u7ed3\u6784\u5217\u8868LABEL_STRUCTURE \u8f93\u51fa\u6548\u679c: \u5728neo4j\u53ef\u89c6\u5316\u9875\u9762\u4e2d\u67e5\u770b: http://0.0.0.0:7474 \u4e3b\u8981\u6ce8\u91ca: # \u56e0\u4e3a\u6211\u4eec\u9700\u8981\u5bfc\u5165settings.py\u4e2d\u7684\u914d\u7f6e\u4fe1\u606f # \u6240\u4ee5\u9700\u8981\u5c06\u4e0a\u4e00\u7ea7\u8def\u5f84\u5bfc\u5165\u5230\u7cfb\u7edf\u8def\u5f84\u4e2d \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u6807\u7b7e\u6811\u7684\u8282\u70b9\u548c\u8fb9\"\"\" # \u5220\u9664\u6240\u6709Label\u8282\u70b9\u4ee5\u53ca\u76f8\u5173\u8054\u7684\u8fb9 \"\"\"\u6839\u636e\u6807\u7b7e\u6811\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178\u53bb\u521b\u5efa\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u904d\u5386\u5b57\u5178\u4e2d\u7684k,v\u5373\u7236\u5b50\u6807\u7b7e # MERGE\u4e00\u4e2a\u7236\u6807\u7b7e\u8282\u70b9 \"\"\"\u7528\u4e8e\u521b\u5efa\u5b50\u6807\u7b7e\u8282\u70b9\u4ee5\u53ca\u4e0e\u7236\u6807\u7b7e\u4e4b\u95f4\u7684\u5173\u7cfb\"\"\" # \u904d\u5386\u5b50\u6807\u7b7e\u5217\u8868 # \u904d\u5386\u6807\u7b7e\u6811\u5217\u8868 \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6570\u636e\u5e93\u4e2d\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9, \u4ee5\u514d\u91cd\u590d\u521b\u5efa. \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868(LABEL_STRUCTURE)\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178. \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue,\u6839\u636ekey, MERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9. \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868,\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb.","title":"2.2 \u6784\u5efa\u6807\u7b7e\u6811"},{"location":"2/#23","text":"\u5b66\u4e60\u76ee\u6807: \u4e86\u89e3\u539f\u59cb\u6570\u636e\u7684\u6765\u6e90\u53ca\u5176\u6837\u5f0f. \u638c\u63e1\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027. \u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546,\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599. \u539f\u59cb\u6570\u636e\u6837\u5f0f: # \u660e\u661f \u73a9\u7b11\u5f52\u73a9\u7b11\uff0c\u8c08\u5230\u5f55\u5236\u611f\u53d7\u548c\u8bc4\u9009\u6807\u51c6\u65f6\uff0c\u6c88\u817e\u81ea\u7206\u81ea\u5df1\u662f\u6700\u5fc3\u8f6f\u7684\u89c2\u5bdf\u5458\uff0c\u7ed9\u7684yes\u6700\u591a\uff0c\u201c\u53ef\u80fd\u662f\u5e74\u7eaa\u5927\u4e86\uff0c\u7279\u522b\u5bb9\u6613\u88ab\u9009\u624b\u611f\u67d3\uff0c\u4e4b\u524d\u4e00\u4e2a\u6b4c\u624b\u521a\u5f00\u53e3\uff0c\u6211\u5c31\u5fcd\u4e0d\u4f4f\u60f3\u54ed\u201d\u3002 \u76f8\u5bf9\u800c\u8a00\uff0c\u91d1\u661f\u7b97\u662f\u6bd4\u8f83\u4e25\u683c\u7684\u68a6\u60f3\u89c2\u5bdf\u5458\uff0c\u5979\u5fc3\u76ee\u4e2d\u7684\u201c\u8fbe\u4eba\u201d\u8981\u5728\u81ea\u5df1\u7684\u666e\u901a\u751f\u6d3b\u4e4b\u5916\uff0c\u6709\u7740\u4e0e\u4f17\u4e0d\u540c\u4e14\u8db3\u591f\u6781\u81f4\u7684\u957f\u5904\uff0c\u201c\u6211\u5bf9\u6bcf\u4e2a\u8282\u76ee\u670940\u79d2\u7684\u5fcd\u8010\u671f\uff0c\u5982\u679c\u5728\u8fd9\u4e4b\u540e\u6ca1\u6709\u6253\u52a8\u6211\u7684\u4e1c\u897f\uff0c\u6211\u5c31\u4f1a\u6309no\u3002\u201d \u4f5c\u4e3a\u56e2\u5185\u6700\u5e74\u8f7b\u7684\u6210\u5458\uff0c\u6d3b\u6cfc\u7684\u6768\u5e42\u8868\u73b0\u51fa\u4e86\u9c9c\u660e\u7684\u201c\u56e2\u5ba0\u5c5e\u6027\u201d\u3002\u4e0d\u4ec5\u4eb2\u5207\u5730\u79f0\u547c\u6c88\u817e\u4e3a\u201c\u4e8c\u8205\u201d\u3001\u91d1\u661f\u4e3a\u201c\u91d1\u59e8\u201d\uff0c\u8fd8\u548c\u53e3\u4e2d\u7684\u201c\u6211\u54e5\u201d\u8521\u56fd\u5e86\u5171\u4eab\u6697\u53f7\u3002\u8282\u76ee\u5f55\u5236\u4e0b\u6765\uff0c\u6768\u5e42\u8c26\u865a\u8868\u793a\uff0c\u81ea\u5df1\u5728\u300a\u8fbe\u4eba\u79c0\u300b\u7684\u821e\u53f0\u4e0a\u89c1\u8bc6\u4e86\u5f88\u591a\u9707\u64bc\u7684\u8868\u6f14\uff0c\u662f\u4e00\u6b21\u957f\u89c1\u8bc6\u7684\u65c5\u7a0b\u3002\u81f3\u4e8e\u8bc4\u5224\u6807\u51c6\uff0c\u6768\u5e42\u5766\u8a00\uff0c\u81ea\u5df1\u5bf9\u4e8e\u4e00\u4e9b\u4e13\u4e1a\u8868\u6f14\u6ca1\u6709\u592a\u591a\u89c1\u89e3\uff0c\u4e3b\u8981\u5c0a\u5d07\u5185\u5fc3\u505a\u9009\u62e9\u3002 # \u65f6\u5c1a \u91c7\u8bbf\u4e2d\u5979\u66fe\u63d0\u5230\u5e0c\u671b\u5927\u5bb6\u5305\u5bb9\u5979\u5584\u5f85\u5979\uff0c\u4e0d\u7ba1\u662f\u5979\u9970\u6f14\u7684\u89d2\u8272\u8fd8\u662f\u5979\u672c\u4eba\u3002\u5979\u4e3a\u89d2\u8272\u53d1\u58f0\uff0c\u4e3a\u6821\u56ed\u9738\u51cc\u53d1\u58f0\uff0c\u540c\u6837\u4e3a\u81ea\u5df1\u53d1\u58f0\uff0c\u5e0c\u671b\u89c2\u4f17\u5bf9\u4e8e\u5979\u8fd9\u4e2a\u65b0\u4eba\u6f14\u5458\uff0c\u80fd\u5728\u7ed9\u4e88\u4e25\u683c\u7684\u8981\u6c42\u540c\u65f6\u66f4\u7ed9\u4e88\u60c5\u611f\u7684\u5305\u5bb9\u3002\u800c\u9762\u5bf9\u4e00\u4e9bdiss\u548c\u5632\u8bbd\u5979\u7684\u8a00\u8bed\uff0c\u5979\u4e5f\u8868\u793a\u4e0d\u4f1a\u56e0\u6b64\u800c\u6539\u53d8\uff0c\u800c\u662f\u4f1a\u9009\u62e9\u575a\u6301\u81ea\u6211\uff0c\u4e0d\u5fd8\u521d\u5fc3\uff0c\u505a\u81ea\u5df1\u3002\u5979\u66fe\u8bf4\u8fc7\u201c\u4eba\u751f\u672c\u65e0\u610f\u4e49\uff0c\u4eba\u7684\u5b58\u5728\u5c31\u662f\u4e3a\u4e86\u521b\u9020\u610f\u4e49\u3002\u201d\u5e74\u9f84\u867d\u5c0f\uff0c\u5374\u662f\u4e2a\u6709\u4e3b\u89c1\u6709\u81ea\u6211\u575a\u6301\u7684\u5973\u5b69\u3002 \u575a\u5b9a\u5982\u521d \u4e0a\u8863\uff1aHollister \u88e4\u5b50\uff1aHollister \u978b\uff1aMizuno \u8033\u73af\uff1aInch Edition \u8033\u5939\uff1aThing In Thing \u9752\u6625\u5c11\u5973\u6301\u5200\u51fa\u884c\uff0c\u5200\u97e7\u950b\u5229\u5374\u4e0d\u654c\u5979\u773c\u4e2d\u7684\u575a\u5b9a\u4e0e\u7099\u70ed\u3002\u8ba9\u6211\u4eec\u770b\u5230\u4e86\u4e00\u4e2a\u4e0d\u523020\u5c81\u7684\u5c11\u5973\u8d85\u51fa\u5e38\u4eba\u7684\u6210\u719f\uff0c\u548c\u5e74\u8f7b\u5145\u6ee1\u6d3b\u529b\u7684\u5c0f\u6027\u611f\u3002 \u7c89\u8272\u5957\u88c5\uff1aIsabel Marant \u978b\u5b50\uff1aStuart Weitzman \u8033\u73af\uff1aAtelier Swarovski # \u5f71\u89c6 \u7535\u5f71\u6709\u65e0\u9650\u7684\u53ef\u80fd\u6027\uff0c\u539f\u58f0\u97f3\u4e50\u4e5f\u80fd\u7ed9\u7535\u5f71\u521b\u4f5c\u63d0\u4f9b\u7075\u611f\uff0c\u7535\u5f71\u548c\u97f3\u4e50\u7684\u5173\u7cfb\u662f\u5f00\u653e\u7684\u3002\u4e3a\u53d1\u51fa\u8fd9\u6837\u7684\u8baf\u53f7\uff0cFIRST\u5f71\u5c55\u4eca\u5e74\u4e0eMOO\u97f3\u4e50\u643a\u624b\u5408\u4f5c\uff0c\u5728\u7535\u5f71\u8282\u671f\u95f4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7535\u5f71\u548c\u97f3\u4e50\u4ea4\u53c9\u7684\u573a\u666f\u3002 MOO\u97f3\u4e50\u96b6\u5c5e\u4e8e\u817e\u8baf\u97f3\u4e50\u5a31\u4e50\u96c6\u56e2\uff0c\u521b\u7acb\u4ee5\u6765\u53d7\u5230\u4e0d\u5c11\u6df1\u5ea6\u97f3\u4e50\u7231\u597d\u8005\u7684\u9752\u7750\u3002\u4ee5\u5929\u7136\u7684\u66f2\u5e93\u4f18\u52bf\u4e3a\u4f9d\u6258\uff0cMOO\u97f3\u4e50\u81f4\u529b\u4e8e\u878d\u5408\u5148\u950b\u4e0e\u7ecf\u5178\uff0c\u62d3\u5c55\u5f53\u4ee3\u6d41\u884c\u97f3\u4e50\u7684\u8fb9\u754c\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u7eaf\u7cb9\u7684\u6c89\u6d78\u5f0f\u97f3\u4e50\u4f53\u9a8c\uff0c\u81f4\u529b\u4e8e\u6210\u4e3a\u4e00\u4e2a\u5f15\u9886\u5f53\u4ee3\u9752\u5e74\u4eba\u53d1\u73b0\u3001\u63a2\u7d22\u65b0\u9c9c\u6d41\u884c\u4e50\u7684\u65b0\u4e00\u4ee3\u6f6e\u6d41\u97f3\u4e50APP\u3002 \u4f5c\u4e3aFIRST\u5f71\u5c55\u97f3\u4e50\u5e73\u53f0\u5408\u4f5c\u4f19\u4f34\uff0cMOO\u97f3\u4e50\u8d5e\u52a9\u4e86\u573a\u5916\u5956\u201c\u5148\u950b\u97f3\u4e50\u7a81\u7834\u5956\u201d\uff0c\u8fd9\u4e5f\u662fFIRST\u9996\u6b21\u8bbe\u7acb\u7535\u5f71\u97f3\u4e50\u65b9\u5411\u7684\u4e13\u9879\u5956\u3002\u4e3a\u300a\u6625\u6f6e\u300b\u914d\u4e50\u7684\u97f3\u4e50\u4eba\u534a\u91ce\u559c\u5f18\u83b7\u5f97\u4e86\u8fd9\u4e00\u5956\u9879\uff0cMOO\u97f3\u4e50\u4ea7\u54c1\u8d1f\u8d23\u4eba\u738b\u5b9d\u534e\u4e3a\u4ed6\u9881\u5956\uff0c\u79f0\u8d5e\u201c\u8fd9\u662f\u5148\u950b\u7684\u97f3\u4e50\u201d\u3002 \u534a\u91ce\u559c\u5f18\u7684\u4f5c\u54c1\u7ecf\u5e38\u51fa\u73b0\u5728\u4faf\u5b5d\u8d24\u548c\u8d3e\u6a1f\u67ef\u5bfc\u6f14\u7684\u7535\u5f71\u91cc\uff0c\u300a\u620f\u68a6\u4eba\u751f\u300b\u300a\u6d77\u4e0a\u82b1\u300b\u300a\u5c71\u6cb3\u6545\u4eba\u300b\u4e2d\u7684\u914d\u4e50\u90fd\u4f53\u73b0\u4e86\u4ed6\u6210\u719f\u7684\u97f3\u4e50\u601d\u7ef4\u548c\u5bf9\u5f71\u50cf\u72ec\u7acb\u3001\u7acb\u4f53\u7684\u7406\u89e3\u3002\u300a\u6625\u6f6e\u300b\u5bfc\u6f14\u6768\u8354\u94a0\u66fe\u8fd9\u6837\u63cf\u8ff0\u4ed6\u4eec\u7684\u521b\u4f5c\u8fc7\u7a0b\uff1a\u201c\u4ed6\u9694\u7a7a\u5bf9\u8bdd\uff0c\u89c6\u9891\u4f20\u9001\uff0c\u53cd\u8986\u4fee\u6539\u4f60\u7684\u65cb\u5f8b\uff0c\u300a\u6625\u68a6\u300b\u300a\u6625\u6f6e\u300b\u90fd\u7559\u6709\u4ed6\u8c31\u5199\u7684\u4e50\u7ae0\u3002\u201d\u300a\u6625\u6f6e\u300b\u540c\u65f6\u5c06\u5728\u5ba3\u53d1\u9636\u6bb5\u5f97\u5230MOO\u548cQQ\u97f3\u4e50\u7684\u63a8\u5e7f\u8d44\u6e90\uff0c\u7b49\u5f85\u65e9\u65e5\u4e0e\u89c2\u4f17\u89c1\u9762\u3002 # \u7f8e\u5986 \u6021\u4e3d\u4e1d\u5c14\u4f18\u60a6\u6d3b\u989c\u773c\u5507\u629a\u7eb9\u7cbe\u534e\u971c\u775b\u91c7\u4e0a\u5e02 9\u5468\u6de1\u7eb9,\u773c\u8bc1\u4e3a\u5b9e\uff0c\u65b0\u4e00\u7ebf\u5973\u6027\u751f\u6d3b\u771f\u76f8\u4ee3\u8868papi\u9171\u5e26\u4f60\u4e00\u540c\u89c1\u8bc1 2018\u5e745\u670810\u65e5,\u6021\u4e3d\u4e1d\u5c14\u4e8e\u5317\u4eac\u865e\u793e\u6f14\u827a\u7a7a\u95f4\u4e3e\u529e\u5168\u65b0\u4f18\u60a6\u6d3b\u989c\u773c\u5507\u629a\u7eb9\u7cbe\u534e\u971c\u65b0\u54c1\u53d1\u5e03\u4f1a.\u54c1\u724c\u603b\u76d1\u4e0a\u7530\u5178\u53f2\u5148\u751f\u4eb2\u4e34\u73b0\u573a\uff0c\u66f4\u643a\u624b\u77e5\u540d\u539f\u521b\u89c6\u9891\u8fbe\u4ebapapi\u9171\u4f5c\u4e3a\u7279\u9080\u771f\u76f8\u89c1\u8bc1\u4eba\uff0c\u63ed\u6653\u300a\u65b0\u4e00\u7ebf\u5973\u6027\u751f\u6d3b\u771f\u76f8\u300b\u767d\u76ae\u4e66\uff0c\u76db\u9080\u6765\u81ea\u5168\u56fd\u5404\u5730\u7684\u4e3b\u6d41\u65f6\u5c1a\u7f8e\u5986\u5a92\u4f53\u3001\u4f17\u591a\u77e5\u540d\u7f8e\u5986\u535a\u4e3b\u53ca\u62a4\u80a4\u8fbe\u4eba\u5171\u540c\u52a0\u5165\u201c9\u5468\u6de1\u7eb9\uff0c\u773c\u8bc1\u4e3a\u5b9e\u201d\u7684\u89c1\u8bc1\u4eba\u884c\u5217\u4e2d\u6765\u3002 \u9996\u5148\u6620\u5165\u773c\u5e18\u7684\u662f\u4e00\u4e2a\u6570\u5b57\u201c9\u201d\u9020\u578b\u7684\u901a\u9053,\u7f6e\u8eab\u5176\u4e2d\uff0c\u4e00\u6761\u6761\u5173\u4e8e\u62a4\u80a4\u7684\u201c\u771f\u76f8\u201d\u5f39\u5e55\u88ad\u6765\uff1a\u201c\u4e2d\u5e74\u5c11\u5973\u9009\u8d2d\u62a4\u80a4\u54c1\u6709\u591a\u6311\u5254\u201d\u3001\u201c\u731c\u731c\u4f60\u7684\u8870\u8001\u4e34\u754c\u70b9\u5728\u51e0\u70b9\u201d\u7b49\u95ee\u9898\u8ba9\u6765\u5bbe\u4f1a\u5fc3\u4e00\u7b11\u7684\u540c\u65f6\uff0c\u4ea6\u5f15\u53d1\u4e86\u62a4\u80a4\u771f\u76f8\u7684\u8bf8\u591a\u601d\u8003.\u6021\u4e3d\u4e1d\u5c14\u59cb\u7ec8\u81f4\u529b\u4e8e\u4e9a\u6d32\u5973\u6027\u4e4b\u7f8e\uff0c\u672c\u6b21\u8054\u5408\u4e2d\u56fd\u9886\u5148\u7684\u793e\u4f1a\u5316\u5546\u4e1a\u8d44\u8baf\u63d0\u4f9b\u673a\u6784Kantar Media CIC\uff0c\u5c06\u591a\u5e74\u6765\u5bf9\u4e2d\u56fd\u5973\u6027\u7684\u5173\u6ce8\u6c47\u805a\u4e3a\u4e00\u672c\u72ec\u5177\u89c1\u89e3\u4e0e\u6d1e\u5bdf\u529b\u7684\u300a\u65b0\u4e00\u7ebf\u5973\u6027\u751f\u6d3b\u771f\u76f8\u300b\u767d\u76ae\u4e66\uff0c\u901a\u8fc7\u5927\u6570\u636e\u7834\u89e3\u65b0\u4e00\u7ebf\u5973\u6027\u7684\u76b1\u7eb9\u79d8\u5bc6\uff0c\u4ece\u793e\u4f1a\u70ed\u70b9\u3001\u751f\u6d3b\u65b9\u5f0f\u548c\u62a4\u80a4\u4e60\u60ef\u4e09\u4e2a\u65b9\u9762\u5524\u8d77\u5927\u5bb6\u5bf9\u76b1\u7eb9\u7684\u8ba4\u77e5\u53ca\u91cd\u89c6\u3002 \u6021\u4e3d\u4e1d\u5c14\u54c1\u724c\u603b\u76d1\u4e0a\u7530\u5178\u53f2\u5148\u751f\u8868\u793a\uff1a \u201c\u81ea2017\u5e74\u5728\u4e2d\u56fd\u5f00\u5c55\u54c1\u724c\u9769\u65b0\u4ee5\u6765,\u6021\u4e3d\u4e1d\u5c14\u4ece\u672a\u505c\u4e0b\u811a\u6b65\uff0c\u4e0d\u65ad\u5411\u524d.\u6211\u4eec\u59cb\u7ec8\u5173\u6ce8\u4e9a\u6d32\u5973\u6027\u4e4b\u7f8e\uff0c\u81f4\u529b\u4e8e\u4e3a\u6d88\u8d39\u8005\u63d0\u4f9b\u6301\u7eed\u521b\u65b0\u7684\u4ea7\u54c1\u548c\u4ef7\u503c\u4f53\u9a8c\u3002\u5728\u8fd9\u6837\u7684\u54c1\u724c\u613f\u666f\u4e0b\uff0c\u6021\u4e3d\u4e1d\u5c14\u5c06\u76ee\u5149\u805a\u7126\u4e8e\u5f53\u4e0b\u4e2d\u56fd\u65b0\u4e00\u7ebf\u5973\u6027\u7684\u751f\u6d3b\u3002\u6211\u4eec\u53d1\u73b0\u5c3d\u7ba1\u5927\u90e8\u5206\u4e2d\u56fd\u5973\u6027\u5341\u5206\u6ce8\u91cd\u6297\u8001\u5316\u95ee\u9898\uff0c\u4f46\u5374\u666e\u904d\u8ba4\u4e3a\u62a4\u80a4\u4ea7\u54c1\u6548\u679c\u4e0d\u5c3d\u4eba\u610f\u3002\u4e3a\u6ee1\u8db3\u5e7f\u5927\u4e2d\u56fd\u6d88\u8d39\u8005\u5bf9\u4e8e\u629a\u7eb9\u7684\u62a4\u80a4\u8bc9\u6c42\uff0c\u6b64\u6b21\u5168\u65b0\u63a8\u51fa\u4e86\u529f\u6548\u8ba4\u8bc1\u7684\u6021\u4e3d\u4e1d\u5c14\u4f18\u60a6\u6d3b\u989c\u773c\u5507\u629a\u7eb9\u7cbe\u534e\u971c\uff0c\u4e0d\u4ec5\u662f\u54c1\u724c\u4ef7\u503c\u7684\u6709\u529b\u8bc1\u660e\uff0c\u66f4\u6807\u5fd7\u7740\u6021\u4e3d\u4e1d\u5c14\u53c8\u4e00\u6b21\u7684\u521b\u65b0\u4e0e\u7a81\u7834\u3002\u6211\u4eec\u671f\u5f85\u8fd9\u6b3e\u4ea7\u54c1\u8ba9\u66f4\u591a\u4e2d\u56fd\u5973\u6027\u7efd\u653e\u81ea\u4fe1\u4e0e\u5065\u5eb7\u7684\u5149\u8292\uff0c\u6210\u5c31\u79ef\u6781\u5411\u4e0a\u4e0e\u81ea\u4fe1\u575a\u5f3a\u7684\u9b45\u529b\u4eba\u751f\uff0c\u9047\u89c1\u66f4\u597d\u7684\u81ea\u5df1\u3002 \u201c \u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027: \u6587\u7ae0\u4e3a\u77ed\u6587,\u5728\u51e0\u767e\u81f3\u51e0\u5343\u5b57\u4e0d\u7b49. \u5185\u5bb9\u56f4\u7ed5\u660e\u786e\u7684\u4e3b\u9898\u5c55\u5f00,\u5176\u4e2d\u6d89\u730e\u5f88\u591a\u76f8\u5173\u547d\u540d\u5b9e\u4f53. \u5b8c\u6574\u53e5\u5b50\u4f7f\u7528\u53e5\u53f7\u5206\u5272,\u5c0f\u6bb5\u4f7f\u7528\u6362\u884c\u7b26\u5206\u5272. \u539f\u59cb\u8bed\u6599\u5b58\u653e\u7684\u4f4d\u7f6e: \u5b58\u653e\u5728/data/django-uwsgi/text_labeled/create_graph/\u76ee\u5f55\u4e0b. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546,\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6837\u5f0f. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027: \u6587\u7ae0\u4e3a\u77ed\u6587,\u5728\u51e0\u767e\u81f3\u51e0\u5343\u5b57\u4e0d\u7b49. \u5185\u5bb9\u56f4\u7ed5\u660e\u786e\u7684\u4e3b\u9898\u5c55\u5f00,\u5176\u4e2d\u6d89\u730e\u5f88\u591a\u76f8\u5173\u547d\u540d\u5b9e\u4f53. \u5b8c\u6574\u53e5\u5b50\u4f7f\u7528\u53e5\u53f7\u5206\u5272,\u5c0f\u6bb5\u4f7f\u7528\u6362\u884c\u7b26\u5206\u5272.","title":"2.3 \u83b7\u53d6\u539f\u59cb\u6570\u636e"},{"location":"2/#24","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4. \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u548cuserdict.txt\u4e4b\u4e2d. \u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import os import jieba # \u4f7f\u7528jieba\u4e2d\u7684\u8bcd\u6027\u6807\u6ce8\u529f\u80fd import jieba.posseg as pseg # jieba\u4e2d\u9884\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u7c7b\u578b,\u5206\u522b\u8868\u793a: \u4eba\u540d\uff0c\u540d\u8bcd\uff0c\u5730\u540d\uff0c\u673a\u6784\u56e2\u4f53\u540d\uff0c\u5176\u4ed6\u4e13\u6709\u540d\u8bcd n_e = [\"nr\", \"n\", \"ns\", \"nt\", \"nz\"] # \u5199\u5165csv\u7684\u8def\u5f84 csv_path = \"./labels\" # \u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84 userdict_path = \"../userdict.txt\" def get_vocabulary(article_path, csv_name): \"\"\"\u51fd\u6570\u5c06\u8bfb\u53d6\u6587\u7ae0\u8def\u5f84\u4e0b\u7684\u6240\u6709\u6587\u7ae0\u6587\u672c,\u5e76\u8f6c\u5316\u4e3a\u8bcd\u6c47\u5199\u5165\u8bcd\u6c47csv\u6587\u4ef6\"\"\" if not os.path.exists(article_path): return if not os.path.exists(csv_path): os.mkdir(csv_path) def _get_n_list(text): \"\"\"\u7528\u4e8e\u83b7\u53d6\u540d\u8bcd\u5217\u8868\"\"\" # \u4f7f\u7528jieba\u7684\u8bcd\u6027\u6807\u6ce8\u65b9\u6cd5\u5207\u5206\u6587\u672c,\u83b7\u5f97\u5177\u6709\u8bcd\u6027\u5c5e\u6027flag\u548c\u8bcd\u6c47\u5c5e\u6027word\u7684\u5bf9\u8c61, # \u4ece\u800c\u5224\u65adflag\u662f\u5426\u5728\u6211\u4eec\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u5217\u8868\u4e2d,\u6765\u8fd4\u56de\u5bf9\u5e94\u7684\u8bcd\u6c47 r = [] for g in pseg.lcut(text): if g.flag in n_e: r.append(g.word) return r with open(os.path.join(csv_path, csv_name), \"a\") as u: for article in os.listdir(article_path): with open(os.path.join(article_path, article), \"r\") as f: text = f.read() # \u53ea\u83b7\u53d6\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e2\u7684\u540d\u8bcd n_list = list(filter(lambda x: len(x)>=2, set(_get_n_list(text)))) list(map(lambda x: u.write(x + \"\\n\"), n_list)) with open(os.path.join(csv_path, csv_name), \"r\") as o: word = o.read() with open(userdict_path, \"a\") as f: f.write(word) return \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/create_graph/get_vocab.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u539f\u59cb\u6587\u7ae0\u8def\u5f84 article_path = \"./fashion\" # \u751f\u6210\u7684csv\u6587\u4ef6\u540d\u5b57(\u8be5\u6587\u4ef6\u5728./labels\u76ee\u5f55\u4e0b) csv_name = \"\u65f6\u5c1a.csv\" \u8f93\u51fa\u6548\u679c: # \u65f6\u5c1a.csv \u798f\u5229 \u5fc3\u60c5 \u5f20\u626c \u8170\u8eab T\u6064 \u95f2\u6687 \u589e\u8272 \u7f8e\u989c \u4e0a\u6d77 \u5168\u8eab \u4e2a\u4eba \u9020\u578b \u65f6\u523b \u5370\u8c61\u6d3e \u84dd\u8272 \u9774\u5b50 \u4e3b\u8981\u6ce8\u91ca: # \u4f7f\u7528jieba\u4e2d\u7684\u8bcd\u6027\u6807\u6ce8\u529f\u80fd # jieba\u4e2d\u9884\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u7c7b\u578b,\u5206\u522b\u8868\u793a: \u4eba\u540d\uff0c\u540d\u8bcd\uff0c\u5730\u540d\uff0c\u673a\u6784\u56e2\u4f53\u540d\uff0c\u5176\u4ed6\u4e13\u6709\u540d\u8bcd # \u5199\u5165csv\u7684\u8def\u5f84 # \u7528\u6237\u81ea\u5b9a\u4e49\u8bcd\u5178\u8def\u5f84 \"\"\"\u51fd\u6570\u5c06\u8bfb\u53d6path\u8def\u5f84\u4e0b\u7684\u6240\u6709\u6587\u7ae0\u6587\u672c,\u5e76\u8f6c\u5316\u4e3a\u8bcd\u6c47\u5199\u5165\u8bcd\u6c47csv\u6587\u4ef6\"\"\" \"\"\"\u7528\u4e8e\u83b7\u53d6\u540d\u8bcd\u5217\u8868\"\"\" # \u4f7f\u7528jieba\u7684\u8bcd\u6027\u6807\u6ce8\u65b9\u6cd5\u5207\u5206\u6587\u672c,\u83b7\u5f97\u5177\u6709\u8bcd\u6027\u5c5e\u6027flag\u548c\u8bcd\u6c47\u5c5e\u6027word\u7684\u5bf9\u8c61, # \u4ece\u800c\u5224\u65adflag\u662f\u5426\u5728\u6211\u4eec\u5b9a\u4e49\u7684\u540d\u8bcd\u6027\u5217\u8868\u4e2d,\u6765\u8fd4\u56de\u5bf9\u5e94\u7684\u8bcd\u6c47 # \u53ea\u83b7\u53d6\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e2\u7684\u540d\u8bcd \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4. \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u548cuserdict.txt\u4e4b\u4e2d.","title":"2.4 \u83b7\u53d6\u8bcd\u6c47\u96c6"},{"location":"2/#25","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65: \u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6. \u7b2c\u4e09\u6b65: \u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u53bb\u521b\u5efa\u8282\u70b9\uff0c\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb. \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790\uff1a import os import random import fileinput csv_path = \"./labels\" def create_vocabulary_node_and_rel(): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u8bcd\u6c47\u8282\u70b9\u548c\u5173\u7cfb\"\"\" _driver = GraphDatabase.driver(**NEO4J_CONFIG) with _driver.session() as session: # \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 cypher = \"MATCH(a:Vocabulary) DETACH DELETE a\" session.run(cypher) def _create_v_and_r(csv): \"\"\"\u8bfb\u53d6\u5355\u4e2acsv\u6587\u4ef6,\u5e76\u5199\u5165\u6570\u636e\u5e93\u521b\u5efa\u8282\u70b9\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb\"\"\" path = os.path.join(csv_path, csv) # \u4f7f\u7528fileinput\u7684FileInput\u65b9\u6cd5\u4ece\u6301\u4e45\u5316\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e, # \u5e76\u8fdb\u884cstrip()\u64cd\u4f5c\u53bb\u6389\u4e24\u4fa7\u7a7a\u767d\u7b26, \u518d\u901a\u8fc7set\u6765\u53bb\u91cd. word_list = list( set(map(lambda x: x.strip(), fileinput.FileInput(path)))) def __create_node(word): \"\"\"\u521b\u5efacsv\u4e2d\u5355\u4e2a\u8bcd\u6c47\u7684\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u5b9a\u4e49\u8bcd\u6c47\u7684\u521d\u59cb\u5316\u6743\u91cd,\u5373\u8bcd\u6c47\u5c5e\u4e8e\u67d0\u4e2a\u6807\u7b7e\u7684\u521d\u59cb\u6982\u7387\uff0c # \u56e0\u4e3a\u8bcd\u6c47\u672c\u8eab\u6765\u81ea\u8be5\u7c7b\u578b\u6587\u7ae0\uff0c\u56e0\u6b64\u521d\u59cb\u6982\u7387\u5b9a\u4e49\u57280.5-1\u4e4b\u95f4\u7684\u968f\u673a\u6570 weight = round(random.uniform(0.5, 1), 3) # \u4f7f\u7528cypher\u8bed\u53e5\u521b\u5efa\u8bcd\u6c47\u8282\u70b9,\u7136\u540e\u5339\u914d\u8fd9\u4e2acsv\u6587\u4ef6\u540d\u5b57\u81f3\u540e\u56db\u4f4d\u5373\u7c7b\u522b\u540d\uff0c # \u5728\u4e24\u8005\u4e4b\u95f4MERGE\u4e00\u6761\u6709\u6743\u91cd\u7684\u8fb9 cypher = \"CREATE(a:Vocabulary{name:%r}) WITH a \\ MATCH(b:Label{title:%r}) \\ MERGE(a)-[r:Related{weight:%f}]-(b)\" % (word, csv[:-4], weight) session.run(cypher) # \u904d\u5386\u8bcd\u6c47\u5217\u8868 list(map(__create_node, word_list)) # \u904d\u5386\u6807\u7b7e\u5217\u8868 label_list = os.listdir(csv_path) list(map(_create_v_and_r, label_list)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/create_graph/build.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u8bcd\u6c47\u96c6csv\u6587\u4ef6\u8def\u5f84 csv_path = \"./labels\" \u8f93\u51fa\u6548\u679c: \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u521b\u5efa\u8bcd\u6c47\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \"\"\"\u8bfb\u53d6\u5355\u4e2acsv\u6587\u4ef6,\u5e76\u5199\u5165\u6570\u636e\u5e93\u521b\u5efa\u8282\u70b9\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb\"\"\" # \u4f7f\u7528fileinput\u7684FileInput\u65b9\u6cd5\u4ece\u6301\u4e45\u5316\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e, # \u5e76\u8fdb\u884cstrip()\u64cd\u4f5c\u53bb\u6389\u4e24\u4fa7\u7a7a\u767d\u7b26, \u518d\u901a\u8fc7set\u6765\u53bb\u91cd. \"\"\"\u521b\u5efacsv\u4e2d\u5355\u4e2a\u8bcd\u6c47\u7684\u8282\u70b9\u548c\u5173\u7cfb\"\"\" # \u5b9a\u4e49\u8bcd\u6c47\u7684\u521d\u59cb\u5316\u6743\u91cd,\u5373\u8bcd\u6c47\u5c5e\u4e8e\u67d0\u4e2a\u6807\u7b7e\u7684\u521d\u59cb\u6982\u7387\uff0c # \u56e0\u4e3a\u8bcd\u6c47\u672c\u8eab\u6765\u81ea\u8be5\u7c7b\u578b\u6587\u7ae0\uff0c\u56e0\u6b64\u521d\u59cb\u6982\u7387\u5b9a\u4e49\u57280.5-1\u4e4b\u95f4\u7684\u968f\u673a\u6570 # \u4f7f\u7528cypher\u8bed\u53e5\u521b\u5efa\u8bcd\u6c47\u8282\u70b9,\u7136\u540e\u5339\u914d\u8fd9\u4e2acsv\u6587\u4ef6\u540d\u5b57\u81f3\u540e\u56db\u4f4d\u5373\u7c7b\u522b\u540d\uff0c # \u5728\u4e24\u8005\u4e4b\u95f4MERGE\u4e00\u6761\u6709\u6743\u91cd\u7684\u8fb9 # \u904d\u5386\u8bcd\u6c47\u5217\u8868 # \u904d\u5386\u6807\u7b7e\u5217\u8868 \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u6240\u6709\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65: \u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6. \u7b2c\u4e09\u6b65: \u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u521b\u5efa\u8282\u70b9\uff0c\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb.","title":"2.5 \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31"},{"location":"2/#_2","text":"\u7b2c1\u5c0f\u8282: \u8bbe\u8ba1\u6807\u7b7e\u6811 \u5b66\u4e60\u4e86\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219. \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8. \u5b66\u4e60\u4e86\u660e\u786e\u8bbe\u8ba1\u539f\u5219: \u4e1a\u52a1\u5bfc\u5411\u539f\u5219 \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219 \u5b66\u4e60\u4e86\u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e. \u5b66\u4e60\u4e86\u6807\u7b7e\u5b58\u50a8: \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784. \u7b2c2\u5c0f\u8282: \u6784\u5efa\u6807\u7b7e\u6811 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9. \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178. \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue,\u6839\u636ekey\uff0cMERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9. \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868,\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb. \u7b2c3\u5c0f\u8282: \u83b7\u53d6\u539f\u59cb\u6570\u636e \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546,\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6837\u5f0f. \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027. \u7b2c4\u5c0f\u8282: \u83b7\u53d6\u8bcd\u6c47\u96c6 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4. \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u4e4b\u4e2d. \u7b2c5\u5c0f\u8282: \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65,\u5220\u9664\u6240\u6709\u4e0e\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65,\u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6. \u7b2c\u4e09\u6b65,\u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u521b\u5efa\u8282\u70b9, \u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb.","title":"\u672c\u7ae0\u603b\u7ed3"},{"location":"3/","text":"\u672c\u7ae0\u5bfc\u5b66 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5982\u4f55\u8fdb\u884cfasttext\u6a21\u578b\u7684\u7279\u5f81\u5de5\u7a0b\u4ee5\u53ca\u8bad\u7ec3\u8fc7\u7a0b, \u5e76\u5b9e\u73b0\u5b83\u4eec. \u5f15\u5bfc\u5206\u6790: \u8fdb\u884c\u51e0\u4e4e\u662f\u6807\u51c6\u5316\u6a21\u578b\u8bad\u7ec3\u6d41\u7a0b. fasttext\u6a21\u578b\uff0c\u7ad9\u5728\u591a\u6a21\u578b\u8bad\u7ec3\u4e0e\u9884\u6d4b\u7684\u6548\u7387\u89d2\u5ea6\u4e0a\uff0c\u4f7f\u7ed3\u6784\u8bbe\u8ba1\u975e\u5e38\u7b80\u5355\uff0c\u4ee5\u81f3\u4e8e\u53ef\u80fd\u65e0\u6cd5\u6709\u6548\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u7cfb\uff0c\u56e0\u6b64\u52a0\u5165n-gram\u7279\u5f81\u8fdb\u884c\u4e86\u8865\u5145. \u8fdb\u884cfasttext\u6a21\u578b\u7684\u7279\u5f81\u5de5\u7a0b\u4ee5\u53ca\u8bad\u7ec3\u8fc7\u7a0b\u7684\u4e03\u6b65\u8bd7: \u672c\u7ae0\u5c0f\u8282: 3.1 \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599 \u5b66\u4e60\u5982\u4f55\u4ece\u539f\u59cb\u8bed\u6599\u751f\u6210\u8bad\u7ec3\u8bed\u6599. 3.2 \u8fdb\u884c\u6570\u636e\u5206\u6790 \u5b66\u4e60\u4f7f\u7528\u8bad\u7ec3\u8bed\u6599\u8fdb\u884c\u4e00\u4e9b\u7edf\u8ba1\u5206\u6790\u5de5\u4f5c. 3.3 \u7279\u5f81\u5904\u7406 \u5b66\u4e60\u5c06n-gram\u4f5c\u4e3a\u7279\u5f81\u52a0\u5165\u5230\u521d\u59cb\u7279\u5f81\u4e2d. 3.4 \u6784\u5efa\u6a21\u578b\u7ed3\u6784 \u5b66\u4e60fasttext\u7684\u6a21\u578b\u7684\u7ec4\u6210\u53ca\u5176\u5404\u4e2a\u5c42\u7684\u4f5c\u7528. 3.5 \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5 \u5b66\u4e60\u6a21\u578b\u9009\u62e9\u7684\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684\u6570\u5b66\u539f\u7406\u548c\u4f18\u7f3a\u70b9. 3.6 \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3 \u5b66\u4e60\u6a21\u578b\u5728\u8bad\u7ec3\u8bed\u6599\u4e0a\u7684\u8bad\u7ec3\u8fc7\u7a0b. 3.7 \u6a21\u578b\u7684\u4fdd\u5b58\u4e0e\u52a0\u8f7d \u5b66\u4e60\u8bad\u7ec3\u4e4b\u540e\u7684\u6a21\u578b\u5982\u4f55\u8fdb\u884c\u4fdd\u5b58\u4e0e\u52a0\u8f7d. 3.1 \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90. \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c. \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0. \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c. \u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import os # \u9650\u5236\u53e5\u5b50\u7684\u6700\u5c0f\u5b57\u7b26\u6570\u548c\u53e5\u5b50\u7684\u6700\u5927\u5b57\u7b26\u6570 MIN_LENGTH = 5 MAX_LENGTH = 500 def get_p_text_list(single_article_path): \"\"\"\u83b7\u53d6\u5355\u7bc7\u6587\u7ae0\u7684\u6587\u672c\u5217\u8868\"\"\" with open(single_article_path, \"r\") as f: text = f.read() # \u53bb\u6389\u6362\u884c\u7b26, \u5e76\u4ee5\u53e5\u53f7\u5212\u5206 cl = text.replace(\"\\n\", \".\").split(\"\u3002\") # \u8fc7\u6ee4\u6389\u957f\u5ea6\u8303\u56f4\u4e4b\u5916\u7684\u53e5\u5b50 cl = list(filter(lambda x: MIN_LENGTH<len(x)<MAX_LENGTH, cl)) return cl def get_p_sample(a_path, p_path): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u6b63\u6837\u672c\u7684csv, \u4ee5\u6587\u7ae0\u8def\u5f84\u548c\u6b63\u6837\u672ccsv\u5199\u5165\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" if not os.path.exists(a_path): return if not os.path.exists(p_path): os.mkdir(p_path) # \u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u6253\u5f00\u9884\u5199\u5165\u6b63\u6837\u672c\u7684csv fp = open(os.path.join(p_path, \"p_sample.csv\"), \"a\") # \u904d\u5386\u6587\u7ae0\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e00\u7bc7\u6587\u7ae0 for u in os.listdir(a_path): cl = get_p_text_list(os.path.join(a_path, u)) for clc in cl: fp.write(\"1\" + \"\\t\" + clc + \"\\n\") fp.close() def get_sample(p_path, n_path_csv_list: list): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u53d6\u6837\u672c\u96c6\u5305\u62ec\u6b63\u8d1f\u6837\u672c, \u4ee5\u6b63\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u548c\u8d1f\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u5217\u8868\u4e3a\u53c2\u6570\"\"\" fp = open(os.path.join(p_path, \"sample.csv\"), \"w\") with open(os.path.join(p_path, \"p_sample.csv\"), \"r\") as f: text = f.read() # \u5148\u5c06\u6b63\u6837\u672c\u5199\u5165\u6837\u672ccsv\u4e4b\u4e2d fp.write(text) # \u904d\u5386\u8d1f\u6837\u672c\u7684csv\u5217\u8868 for n_p_c in n_path_csv_list: with open(n_p_c, \"r\") as f: # \u5c06\u5176\u4e2d\u7684\u6807\u7b7e1\u6539\u5199\u4e3a0 text = f.read().replace(\"1\", \"0\") # \u7136\u540e\u5199\u5165\u6837\u672c\u7684csv\u4e4b\u4e2d fp.write(text) fp.close() \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/get_sample.py\u4e2d\u3002 \u51fd\u6570: get_p_text_list(single_article_path) \u8f93\u5165\u5b9e\u4f8b: # \u539f\u59cb\u8bed\u6599\u5728\u4e0a\u4e00\u4e2a\u76ee\u5f55\u7684create_graph\u76ee\u5f55\u4e0b single_article_path = \"../create_graph/beauty/article-191721\" \u8f93\u51fa\u6548\u679c: ['\u5361\u59ff\u5170\u643a\u624b\u5168\u65b0\u54c1\u724c\u4ee3\u8a00\u4eba\u5a01\u795eV\u4e09\u5b50\u9ec4\u65ed\u7199\u3001\u94b1\u951f\u3001\u5218\u626c\u626c\uff0c\u5f15\u7206\u4e1d\u7ed2\u7ea2\u5507\u8bf1\u60d1\u9b45\u529b2019\u5e747\u670823\u65e5\uff0c\u65f6\u5c1a\u5f69\u5986\u9886\u5bfc\u54c1\u724c\u5361\u59ff\u5170\uff08Carslan\uff09\u6b63\u5f0f\u5b98\u5ba3\uff0c\u6765\u81ea\u65b0\u664b\u4eba\u6c14\u7537\u56e2\u5a01\u795eV\uff08WayV\uff09\u7684\u4e09\u4f4d\u6210\u5458\u9ec4\u65ed\u7199LUCAS\u3001\u94b1\u951fKUN\u3001\u5218\u626c\u626cYANGYANG\u6210\u4e3a\u5168\u65b0\u54c1\u724c\u4ee3\u8a00\u4eba', '\u4e09\u4f4d\u517c\u5177\u5e05\u6c14\u5916\u8868\u7684\u5b9e\u529b\u6d3e\u5076\u50cf\u81ea\u51fa\u9053\u4ee5\u6765\uff0c\u4fbf\u4ee5\u5404\u81ea\u72ec\u7279\u7684\u97f3\u4e50\u4e2a\u6027\u548c\u6c14\u8d28\u9b45\u529b\u5f81\u670d\u4e86\u4e00\u4f17\u7c89\u4e1d', '\u540c\u4e3a\u5e74\u8f7b\u5b9e\u529b\u6d3e\uff0c\u6b64\u6b21\u5361\u59ff\u5170\u643a\u624b\u4e09\u4eba\uff0c\u4ee5\u4e1d\u7ed2\u5507\u818f\u7684\u6781\u81f4\u9b45\u529b\u5f15\u7206\u65f6\u5c1a\u70ed\u70b9', '\u5361\u59ff\u5170\u6b63\u5f0f\u5b98\u5ba3\u5168\u65b0\u54c1\u724c\u4ee3\u8a00\u4eba\u94b1\u951fKUN\u3001\u9ec4\u65ed\u7199LUCAS\u3001\u5218\u626c\u626cYANGYANG \u65e0\u754f\u5e74\u8f7b\u5b9e\u529b\u6d3e\uff0c\u6781\u81f4\u6f14\u7ece\u4e1d\u7ed2\u9b45\u529b\u51fa\u9053\u4e0d\u6ee1\u4e00\u5e74\u5374\u5907\u53d7\u5173\u6ce8\u7684\u4e2d\u56fd\u7537\u56e2\u5a01\u795eV\uff0c\u4ee5\u72ec\u7279\u7684\u97f3\u4e50\u624d\u80fd\u548c\u8d85\u5f3a\u7684\u827a\u80fd\u611f\u4e3a\u4e2d\u56fd\u4e50\u575b\u6ce8\u5165\u4e86\u65b0\u9c9c\u8840\u6db2', '\u6210\u5458\u9ec4\u65ed\u7199LUCAS\u3001\u94b1\u951fKUN\u3001\u5218\u626c\u626cYANGYANG\u66f4\u4ee5\u4e0d\u4fd7\u7684\u821e\u8e48\u5b9e\u529b\u4e0e\u6781\u5177\u7279\u8272\u7684\u97f3\u4e50\u6f14\u7ece\u6280\u5de7\uff0c\u5728\u821e\u53f0\u4e0a\u5f70\u663e\u51fa\u6781\u5f3a\u7684\u4e2a\u4eba\u6c14\u573a', '\u6c14\u8d28\u7f8e\u5c11\u5e74\u9ec4\u65ed\u7199LUCAS\u51ed\u501f\u7740\u7cbe\u81f4\u4e94\u5b98\u548c\u5b8c\u7f8e\u8eab\u6750\uff0c\u6210\u4e3a\u5907\u53d7\u7c89\u4e1d\u8ffd\u6367\u7684\u201c\u6495\u6f2b\u7537\u201d\uff1b\u5a01\u795eV\u961f\u957f\u94b1\u951fKUN\u6709\u7740\u6e29\u67d4\u58f0\u7ebf\uff0c\u5c3d\u663e\u9633\u5149\u6696\u7537\u7684\u6210\u719f\u6c14\u8d28\uff1b\u5e74\u7eaa\u6700\u5c0f\u7684\u5218\u626c\u626cYANGYANG\u53ef\u8c13\u7ec4\u5408\u5f53\u4e2d\u7684\u9b3c\u9a6c\u7cbe\u7075\uff0c\u8eab\u4e3a\u5fb7\u56fd\u534e\u88d4\u7684\u4ed6\u6781\u5bcc\u8bed\u8a00\u5929\u8d4b', ' \u5728\u5168\u65b0\u5e7f\u544a\u7247\u4e2d\uff0c\u4e09\u4f4d\u7537\u795e\u7275\u624b\u5361\u59ff\u5170\u6c14\u573a\u5168\u5f00\uff0c\u6f14\u7ece\u51fa\u9ad8\u7ea7\u4e1d\u7ed2\u65f6\u4ee3\u7684\u8bf1\u60d1\u9b45\u529b', '\u5728\u6b64\u7cfb\u5217\u4e2d\uff0c\u9ec4\u65ed\u7199LUCAS\u4ee3\u8a00\u7684\u5361\u59ff\u5170\u4e1d\u7ed210\u53f7\u8272\u6597\u58eb\u5507\u818f\uff0c\u4ee5\u590d\u53e4\u6df1\u7ea2\u663e\u8272\u800c\u4e0d\u6311\u80a4\u7684\u767e\u642d\u7279\u70b9\uff0c\u8f7b\u677e\u9a7e\u9a6d\u5404\u5927\u573a\u9762\uff0c\u4e3a\u65b0\u65f6\u4ee3\u5973\u6027\u6c14\u573a\u9738\u6c14\u52a0\u6301'] \u51fd\u6570: get_p_sample(a_path, p_path) \u8f93\u5165\u5b9e\u4f8b: # \u539f\u59cb\u8bed\u6599\u5728\u4e0a\u4e00\u4e2a\u76ee\u5f55\u7684create_graph\u76ee\u5f55\u4e0b a_path = \"../create_graph/beauty/\" p_path = \"./beauty\" \u8f93\u51fa\u6548\u679c: # \u83b7\u5f97\u4e00\u4e2ap_sample.csv\u6587\u4ef6, \u91cc\u9762\u7684\u5185\u5bb9\u5f62\u5982: 1 \u8fd9\u4e00\u6b21\u7684\u300a\u6d41\u661f\u82b1\u56ed\u300b\u4e3b\u9898\u4f53\u9a8c\u9986\u5982\u68a6\u5982\u5e7b\uff0c\u6fc0\u8361\u8d77\u65e0\u6570\u5c11\u5973\u5fc3\uff0c\u90a3\u4e48\u690d\u7269\u533b\u751f\u4e0b\u4e00\u6b21\u5236\u9020\u7684\u60ca\u559c\u6211\u4eec\u7fd8\u9996\u4ee5\u76fc 1 \u7f8e\u5986\u798f\u5229\u65f6\u95f4\u53c8\u5230\u5566\uff01\u672c\u671f\u514d\u8d39\u8bd5\u7528\u4ea7\u54c1\uff1a\u83f2\u6d1b\u5609\u65b0\u808c\u8d4b\u6d3b\u4e73\u971c\u4ef7\u683c/\u89c4\u683c\uff1a739RMB/50ml\u8bd5\u7528\u603b\u91cf\uff1a10\u4efd\u622a\u81f3\u7533\u8bf7\u65e5\u671f\uff1a2018\u5e7412\u67084\u65e5\u8bd5\u7528\u62a5\u544a\u622a\u81f3\u65e5\u671f\uff1a2018\u5e741\u67084\u65e5\u83f2\u6d1b\u5609\u65b0\u808c\u8d4b\u6d3b\u4e73\u971c\uff0c\u5373\u65b0\u808c\u8d4b\u6d3b\u9762\u971c\u54d1\u5149\u578b\uff0c\u66f4\u9002\u5408\u4e2d\u6027\u53ca\u6df7\u5408\u80a4\u8d28 1 \u9ad8\u542b\u91cf*NCTF\u662f\u62b5\u5fa1\u808c\u80a4\u8001\u5316\u3001\u591a\u91cd\u8d4b\u6d3b\u7f8e\u808c\u7684\u7406\u60f3\u89e3\u51b3\u65b9\u6848 1 -\u76c8\u6da6\u629a\u7eb9\uff1a\u900f\u660e\u8d28\u9178\u7ed3\u5408\u591a\u80bd\uff0c\u4fc3\u8fdb\u900f\u660e\u8d28\u9178\u751f\u6210\uff0c\u5e73\u6ed1\u7eb9\u8def\uff0c\u5bc6\u96c6\u4e30\u76c8\u808c\u80a4\uff1b-\u7d27\u81f4\u9971\u6ee1\uff1a\u80f6\u539f\u86cb\u767d\u4fc3\u8fdb\u56e0\u5b50**\u52a0\u5f3a\u808c\u80a4\u7ea4\u7ef4\u652f\u6491\uff0c\u7ed3\u5408\u900f\u660e\u8d28\u9178\u7d27\u5b9e\u5f39\u97e7\u808c\u80a4\uff1b-\u7115\u4eae\u6c14\u8272\uff1a\u7ef4\u4ed6\u547dC\u8212\u7f13\u808c\u80a4\u5747\u5300\u80a4\u8272\uff1b\u7ef4\u4ed6\u547d\u590d\u5408\u7269A+H+E\u7ed3\u5408\u591a\u915a\u690d\u7269\u7cbe\u534e\uff0c\u5e73\u6ed1\u808c\u7406\uff0c\u7115\u53d1\u5149\u6cfd\uff0c\u5f3a\u5316\u808c\u80a4\u5c4f\u969c\uff0c\u63d0\u5347\u62b5\u5fa1\u529b\uff1b-\u6291\u5236\u6cb9\u5149\uff1a\u6a44\u6984\u679c\u9178+\u690d\u7269\u7cbe\u534e\u51cf\u5c11\u6cb9\u8102\u5206\u6ccc\u3001\u6536\u7f29\u6bdb\u5b54\uff0c\u6301\u4e45\u8425\u9020\u54d1\u5149\u65e0\u6cb9\u80a4\u8d28 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6309\u7167\u6b64\u65b9\u6cd5, \u5c06\u6211\u4eec\u5728\u76ee\u5f55/data/django-uwsgi/text_labeled/create_graph\u4e0b, \u7ed9\u51fa\u7684fashion, movie, star\u4e09\u4e2a\u539f\u59cb\u8bed\u6599\u6587\u4ef6, \u63d0\u53d6\u51fa\u5b83\u4eec\u6b63\u6837\u672c. \u6700\u7ec8\u5728\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\u751f\u6210p_sample.csv\u6587\u4ef6. \u51fd\u6570: get_sample(p_path, n_path_csv_list) \u8f93\u5165\u5b9e\u4f8b: p_path = \"./beauty\" n_path_csv_list = [\"./movie/p_sample.csv\", \"./star/p_sample.csv\", \"./fashion/p_sample.csv\"] \u8f93\u51fa\u6548\u679c: # \u67e5\u770b\u524d5\u6761\u7684\u6b63\u6837\u672c: 1 #PINKGANG#\uff1a\u4e0d\u7c89\u6240\u6709\u4eba\u7eaa\u68b5\u5e0c2018\u5168\u65b0\u7981\u5fcc\u4e4b\u543b\u6f06\u5149\u5507\u871c\u53d1\u5e03\u4f1a\u66a8\u6d3e\u5bf9 2018\u5e748\u670819\u65e5\uff0c\u6cd5\u56fd\u54c1\u724c\u7eaa\u68b5\u5e0c\u7279\u522b\u6253\u9020\u4e86\u4e00\u573a\u7cbe\u81f4\u9177\u70ab\u7684#PINKGANG#\u65f6\u5c1a\u6d3e\u5bf9\uff0c\u4e3a\u5e86\u795d\u7eaa\u68b5\u5e0c\u5168\u65b0\u7981\u5fcc\u4e4b\u543b\u6f06\u5149\u5507\u871c\uff08Gloss Interdit Vinyl\uff09\u7684\u95ea\u8000\u4e0a\u5e02 1 \u4e0a\u6d77\u9ec4\u6d66\u6c5f\u7554\u7684\u5fb7\u5fc5\u5916\u6ee98\u53f7\uff0c\u5728\u5386\u53f2\u60a0\u4e45\u7684\u6cd5\u5f0f\u53e4\u5178\u5efa\u7b51\u4e2d\uff0c\u7eaa\u68b5\u5e0c\u4e0e\u56fd\u5185\u5404\u5927\u65f6\u5c1a\u5a92\u4f53\u3001\u65f6\u5c1a\u7f8e\u5986\u9886\u57df\u7684\u8fbe\u4eba\u4ee5\u53ca\u65f6\u9ae6\u4eba\u58eb\u4e00\u8d77\u5206\u4eab\u5e76\u4f53\u9a8c\u54c1\u724c\u7684\u5168\u65b0\u4ea7\u54c1\uff0c\u611f\u53d7\u54c1\u724c\u65f6\u5c1a\u53db\u9006\u7684\u5962\u534e\u9b45\u529b 1 \u8d85\u4eba\u6c14\u9752\u6625\u5076\u50cf\u9648\u7acb\u519c\u4f5c\u4e3a\u54c1\u724c\u631a\u53cb\u51fa\u5e2d\u6d3b\u52a8\uff0c\u6f14\u5458\u80e1\u51b0\u537f\u3001\u9648\u7476\u3001\u674e\u5170\u8fea\u4ee3\u8868\u65b0\u65f6\u4ee3\u6f6e\u6d41\u6807\u6746\u53d7\u9080\u4e00\u540c\u4eae\u76f8\u6d3e\u5bf9\uff0c\u5171\u540c\u5206\u4eab\u7eaa\u68b5\u5e0c\u5168\u65b0\u5507\u871c\u7684\u70ab\u76ee\u53d1\u5e03 1 \u503c\u6b64\u4e4b\u9645\uff0c\u56f4\u7ed5\u7740\u201c#PINKGANG#\u4e0d\u7c89\u6240\u6709\u4eba\u201d\u7684\u4e3b\u9898\uff0c\u7eaa\u68b5\u5e0c\u4e3a\u6765\u5bbe\u8425\u9020\u51fa\u53db\u9006\u65f6\u9ae6\u3001\u4e0d\u53d7\u7ea6\u675f\u7684\u6d3e\u5bf9\u6c1b\u56f4\uff0c\u5145\u5206\u5c55\u793a\u4e86\u54c1\u724c\u4e00\u8d2f\u4ee5\u6765\u7a81\u7834\u7ecf\u5178\u3001\u4e2a\u6027\u524d\u536b\u7684\u6001\u5ea6 1 \u73b0\u573a\u7684\u5e03\u7f6e\u4ee5\u7981\u5fcc\u4e4b\u543b\u6f06\u5149\u5507\u871c\u7684\u8272\u5f69\u4e3a\u7075\u611f\uff0c\u5c06\u9713\u8679\u7c89\u8272\u4f5c\u4e3a\u573a\u9986\u7684\u4e3b\u8272\u8c03\uff0c\u7a81\u663e\u7eaa\u68b5\u5e0c\u5168\u65b0\u4ea7\u54c1\u795e\u79d8\u3001\u7981\u5fcc\u3001\u65f6\u5c1a\u7684\u98ce\u683c # \u67e5\u770b\u540e5\u6761\u7684\u8d1f\u6837\u672c\uff1a 0 \u5b83\u91c7\u7528\u76ae\u9769\u9970\u8fb9\u5851\u9020\u67d4\u8f6f\u4f11\u95f2\u6b3e\u5f0f\u7684\u8f6e\u5ed3\uff0c\u6fc0\u5149\u5207\u5272\u9876\u90e8 0 \u7ec9\u80f6\u978b\u5e95\u975e\u5e38\u8010\u7a7f 0 \u7cfb\u5e26\u7684\u6b3e\u5f0f\u4e5f\u5f88\u65f6\u9ae6\u54e6~\u76ae\u6bdb\u662f\u5929\u7136\u8fde\u6bdb\u5c0f\u7ef5\u7f8a\u76ae\uff0c\u6765\u81ea\u745e\u58eb 0 \u76ae\u9769\u91c7\u7528\u5c0f\u7ef5\u7f8a\u76ae\uff0c\u6750\u8d28\u975e\u5e38\u597d\uff0c\u6240\u4ee5\u7279\u522b\u4fdd\u6696\uff0c\u4ef7\u683c\u81ea\u7136\u4e5f\u4f1a\u8d35\u4e00\u4e9b 0 \u5927\u5bb6\u53ef\u53bbShopbop\u4e0a\u8d2d\u4e70\uff0c\u4ef7\u683c\u6bd4UGG\u8d35\u5f88\u591a\uff0c\u4f46\u662f\u8d28\u91cf\u4e5f\u597d~\u54c1\u724c\uff1aINUIKI \u5b98\u7f51\u94fe\u63a5\u6233\u8fd9\u2190\u5355\u54c1\u8d2d\u4e70\u94fe\u63a5\u6233\u8fd9\u2190\u6700\u540e\u4e00\u53e5\u54ce\u54df\u5582\uff0c\u8fd9\u53cc00\u521a\u7ed3\u675f\uff0c\u53c8\u8981\u5f00\u59cb\u5241\u624b\u4e70\u96ea\u5730\u9774\u4e86\uff01 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6309\u7167\u6b64\u65b9\u6cd5, \u5c06\u6211\u4eec\u5728\u76ee\u5f55/data/django-uwsgi/text_labeled/create_graph\u4e0b, \u7ed9\u51fa\u7684fashion, movie, star\u4e09\u4e2a\u539f\u59cb\u8bed\u6599\u6587\u4ef6, \u63d0\u53d6\u51fa\u5b83\u4eec\u6b63\u8d1f\u6837\u672c, \u6700\u7ec8\u5728\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\u751f\u6210sample.csv\u6587\u4ef6. \u4e3b\u8981\u6ce8\u91ca: # \u9650\u5236\u53e5\u5b50\u7684\u6700\u5c0f\u5b57\u7b26\u6570\u548c\u53e5\u5b50\u7684\u6700\u5927\u5b57\u7b26\u6570 \"\"\"\u83b7\u53d6\u5355\u7bc7\u6587\u7ae0\u7684\u6587\u672c\u5217\u8868\"\"\" # \u53bb\u6389\u6362\u884c\u7b26, \u5e76\u4ee5\u53e5\u53f7\u5212\u5206 # \u8fc7\u6ee4\u6389\u957f\u5ea6\u8303\u56f4\u4e4b\u5916\u7684\u53e5\u5b50 \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u6b63\u6837\u672c\u7684csv, \u4ee5\u6587\u7ae0\u8def\u5f84\u548c\u6b63\u6837\u672ccsv\u5199\u5165\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" # \u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u6253\u5f00\u9884\u5199\u5165\u6b63\u6837\u672c\u7684csv # \u904d\u5386\u6587\u7ae0\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e00\u7bc7\u6587\u7ae0 \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u53d6\u6837\u672c\u96c6\u5305\u62ec\u6b63\u8d1f\u6837\u672c, \u4ee5\u6b63\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u548c\u8d1f\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u5217\u8868\u4e3a\u53c2\u6570\"\"\" # \u5148\u5c06\u6b63\u6837\u672c\u5199\u5165\u6837\u672ccsv\u4e4b\u4e2d # \u904d\u5386\u8d1f\u6837\u672c\u7684csv\u5217\u8868 # \u5c06\u5176\u4e2d\u7684\u6807\u7b7e1\u6539\u5199\u4e3a0 # \u7136\u540e\u5199\u5165\u6837\u672c\u7684csv\u4e4b\u4e2d \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90. \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c. \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0. \u5b66\u4e60\u4e86\u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. 3.2 \u8fdb\u884c\u6570\u636e\u5206\u6790 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u6587\u672c\u6570\u636e\u5fc5\u8981\u7684\u5206\u6790\u8fc7\u7a0b\u5e76\u7406\u89e3\u5b83\u4eec\u7684\u4f5c\u7528. \u6587\u672c\u6570\u636e\u5fc5\u8981\u7684\u5206\u6790\u8fc7\u7a0b: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790, \u5982\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03, \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03, \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u7b49\u4f5c\u6570\u636e\u51c6\u5907. \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u800c\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u5bf9\u6211\u4eec\u8fdb\u884c\u63a5\u4e0b\u6765\u7684\u6570\u636e\u5206\u6790\u548c\u5224\u65ad\u6a21\u578b\u51c6\u786e\u7387\u57fa\u7ebf\u8d77\u5230\u5173\u952e\u4f5c\u7528. \u4e3e\u4e2a\u6817\u5b50: \u5047\u5982\u6b63\u6837\u672c\u6570\u91cf\u4e3a8\u4e07\u6761, \u8d1f\u6837\u672c\u6570\u91cf\u4e3a2\u4e07\u6761, \u5982\u679c\u6211\u4eec\u4e0d\u505a\u4efb\u4f55\u6837\u672c\u8c03\u6574\u5de5\u4f5c, \u5c31\u5c06\u5176\u8f93\u9001\u7ed9\u6a21\u578b\u8bad\u7ec3, \u90a3\u4e48\u6a21\u578b\u5f88\u5feb\u5c31\u80fd\u627e\u5230\u4e00\u4e2a\u89c4\u5f8b, \u5c31\u662f\u4e0d\u5206\u9752\u7ea2\u7682\u767d\u7684\u90fd\u628a\u7ed3\u679c\u9884\u6d4b\u4e3a\u6b63\u6837\u672c, \u4e5f\u53ef\u4ee5\u5f97\u5230\u5dee\u4e0d\u591a80%\u7684\u51c6\u786e\u7387. \u8fd9\u5c31\u8bf4\u660e\u6211\u4eec\u6b64\u65f6\u6a21\u578b\u7684\u51c6\u786e\u7387\u57fa\u7ebf\u5c31\u662f80%, \u56e0\u6b64\u8fd9\u662f\u4e0d\u5408\u7406\u7684, \u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u5747\u8861\u6b63\u8d1f\u6837\u672c, \u4fdd\u8bc1\u6a21\u578b\u57fa\u7ebf\u572850%\u5de6\u53f3, \u8fd9\u6837\u5f97\u5230\u51c6\u786e\u738780%\u7684\u6a21\u578b\u624d\u7b97\u5f97\u4e0a\u6709\u610f\u4e49. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u5bf9\u9f50\u957f\u5ea6, \u800c\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6\u5c06\u6709\u6548\u7684\u907f\u514d\u7a00\u758f\u7279\u5f81\u6216\u5197\u4f59\u7279\u5f81\u7684\u4ea7\u751f, \u63d0\u5347\u8bad\u7ec3\u6548\u7387. \u4e3e\u4e2a\u6817\u5b50: \u5047\u5982\u6211\u4eec\u670910\u4e07\u6761\u6570\u636e, \u5176\u4e2d9.9\u4e07\u6761\u7684\u53e5\u5b50\u957f\u5ea6\u90fd\u5728100\u4e2a\u5b57\u7b26\u5185, \u53ea\u6709\u5269\u4e0b\u7684\u4e00\u5c0f\u90e8\u5206\u53e5\u5b50\u957f\u5ea6\u975e\u5e38\u957f, \u56e0\u4e3a\u6a21\u578b\u7684\u8f93\u5165\u9700\u8981\u662f\u77e9\u9635, \u4e5f\u5c31\u662f\u7b49\u957f\u5411\u91cf, \u56e0\u6b64\u6587\u672c\u9700\u8981\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50, \u800c\u5206\u6790\u5728\u4ec0\u4e48\u957f\u5ea6\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u5341\u5206\u91cd\u8981, \u5982\u679c\u6211\u4eec\u4ee5\u6700\u957f\u957f\u5ea6\u5bf9\u9f50\u7684\u8bdd, \u5c06\u67099.9\u4e07\u6761\u6570\u636e\u6269\u5145\u6ca1\u6709\u5fc5\u8981\u7684\u7279\u5f81\u957f\u5ea6, \u4e0d\u4ec5\u5360\u7528\u66f4\u591a\u7684\u5185\u5b58, \u5e76\u4e14\u5bfc\u81f4\u6a21\u578b\u53c2\u6570\u6fc0\u589e, \u6a21\u578b\u8bad\u7ec3\u6548\u7387\u4e0b\u964d. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03 \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_feature(\u6700\u5927\u7684\u7279\u5f81\u603b\u6570)\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf. \u89e3\u91ca: \u6a21\u578b\u8d85\u53c2\u6570max_feature\u7684\u9009\u5b9a\u5728NLP\u9886\u57df\u4e00\u822c\u662f\u5927\u4e8e\u6240\u6709\u8bed\u6599\u6d89\u53ca\u7684\u8bcd\u6c47\u603b\u6570\u7684, \u4f46\u662f\u53c8\u4e0d\u80fd\u9009\u62e9\u8fc7\u4e8e\u5927, \u5426\u5219\u4f1a\u5bfc\u81f4\u7f51\u7edc\u53c2\u6570\u6fc0\u589e, \u6a21\u578b\u8fc7\u4e8e\u590d\u6742\uff0c\u5bb9\u6613\u8fc7\u62df\u5408. \u56e0\u6b64\u9700\u8981\u53c2\u8003\u8bcd\u6c47\u603b\u6570. \u540c\u65f6, \u8bcd\u9891\u5206\u5e03\u53ef\u4ee5\u770b\u51fa\u9ad8\u9891\u8bcd\u6c47\u4e0e\u7c7b\u522b\u7684\u76f8\u5173\u6027, \u5224\u65ad\u6b63\u8d1f\u6837\u672c\u7684\u662f\u5426\u5bf9\u5206\u7c7b\u4ea7\u751f\u6548\u679c. \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import pandas as pd import jieba def get_data_labels(csv_path): \"\"\"\u83b7\u5f97\u8bad\u7ec3\u6570\u636e\u548c\u5bf9\u5e94\u7684\u6807\u7b7e, \u4ee5\u6b63\u8d1f\u6837\u672c\u7684csv\u6587\u4ef6\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528pandas\u8bfb\u53d6csv\u6587\u4ef6\u81f3\u5185\u5b58 df = pd.read_csv(csv_path, header=None, sep=\"\\t\") # \u5bf9\u53e5\u5b50\u8fdb\u884c\u5206\u8bcd\u5904\u7406\u5e76\u8fc7\u6ee4\u6389\u957f\u5ea6\u4e3a1\u7684\u8bcd train_data = list(map(lambda x: list(filter(lambda x: len(x)>1, jieba.lcut(x))), df[1].values)) # \u53d6\u7b2c0\u5217\u7684\u503c\u4f5c\u4e3a\u8bad\u7ec3\u6807\u7b7e train_labels = df[0].values return train_data, train_labels \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u6837\u672ccsv\u6587\u4ef6\u8def\u5f84 csv_path = \"./movie/sample.csv\" \u8f93\u51fa\u6548\u679c: # train_data [['\u4eca\u65e5', '\u6349\u5996', '\u5317\u4eac', '\u4e3e\u529e', '\u5168\u7403', '\u9996\u6620\u793c', '\u53d1\u5e03\u4f1a', '\u5bfc\u6f14'], ['\u8bb8\u8bda\u6bc5', '\u5404\u4f4d', '\u4e3b\u6f14', '\u4eae\u76f8', '\u73b0\u573a', '\u5404\u4f4d', '\u6f14\u5458'], [ '\u5927\u5bb6', '\u8bb2\u8ff0', '\u81ea\u5df1', '\u62cd\u6444', '\u8fc7\u7a0b', '\u53d1\u751f', '\u8da3\u4e8b', '\u5927\u5bb6', '\u5206\u4eab'], [ '\u81ea\u5df1', '\u8fc7\u5e74', '\u8ba1\u5212', '\u73b0\u573a', '\u5e03\u7f6e', '\u5341\u5206', '\u559c\u5e86', '\u653e\u773c\u671b\u53bb', '\u4e00\u7247', '\u7ea2\u5f64\u5f64', '\u989c\u8272', '\u611f\u53d7', '\u6d53\u6d53\u7684', '\u5e74\u5473'], ['\u80e1\u5df4', '\u906d\u9047', '\u5371\u9669', '\u5168\u6c11', '\u8ffd\u51fb', '\u53d1\u5e03', '\u9884\u544a\u7247', '\u5f53\u4e2d', '\u80e1\u5df4'], ['\u906d\u5230', '\u8ffd\u6740', '\u6d41\u843d', '\u4eba\u95f4', '\u6881\u671d\u4f1f', '\u6536\u7559', '\u4e0e\u6b64\u540c\u65f6'], ...] # train_labels [1 1 1 ... 0 0 0] \u83b7\u53d6\u6807\u7b7e\u7c7b\u522b\u6570\u91cf\u5206\u5e03\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import os from collections import Counter def pic_show(pic, pic_path, pic_name): \"\"\"\u7528\u4e8e\u56fe\u7247\u663e\u793a\uff0c\u4ee5\u56fe\u7247\u5bf9\u8c61\u548c\u9884\u4fdd\u5b58\u7684\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" if not os.path.exists(pic_path): os.mkdir(pic_path) pic.savefig(os.path.join(pic_path, pic_name) print(\"\u8bf7\u901a\u8fc7\u5730\u5740http://47.92.175.143:8087/text_labeled/model_train\" + pic_path[1:] + pic_name + \"\u67e5\u770b.\") def get_labels_distribution(train_labels, pic_path, pic_name=\"ld.png\"): \"\"\"\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u6570\u91cf\u7684\u57fa\u672c\u5206\u5e03\u60c5\u51b5\"\"\" # class_dict >>> {1: 3995, 0: 4418} class_dict = dict(Counter(train_labels)) print(class_dict) df = pd.DataFrame(list(class_dict.values()), list(class_dict.keys())) pic = df.plot(kind='bar', title=\"\u7c7b\u522b\u5206\u5e03\u56fe\").get_figure() pic_show(pic, pic_path, pic_name) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # get_data_labels\u51fd\u6570\u5f97\u5230\u7684train_labels # \u56fe\u7247\u7684\u5b58\u50a8\u8def\u5f84 pic_path = \"./movie/\" # \u56fe\u7247\u7684\u540d\u5b57, \u9ed8\u8ba4\u662fld.png pic_name = \"ld.png\" \u8f93\u51fa\u6548\u679c: {1: 4640, 0: 7165} \u6807\u7b7e\u7c7b\u522b\u6570\u91cf\u5206\u5e03\u56fe, \u4f4d\u4e8e./movie/ld.png \u7ed3\u679c\u5206\u6790: \u5f53\u524d\u7684\u6b63\u8d1f\u6837\u672c\u6570\u91cf\u662f\u5206\u522b\u662f: 4640\u548c7165,\u76f8\u5dee2525\u6761\u6570\u636e. \u4e3a\u4e86\u4f7f\u6b63\u8d1f\u6837\u672c\u5747\u8861, \u8ba9\u5b83\u4eec\u7684\u6bd4\u4f8b\u4e3a1:1, \u6211\u4eec\u5c06\u5728\u4e4b\u540e\u8fdb\u884c\u7684\u8be5\u7c7b\u522b\u7684\u6570\u636e\u5206\u6790\u548c\u6a21\u578b\u8bad\u7ec3\u4e2d, \u53bb\u63892525\u6761\u8d1f\u6837\u672c\u7684\u6570\u91cf. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: def get_sentence_length_distribution(train_data, pic_path, pic_name=\"sld.png\"): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u60c5\u51b5\"\"\" sentence_len_list = list(map(len, train_data)) # len_dict >>> {38: 62, 58: 18, 40: 64, 35: 83,....} len_dict = dict(Counter(sentence_len_list)) len_list = list(zip(len_dict.keys(), len_dict.values())) # len_list >>> [(1, 3), (2, 20), (3, 51), (4, 96), (5, 121), (6, 173), ...] len_list.sort(key=(lambda x: x[0])) df = pd.DataFrame(list(map(lambda x: x[1], len_list)), list( map(lambda x: x[0], len_list))) ax = df.plot(kind='bar', figsize=(18, 18), title=\"\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u56fe\") ax.set_xlabel(\"\u53e5\u5b50\u957f\u5ea6\") ax.set_ylabel(\"\u8be5\u957f\u5ea6\u51fa\u73b0\u7684\u6b21\u6570\") pic = ax.get_figure() pic_show(pic, pic_path, pic_name) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u901a\u8fc7get_data_labels\u5f97\u5230\u7684train_data(\u9700\u8981\u8fdb\u884c\u5747\u8861\u5207\u7247) # \u56fe\u7247\u7684\u5b58\u50a8\u8def\u5f84 pic_path = \"./movie/\" # \u56fe\u7247\u7684\u540d\u5b57, \u9ed8\u8ba4\u662fsld.png pic_name = \"sld.png\" \u8f93\u51fa\u6548\u679c: \u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u56fe, \u4f4d\u4e8e./movie/sld.png \u7ed3\u679c\u5206\u6790: \u901a\u8fc7\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u56fe, \u6211\u4eec\u77e5\u9053\u4e86\u53e5\u5b50\u7684\u957f\u5ea6\u8303\u56f4\u57280-151\u4e4b\u95f4. \u4f46\u57280-60\u7684\u957f\u5ea6\u4e4b\u95f4, \u5df2\u7ecf\u5305\u542b\u4e86\u8d85\u8fc790%\u7684\u53e5\u5b50, \u56e0\u6b64\u8fd9\u91cc\u53ef\u4ee5\u8ba4\u4e3a60\u7684\u957f\u5ea6\u662f\u4e00\u4e2a\u5408\u7406\u7684\u622a\u65ad\u5bf9\u9f50\u957f\u5ea6, \u5373\u4e0d\u4f1a\u4f7f\u5927\u91cf\u53e5\u5b50\u88ab\u622a\u65ad\u800c\u5931\u53bb\u4e3b\u8981\u4fe1\u606f, \u53c8\u80fd\u591f\u6709\u6548\u907f\u514d\u8865\u9f50\u7684\u7279\u5f81\u6570\u91cf\u592a\u591a, \u5bfc\u81f4\u6a21\u578b\u53c2\u6570\u8fc7\u5927. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: from itertools import chain def get_word_frequency_distribution(train_data, pic_path, pic_name=\"wfd.png\"): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u8bcd\u9891\u5206\u5e03\"\"\" vocab_size = len(set(chain(*train_data))) print(\"\u6240\u6709\u6837\u672c\u5171\u5305\u542b\u4e0d\u540c\u8bcd\u6c47\u6570\u91cf\u4e3a\uff1a\", vocab_size) # \u83b7\u53d6\u5e38\u89c1\u8bcd\u5206\u5e03\u5b57\u5178\uff0c\u4ee5\u4fbf\u8fdb\u884c\u7ed8\u56fe # common_word_dict >>> {'\u7535\u5f71': 1548, '\u81ea\u5df1': 968, '\u4e00\u4e2a': 850, '\u5bfc\u6f14': 757, '\u73b0\u573a': 744, ...} common_word_dict = dict(Counter(chain(*train_data)).most_common(50)) df = pd.DataFrame(list(common_word_dict.values()), list(common_word_dict.keys())) pic = df.plot(kind='bar', figsize=(18, 18), title=\"\u5e38\u89c1\u8bcd\u5206\u5e03\u56fe\").get_figure() pic_show(pic, pic_path, pic_name) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u901a\u8fc7get_data_labels\u5f97\u5230\u7684train_data(\u9700\u8981\u8fdb\u884c\u5747\u8861\u5207\u7247) # \u56fe\u7247\u7684\u5b58\u50a8\u8def\u5f84 pic_path = \"./movie/\" # \u56fe\u7247\u7684\u540d\u5b57, \u9ed8\u8ba4\u662fwfd.png pic_name = \"wfd.png\" \u8f93\u51fa\u6548\u679c: \u6240\u6709\u6837\u672c\u5171\u5305\u542b\u4e0d\u540c\u8bcd\u6c47\u6570\u91cf\u4e3a\uff1a24020 \u7535\u5f71\u8bad\u7ec3\u96c6\u5e38\u89c1\u8bcd\u5206\u5e03\u56fe, \u4f4d\u4e8e./movie/wfd.png \u7ed3\u679c\u5206\u6790: \u901a\u8fc7\u5e38\u89c1\u8bcd\u9891\u5206\u6790, \u5168\u6587\u8bcd\u6c47\u603b\u6570\u4e3a24020, \u5728\u6a21\u578b\u8bad\u7ec3\u65f6\u5b9a\u4e49\u7684max_features\u5e94\u5927\u4e8e\u8be5\u6570\u503c. \u540c\u65f6\u5bf9\u6bd4\u9ad8\u9891\u8bcd\u6c47\u4e2d\u51fa\u73b0\u7684\u4e0e\u5f71\u89c6\u76f8\u5173\u7684\u8bcd\u6c47\u5360\u6bd4\u5927\u6982\u572850%\u5de6\u53f3, \u7b26\u5408\u6b63\u8d1f\u6837\u672c\u7684\u5206\u5e03\u6bd4\u4f8b, \u56e0\u6b64\u8bed\u6599\u8d28\u91cf\u5c1a\u53ef. \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u83b7\u5f97\u8bad\u7ec3\u6570\u636e\u548c\u5bf9\u5e94\u7684\u6807\u7b7e, \u4ee5\u6b63\u8d1f\u6837\u672c\u7684csv\u6587\u4ef6\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528pandas\u8bfb\u53d6csv\u6587\u4ef6\u81f3\u5185\u5b58 # \u5bf9\u53e5\u5b50\u8fdb\u884c\u5206\u8bcd\u5904\u7406\u5e76\u8fc7\u6ee4\u6389\u957f\u5ea6\u4e3a1\u7684\u8bcd # \u53d6\u7b2c0\u5217\u7684\u503c\u4f5c\u4e3a\u8bad\u7ec3\u6807\u7b7e \"\"\"\u7528\u4e8e\u56fe\u7247\u663e\u793a\uff0c\u4ee5\u56fe\u7247\u5bf9\u8c61\u548c\u9884\u4fdd\u5b58\u7684\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" \"\"\"\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u6570\u91cf\u7684\u57fa\u672c\u5206\u5e03\u60c5\u51b5\"\"\" # class_dict >>> {1: 3995, 0: 4418} \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u60c5\u51b5\"\"\" # len_dict >>> {38: 62, 58: 18, 40: 64, 35: 83,....} # len_list >>> [(1, 3), (2, 20), (3, 51), (4, 96), (5, 121), (6, 173), ...] \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u8bcd\u9891\u5206\u5e03\"\"\" # \u83b7\u53d6\u5e38\u89c1\u8bcd\u5206\u5e03\u5b57\u5178\uff0c\u4ee5\u4fbf\u8fdb\u884c\u7ed8\u56fe # common_word_dict >>> {'\u7535\u5f71': 1548, '\u81ea\u5df1': 968, '\u4e00\u4e2a': 850, '\u5bfc\u6f14': 757, '\u73b0\u573a': 744, ...} \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6309\u7167\u4e0a\u9762\u5b66\u4e60\u7684\u6570\u636e\u5206\u6790\u65b9\u6cd5, \u5bf9\u5176\u4ed6\u7ed9\u51fa\u7684\u8bad\u7ec3\u6570\u636e(fashion, beauty, star), \u8fdb\u884c\u7c7b\u4f3c\u7684\u6570\u636e\u5206\u6790, \u5e76\u5728\u5bf9\u5e94\u7684\u6587\u4ef6\u4e2d\u751f\u6210\u4e09\u5f20\u5206\u5e03\u56fe. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u6587\u672c\u6570\u636e\u5206\u6790\u7684\u8fc7\u7a0b: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790\u4f5c\u6570\u636e\u51c6\u5907. \u5b9e\u73b0\u51fd\u6570: get_data_labels \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u800c\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u5bf9\u6211\u4eec\u8fdb\u884c\u63a5\u4e0b\u6765\u7684\u6570\u636e\u5206\u6790\u548c\u5224\u65ad\u6a21\u578b\u51c6\u786e\u7387\u57fa\u7ebf\u8d77\u5230\u5173\u952e\u4f5c\u7528. \u5b9e\u73b0\u51fd\u6570: get_labels_distribution \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6. \u5b9e\u73b0\u51fd\u6570: get_sentence_length_distribution \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_features\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf. \u5b9e\u73b0\u51fd\u6570: get_word_frequency_distribution 3.3 \u7279\u5f81\u5904\u7406 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2\u53ca\u5176\u4f5c\u7528. \u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57. \u4e3e\u4e2a\u6817\u5b50 \u5206\u8bcd(\u8bcd\u6c47)\u5217\u8868: [\"\u6709\u65f6\", \"\u6211\u60f3\", \"\u653e\u5f03\", \"\u6323\u624e\", \"\u4e5f\u653e\u4e0b\", \"\u6211\", \"\u5199\u5b57\u7684\u624b\"] \u628a\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57, \u5f97\u5230\u5e8f\u5217\u5217\u8868: [1, 2, 3, 4, 5, 6, 7] \u5206\u8bcd\u5217\u8868: [\"\u53ef\u662f\", \"\u6211\u5df2\u7ecf\", \"\u653e\u5f03\", \"\u592a\u591a\", \"\u8fd8\u575a\u6301\", \"\u7740\u8bf4\", \"\u8fd8\u575a\u6301\", \"\u7740\u8d70\"] \u5f97\u5230\u5e8f\u5217\u5217\u8868: [8, 9, 3, 10, 11, 12, 11, 13] \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad\u5bf9\u9f50: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408. \u4e3e\u4e2a\u6817\u5b50: \u5e8f\u5217\u5217\u8868: [[1, 2, 3, 4, 5, 6], [1, 3, 9], [2, 4, 6], [2, 3]] \u4ee5\u957f\u5ea63\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u540e\u5f97\u5230 \u65b0\u7684\u5e8f\u5217\u5217\u8868: [[1, 2, 3], [1, 3, 9], [2, 4, 6], [2, 3, 0]] \u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054. \u4e3e\u4e2a\u6817\u5b50: \u5728\u8fd9\u91cc, \u53ef\u4ee5\u5c06n-gram\u7279\u5f81\u53ef\u4ee5\u7406\u89e3\u4e3a\u76f8\u90bb\u8bcd\u6c47\u7684\u5171\u73b0\u7279\u5f81, \u5f53n\u4e3a2\u65f6, \u5c31\u662f\u8fde\u7eed\u4e24\u4e2a\u8bcd\u7684\u5171\u73b0. \u6211\u4eec\u8fd9\u91cc\u5c06\u4f7f\u75282-gram, \u56e0\u6b64\u4ee52-gram\u4e3a\u4f8b\u8fdb\u884c\u89e3\u91ca: \u5206\u8bcd\u5217\u8868: [\"\u662f\u8c01\", \"\u6572\u52a8\", \"\u6211\u5fc3\"] \u5bf9\u5e94\u7684\u5e8f\u5217\u5217\u8868: [1, 34, 21] \u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u5e8f\u5217\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u6570\u5b57\u5c31\u662f\u539f\u59cb\u53e5\u5b50\u7684\u7279\u5f81, \u5373\u8bcd\u6c47\u662f\u539f\u59cb\u53e5\u5b50\u7684\u7279\u5f81. \u9664\u6b64\u4e4b\u5916, \u6211\u4eec\u8fd8\u53ef\u4ee5\u628a\"\u662f\u8c01\"\u548c\"\u6572\u52a8\"\u4e24\u4e2a\u8bcd\u5171\u540c\u51fa\u73b0\u4e14\u76f8\u90bb\u4e5f\u4f5c\u4e3a\u4e00\u79cd\u7279\u5f81\u52a0\u5165\u5230\u5e8f\u5217\u5217\u8868\u4e2d, \u6b64\u65f6\u5e8f\u5217\u5217\u8868\u5c31\u53d8\u6210\u4e86\u5305\u542b2-gram\u7279\u5f81\u7684\u7279\u5f81\u5217\u8868: [1, 34, 21, 1000] \u8fd9\u91cc\u76841000\u5c31\u4ee3\u8868\"\u662f\u8c01\"\u548c\"\u6572\u52a8\"\u5171\u540c\u51fa\u73b0\u4e14\u76f8\u90bb, \u8fd9\u79cd\u7279\u5f81\u4e5f\u5c31\u662fn-gram\u7279\u5f81.\u5176\u4e2dn\u4e3a2. \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165. \u4e3e\u4e2a\u6817\u5b50: \u548c\u7b2c\u4e8c\u6b65\u622a\u65ad\u8865\u9f50\u7c7b\u4f3c: \u5e8f\u5217\u5217\u8868: [[1, 2, 3, 4, 5, 6], [1, 3, 9], [2, 4, 6], [2, 3]] \u4ee5\u6700\u957f\u957f\u5ea6\u8fdb\u884c\u5bf9\u9f50\u540e\u5f97\u5230 \u65b0\u7684\u5e8f\u5217\u5217\u8868: [[1, 2, 3, 4, 5, 6], [1, 3, 9, 0, 0, 0], [2, 4, 6, 0, 0, 0], [2, 3, 0, 0, 0, 0]] \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: # \u5bfc\u5165\u7528\u4e8e\u5bf9\u8c61\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684joblib from sklearn.externals import joblib # \u5bfc\u5165keras\u4e2d\u7684\u8bcd\u6c47\u6620\u5c04\u5668Tokenizer from keras.preprocessing.text import Tokenizer # \u5bfc\u5165\u4ece\u6837\u672ccsv\u5230\u5185\u5b58\u7684get_data_labels\u51fd\u6570 from data_analysis import get_data_labels def word_map(csv_path, tokenizer_path, cut_num): \"\"\"\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04\uff0c\u4ee5\u8bad\u7ec3\u6570\u636e\u7684csv\u8def\u5f84\u548c\u6620\u5c04\u5668\u5b58\u50a8\u8def\u5f84\u4ee5\u53ca\u622a\u65ad\u6570\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528get_data_labels\u51fd\u6570\u83b7\u53d6\u7b80\u5355\u5904\u7406\u540e\u7684\u8bad\u7ec3\u6570\u636e\u548c\u6807\u7b7e train_data, train_labels = get_data_labels(csv_path) # \u8fdb\u884c\u6b63\u8d1f\u6837\u672c\u5747\u8861\u5207\u5272, \u4f7f\u5176\u6570\u91cf\u6bd4\u4f8b\u4e3a1:1 train_data = train_data[:-cut_num] train_labels = train_labels[:-cut_num] # \u5b9e\u4f8b\u5316\u4e00\u4e2a\u8bcd\u6c47\u6620\u5c04\u5668\u5bf9\u8c61 t = Tokenizer(num_words=None, char_level=False) # \u4f7f\u7528\u6620\u5c04\u5668\u62df\u5408\u73b0\u6709\u6587\u672c\u6570\u636e t.fit_on_texts(train_data) # \u4f7f\u7528joblib\u5de5\u5177\u4fdd\u5b58\u6620\u5c04\u5668 joblib.dump(t, tokenizer_path) # \u4f7f\u7528\u6620\u5c04\u5668\u8f6c\u5316\u73b0\u6709\u6587\u672c\u6570\u636e x_train = t.texts_to_sequences(train_data) # \u83b7\u5f97\u6807\u7b7e\u6570\u636e y_train = train_labels return x_train, y_train \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u5bf9\u5e94\u7684\u6837\u672ccsv\u8def\u5f84 csv_path = \"./movie/sample.csv\" # \u8bcd\u6c47\u6620\u5c04\u5668\u4fdd\u5b58\u7684\u8def\u5f84 tokenizer_path = \"./movie/Tokenizer\" # \u622a\u65ad\u6570 cut_num = 2525 \u8f93\u51fa\u6548\u679c: # x_train [[3480, 485, 9674, 979, 23, 67, 39, 1097, 432, 49, 27584, 205], [17, 27585, 27586, 1355, 27587, 14019, 65, 100], [2282, 2609, 7, 7616, 1897, 2302, 274, 1355, 2302, 20], [57, 27588, 13601, 135, 586, 134, 4138], ...] # y_train [1 1 1 ... 0 0 0] \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u7528\u4e8e\u5bf9\u8c61\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684joblib # \u5bfc\u5165keras\u4e2d\u7684\u8bcd\u6c47\u6620\u5c04\u5668Tokenizer # \u5bfc\u5165\u4ece\u6837\u672ccsv\u5230\u5185\u5b58\u7684get_data_labels\u51fd\u6570 \"\"\"\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04\uff0c\u4ee5\u8bad\u7ec3\u6570\u636e\u7684csv\u8def\u5f84\u548c\u6620\u5c04\u5668\u5b58\u50a8\u8def\u5f84\u4ee5\u53ca\u622a\u65ad\u6570\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528get_data_labels\u51fd\u6570\u83b7\u53d6\u7b80\u5355\u5904\u7406\u540e\u7684\u8bad\u7ec3\u6570\u636e\u548c\u6807\u7b7e # \u8fdb\u884c\u6b63\u8d1f\u6837\u672c\u5747\u8861\u5207\u5272, \u4f7f\u5176\u6570\u91cf\u6bd4\u4f8b\u4e3a1:1 # \u5b9e\u4f8b\u5316\u4e00\u4e2a\u8bcd\u6c47\u6620\u5c04\u5668\u5bf9\u8c61 # \u4f7f\u7528\u6620\u5c04\u5668\u62df\u5408\u73b0\u6709\u6587\u672c\u6570\u636e # \u4f7f\u7528joblib\u5de5\u5177\u4fdd\u5b58\u6620\u5c04\u5668 # \u4f7f\u7528\u6620\u5c04\u5668\u8f6c\u5316\u73b0\u6709\u6587\u672c\u6570\u636e # \u83b7\u5f97\u6807\u7b7e\u6570\u636e \u5411\u91cf\u622a\u65ad\u5bf9\u9f50\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: from keras.preprocessing import sequence # cutlen\u6839\u636e\u6570\u636e\u5206\u6790\u4e2d\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\uff0c\u8986\u76d690%\u8bed\u6599\u7684\u6700\u77ed\u957f\u5ea6. cutlen = 60 def padding(x_train, cutlen): return sequence.pad_sequences(x_train, cutlen) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u901a\u8fc7word_map\u51fd\u6570\u83b7\u5f97\u7684x_train # \u901a\u8fc7\u6570\u636e\u5206\u6790\u83b7\u5f97\u7684\u622a\u65ad\u957f\u5ea6 cutlen = 60 \u8f93\u51fa\u6548\u679c: # \u8fdb\u884c\u622a\u65ad\u8865\u9f50\u540e\u7684\u77e9\u9635x_train [[ 0 0 0 ... 49 5576 5577] [ 0 0 1682 ... 1 1682 7179] [ 0 0 0 ... 148 10517 7183] ... [ 0 0 0 ... 7245 1567 1731] [ 0 0 0 ... 1872 364 20985] [ 0 0 0 ... 10353 1207 20989]] \u4e3b\u8981\u6ce8\u91ca # cutlen\u6839\u636e\u6570\u636e\u5206\u6790\u4e2d\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\uff0c\u8986\u76d690%\u8bed\u6599\u7684\u6700\u77ed\u957f\u5ea6. \u52a0\u5165n-gram\u7279\u5f81\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import numpy as np # \u6839\u636e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570\u9009\u62e9\u6700\u5927\u7279\u5f81\u6570\uff0c\u5e94\u5927\u4e8e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570 max_features = 25000 # n-gram\u7279\u5f81\u7684\u8303\u56f4\uff0c\u4e00\u822c\u9009\u62e9\u4e3a2 ngram_range = 2 def create_ngram_set(input_list, ngram_value=2): \"\"\" \u4ece\u5217\u8868\u4e2d\u63d0\u53d6n-gram\u7279\u5f81 >>> create_ngram_set([1, 4, 9, 4, 1, 4], ngram_value=2) {(4, 9), (4, 1), (1, 4), (9, 4)} \"\"\" return set(zip(*[input_list[i:] for i in range(ngram_value)])) def get_ti_and_nmf(x_train, ti_path, ngram_range): \"\"\"\u4ece\u8bad\u7ec3\u6570\u636e\u4e2d\u83b7\u5f97token_indice\u548c\u65b0\u7684max_features\"\"\" # >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} # \u521b\u5efa\u4e00\u4e2a\u76db\u88c5n-gram\u7279\u5f81\u7684\u96c6\u5408. ngram_set = set() # \u904d\u5386\u6bcf\u4e00\u4e2a\u6570\u503c\u6620\u5c04\u540e\u7684\u5217\u8868 for input_list in x_train: # \u904d\u5386\u53ef\u80fd\u5b58\u57282-gram, 3-gram\u7b49 for i in range(2, ngram_range + 1): # \u83b7\u5f97\u5bf9\u5e94\u7684n-gram\u8868\u793a set_of_ngram = create_ngram_set(input_list, ngram_value=i) # \u66f4\u65b0n-gram\u96c6\u5408 ngram_set.update(set_of_ngram) # \u53bb\u9664\u6389(0, 0)\u8fd9\u4e2a2-gram\u7279\u5f81 ngram_set.discard(tuple([0]*ngram_range)) # \u5c06n-gram\u7279\u5f81\u6620\u5c04\u6210\u6574\u6570. # \u4e3a\u4e86\u907f\u514d\u548c\u4e4b\u524d\u7684\u8bcd\u6c47\u7279\u5f81\u51b2\u7a81\uff0cn-gram\u4ea7\u751f\u7684\u7279\u5f81\u5c06\u4ecemax_features+1\u5f00\u59cb start_index = max_features + 1 # \u5f97\u5230\u5bf9n-gram\u8868\u793a\u4e0e\u5bf9\u5e94\u7279\u5f81\u503c\u7684\u5b57\u5178 token_indice = {v: k + start_index for k, v in enumerate(ngram_set)} # \u5c06token_indice\u5199\u5165\u6587\u4ef6\u4ee5\u4fbf\u9884\u6d4b\u65f6\u4f7f\u7528 with open(ti_path, \"w\") as f: f.write(str(token_indice)) # token_indice\u7684\u53cd\u8f6c\u5b57\u5178\uff0c\u4e3a\u4e86\u6c42\u89e3\u65b0\u7684\u6700\u5927\u7279\u5f81\u6570 indice_token = {token_indice[k]: k for k in token_indice} # \u83b7\u5f97\u52a0\u5165n-gram\u4e4b\u540e\u7684\u6700\u5927\u7279\u5f81\u6570 new_max_features = np.max(list(indice_token.keys())) + 1 return token_indice, new_max_features def add_ngram(sequences, token_indice, ngram_range=2): \"\"\" \u5c06n-gram\u7279\u5f81\u52a0\u5165\u5230\u8bad\u7ec3\u6570\u636e\u4e2d \u5982: adding bi-gram >>> sequences = [[1, 3, 4, 5], [1, 3, 7, 9, 2]] >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} >>> add_ngram(sequences, token_indice, ngram_range=2) [[1, 3, 4, 5, 1337, 2017], [1, 3, 7, 9, 2, 1337, 42]] \"\"\" new_sequences = [] # \u904d\u5386\u5e8f\u5217\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3ainput_list, \u5373\u4ee3\u8868\u4e00\u4e2a\u53e5\u5b50\u7684\u5217\u8868 for input_list in sequences: # copy\u4e00\u4e2anew_list new_list = input_list[:].tolist() # \u904d\u5386n-gram\u7684value\uff0c\u81f3\u5c11\u4ece2\u5f00\u59cb for ngram_value in range(2, ngram_range + 1): # \u904d\u5386\u5404\u4e2a\u53ef\u80fd\u7684n-gram\u957f\u5ea6 for i in range(len(new_list) - ngram_value + 1): # \u83b7\u5f97input_list\u4e2d\u7684n-gram\u8868\u793a ngram = tuple(new_list[i:i + ngram_value]) # \u5982\u679c\u5728token_indice\u4e2d\uff0c\u5219\u8ffd\u52a0\u76f8\u5e94\u7684\u6570\u503c\u7279\u5f81 if ngram in token_indice: new_list.append(token_indice[ngram]) new_sequences.append(new_list) return np.array(new_sequences) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u51fd\u6570create_ngram_set(input_list, ngram_value=2): \u8f93\u5165\u5b9e\u4f8b: input_list = [1, 4, 9, 4, 1, 4] \u8f93\u51fa\u6548\u679c: # 2-gram\u7279\u5f81\u7ec4\u6210\u7684\u96c6\u5408 {(4, 1), (9, 4), (4, 9), (1, 4)} \u51fd\u6570get_ti_and_nmf(x_train, ti_path, ngram_range): \u8f93\u5165\u5b9e\u4f8b: # \u6570\u636e\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u540e\u7684\u77e9\u9635x_train # token_indice\u7684\u4fdd\u5b58\u8def\u5f84 ti_path = \"./movie/token_indice\" \u8f93\u51fa\u6548\u679c: # token_indice 2-gram\u7279\u5f81\u5bf9\u5e94\u7684\u6570\u503c {(28, 1329): 143282, (413, 841): 143283, (8731, 6757): 143284, (4975, 68): 143285, (581, 9339): 143286, (744, 1819): 143287, (16, 1368): 143288, (17661, 4177): 143289, (20, 76): 143290, (495, 418): 143291, ...} # new_max_features \u65b0\u7684\u6700\u5927\u7279\u5f81\u6570 143307 \u51fd\u6570add_ngram(sequences, token_indice, ngram_range=2): \u8f93\u5165\u5b9e\u4f8b: # \u6570\u636e\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u540e\u7684\u77e9\u9635x_train, \u4e5f\u5c31\u662f\u8f93\u5165sequences # \u7531\u51fd\u6570get_ti_and_nmf\u5f97\u5230\u7684token_indice \u8f93\u51fa\u6548\u679c: # \u6dfb\u52a0\u4e86n-gram\u7279\u5f81\u7684\u77e9\u9635x_train [list([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1296, 1086, 9, 2510, 2325, 1004, 668, 2990, 669, 482, 669, 335, 126063, 46370, 36768, 93632, 116281, 46593, 136403, 29955, 34254, 127711, 47353, 132158]) list([0, 0, 0, 0, 11, 4, 8280, 26, 2511, 2991, 528, 22, 411, 702, 11, 350, 8281, 604, 85, 1501, 468, 52, 11, 56, 3255, 104815, 38229, 35505, 67872, 28659, 50795, 140653, 113341, 65967, 78902, 57072, 108083, 29205, 115079, 61698, 48928, 42416, 46802, 110530, 99281, 40828]) ... ] \u4e3b\u8981\u6ce8\u91ca: # \u6839\u636e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570\u9009\u62e9\u6700\u5927\u7279\u5f81\u6570\uff0c\u5e94\u5927\u4e8e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570 # n-gram\u7279\u5f81\u7684\u8303\u56f4\uff0c\u4e00\u822c\u9009\u62e9\u4e3a2 \"\"\" \u4ece\u5217\u8868\u4e2d\u63d0\u53d6n-gram\u7279\u5f81 >>> create_ngram_set([1, 4, 9, 4, 1, 4], ngram_value=2) {(4, 9), (4, 1), (1, 4), (9, 4)} \"\"\" \"\"\"\u4ece\u8bad\u7ec3\u6570\u636e\u4e2d\u83b7\u5f97token_indice\u548c\u65b0\u7684max_features\"\"\" # >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} # \u521b\u5efa\u4e00\u4e2a\u76db\u88c5n-gram\u7279\u5f81\u7684\u96c6\u5408. # \u904d\u5386\u6bcf\u4e00\u4e2a\u6570\u503c\u6620\u5c04\u540e\u7684\u5217\u8868 # \u904d\u5386\u53ef\u80fd\u5b58\u57282-gram, 3-gram\u7b49 # \u83b7\u5f97\u5bf9\u5e94\u7684n-gram\u8868\u793a # \u66f4\u65b0n-gram\u96c6\u5408 # \u53bb\u9664\u6389(0, 0)\u8fd9\u4e2a2-gram\u7279\u5f81 # \u5c06n-gram\u7279\u5f81\u6620\u5c04\u6210\u6574\u6570. # \u4e3a\u4e86\u907f\u514d\u548c\u4e4b\u524d\u7684\u8bcd\u6c47\u7279\u5f81\u51b2\u7a81\uff0cn-gram\u4ea7\u751f\u7684\u7279\u5f81\u5c06\u4ecemax_features+1\u5f00\u59cb # \u5f97\u5230\u5bf9n-gram\u8868\u793a\u4e0e\u5bf9\u5e94\u7279\u5f81\u503c\u7684\u5b57\u5178 # \u5c06token_indice\u5199\u5165\u6587\u4ef6\u4ee5\u4fbf\u9884\u6d4b\u65f6\u4f7f\u7528 # token_indice\u7684\u53cd\u8f6c\u5b57\u5178\uff0c\u4e3a\u4e86\u6c42\u89e3\u65b0\u7684\u6700\u5927\u7279\u5f81\u6570 # \u83b7\u5f97\u52a0\u5165n-gram\u4e4b\u540e\u7684\u6700\u5927\u7279\u5f81\u6570 \"\"\" \u5c06n-gram\u7279\u5f81\u52a0\u5165\u5230\u8bad\u7ec3\u6570\u636e\u4e2d \u5982: adding bi-gram >>> sequences = [[1, 3, 4, 5], [1, 3, 7, 9, 2]] >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} >>> add_ngram(sequences, token_indice, ngram_range=2) [[1, 3, 4, 5, 1337, 2017], [1, 3, 7, 9, 2, 1337, 42]] \"\"\" # \u904d\u5386\u5e8f\u5217\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3ainput_list, \u5373\u4ee3\u8868\u4e00\u4e2a\u53e5\u5b50\u7684\u5217\u8868 # copy\u4e00\u4e2anew_list # \u904d\u5386n-gram\u7684value\uff0c\u81f3\u5c11\u4ece2\u5f00\u59cb # \u904d\u5386\u5404\u4e2a\u53ef\u80fd\u7684n-gram\u957f\u5ea6 # \u83b7\u5f97input_list\u4e2d\u7684n-gram\u8868\u793a # \u5982\u679c\u5728token_indice\u4e2d\uff0c\u5219\u8ffd\u52a0\u76f8\u5e94\u7684\u6570\u503c\u7279\u5f81 \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: def align(x_train): \"\"\"\u7528\u4e8e\u5411\u91cf\u6309\u7167\u6700\u957f\u957f\u5ea6\u8fdb\u884c\u8865\u9f50\"\"\" # \u83b7\u5f97\u6240\u6709\u53e5\u5b50\u957f\u5ea6\u7684\u6700\u5927\u503c maxlen = max(list(map(lambda x: len(x), x_train))) # \u8c03\u7528padding\u51fd\u6570 x_train = padding(x_train, maxlen) return x_train, maxlen \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u7531\u51fd\u6570add_ngram\u8f93\u51fa\u7684\u77e9\u9635x_train \u8f93\u51fa\u6548\u679c: # \u8fdb\u884c\u4e86\u6700\u5927\u957f\u5ea6\u8865\u9f50\u7684\u77e9\u9635x_train [[ 0 0 0 ... 113541 36959 22941] [ 0 0 1682 ... 42518 59855 25524] [ 0 0 0 ... 75385 50810 68725] ... [ 0 0 0 ... 97401 34490 77114] [ 0 0 0 ... 21440 85555 32122] [ 0 0 0 ... 56394 95696 45331]] # \u8865\u9f50\u7684\u6700\u5927\u957f\u5ea6 119 \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u7528\u4e8e\u5411\u91cf\u6309\u7167\u6700\u957f\u957f\u5ea6\u8fdb\u884c\u8865\u9f50\"\"\" # \u83b7\u5f97\u6240\u6709\u53e5\u5b50\u957f\u5ea6\u7684\u6700\u5927\u503c # \u8c03\u7528padding\u51fd\u6570 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u7279\u5f81\u5904\u7406\u8fc7\u7a0b,\u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b, \u521b\u5efastar_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6, \u5e76\u6839\u636e\u6570\u636e\u5206\u6790\u7684\u7ed3\u679c\u5199\u51fa\u5b83\u4eec\u7684\u7279\u5f81\u5904\u7406\u6d41\u7a0b. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57. \u51fd\u6570: word_map \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad\u8865\u9f50: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\u8865\u9f50\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408. \u51fd\u6570: padding \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054. \u51fd\u6570: create_ngram_set \u51fd\u6570: get_ti_and_nmf \u51fd\u6570: add_ngram \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165. \u51fd\u6570: align 3.4 \u6784\u5efa\u6a21\u578b\u7ed3\u6784 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1fasttext\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42\u5e76\u4f7f\u7528\u5b83\u4eec\u6784\u5efa\u6a21\u578b. fasttext\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6700\u5927\u7279\u5f81\u6570(new_max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a. \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u90fd\u662f\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fnew_max_features x embedding_dims. \u8f93\u5165\u53c2\u6570: new_max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6. \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb. GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784. \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408. Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid. \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570. \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570. \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c. \u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b\u7684\u4ee3\u7801\u5206\u6790: # \u9996\u5148\u5bfc\u5165keras\u6784\u5efa\u6a21\u578b\u7684\u5fc5\u5907\u5de5\u5177\u5305 from keras.models import Sequential from keras.layers import Dense from keras.layers import Embedding from keras.layers import GlobalAveragePooling1D # \u5b9a\u4e49\u8bcd\u5d4c\u5165\u7ef4\u5ea6\u4e3a50 embedding_dims = 50 def model_build(maxlen, new_max_features): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u6a21\u578b\u7ed3\u6784\u6784\u5efa\"\"\" # \u5728\u51fd\u6570\u4e2d\uff0c\u9996\u5148\u521d\u59cb\u5316\u4e00\u4e2a\u5e8f\u5217\u6a21\u578b\u5bf9\u8c61 model = Sequential() # \u7136\u540e\u9996\u5c42\u4f7f\u7528Embedding\u5c42\u8fdb\u884c\u8bcd\u5411\u91cf\u6620\u5c04 model.add(Embedding(new_max_features, embedding_dims, input_length=maxlen)) # \u7136\u540e\u7528\u6784\u5efa\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42\uff0c\u51cf\u5c11\u6a21\u578b\u53c2\u6570\uff0c\u9632\u6b62\u8fc7\u62df\u5408 model.add(GlobalAveragePooling1D()) # \u6700\u540e\u6784\u5efa\u5168\u8fde\u63a5\u5c42 + sigmoid\u5c42\u6765\u8fdb\u884c\u5206\u7c7b. model.add(Dense(1, activation='sigmoid')) return model \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u6700\u5927\u5bf9\u9f50\u957f\u5ea6, \u5373\u8f93\u5165\u77e9\u9635\u4e2d\u6bcf\u6761\u5411\u91cf\u7684\u957f\u5ea6 maxlen = 119 # \u6700\u5927\u7279\u5f81\u6570, \u5373\u8f93\u5165\u77e9\u9635\u4e2d\u5143\u7d20\u7684\u6700\u5927\u503c new_max_features = 143307 # \u8bcd\u5d4c\u5165\u7684\u6570\u91cf, \u4f7f\u752850\u7ef4 embedding_dims = 50 \u8f93\u51fa\u6548\u679c: # keras sequential\u7684model\u5bf9\u8c61: <keras.engine.sequential.Sequential object at 0x7f67cc2bf208> \u4e3b\u8981\u6ce8\u91ca: # \u9996\u5148\u5bfc\u5165keras\u6784\u5efa\u6a21\u578b\u7684\u5fc5\u5907\u5de5\u5177\u5305 # \u5b9a\u4e49\u8bcd\u5d4c\u5165\u7ef4\u5ea6\u4e3a50 \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u6a21\u578b\u7ed3\u6784\u6784\u5efa\"\"\" # \u5728\u51fd\u6570\u4e2d\uff0c\u9996\u5148\u521d\u59cb\u5316\u4e00\u4e2a\u5e8f\u5217\u6a21\u578b\u5bf9\u8c61 # \u7136\u540e\u9996\u5c42\u4f7f\u7528Embedding\u5c42\u8fdb\u884c\u8bcd\u5411\u91cf\u6620\u5c04 # \u7136\u540e\u7528\u6784\u5efa\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42\uff0c\u51cf\u5c11\u6a21\u578b\u53c2\u6570\uff0c\u9632\u6b62\u8fc7\u62df\u5408 # \u6700\u540e\u6784\u5efa\u5168\u8fde\u63a5\u5c42 + sigmoid\u5c42\u6765\u8fdb\u884c\u5206\u7c7b. \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u6a21\u578b\u6784\u5efa\u8fc7\u7a0b,\u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u6a21\u578b\u7ed3\u6784\u6784\u5efa\u51fd\u6570. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86fasttext\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 \u5b66\u4e60\u4e86Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6700\u5927\u7279\u5f81\u6570(new_max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a. \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u90fd\u662f\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fnew_max_features x embedding_dims. \u8f93\u5165\u53c2\u6570: new_max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6. \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb. \u5b66\u4e60\u4e86GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784. \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408. \u5b66\u4e60\u4e86Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid. \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570. \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570. \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b. \u51fd\u6570: model_build 3.5 \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5\u53ca\u5176\u5b9e\u73b0. fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f. \u5f62\u5f0f\uff1a \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61.\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5. \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282. \u5b9e\u73b0\u5728\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: def model_compile(model): \"\"\"\u7528\u4e8e\u9009\u53d6\u6a21\u578b\u7684\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\"\"\" # \u4f7f\u7528model\u81ea\u5e26\u7684compile\u65b9\u6cd5\uff0c\u9009\u62e9\u9884\u5b9a\u4e49\u597d\u7684\u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570\uff0cAdam\u4f18\u5316\u65b9\u6cd5\uff0c\u4ee5\u53ca\u51c6\u786e\u7387\u8bc4\u4f30\u6307\u6807. model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy']) return model \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u7531model_build\u83b7\u5f97\u7684keras sequential\u7684model\u5bf9\u8c61 <keras.engine.sequential.Sequential object at 0x7f67cc2bf208> \u8f93\u51fa\u6548\u679c: # \u52a0\u5165\u4e86\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684keras sequential\u7684model\u5bf9\u8c61 <keras.engine.sequential.Sequential object at 0x7f3f09baf1d0> \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u7528\u4e8e\u9009\u53d6\u6a21\u578b\u7684\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\"\"\" # \u4f7f\u7528model\u81ea\u5e26\u7684compile\u65b9\u6cd5\uff0c\u9009\u62e9\u9884\u5b9a\u4e49\u597d\u7684\u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570\uff0cAdam\u4f18\u5316\u65b9\u6cd5\uff0c\u4ee5\u53ca\u51c6\u786e\u7387\u8bc4\u4f30\u6307\u6807. \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684\u8fc7\u7a0b, \u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684\u51fd\u6570. \u5c0f\u8282\u603b\u7ed3: fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f. \u5f62\u5f0f: \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61.\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5. \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5728\u6a21\u578b\u4e2d\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5. \u51fd\u6570: model_compile 3.6 \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b. \u5b66\u4e60\u5982\u4f55\u6839\u636e\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\u53ca\u5176\u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408. \u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u4f5c\u56fe\u5de5\u5177\u5305matplotlib import matplotlib.pyplot as plt # batch_size\u662f\u6bcf\u6b21\u8fdb\u884c\u53c2\u6570\u66f4\u65b0\u7684\u6837\u672c\u6570\u91cf batch_size = 32 # epochs\u5c06\u5168\u90e8\u6570\u636e\u904d\u5386\u8bad\u7ec3\u7684\u6b21\u6570 epochs = 40 def model_fit(model, x_train, y_train): \"\"\"\u7528\u4e8e\u6a21\u578b\u8bad\u7ec3\"\"\" history = model.fit(x_train, y_train, batch_size=batch_size, epochs=epochs, # validation_split\u8868\u793a\u5c06\u5168\u90e8\u8bad\u7ec3\u6570\u636e\u7684\u591a\u5c11\u5212\u5206\u4e3a\u9a8c\u8bc1\u96c6. validation_split=0.1) return history def plot_loss_acc(history, acc_png_path, loss_png_path): \"\"\"\u7528\u4e8e\u7ed8\u5236\u6a21\u578b\u7684\u635f\u5931\u548cacc\u5bf9\u7167\u66f2\u7ebf, \u4ee5\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u4e3a\u53c2\u6570\"\"\" # \u9996\u5148\u83b7\u5f97\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u5b57\u5178\uff0c # \u5f62\u5982{'val_loss': [0.8132099324259264, ..., 0.8765081824927494], # 'val_acc': [0.029094827586206896,...,0.13038793103448276], # 'loss': [0.6650978644232184,..., 0.5267722122513928], # 'acc': [0.5803400383141762, ...,0.8469827586206896]} history_dict = history.history # \u53d6\u51fa\u9700\u8981\u7684\u7684\u5404\u4e2akey\u5bf9\u5e94\u7684value\uff0c\u51c6\u5907\u4f5c\u4e3a\u7eb5\u5750\u6807 acc = history_dict['acc'] val_acc = history_dict['val_acc'] loss = history_dict['loss'] val_loss = history_dict['val_loss'] # \u53d6epochs\u7684\u9012\u589e\u5217\u8868\u4f5c\u4e3a\u6a2a\u5750\u6807 epochs = range(1, len(acc) + 1) # \u7ed8\u5236\u8bad\u7ec3\u51c6\u786e\u7387\u7684\u70b9\u56fe plt.plot(epochs, acc, 'bo', label='Training acc') # \u7ed8\u5236\u9a8c\u8bc1\u51c6\u786e\u7387\u7684\u7ebf\u56fe plt.plot(epochs, val_acc, 'b', label='Validation acc') # \u589e\u52a0\u6807\u9898 plt.title('Training and validation accuracy') # \u589e\u52a0\u6a2a\u5750\u6807\u540d\u5b57 plt.xlabel('Epochs') # \u589e\u52a0\u7eb5\u5750\u6807\u540d\u5b57 plt.ylabel('Accuracy') # \u5c06\u4e0a\u9762\u7684\u56fe\u653e\u5728\u4e00\u5757\u753b\u677f\u4e2d plt.legend() # \u4fdd\u5b58\u56fe\u7247 plt.savefig(acc_png_path) # \u6e05\u7a7a\u9762\u677f plt.clf() # \u7ed8\u5236\u8bad\u7ec3\u635f\u5931\u7684\u70b9\u56fe plt.plot(epochs, loss, 'bo', label='Training loss') # \u7ed8\u5236\u9a8c\u8bc1\u635f\u5931\u7684\u7ebf\u56fe plt.plot(epochs, val_loss, 'b', label='Validation loss') # \u6dfb\u52a0\u6807\u9898 plt.title('Training and validation loss') # \u6dfb\u52a0\u6a2a\u5750\u6807\u540d\u5b57 plt.xlabel('Epochs') # \u6dfb\u52a0\u7eb5\u5750\u6807\u540d\u5b57 plt.ylabel('Loss') # \u628a\u4e24\u5f20\u56fe\u653e\u5728\u4e00\u8d77 plt.legend() # \u4fdd\u5b58\u56fe\u7247 plt.savefig(loss_png_path) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u51fd\u6570model_fit(model, x_train, y_train): \u8f93\u5165\u5b9e\u4f8b: # \u52a0\u5165\u4e86\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684keras sequential\u7684model\u5bf9\u8c61 <keras.engine.sequential.Sequential object at 0x7f3f09baf1d0> # \u7ecf\u8fc7\u7279\u5f81\u5904\u7406\u7684x_train\u4ee5\u53ca\u5bf9\u5e94y_train \u8f93\u51fa\u6548\u679c: # \u6a21\u578b\u8bad\u7ec3\u65e5\u5fd7 Epoch 3/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.4094 - acc: 0.7998 - val_loss: 0.9937 - val_acc: 0.1800 Epoch 4/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.3185 - acc: 0.8498 - val_loss: 0.8025 - val_acc: 0.3548 Epoch 5/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.2379 - acc: 0.9136 - val_loss: 0.7550 - val_acc: 0.4482 Epoch 6/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.1779 - acc: 0.9500 - val_loss: 0.6113 - val_acc: 0.5857 Epoch 7/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.1355 - acc: 0.9726 - val_loss: 0.5836 - val_acc: 0.6214 Epoch 8/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.1056 - acc: 0.9826 - val_loss: 0.4837 - val_acc: 0.6893 Epoch 9/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.0844 - acc: 0.9870 - val_loss: 0.5271 - val_acc: 0.6570 Epoch 10/40 4384/5299 [=======================>......] - ETA: 1s - loss: 0.0691 - acc: 0.991 # \u6a21\u578b\u8bad\u7ec3\u7684\u5386\u53f2\u5bf9\u8c61 <keras.callbacks.History object at 0x7f75135f55f8> \u51fd\u6570plot_loss_acc(history, acc_png_path, loss_png_path): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u8bad\u7ec3\u7684\u5386\u53f2\u5bf9\u8c61history # \u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5b58\u50a8\u8def\u5f84 acc_png_path = \"./movie/acc.png\" # \u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u5b58\u50a8\u8def\u5f84 loss_png_path = \"./movie/loss.png\" \u8f93\u51fa\u6548\u679c: # \u5728./movie/\u8def\u5f84\u4e0b\u4e24\u5f20\u56fe\u7247, acc.png\u548closs.png, \u5206\u522b\u662f\u8bad\u7ec3\u4e0e\u9a8c\u8bc1\u7684\u51c6\u786e\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf \u8bad\u7ec3\u4e0e\u9a8c\u8bc1\u7684\u635f\u5931\u5bf9\u7167\u66f2\u7ebf: \u901a\u8fc7\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u6a21\u578b\u662f\u5426\u6536\u655b\uff1a \u5f53\u53cc\u635f\u5931\u66f2\u7ebf\u90fd\u5728\u4e0b\u964d\u65f6,\u8bf4\u660e\u6a21\u578b\u6b63\u5728\u6536\u655b, \u5927\u90e8\u5206\u60c5\u51b5\u4e0b,\u6a21\u578b\u90fd\u4f1a\u6536\u655b. \u8bad\u7ec3\u4e0e\u9a8c\u8bc1\u7684\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf: \u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u5e73\u7f13\u6216\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61. \u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408: \u901a\u8fc7\u5bf9\u6bd4\u9a8c\u8bc1\u96c6\u4e0e\u8bad\u7ec3\u96c6\u51c6\u786e\u66f2\u7ebf\uff0c\u5728\u9a8c\u8bc1acc\u4e0d\u5728\u4e0a\u5347\u7684\u8f6e\u6570\u65f6\u505c\u6b62\u8bad\u7ec3. \u8fdb\u5165\u670d\u52a1\u5668\u4e2d\u4fee\u6539epochs\u7684\u503c\u4e3a10-20\u4e4b\u95f4\u6570\u503c, \u91cd\u65b0\u8bad\u7ec3\u5373\u53ef. \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u4f5c\u56fe\u5de5\u5177\u5305matplotlib # batch_size\u662f\u6bcf\u6b21\u8fdb\u884c\u53c2\u6570\u66f4\u65b0\u7684\u6837\u672c\u6570\u91cf # epochs\u5c06\u5168\u90e8\u6570\u636e\u904d\u5386\u8bad\u7ec3\u7684\u6b21\u6570 \"\"\"\u7528\u4e8e\u6a21\u578b\u8bad\u7ec3\"\"\" # validation_split\u8868\u793a\u5c06\u5168\u90e8\u8bad\u7ec3\u6570\u636e\u7684\u591a\u5c11\u5212\u5206\u4e3a\u9a8c\u8bc1\u96c6. \"\"\"\u7528\u4e8e\u7ed8\u5236\u6a21\u578b\u7684\u635f\u5931\u548cacc\u5bf9\u7167\u66f2\u7ebf, \u4ee5\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u4e3a\u53c2\u6570\"\"\" # \u9996\u5148\u83b7\u5f97\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u5b57\u5178\uff0c # \u5f62\u5982{'val_loss': [0.8132099324259264, ..., 0.8765081824927494], # 'val_acc': [0.029094827586206896,...,0.13038793103448276], # 'loss': [0.6650978644232184,..., 0.5267722122513928], # 'acc': [0.5803400383141762, ...,0.8469827586206896]} # \u53d6\u51fa\u9700\u8981\u7684\u7684\u5404\u4e2akey\u5bf9\u5e94\u7684value\uff0c\u51c6\u5907\u4f5c\u4e3a\u7eb5\u5750\u6807 # \u53d6epochs\u7684\u9012\u589e\u5217\u8868\u4f5c\u4e3a\u6a2a\u5750\u6807 # \u7ed8\u5236\u8bad\u7ec3\u51c6\u786e\u7387\u7684\u70b9\u56fe # \u7ed8\u5236\u9a8c\u8bc1\u51c6\u786e\u7387\u7684\u7ebf\u56fe # \u589e\u52a0\u6807\u9898 # \u589e\u52a0\u6a2a\u5750\u6807\u540d\u5b57 # \u589e\u52a0\u7eb5\u5750\u6807\u540d\u5b57 # \u5c06\u4e0a\u9762\u7684\u56fe\u653e\u5728\u4e00\u5757\u753b\u677f\u4e2d # \u4fdd\u5b58\u56fe\u7247 # \u6e05\u7a7a\u9762\u677f # \u7ed8\u5236\u8bad\u7ec3\u635f\u5931\u7684\u70b9\u56fe # \u7ed8\u5236\u9a8c\u8bc1\u635f\u5931\u7684\u7ebf\u56fe # \u6dfb\u52a0\u6807\u9898 # \u6dfb\u52a0\u6a2a\u5750\u6807\u540d\u5b57 # \u6dfb\u52a0\u7eb5\u5750\u6807\u540d\u5b57 # \u628a\u4e24\u5f20\u56fe\u653e\u5728\u4e00\u8d77 # \u4fdd\u5b58\u56fe\u7247 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u6a21\u578b\u8bad\u7ec3\u8fc7\u7a0b, \u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\u51fd\u6570, \u5e76\u8fdb\u884c\u8bad\u7ec3, \u5f97\u5230\u635f\u5931\u4ee5\u53ca\u51c6\u786e\u7387\u5bf9\u6bd4\u66f2\u7ebf. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u786e\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b. \u51fd\u6570: model_fit \u51fd\u6570: plot_loss_acc \u5b66\u4e60\u4e86\u901a\u8fc7\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u6a21\u578b\u662f\u5426\u6536\u655b: \u5f53\u53cc\u635f\u5931\u66f2\u7ebf\u90fd\u5728\u4e0b\u964d\u65f6,\u8bf4\u660e\u6a21\u578b\u6b63\u5728\u6536\u655b, \u5927\u90e8\u5206\u60c5\u51b5\u4e0b,\u6a21\u578b\u90fd\u4f1a\u6536\u655b. \u5b66\u4e60\u4e86\u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u5e73\u7f13\u6216\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61. \u5b66\u4e60\u4e86\u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408: \u901a\u8fc7\u5bf9\u6bd4\u9a8c\u8bc1\u96c6\u4e0e\u8bad\u7ec3\u96c6\u51c6\u786e\u66f2\u7ebf\uff0c\u5728\u9a8c\u8bc1acc\u4e0d\u5728\u4e0a\u5347\u7684\u8f6e\u6570\u65f6\u505c\u6b62\u8bad\u7ec3. 3.7 \u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684\u8fc7\u7a0b. \u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: from keras.models import load_model def model_save(save_path, model): \"\"\"\u6a21\u578b\u4fdd\u5b58\u51fd\u6570\"\"\" # \u4f7f\u7528model.save\u5bf9\u6a21\u578b\u8fdb\u884c\u4fdd\u5b58. model.save(save_path) return def model_load(save_path, sample): \"\"\"\u6a21\u578b\u52a0\u8f7d\u4e0e\u9884\u6d4b\u51fd\u6570\"\"\" # \u4f7f\u7528load_model\u65b9\u6cd5\u8fdb\u884c\u52a0\u8f7d model = load_model(save_path) # \u4f7f\u7528predict\u65b9\u6cd5\u8fdb\u884c\u9884\u6d4b result = model.predict(sample) return result \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u51fd\u6570model_save(save_path, model): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84 save_path = \"./movie/model.h5\" # \u8bad\u7ec3\u4e4b\u540e\u7684model\u5bf9\u8c61 \u8f93\u51fa\u6548\u679c: # \u5728./movie\u8def\u5f84\u4e0b, \u83b7\u5f97\u4e00\u4e2amodel.h5 \u51fd\u6570model_load(save_path, sample): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u4fdd\u5b58\u7684\u8def\u5f84 save_path = \"./movie/model.h5\" # \u4e00\u4e2a\u5b9e\u4f8b: \u8bad\u7ec3\u6570\u636e\u7684\u7b2c\u4e00\u6761 sample = np.array([x_train[0]]) \u8f93\u51fa\u6548\u679c: # \u4e00\u4e2a\u8bad\u7ec3\u5b9e\u4f8b\u7684\u9884\u6d4b\u7ed3\u679c [[0.9996284]] \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u6a21\u578b\u4fdd\u5b58\u51fd\u6570\"\"\" # \u4f7f\u7528model.save\u5bf9\u6a21\u578b\u8fdb\u884c\u4fdd\u5b58. \"\"\"\u6a21\u578b\u52a0\u8f7d\u4e0e\u9884\u6d4b\u51fd\u6570\"\"\" # \u4f7f\u7528load_model\u65b9\u6cd5\u8fdb\u884c\u52a0\u8f7d # \u4f7f\u7528predict\u65b9\u6cd5\u8fdb\u884c\u9884\u6d4b \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u8fc7\u7a0b, \u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u6a21\u578b\u4fdd\u5b58 \u4e0e\u52a0\u8f7d\u51fd\u6570, \u5f97\u5230\u5bf9\u5e94\u7684h5\u6a21\u578b. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4f1a\u4e86\u5b9e\u73b0\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684\u8fc7\u7a0b. \u51fd\u6570: model_save \u51fd\u6570: model_load \u672c\u7ae0\u603b\u7ed3 \u7b2c1\u5c0f\u8282: \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599 \u5b66\u4e60\u4e86\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90. \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c. \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0. \u5b66\u4e60\u4e86\u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u7b2c2\u5c0f\u8282: \u8fdb\u884c\u6570\u636e\u5206\u6790 \u5b66\u4e60\u4e86\u6570\u636e\u5206\u6790\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u7b2c\u4e09\u6b65: \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u7b2c\u56db\u6b65: \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790\u4f5c\u6570\u636e\u51c6\u5907. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_features\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf. \u7b2c3\u5c0f\u8282: \u7279\u5f81\u5904\u7406 \u5b66\u4e60\u4e86\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u4e2d\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165. \u7b2c4\u5c0f\u8282: \u6784\u5efa\u6a21\u578b\u7ed3\u6784 \u5b66\u4e60\u4e86\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 \u5b66\u4e60\u4e86Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6709\u6548\u8bcd\u6c47\u603b\u6570(max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a. \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u4e00\u822c\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fmax_features x embedding_dims. \u8f93\u5165\u53c2\u6570: max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6. \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb. \u5b66\u4e60\u4e86GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784. \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408. \u5b66\u4e60\u4e86Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid. \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570. \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570. \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b. \u7b2c5\u5c0f\u8282: \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5 fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f. \u5f62\u5f0f: \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61.\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5. \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5728\u6a21\u578b\u4e2d\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5. \u7b2c6\u5c0f\u8282: \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b. \u5b66\u4e60\u4e86\u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61.","title":"\u7b2c\u4e09\u7ae0:\u7279\u5f81\u5de5\u7a0b\u4e0efasttext\u6a21\u578b\u8bad\u7ec3"},{"location":"3/#_1","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5982\u4f55\u8fdb\u884cfasttext\u6a21\u578b\u7684\u7279\u5f81\u5de5\u7a0b\u4ee5\u53ca\u8bad\u7ec3\u8fc7\u7a0b, \u5e76\u5b9e\u73b0\u5b83\u4eec. \u5f15\u5bfc\u5206\u6790: \u8fdb\u884c\u51e0\u4e4e\u662f\u6807\u51c6\u5316\u6a21\u578b\u8bad\u7ec3\u6d41\u7a0b. fasttext\u6a21\u578b\uff0c\u7ad9\u5728\u591a\u6a21\u578b\u8bad\u7ec3\u4e0e\u9884\u6d4b\u7684\u6548\u7387\u89d2\u5ea6\u4e0a\uff0c\u4f7f\u7ed3\u6784\u8bbe\u8ba1\u975e\u5e38\u7b80\u5355\uff0c\u4ee5\u81f3\u4e8e\u53ef\u80fd\u65e0\u6cd5\u6709\u6548\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u7cfb\uff0c\u56e0\u6b64\u52a0\u5165n-gram\u7279\u5f81\u8fdb\u884c\u4e86\u8865\u5145. \u8fdb\u884cfasttext\u6a21\u578b\u7684\u7279\u5f81\u5de5\u7a0b\u4ee5\u53ca\u8bad\u7ec3\u8fc7\u7a0b\u7684\u4e03\u6b65\u8bd7: \u672c\u7ae0\u5c0f\u8282: 3.1 \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599 \u5b66\u4e60\u5982\u4f55\u4ece\u539f\u59cb\u8bed\u6599\u751f\u6210\u8bad\u7ec3\u8bed\u6599. 3.2 \u8fdb\u884c\u6570\u636e\u5206\u6790 \u5b66\u4e60\u4f7f\u7528\u8bad\u7ec3\u8bed\u6599\u8fdb\u884c\u4e00\u4e9b\u7edf\u8ba1\u5206\u6790\u5de5\u4f5c. 3.3 \u7279\u5f81\u5904\u7406 \u5b66\u4e60\u5c06n-gram\u4f5c\u4e3a\u7279\u5f81\u52a0\u5165\u5230\u521d\u59cb\u7279\u5f81\u4e2d. 3.4 \u6784\u5efa\u6a21\u578b\u7ed3\u6784 \u5b66\u4e60fasttext\u7684\u6a21\u578b\u7684\u7ec4\u6210\u53ca\u5176\u5404\u4e2a\u5c42\u7684\u4f5c\u7528. 3.5 \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5 \u5b66\u4e60\u6a21\u578b\u9009\u62e9\u7684\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684\u6570\u5b66\u539f\u7406\u548c\u4f18\u7f3a\u70b9. 3.6 \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3 \u5b66\u4e60\u6a21\u578b\u5728\u8bad\u7ec3\u8bed\u6599\u4e0a\u7684\u8bad\u7ec3\u8fc7\u7a0b. 3.7 \u6a21\u578b\u7684\u4fdd\u5b58\u4e0e\u52a0\u8f7d \u5b66\u4e60\u8bad\u7ec3\u4e4b\u540e\u7684\u6a21\u578b\u5982\u4f55\u8fdb\u884c\u4fdd\u5b58\u4e0e\u52a0\u8f7d.","title":"\u672c\u7ae0\u5bfc\u5b66"},{"location":"3/#31","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2. \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90. \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c. \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0. \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c. \u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import os # \u9650\u5236\u53e5\u5b50\u7684\u6700\u5c0f\u5b57\u7b26\u6570\u548c\u53e5\u5b50\u7684\u6700\u5927\u5b57\u7b26\u6570 MIN_LENGTH = 5 MAX_LENGTH = 500 def get_p_text_list(single_article_path): \"\"\"\u83b7\u53d6\u5355\u7bc7\u6587\u7ae0\u7684\u6587\u672c\u5217\u8868\"\"\" with open(single_article_path, \"r\") as f: text = f.read() # \u53bb\u6389\u6362\u884c\u7b26, \u5e76\u4ee5\u53e5\u53f7\u5212\u5206 cl = text.replace(\"\\n\", \".\").split(\"\u3002\") # \u8fc7\u6ee4\u6389\u957f\u5ea6\u8303\u56f4\u4e4b\u5916\u7684\u53e5\u5b50 cl = list(filter(lambda x: MIN_LENGTH<len(x)<MAX_LENGTH, cl)) return cl def get_p_sample(a_path, p_path): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u6b63\u6837\u672c\u7684csv, \u4ee5\u6587\u7ae0\u8def\u5f84\u548c\u6b63\u6837\u672ccsv\u5199\u5165\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" if not os.path.exists(a_path): return if not os.path.exists(p_path): os.mkdir(p_path) # \u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u6253\u5f00\u9884\u5199\u5165\u6b63\u6837\u672c\u7684csv fp = open(os.path.join(p_path, \"p_sample.csv\"), \"a\") # \u904d\u5386\u6587\u7ae0\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e00\u7bc7\u6587\u7ae0 for u in os.listdir(a_path): cl = get_p_text_list(os.path.join(a_path, u)) for clc in cl: fp.write(\"1\" + \"\\t\" + clc + \"\\n\") fp.close() def get_sample(p_path, n_path_csv_list: list): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u53d6\u6837\u672c\u96c6\u5305\u62ec\u6b63\u8d1f\u6837\u672c, \u4ee5\u6b63\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u548c\u8d1f\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u5217\u8868\u4e3a\u53c2\u6570\"\"\" fp = open(os.path.join(p_path, \"sample.csv\"), \"w\") with open(os.path.join(p_path, \"p_sample.csv\"), \"r\") as f: text = f.read() # \u5148\u5c06\u6b63\u6837\u672c\u5199\u5165\u6837\u672ccsv\u4e4b\u4e2d fp.write(text) # \u904d\u5386\u8d1f\u6837\u672c\u7684csv\u5217\u8868 for n_p_c in n_path_csv_list: with open(n_p_c, \"r\") as f: # \u5c06\u5176\u4e2d\u7684\u6807\u7b7e1\u6539\u5199\u4e3a0 text = f.read().replace(\"1\", \"0\") # \u7136\u540e\u5199\u5165\u6837\u672c\u7684csv\u4e4b\u4e2d fp.write(text) fp.close() \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/get_sample.py\u4e2d\u3002 \u51fd\u6570: get_p_text_list(single_article_path) \u8f93\u5165\u5b9e\u4f8b: # \u539f\u59cb\u8bed\u6599\u5728\u4e0a\u4e00\u4e2a\u76ee\u5f55\u7684create_graph\u76ee\u5f55\u4e0b single_article_path = \"../create_graph/beauty/article-191721\" \u8f93\u51fa\u6548\u679c: ['\u5361\u59ff\u5170\u643a\u624b\u5168\u65b0\u54c1\u724c\u4ee3\u8a00\u4eba\u5a01\u795eV\u4e09\u5b50\u9ec4\u65ed\u7199\u3001\u94b1\u951f\u3001\u5218\u626c\u626c\uff0c\u5f15\u7206\u4e1d\u7ed2\u7ea2\u5507\u8bf1\u60d1\u9b45\u529b2019\u5e747\u670823\u65e5\uff0c\u65f6\u5c1a\u5f69\u5986\u9886\u5bfc\u54c1\u724c\u5361\u59ff\u5170\uff08Carslan\uff09\u6b63\u5f0f\u5b98\u5ba3\uff0c\u6765\u81ea\u65b0\u664b\u4eba\u6c14\u7537\u56e2\u5a01\u795eV\uff08WayV\uff09\u7684\u4e09\u4f4d\u6210\u5458\u9ec4\u65ed\u7199LUCAS\u3001\u94b1\u951fKUN\u3001\u5218\u626c\u626cYANGYANG\u6210\u4e3a\u5168\u65b0\u54c1\u724c\u4ee3\u8a00\u4eba', '\u4e09\u4f4d\u517c\u5177\u5e05\u6c14\u5916\u8868\u7684\u5b9e\u529b\u6d3e\u5076\u50cf\u81ea\u51fa\u9053\u4ee5\u6765\uff0c\u4fbf\u4ee5\u5404\u81ea\u72ec\u7279\u7684\u97f3\u4e50\u4e2a\u6027\u548c\u6c14\u8d28\u9b45\u529b\u5f81\u670d\u4e86\u4e00\u4f17\u7c89\u4e1d', '\u540c\u4e3a\u5e74\u8f7b\u5b9e\u529b\u6d3e\uff0c\u6b64\u6b21\u5361\u59ff\u5170\u643a\u624b\u4e09\u4eba\uff0c\u4ee5\u4e1d\u7ed2\u5507\u818f\u7684\u6781\u81f4\u9b45\u529b\u5f15\u7206\u65f6\u5c1a\u70ed\u70b9', '\u5361\u59ff\u5170\u6b63\u5f0f\u5b98\u5ba3\u5168\u65b0\u54c1\u724c\u4ee3\u8a00\u4eba\u94b1\u951fKUN\u3001\u9ec4\u65ed\u7199LUCAS\u3001\u5218\u626c\u626cYANGYANG \u65e0\u754f\u5e74\u8f7b\u5b9e\u529b\u6d3e\uff0c\u6781\u81f4\u6f14\u7ece\u4e1d\u7ed2\u9b45\u529b\u51fa\u9053\u4e0d\u6ee1\u4e00\u5e74\u5374\u5907\u53d7\u5173\u6ce8\u7684\u4e2d\u56fd\u7537\u56e2\u5a01\u795eV\uff0c\u4ee5\u72ec\u7279\u7684\u97f3\u4e50\u624d\u80fd\u548c\u8d85\u5f3a\u7684\u827a\u80fd\u611f\u4e3a\u4e2d\u56fd\u4e50\u575b\u6ce8\u5165\u4e86\u65b0\u9c9c\u8840\u6db2', '\u6210\u5458\u9ec4\u65ed\u7199LUCAS\u3001\u94b1\u951fKUN\u3001\u5218\u626c\u626cYANGYANG\u66f4\u4ee5\u4e0d\u4fd7\u7684\u821e\u8e48\u5b9e\u529b\u4e0e\u6781\u5177\u7279\u8272\u7684\u97f3\u4e50\u6f14\u7ece\u6280\u5de7\uff0c\u5728\u821e\u53f0\u4e0a\u5f70\u663e\u51fa\u6781\u5f3a\u7684\u4e2a\u4eba\u6c14\u573a', '\u6c14\u8d28\u7f8e\u5c11\u5e74\u9ec4\u65ed\u7199LUCAS\u51ed\u501f\u7740\u7cbe\u81f4\u4e94\u5b98\u548c\u5b8c\u7f8e\u8eab\u6750\uff0c\u6210\u4e3a\u5907\u53d7\u7c89\u4e1d\u8ffd\u6367\u7684\u201c\u6495\u6f2b\u7537\u201d\uff1b\u5a01\u795eV\u961f\u957f\u94b1\u951fKUN\u6709\u7740\u6e29\u67d4\u58f0\u7ebf\uff0c\u5c3d\u663e\u9633\u5149\u6696\u7537\u7684\u6210\u719f\u6c14\u8d28\uff1b\u5e74\u7eaa\u6700\u5c0f\u7684\u5218\u626c\u626cYANGYANG\u53ef\u8c13\u7ec4\u5408\u5f53\u4e2d\u7684\u9b3c\u9a6c\u7cbe\u7075\uff0c\u8eab\u4e3a\u5fb7\u56fd\u534e\u88d4\u7684\u4ed6\u6781\u5bcc\u8bed\u8a00\u5929\u8d4b', ' \u5728\u5168\u65b0\u5e7f\u544a\u7247\u4e2d\uff0c\u4e09\u4f4d\u7537\u795e\u7275\u624b\u5361\u59ff\u5170\u6c14\u573a\u5168\u5f00\uff0c\u6f14\u7ece\u51fa\u9ad8\u7ea7\u4e1d\u7ed2\u65f6\u4ee3\u7684\u8bf1\u60d1\u9b45\u529b', '\u5728\u6b64\u7cfb\u5217\u4e2d\uff0c\u9ec4\u65ed\u7199LUCAS\u4ee3\u8a00\u7684\u5361\u59ff\u5170\u4e1d\u7ed210\u53f7\u8272\u6597\u58eb\u5507\u818f\uff0c\u4ee5\u590d\u53e4\u6df1\u7ea2\u663e\u8272\u800c\u4e0d\u6311\u80a4\u7684\u767e\u642d\u7279\u70b9\uff0c\u8f7b\u677e\u9a7e\u9a6d\u5404\u5927\u573a\u9762\uff0c\u4e3a\u65b0\u65f6\u4ee3\u5973\u6027\u6c14\u573a\u9738\u6c14\u52a0\u6301'] \u51fd\u6570: get_p_sample(a_path, p_path) \u8f93\u5165\u5b9e\u4f8b: # \u539f\u59cb\u8bed\u6599\u5728\u4e0a\u4e00\u4e2a\u76ee\u5f55\u7684create_graph\u76ee\u5f55\u4e0b a_path = \"../create_graph/beauty/\" p_path = \"./beauty\" \u8f93\u51fa\u6548\u679c: # \u83b7\u5f97\u4e00\u4e2ap_sample.csv\u6587\u4ef6, \u91cc\u9762\u7684\u5185\u5bb9\u5f62\u5982: 1 \u8fd9\u4e00\u6b21\u7684\u300a\u6d41\u661f\u82b1\u56ed\u300b\u4e3b\u9898\u4f53\u9a8c\u9986\u5982\u68a6\u5982\u5e7b\uff0c\u6fc0\u8361\u8d77\u65e0\u6570\u5c11\u5973\u5fc3\uff0c\u90a3\u4e48\u690d\u7269\u533b\u751f\u4e0b\u4e00\u6b21\u5236\u9020\u7684\u60ca\u559c\u6211\u4eec\u7fd8\u9996\u4ee5\u76fc 1 \u7f8e\u5986\u798f\u5229\u65f6\u95f4\u53c8\u5230\u5566\uff01\u672c\u671f\u514d\u8d39\u8bd5\u7528\u4ea7\u54c1\uff1a\u83f2\u6d1b\u5609\u65b0\u808c\u8d4b\u6d3b\u4e73\u971c\u4ef7\u683c/\u89c4\u683c\uff1a739RMB/50ml\u8bd5\u7528\u603b\u91cf\uff1a10\u4efd\u622a\u81f3\u7533\u8bf7\u65e5\u671f\uff1a2018\u5e7412\u67084\u65e5\u8bd5\u7528\u62a5\u544a\u622a\u81f3\u65e5\u671f\uff1a2018\u5e741\u67084\u65e5\u83f2\u6d1b\u5609\u65b0\u808c\u8d4b\u6d3b\u4e73\u971c\uff0c\u5373\u65b0\u808c\u8d4b\u6d3b\u9762\u971c\u54d1\u5149\u578b\uff0c\u66f4\u9002\u5408\u4e2d\u6027\u53ca\u6df7\u5408\u80a4\u8d28 1 \u9ad8\u542b\u91cf*NCTF\u662f\u62b5\u5fa1\u808c\u80a4\u8001\u5316\u3001\u591a\u91cd\u8d4b\u6d3b\u7f8e\u808c\u7684\u7406\u60f3\u89e3\u51b3\u65b9\u6848 1 -\u76c8\u6da6\u629a\u7eb9\uff1a\u900f\u660e\u8d28\u9178\u7ed3\u5408\u591a\u80bd\uff0c\u4fc3\u8fdb\u900f\u660e\u8d28\u9178\u751f\u6210\uff0c\u5e73\u6ed1\u7eb9\u8def\uff0c\u5bc6\u96c6\u4e30\u76c8\u808c\u80a4\uff1b-\u7d27\u81f4\u9971\u6ee1\uff1a\u80f6\u539f\u86cb\u767d\u4fc3\u8fdb\u56e0\u5b50**\u52a0\u5f3a\u808c\u80a4\u7ea4\u7ef4\u652f\u6491\uff0c\u7ed3\u5408\u900f\u660e\u8d28\u9178\u7d27\u5b9e\u5f39\u97e7\u808c\u80a4\uff1b-\u7115\u4eae\u6c14\u8272\uff1a\u7ef4\u4ed6\u547dC\u8212\u7f13\u808c\u80a4\u5747\u5300\u80a4\u8272\uff1b\u7ef4\u4ed6\u547d\u590d\u5408\u7269A+H+E\u7ed3\u5408\u591a\u915a\u690d\u7269\u7cbe\u534e\uff0c\u5e73\u6ed1\u808c\u7406\uff0c\u7115\u53d1\u5149\u6cfd\uff0c\u5f3a\u5316\u808c\u80a4\u5c4f\u969c\uff0c\u63d0\u5347\u62b5\u5fa1\u529b\uff1b-\u6291\u5236\u6cb9\u5149\uff1a\u6a44\u6984\u679c\u9178+\u690d\u7269\u7cbe\u534e\u51cf\u5c11\u6cb9\u8102\u5206\u6ccc\u3001\u6536\u7f29\u6bdb\u5b54\uff0c\u6301\u4e45\u8425\u9020\u54d1\u5149\u65e0\u6cb9\u80a4\u8d28 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6309\u7167\u6b64\u65b9\u6cd5, \u5c06\u6211\u4eec\u5728\u76ee\u5f55/data/django-uwsgi/text_labeled/create_graph\u4e0b, \u7ed9\u51fa\u7684fashion, movie, star\u4e09\u4e2a\u539f\u59cb\u8bed\u6599\u6587\u4ef6, \u63d0\u53d6\u51fa\u5b83\u4eec\u6b63\u6837\u672c. \u6700\u7ec8\u5728\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\u751f\u6210p_sample.csv\u6587\u4ef6. \u51fd\u6570: get_sample(p_path, n_path_csv_list) \u8f93\u5165\u5b9e\u4f8b: p_path = \"./beauty\" n_path_csv_list = [\"./movie/p_sample.csv\", \"./star/p_sample.csv\", \"./fashion/p_sample.csv\"] \u8f93\u51fa\u6548\u679c: # \u67e5\u770b\u524d5\u6761\u7684\u6b63\u6837\u672c: 1 #PINKGANG#\uff1a\u4e0d\u7c89\u6240\u6709\u4eba\u7eaa\u68b5\u5e0c2018\u5168\u65b0\u7981\u5fcc\u4e4b\u543b\u6f06\u5149\u5507\u871c\u53d1\u5e03\u4f1a\u66a8\u6d3e\u5bf9 2018\u5e748\u670819\u65e5\uff0c\u6cd5\u56fd\u54c1\u724c\u7eaa\u68b5\u5e0c\u7279\u522b\u6253\u9020\u4e86\u4e00\u573a\u7cbe\u81f4\u9177\u70ab\u7684#PINKGANG#\u65f6\u5c1a\u6d3e\u5bf9\uff0c\u4e3a\u5e86\u795d\u7eaa\u68b5\u5e0c\u5168\u65b0\u7981\u5fcc\u4e4b\u543b\u6f06\u5149\u5507\u871c\uff08Gloss Interdit Vinyl\uff09\u7684\u95ea\u8000\u4e0a\u5e02 1 \u4e0a\u6d77\u9ec4\u6d66\u6c5f\u7554\u7684\u5fb7\u5fc5\u5916\u6ee98\u53f7\uff0c\u5728\u5386\u53f2\u60a0\u4e45\u7684\u6cd5\u5f0f\u53e4\u5178\u5efa\u7b51\u4e2d\uff0c\u7eaa\u68b5\u5e0c\u4e0e\u56fd\u5185\u5404\u5927\u65f6\u5c1a\u5a92\u4f53\u3001\u65f6\u5c1a\u7f8e\u5986\u9886\u57df\u7684\u8fbe\u4eba\u4ee5\u53ca\u65f6\u9ae6\u4eba\u58eb\u4e00\u8d77\u5206\u4eab\u5e76\u4f53\u9a8c\u54c1\u724c\u7684\u5168\u65b0\u4ea7\u54c1\uff0c\u611f\u53d7\u54c1\u724c\u65f6\u5c1a\u53db\u9006\u7684\u5962\u534e\u9b45\u529b 1 \u8d85\u4eba\u6c14\u9752\u6625\u5076\u50cf\u9648\u7acb\u519c\u4f5c\u4e3a\u54c1\u724c\u631a\u53cb\u51fa\u5e2d\u6d3b\u52a8\uff0c\u6f14\u5458\u80e1\u51b0\u537f\u3001\u9648\u7476\u3001\u674e\u5170\u8fea\u4ee3\u8868\u65b0\u65f6\u4ee3\u6f6e\u6d41\u6807\u6746\u53d7\u9080\u4e00\u540c\u4eae\u76f8\u6d3e\u5bf9\uff0c\u5171\u540c\u5206\u4eab\u7eaa\u68b5\u5e0c\u5168\u65b0\u5507\u871c\u7684\u70ab\u76ee\u53d1\u5e03 1 \u503c\u6b64\u4e4b\u9645\uff0c\u56f4\u7ed5\u7740\u201c#PINKGANG#\u4e0d\u7c89\u6240\u6709\u4eba\u201d\u7684\u4e3b\u9898\uff0c\u7eaa\u68b5\u5e0c\u4e3a\u6765\u5bbe\u8425\u9020\u51fa\u53db\u9006\u65f6\u9ae6\u3001\u4e0d\u53d7\u7ea6\u675f\u7684\u6d3e\u5bf9\u6c1b\u56f4\uff0c\u5145\u5206\u5c55\u793a\u4e86\u54c1\u724c\u4e00\u8d2f\u4ee5\u6765\u7a81\u7834\u7ecf\u5178\u3001\u4e2a\u6027\u524d\u536b\u7684\u6001\u5ea6 1 \u73b0\u573a\u7684\u5e03\u7f6e\u4ee5\u7981\u5fcc\u4e4b\u543b\u6f06\u5149\u5507\u871c\u7684\u8272\u5f69\u4e3a\u7075\u611f\uff0c\u5c06\u9713\u8679\u7c89\u8272\u4f5c\u4e3a\u573a\u9986\u7684\u4e3b\u8272\u8c03\uff0c\u7a81\u663e\u7eaa\u68b5\u5e0c\u5168\u65b0\u4ea7\u54c1\u795e\u79d8\u3001\u7981\u5fcc\u3001\u65f6\u5c1a\u7684\u98ce\u683c # \u67e5\u770b\u540e5\u6761\u7684\u8d1f\u6837\u672c\uff1a 0 \u5b83\u91c7\u7528\u76ae\u9769\u9970\u8fb9\u5851\u9020\u67d4\u8f6f\u4f11\u95f2\u6b3e\u5f0f\u7684\u8f6e\u5ed3\uff0c\u6fc0\u5149\u5207\u5272\u9876\u90e8 0 \u7ec9\u80f6\u978b\u5e95\u975e\u5e38\u8010\u7a7f 0 \u7cfb\u5e26\u7684\u6b3e\u5f0f\u4e5f\u5f88\u65f6\u9ae6\u54e6~\u76ae\u6bdb\u662f\u5929\u7136\u8fde\u6bdb\u5c0f\u7ef5\u7f8a\u76ae\uff0c\u6765\u81ea\u745e\u58eb 0 \u76ae\u9769\u91c7\u7528\u5c0f\u7ef5\u7f8a\u76ae\uff0c\u6750\u8d28\u975e\u5e38\u597d\uff0c\u6240\u4ee5\u7279\u522b\u4fdd\u6696\uff0c\u4ef7\u683c\u81ea\u7136\u4e5f\u4f1a\u8d35\u4e00\u4e9b 0 \u5927\u5bb6\u53ef\u53bbShopbop\u4e0a\u8d2d\u4e70\uff0c\u4ef7\u683c\u6bd4UGG\u8d35\u5f88\u591a\uff0c\u4f46\u662f\u8d28\u91cf\u4e5f\u597d~\u54c1\u724c\uff1aINUIKI \u5b98\u7f51\u94fe\u63a5\u6233\u8fd9\u2190\u5355\u54c1\u8d2d\u4e70\u94fe\u63a5\u6233\u8fd9\u2190\u6700\u540e\u4e00\u53e5\u54ce\u54df\u5582\uff0c\u8fd9\u53cc00\u521a\u7ed3\u675f\uff0c\u53c8\u8981\u5f00\u59cb\u5241\u624b\u4e70\u96ea\u5730\u9774\u4e86\uff01 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6309\u7167\u6b64\u65b9\u6cd5, \u5c06\u6211\u4eec\u5728\u76ee\u5f55/data/django-uwsgi/text_labeled/create_graph\u4e0b, \u7ed9\u51fa\u7684fashion, movie, star\u4e09\u4e2a\u539f\u59cb\u8bed\u6599\u6587\u4ef6, \u63d0\u53d6\u51fa\u5b83\u4eec\u6b63\u8d1f\u6837\u672c, \u6700\u7ec8\u5728\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\u751f\u6210sample.csv\u6587\u4ef6. \u4e3b\u8981\u6ce8\u91ca: # \u9650\u5236\u53e5\u5b50\u7684\u6700\u5c0f\u5b57\u7b26\u6570\u548c\u53e5\u5b50\u7684\u6700\u5927\u5b57\u7b26\u6570 \"\"\"\u83b7\u53d6\u5355\u7bc7\u6587\u7ae0\u7684\u6587\u672c\u5217\u8868\"\"\" # \u53bb\u6389\u6362\u884c\u7b26, \u5e76\u4ee5\u53e5\u53f7\u5212\u5206 # \u8fc7\u6ee4\u6389\u957f\u5ea6\u8303\u56f4\u4e4b\u5916\u7684\u53e5\u5b50 \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u6b63\u6837\u672c\u7684csv, \u4ee5\u6587\u7ae0\u8def\u5f84\u548c\u6b63\u6837\u672ccsv\u5199\u5165\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" # \u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u6253\u5f00\u9884\u5199\u5165\u6b63\u6837\u672c\u7684csv # \u904d\u5386\u6587\u7ae0\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e00\u7bc7\u6587\u7ae0 \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u53d6\u6837\u672c\u96c6\u5305\u62ec\u6b63\u8d1f\u6837\u672c, \u4ee5\u6b63\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u548c\u8d1f\u6837\u672ccsv\u6587\u4ef6\u8def\u5f84\u5217\u8868\u4e3a\u53c2\u6570\"\"\" # \u5148\u5c06\u6b63\u6837\u672c\u5199\u5165\u6837\u672ccsv\u4e4b\u4e2d # \u904d\u5386\u8d1f\u6837\u672c\u7684csv\u5217\u8868 # \u5c06\u5176\u4e2d\u7684\u6807\u7b7e1\u6539\u5199\u4e3a0 # \u7136\u540e\u5199\u5165\u6837\u672c\u7684csv\u4e4b\u4e2d \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90. \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c. \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0. \u5b66\u4e60\u4e86\u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599.","title":"3.1 \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599"},{"location":"3/#32","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u6587\u672c\u6570\u636e\u5fc5\u8981\u7684\u5206\u6790\u8fc7\u7a0b\u5e76\u7406\u89e3\u5b83\u4eec\u7684\u4f5c\u7528. \u6587\u672c\u6570\u636e\u5fc5\u8981\u7684\u5206\u6790\u8fc7\u7a0b: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790, \u5982\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03, \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03, \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u7b49\u4f5c\u6570\u636e\u51c6\u5907. \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u800c\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u5bf9\u6211\u4eec\u8fdb\u884c\u63a5\u4e0b\u6765\u7684\u6570\u636e\u5206\u6790\u548c\u5224\u65ad\u6a21\u578b\u51c6\u786e\u7387\u57fa\u7ebf\u8d77\u5230\u5173\u952e\u4f5c\u7528. \u4e3e\u4e2a\u6817\u5b50: \u5047\u5982\u6b63\u6837\u672c\u6570\u91cf\u4e3a8\u4e07\u6761, \u8d1f\u6837\u672c\u6570\u91cf\u4e3a2\u4e07\u6761, \u5982\u679c\u6211\u4eec\u4e0d\u505a\u4efb\u4f55\u6837\u672c\u8c03\u6574\u5de5\u4f5c, \u5c31\u5c06\u5176\u8f93\u9001\u7ed9\u6a21\u578b\u8bad\u7ec3, \u90a3\u4e48\u6a21\u578b\u5f88\u5feb\u5c31\u80fd\u627e\u5230\u4e00\u4e2a\u89c4\u5f8b, \u5c31\u662f\u4e0d\u5206\u9752\u7ea2\u7682\u767d\u7684\u90fd\u628a\u7ed3\u679c\u9884\u6d4b\u4e3a\u6b63\u6837\u672c, \u4e5f\u53ef\u4ee5\u5f97\u5230\u5dee\u4e0d\u591a80%\u7684\u51c6\u786e\u7387. \u8fd9\u5c31\u8bf4\u660e\u6211\u4eec\u6b64\u65f6\u6a21\u578b\u7684\u51c6\u786e\u7387\u57fa\u7ebf\u5c31\u662f80%, \u56e0\u6b64\u8fd9\u662f\u4e0d\u5408\u7406\u7684, \u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u5747\u8861\u6b63\u8d1f\u6837\u672c, \u4fdd\u8bc1\u6a21\u578b\u57fa\u7ebf\u572850%\u5de6\u53f3, \u8fd9\u6837\u5f97\u5230\u51c6\u786e\u738780%\u7684\u6a21\u578b\u624d\u7b97\u5f97\u4e0a\u6709\u610f\u4e49. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u5bf9\u9f50\u957f\u5ea6, \u800c\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6\u5c06\u6709\u6548\u7684\u907f\u514d\u7a00\u758f\u7279\u5f81\u6216\u5197\u4f59\u7279\u5f81\u7684\u4ea7\u751f, \u63d0\u5347\u8bad\u7ec3\u6548\u7387. \u4e3e\u4e2a\u6817\u5b50: \u5047\u5982\u6211\u4eec\u670910\u4e07\u6761\u6570\u636e, \u5176\u4e2d9.9\u4e07\u6761\u7684\u53e5\u5b50\u957f\u5ea6\u90fd\u5728100\u4e2a\u5b57\u7b26\u5185, \u53ea\u6709\u5269\u4e0b\u7684\u4e00\u5c0f\u90e8\u5206\u53e5\u5b50\u957f\u5ea6\u975e\u5e38\u957f, \u56e0\u4e3a\u6a21\u578b\u7684\u8f93\u5165\u9700\u8981\u662f\u77e9\u9635, \u4e5f\u5c31\u662f\u7b49\u957f\u5411\u91cf, \u56e0\u6b64\u6587\u672c\u9700\u8981\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50, \u800c\u5206\u6790\u5728\u4ec0\u4e48\u957f\u5ea6\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u5341\u5206\u91cd\u8981, \u5982\u679c\u6211\u4eec\u4ee5\u6700\u957f\u957f\u5ea6\u5bf9\u9f50\u7684\u8bdd, \u5c06\u67099.9\u4e07\u6761\u6570\u636e\u6269\u5145\u6ca1\u6709\u5fc5\u8981\u7684\u7279\u5f81\u957f\u5ea6, \u4e0d\u4ec5\u5360\u7528\u66f4\u591a\u7684\u5185\u5b58, \u5e76\u4e14\u5bfc\u81f4\u6a21\u578b\u53c2\u6570\u6fc0\u589e, \u6a21\u578b\u8bad\u7ec3\u6548\u7387\u4e0b\u964d. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03 \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_feature(\u6700\u5927\u7684\u7279\u5f81\u603b\u6570)\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf. \u89e3\u91ca: \u6a21\u578b\u8d85\u53c2\u6570max_feature\u7684\u9009\u5b9a\u5728NLP\u9886\u57df\u4e00\u822c\u662f\u5927\u4e8e\u6240\u6709\u8bed\u6599\u6d89\u53ca\u7684\u8bcd\u6c47\u603b\u6570\u7684, \u4f46\u662f\u53c8\u4e0d\u80fd\u9009\u62e9\u8fc7\u4e8e\u5927, \u5426\u5219\u4f1a\u5bfc\u81f4\u7f51\u7edc\u53c2\u6570\u6fc0\u589e, \u6a21\u578b\u8fc7\u4e8e\u590d\u6742\uff0c\u5bb9\u6613\u8fc7\u62df\u5408. \u56e0\u6b64\u9700\u8981\u53c2\u8003\u8bcd\u6c47\u603b\u6570. \u540c\u65f6, \u8bcd\u9891\u5206\u5e03\u53ef\u4ee5\u770b\u51fa\u9ad8\u9891\u8bcd\u6c47\u4e0e\u7c7b\u522b\u7684\u76f8\u5173\u6027, \u5224\u65ad\u6b63\u8d1f\u6837\u672c\u7684\u662f\u5426\u5bf9\u5206\u7c7b\u4ea7\u751f\u6548\u679c. \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import pandas as pd import jieba def get_data_labels(csv_path): \"\"\"\u83b7\u5f97\u8bad\u7ec3\u6570\u636e\u548c\u5bf9\u5e94\u7684\u6807\u7b7e, \u4ee5\u6b63\u8d1f\u6837\u672c\u7684csv\u6587\u4ef6\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528pandas\u8bfb\u53d6csv\u6587\u4ef6\u81f3\u5185\u5b58 df = pd.read_csv(csv_path, header=None, sep=\"\\t\") # \u5bf9\u53e5\u5b50\u8fdb\u884c\u5206\u8bcd\u5904\u7406\u5e76\u8fc7\u6ee4\u6389\u957f\u5ea6\u4e3a1\u7684\u8bcd train_data = list(map(lambda x: list(filter(lambda x: len(x)>1, jieba.lcut(x))), df[1].values)) # \u53d6\u7b2c0\u5217\u7684\u503c\u4f5c\u4e3a\u8bad\u7ec3\u6807\u7b7e train_labels = df[0].values return train_data, train_labels \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u6837\u672ccsv\u6587\u4ef6\u8def\u5f84 csv_path = \"./movie/sample.csv\" \u8f93\u51fa\u6548\u679c: # train_data [['\u4eca\u65e5', '\u6349\u5996', '\u5317\u4eac', '\u4e3e\u529e', '\u5168\u7403', '\u9996\u6620\u793c', '\u53d1\u5e03\u4f1a', '\u5bfc\u6f14'], ['\u8bb8\u8bda\u6bc5', '\u5404\u4f4d', '\u4e3b\u6f14', '\u4eae\u76f8', '\u73b0\u573a', '\u5404\u4f4d', '\u6f14\u5458'], [ '\u5927\u5bb6', '\u8bb2\u8ff0', '\u81ea\u5df1', '\u62cd\u6444', '\u8fc7\u7a0b', '\u53d1\u751f', '\u8da3\u4e8b', '\u5927\u5bb6', '\u5206\u4eab'], [ '\u81ea\u5df1', '\u8fc7\u5e74', '\u8ba1\u5212', '\u73b0\u573a', '\u5e03\u7f6e', '\u5341\u5206', '\u559c\u5e86', '\u653e\u773c\u671b\u53bb', '\u4e00\u7247', '\u7ea2\u5f64\u5f64', '\u989c\u8272', '\u611f\u53d7', '\u6d53\u6d53\u7684', '\u5e74\u5473'], ['\u80e1\u5df4', '\u906d\u9047', '\u5371\u9669', '\u5168\u6c11', '\u8ffd\u51fb', '\u53d1\u5e03', '\u9884\u544a\u7247', '\u5f53\u4e2d', '\u80e1\u5df4'], ['\u906d\u5230', '\u8ffd\u6740', '\u6d41\u843d', '\u4eba\u95f4', '\u6881\u671d\u4f1f', '\u6536\u7559', '\u4e0e\u6b64\u540c\u65f6'], ...] # train_labels [1 1 1 ... 0 0 0] \u83b7\u53d6\u6807\u7b7e\u7c7b\u522b\u6570\u91cf\u5206\u5e03\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import os from collections import Counter def pic_show(pic, pic_path, pic_name): \"\"\"\u7528\u4e8e\u56fe\u7247\u663e\u793a\uff0c\u4ee5\u56fe\u7247\u5bf9\u8c61\u548c\u9884\u4fdd\u5b58\u7684\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" if not os.path.exists(pic_path): os.mkdir(pic_path) pic.savefig(os.path.join(pic_path, pic_name) print(\"\u8bf7\u901a\u8fc7\u5730\u5740http://47.92.175.143:8087/text_labeled/model_train\" + pic_path[1:] + pic_name + \"\u67e5\u770b.\") def get_labels_distribution(train_labels, pic_path, pic_name=\"ld.png\"): \"\"\"\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u6570\u91cf\u7684\u57fa\u672c\u5206\u5e03\u60c5\u51b5\"\"\" # class_dict >>> {1: 3995, 0: 4418} class_dict = dict(Counter(train_labels)) print(class_dict) df = pd.DataFrame(list(class_dict.values()), list(class_dict.keys())) pic = df.plot(kind='bar', title=\"\u7c7b\u522b\u5206\u5e03\u56fe\").get_figure() pic_show(pic, pic_path, pic_name) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # get_data_labels\u51fd\u6570\u5f97\u5230\u7684train_labels # \u56fe\u7247\u7684\u5b58\u50a8\u8def\u5f84 pic_path = \"./movie/\" # \u56fe\u7247\u7684\u540d\u5b57, \u9ed8\u8ba4\u662fld.png pic_name = \"ld.png\" \u8f93\u51fa\u6548\u679c: {1: 4640, 0: 7165} \u6807\u7b7e\u7c7b\u522b\u6570\u91cf\u5206\u5e03\u56fe, \u4f4d\u4e8e./movie/ld.png \u7ed3\u679c\u5206\u6790: \u5f53\u524d\u7684\u6b63\u8d1f\u6837\u672c\u6570\u91cf\u662f\u5206\u522b\u662f: 4640\u548c7165,\u76f8\u5dee2525\u6761\u6570\u636e. \u4e3a\u4e86\u4f7f\u6b63\u8d1f\u6837\u672c\u5747\u8861, \u8ba9\u5b83\u4eec\u7684\u6bd4\u4f8b\u4e3a1:1, \u6211\u4eec\u5c06\u5728\u4e4b\u540e\u8fdb\u884c\u7684\u8be5\u7c7b\u522b\u7684\u6570\u636e\u5206\u6790\u548c\u6a21\u578b\u8bad\u7ec3\u4e2d, \u53bb\u63892525\u6761\u8d1f\u6837\u672c\u7684\u6570\u91cf. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: def get_sentence_length_distribution(train_data, pic_path, pic_name=\"sld.png\"): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u60c5\u51b5\"\"\" sentence_len_list = list(map(len, train_data)) # len_dict >>> {38: 62, 58: 18, 40: 64, 35: 83,....} len_dict = dict(Counter(sentence_len_list)) len_list = list(zip(len_dict.keys(), len_dict.values())) # len_list >>> [(1, 3), (2, 20), (3, 51), (4, 96), (5, 121), (6, 173), ...] len_list.sort(key=(lambda x: x[0])) df = pd.DataFrame(list(map(lambda x: x[1], len_list)), list( map(lambda x: x[0], len_list))) ax = df.plot(kind='bar', figsize=(18, 18), title=\"\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u56fe\") ax.set_xlabel(\"\u53e5\u5b50\u957f\u5ea6\") ax.set_ylabel(\"\u8be5\u957f\u5ea6\u51fa\u73b0\u7684\u6b21\u6570\") pic = ax.get_figure() pic_show(pic, pic_path, pic_name) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u901a\u8fc7get_data_labels\u5f97\u5230\u7684train_data(\u9700\u8981\u8fdb\u884c\u5747\u8861\u5207\u7247) # \u56fe\u7247\u7684\u5b58\u50a8\u8def\u5f84 pic_path = \"./movie/\" # \u56fe\u7247\u7684\u540d\u5b57, \u9ed8\u8ba4\u662fsld.png pic_name = \"sld.png\" \u8f93\u51fa\u6548\u679c: \u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u56fe, \u4f4d\u4e8e./movie/sld.png \u7ed3\u679c\u5206\u6790: \u901a\u8fc7\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u56fe, \u6211\u4eec\u77e5\u9053\u4e86\u53e5\u5b50\u7684\u957f\u5ea6\u8303\u56f4\u57280-151\u4e4b\u95f4. \u4f46\u57280-60\u7684\u957f\u5ea6\u4e4b\u95f4, \u5df2\u7ecf\u5305\u542b\u4e86\u8d85\u8fc790%\u7684\u53e5\u5b50, \u56e0\u6b64\u8fd9\u91cc\u53ef\u4ee5\u8ba4\u4e3a60\u7684\u957f\u5ea6\u662f\u4e00\u4e2a\u5408\u7406\u7684\u622a\u65ad\u5bf9\u9f50\u957f\u5ea6, \u5373\u4e0d\u4f1a\u4f7f\u5927\u91cf\u53e5\u5b50\u88ab\u622a\u65ad\u800c\u5931\u53bb\u4e3b\u8981\u4fe1\u606f, \u53c8\u80fd\u591f\u6709\u6548\u907f\u514d\u8865\u9f50\u7684\u7279\u5f81\u6570\u91cf\u592a\u591a, \u5bfc\u81f4\u6a21\u578b\u53c2\u6570\u8fc7\u5927. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: from itertools import chain def get_word_frequency_distribution(train_data, pic_path, pic_name=\"wfd.png\"): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u8bcd\u9891\u5206\u5e03\"\"\" vocab_size = len(set(chain(*train_data))) print(\"\u6240\u6709\u6837\u672c\u5171\u5305\u542b\u4e0d\u540c\u8bcd\u6c47\u6570\u91cf\u4e3a\uff1a\", vocab_size) # \u83b7\u53d6\u5e38\u89c1\u8bcd\u5206\u5e03\u5b57\u5178\uff0c\u4ee5\u4fbf\u8fdb\u884c\u7ed8\u56fe # common_word_dict >>> {'\u7535\u5f71': 1548, '\u81ea\u5df1': 968, '\u4e00\u4e2a': 850, '\u5bfc\u6f14': 757, '\u73b0\u573a': 744, ...} common_word_dict = dict(Counter(chain(*train_data)).most_common(50)) df = pd.DataFrame(list(common_word_dict.values()), list(common_word_dict.keys())) pic = df.plot(kind='bar', figsize=(18, 18), title=\"\u5e38\u89c1\u8bcd\u5206\u5e03\u56fe\").get_figure() pic_show(pic, pic_path, pic_name) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/data_analysis.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u901a\u8fc7get_data_labels\u5f97\u5230\u7684train_data(\u9700\u8981\u8fdb\u884c\u5747\u8861\u5207\u7247) # \u56fe\u7247\u7684\u5b58\u50a8\u8def\u5f84 pic_path = \"./movie/\" # \u56fe\u7247\u7684\u540d\u5b57, \u9ed8\u8ba4\u662fwfd.png pic_name = \"wfd.png\" \u8f93\u51fa\u6548\u679c: \u6240\u6709\u6837\u672c\u5171\u5305\u542b\u4e0d\u540c\u8bcd\u6c47\u6570\u91cf\u4e3a\uff1a24020 \u7535\u5f71\u8bad\u7ec3\u96c6\u5e38\u89c1\u8bcd\u5206\u5e03\u56fe, \u4f4d\u4e8e./movie/wfd.png \u7ed3\u679c\u5206\u6790: \u901a\u8fc7\u5e38\u89c1\u8bcd\u9891\u5206\u6790, \u5168\u6587\u8bcd\u6c47\u603b\u6570\u4e3a24020, \u5728\u6a21\u578b\u8bad\u7ec3\u65f6\u5b9a\u4e49\u7684max_features\u5e94\u5927\u4e8e\u8be5\u6570\u503c. \u540c\u65f6\u5bf9\u6bd4\u9ad8\u9891\u8bcd\u6c47\u4e2d\u51fa\u73b0\u7684\u4e0e\u5f71\u89c6\u76f8\u5173\u7684\u8bcd\u6c47\u5360\u6bd4\u5927\u6982\u572850%\u5de6\u53f3, \u7b26\u5408\u6b63\u8d1f\u6837\u672c\u7684\u5206\u5e03\u6bd4\u4f8b, \u56e0\u6b64\u8bed\u6599\u8d28\u91cf\u5c1a\u53ef. \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u83b7\u5f97\u8bad\u7ec3\u6570\u636e\u548c\u5bf9\u5e94\u7684\u6807\u7b7e, \u4ee5\u6b63\u8d1f\u6837\u672c\u7684csv\u6587\u4ef6\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528pandas\u8bfb\u53d6csv\u6587\u4ef6\u81f3\u5185\u5b58 # \u5bf9\u53e5\u5b50\u8fdb\u884c\u5206\u8bcd\u5904\u7406\u5e76\u8fc7\u6ee4\u6389\u957f\u5ea6\u4e3a1\u7684\u8bcd # \u53d6\u7b2c0\u5217\u7684\u503c\u4f5c\u4e3a\u8bad\u7ec3\u6807\u7b7e \"\"\"\u7528\u4e8e\u56fe\u7247\u663e\u793a\uff0c\u4ee5\u56fe\u7247\u5bf9\u8c61\u548c\u9884\u4fdd\u5b58\u7684\u8def\u5f84\u4e3a\u53c2\u6570\"\"\" \"\"\"\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u6570\u91cf\u7684\u57fa\u672c\u5206\u5e03\u60c5\u51b5\"\"\" # class_dict >>> {1: 3995, 0: 4418} \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u60c5\u51b5\"\"\" # len_dict >>> {38: 62, 58: 18, 40: 64, 35: 83,....} # len_list >>> [(1, 3), (2, 20), (3, 51), (4, 96), (5, 121), (6, 173), ...] \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u5f97\u8bcd\u9891\u5206\u5e03\"\"\" # \u83b7\u53d6\u5e38\u89c1\u8bcd\u5206\u5e03\u5b57\u5178\uff0c\u4ee5\u4fbf\u8fdb\u884c\u7ed8\u56fe # common_word_dict >>> {'\u7535\u5f71': 1548, '\u81ea\u5df1': 968, '\u4e00\u4e2a': 850, '\u5bfc\u6f14': 757, '\u73b0\u573a': 744, ...} \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6309\u7167\u4e0a\u9762\u5b66\u4e60\u7684\u6570\u636e\u5206\u6790\u65b9\u6cd5, \u5bf9\u5176\u4ed6\u7ed9\u51fa\u7684\u8bad\u7ec3\u6570\u636e(fashion, beauty, star), \u8fdb\u884c\u7c7b\u4f3c\u7684\u6570\u636e\u5206\u6790, \u5e76\u5728\u5bf9\u5e94\u7684\u6587\u4ef6\u4e2d\u751f\u6210\u4e09\u5f20\u5206\u5e03\u56fe. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u6587\u672c\u6570\u636e\u5206\u6790\u7684\u8fc7\u7a0b: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790\u4f5c\u6570\u636e\u51c6\u5907. \u5b9e\u73b0\u51fd\u6570: get_data_labels \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u800c\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b, \u5bf9\u6211\u4eec\u8fdb\u884c\u63a5\u4e0b\u6765\u7684\u6570\u636e\u5206\u6790\u548c\u5224\u65ad\u6a21\u578b\u51c6\u786e\u7387\u57fa\u7ebf\u8d77\u5230\u5173\u952e\u4f5c\u7528. \u5b9e\u73b0\u51fd\u6570: get_labels_distribution \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6. \u5b9e\u73b0\u51fd\u6570: get_sentence_length_distribution \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_features\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf. \u5b9e\u73b0\u51fd\u6570: get_word_frequency_distribution","title":"3.2 \u8fdb\u884c\u6570\u636e\u5206\u6790"},{"location":"3/#33","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2\u53ca\u5176\u4f5c\u7528. \u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57. \u4e3e\u4e2a\u6817\u5b50 \u5206\u8bcd(\u8bcd\u6c47)\u5217\u8868: [\"\u6709\u65f6\", \"\u6211\u60f3\", \"\u653e\u5f03\", \"\u6323\u624e\", \"\u4e5f\u653e\u4e0b\", \"\u6211\", \"\u5199\u5b57\u7684\u624b\"] \u628a\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57, \u5f97\u5230\u5e8f\u5217\u5217\u8868: [1, 2, 3, 4, 5, 6, 7] \u5206\u8bcd\u5217\u8868: [\"\u53ef\u662f\", \"\u6211\u5df2\u7ecf\", \"\u653e\u5f03\", \"\u592a\u591a\", \"\u8fd8\u575a\u6301\", \"\u7740\u8bf4\", \"\u8fd8\u575a\u6301\", \"\u7740\u8d70\"] \u5f97\u5230\u5e8f\u5217\u5217\u8868: [8, 9, 3, 10, 11, 12, 11, 13] \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad\u5bf9\u9f50: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408. \u4e3e\u4e2a\u6817\u5b50: \u5e8f\u5217\u5217\u8868: [[1, 2, 3, 4, 5, 6], [1, 3, 9], [2, 4, 6], [2, 3]] \u4ee5\u957f\u5ea63\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u540e\u5f97\u5230 \u65b0\u7684\u5e8f\u5217\u5217\u8868: [[1, 2, 3], [1, 3, 9], [2, 4, 6], [2, 3, 0]] \u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054. \u4e3e\u4e2a\u6817\u5b50: \u5728\u8fd9\u91cc, \u53ef\u4ee5\u5c06n-gram\u7279\u5f81\u53ef\u4ee5\u7406\u89e3\u4e3a\u76f8\u90bb\u8bcd\u6c47\u7684\u5171\u73b0\u7279\u5f81, \u5f53n\u4e3a2\u65f6, \u5c31\u662f\u8fde\u7eed\u4e24\u4e2a\u8bcd\u7684\u5171\u73b0. \u6211\u4eec\u8fd9\u91cc\u5c06\u4f7f\u75282-gram, \u56e0\u6b64\u4ee52-gram\u4e3a\u4f8b\u8fdb\u884c\u89e3\u91ca: \u5206\u8bcd\u5217\u8868: [\"\u662f\u8c01\", \"\u6572\u52a8\", \"\u6211\u5fc3\"] \u5bf9\u5e94\u7684\u5e8f\u5217\u5217\u8868: [1, 34, 21] \u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u5e8f\u5217\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u6570\u5b57\u5c31\u662f\u539f\u59cb\u53e5\u5b50\u7684\u7279\u5f81, \u5373\u8bcd\u6c47\u662f\u539f\u59cb\u53e5\u5b50\u7684\u7279\u5f81. \u9664\u6b64\u4e4b\u5916, \u6211\u4eec\u8fd8\u53ef\u4ee5\u628a\"\u662f\u8c01\"\u548c\"\u6572\u52a8\"\u4e24\u4e2a\u8bcd\u5171\u540c\u51fa\u73b0\u4e14\u76f8\u90bb\u4e5f\u4f5c\u4e3a\u4e00\u79cd\u7279\u5f81\u52a0\u5165\u5230\u5e8f\u5217\u5217\u8868\u4e2d, \u6b64\u65f6\u5e8f\u5217\u5217\u8868\u5c31\u53d8\u6210\u4e86\u5305\u542b2-gram\u7279\u5f81\u7684\u7279\u5f81\u5217\u8868: [1, 34, 21, 1000] \u8fd9\u91cc\u76841000\u5c31\u4ee3\u8868\"\u662f\u8c01\"\u548c\"\u6572\u52a8\"\u5171\u540c\u51fa\u73b0\u4e14\u76f8\u90bb, \u8fd9\u79cd\u7279\u5f81\u4e5f\u5c31\u662fn-gram\u7279\u5f81.\u5176\u4e2dn\u4e3a2. \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165. \u4e3e\u4e2a\u6817\u5b50: \u548c\u7b2c\u4e8c\u6b65\u622a\u65ad\u8865\u9f50\u7c7b\u4f3c: \u5e8f\u5217\u5217\u8868: [[1, 2, 3, 4, 5, 6], [1, 3, 9], [2, 4, 6], [2, 3]] \u4ee5\u6700\u957f\u957f\u5ea6\u8fdb\u884c\u5bf9\u9f50\u540e\u5f97\u5230 \u65b0\u7684\u5e8f\u5217\u5217\u8868: [[1, 2, 3, 4, 5, 6], [1, 3, 9, 0, 0, 0], [2, 4, 6, 0, 0, 0], [2, 3, 0, 0, 0, 0]] \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: # \u5bfc\u5165\u7528\u4e8e\u5bf9\u8c61\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684joblib from sklearn.externals import joblib # \u5bfc\u5165keras\u4e2d\u7684\u8bcd\u6c47\u6620\u5c04\u5668Tokenizer from keras.preprocessing.text import Tokenizer # \u5bfc\u5165\u4ece\u6837\u672ccsv\u5230\u5185\u5b58\u7684get_data_labels\u51fd\u6570 from data_analysis import get_data_labels def word_map(csv_path, tokenizer_path, cut_num): \"\"\"\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04\uff0c\u4ee5\u8bad\u7ec3\u6570\u636e\u7684csv\u8def\u5f84\u548c\u6620\u5c04\u5668\u5b58\u50a8\u8def\u5f84\u4ee5\u53ca\u622a\u65ad\u6570\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528get_data_labels\u51fd\u6570\u83b7\u53d6\u7b80\u5355\u5904\u7406\u540e\u7684\u8bad\u7ec3\u6570\u636e\u548c\u6807\u7b7e train_data, train_labels = get_data_labels(csv_path) # \u8fdb\u884c\u6b63\u8d1f\u6837\u672c\u5747\u8861\u5207\u5272, \u4f7f\u5176\u6570\u91cf\u6bd4\u4f8b\u4e3a1:1 train_data = train_data[:-cut_num] train_labels = train_labels[:-cut_num] # \u5b9e\u4f8b\u5316\u4e00\u4e2a\u8bcd\u6c47\u6620\u5c04\u5668\u5bf9\u8c61 t = Tokenizer(num_words=None, char_level=False) # \u4f7f\u7528\u6620\u5c04\u5668\u62df\u5408\u73b0\u6709\u6587\u672c\u6570\u636e t.fit_on_texts(train_data) # \u4f7f\u7528joblib\u5de5\u5177\u4fdd\u5b58\u6620\u5c04\u5668 joblib.dump(t, tokenizer_path) # \u4f7f\u7528\u6620\u5c04\u5668\u8f6c\u5316\u73b0\u6709\u6587\u672c\u6570\u636e x_train = t.texts_to_sequences(train_data) # \u83b7\u5f97\u6807\u7b7e\u6570\u636e y_train = train_labels return x_train, y_train \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u5bf9\u5e94\u7684\u6837\u672ccsv\u8def\u5f84 csv_path = \"./movie/sample.csv\" # \u8bcd\u6c47\u6620\u5c04\u5668\u4fdd\u5b58\u7684\u8def\u5f84 tokenizer_path = \"./movie/Tokenizer\" # \u622a\u65ad\u6570 cut_num = 2525 \u8f93\u51fa\u6548\u679c: # x_train [[3480, 485, 9674, 979, 23, 67, 39, 1097, 432, 49, 27584, 205], [17, 27585, 27586, 1355, 27587, 14019, 65, 100], [2282, 2609, 7, 7616, 1897, 2302, 274, 1355, 2302, 20], [57, 27588, 13601, 135, 586, 134, 4138], ...] # y_train [1 1 1 ... 0 0 0] \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u7528\u4e8e\u5bf9\u8c61\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684joblib # \u5bfc\u5165keras\u4e2d\u7684\u8bcd\u6c47\u6620\u5c04\u5668Tokenizer # \u5bfc\u5165\u4ece\u6837\u672ccsv\u5230\u5185\u5b58\u7684get_data_labels\u51fd\u6570 \"\"\"\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04\uff0c\u4ee5\u8bad\u7ec3\u6570\u636e\u7684csv\u8def\u5f84\u548c\u6620\u5c04\u5668\u5b58\u50a8\u8def\u5f84\u4ee5\u53ca\u622a\u65ad\u6570\u4e3a\u53c2\u6570\"\"\" # \u4f7f\u7528get_data_labels\u51fd\u6570\u83b7\u53d6\u7b80\u5355\u5904\u7406\u540e\u7684\u8bad\u7ec3\u6570\u636e\u548c\u6807\u7b7e # \u8fdb\u884c\u6b63\u8d1f\u6837\u672c\u5747\u8861\u5207\u5272, \u4f7f\u5176\u6570\u91cf\u6bd4\u4f8b\u4e3a1:1 # \u5b9e\u4f8b\u5316\u4e00\u4e2a\u8bcd\u6c47\u6620\u5c04\u5668\u5bf9\u8c61 # \u4f7f\u7528\u6620\u5c04\u5668\u62df\u5408\u73b0\u6709\u6587\u672c\u6570\u636e # \u4f7f\u7528joblib\u5de5\u5177\u4fdd\u5b58\u6620\u5c04\u5668 # \u4f7f\u7528\u6620\u5c04\u5668\u8f6c\u5316\u73b0\u6709\u6587\u672c\u6570\u636e # \u83b7\u5f97\u6807\u7b7e\u6570\u636e \u5411\u91cf\u622a\u65ad\u5bf9\u9f50\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: from keras.preprocessing import sequence # cutlen\u6839\u636e\u6570\u636e\u5206\u6790\u4e2d\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\uff0c\u8986\u76d690%\u8bed\u6599\u7684\u6700\u77ed\u957f\u5ea6. cutlen = 60 def padding(x_train, cutlen): return sequence.pad_sequences(x_train, cutlen) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u901a\u8fc7word_map\u51fd\u6570\u83b7\u5f97\u7684x_train # \u901a\u8fc7\u6570\u636e\u5206\u6790\u83b7\u5f97\u7684\u622a\u65ad\u957f\u5ea6 cutlen = 60 \u8f93\u51fa\u6548\u679c: # \u8fdb\u884c\u622a\u65ad\u8865\u9f50\u540e\u7684\u77e9\u9635x_train [[ 0 0 0 ... 49 5576 5577] [ 0 0 1682 ... 1 1682 7179] [ 0 0 0 ... 148 10517 7183] ... [ 0 0 0 ... 7245 1567 1731] [ 0 0 0 ... 1872 364 20985] [ 0 0 0 ... 10353 1207 20989]] \u4e3b\u8981\u6ce8\u91ca # cutlen\u6839\u636e\u6570\u636e\u5206\u6790\u4e2d\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\uff0c\u8986\u76d690%\u8bed\u6599\u7684\u6700\u77ed\u957f\u5ea6. \u52a0\u5165n-gram\u7279\u5f81\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: import numpy as np # \u6839\u636e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570\u9009\u62e9\u6700\u5927\u7279\u5f81\u6570\uff0c\u5e94\u5927\u4e8e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570 max_features = 25000 # n-gram\u7279\u5f81\u7684\u8303\u56f4\uff0c\u4e00\u822c\u9009\u62e9\u4e3a2 ngram_range = 2 def create_ngram_set(input_list, ngram_value=2): \"\"\" \u4ece\u5217\u8868\u4e2d\u63d0\u53d6n-gram\u7279\u5f81 >>> create_ngram_set([1, 4, 9, 4, 1, 4], ngram_value=2) {(4, 9), (4, 1), (1, 4), (9, 4)} \"\"\" return set(zip(*[input_list[i:] for i in range(ngram_value)])) def get_ti_and_nmf(x_train, ti_path, ngram_range): \"\"\"\u4ece\u8bad\u7ec3\u6570\u636e\u4e2d\u83b7\u5f97token_indice\u548c\u65b0\u7684max_features\"\"\" # >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} # \u521b\u5efa\u4e00\u4e2a\u76db\u88c5n-gram\u7279\u5f81\u7684\u96c6\u5408. ngram_set = set() # \u904d\u5386\u6bcf\u4e00\u4e2a\u6570\u503c\u6620\u5c04\u540e\u7684\u5217\u8868 for input_list in x_train: # \u904d\u5386\u53ef\u80fd\u5b58\u57282-gram, 3-gram\u7b49 for i in range(2, ngram_range + 1): # \u83b7\u5f97\u5bf9\u5e94\u7684n-gram\u8868\u793a set_of_ngram = create_ngram_set(input_list, ngram_value=i) # \u66f4\u65b0n-gram\u96c6\u5408 ngram_set.update(set_of_ngram) # \u53bb\u9664\u6389(0, 0)\u8fd9\u4e2a2-gram\u7279\u5f81 ngram_set.discard(tuple([0]*ngram_range)) # \u5c06n-gram\u7279\u5f81\u6620\u5c04\u6210\u6574\u6570. # \u4e3a\u4e86\u907f\u514d\u548c\u4e4b\u524d\u7684\u8bcd\u6c47\u7279\u5f81\u51b2\u7a81\uff0cn-gram\u4ea7\u751f\u7684\u7279\u5f81\u5c06\u4ecemax_features+1\u5f00\u59cb start_index = max_features + 1 # \u5f97\u5230\u5bf9n-gram\u8868\u793a\u4e0e\u5bf9\u5e94\u7279\u5f81\u503c\u7684\u5b57\u5178 token_indice = {v: k + start_index for k, v in enumerate(ngram_set)} # \u5c06token_indice\u5199\u5165\u6587\u4ef6\u4ee5\u4fbf\u9884\u6d4b\u65f6\u4f7f\u7528 with open(ti_path, \"w\") as f: f.write(str(token_indice)) # token_indice\u7684\u53cd\u8f6c\u5b57\u5178\uff0c\u4e3a\u4e86\u6c42\u89e3\u65b0\u7684\u6700\u5927\u7279\u5f81\u6570 indice_token = {token_indice[k]: k for k in token_indice} # \u83b7\u5f97\u52a0\u5165n-gram\u4e4b\u540e\u7684\u6700\u5927\u7279\u5f81\u6570 new_max_features = np.max(list(indice_token.keys())) + 1 return token_indice, new_max_features def add_ngram(sequences, token_indice, ngram_range=2): \"\"\" \u5c06n-gram\u7279\u5f81\u52a0\u5165\u5230\u8bad\u7ec3\u6570\u636e\u4e2d \u5982: adding bi-gram >>> sequences = [[1, 3, 4, 5], [1, 3, 7, 9, 2]] >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} >>> add_ngram(sequences, token_indice, ngram_range=2) [[1, 3, 4, 5, 1337, 2017], [1, 3, 7, 9, 2, 1337, 42]] \"\"\" new_sequences = [] # \u904d\u5386\u5e8f\u5217\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3ainput_list, \u5373\u4ee3\u8868\u4e00\u4e2a\u53e5\u5b50\u7684\u5217\u8868 for input_list in sequences: # copy\u4e00\u4e2anew_list new_list = input_list[:].tolist() # \u904d\u5386n-gram\u7684value\uff0c\u81f3\u5c11\u4ece2\u5f00\u59cb for ngram_value in range(2, ngram_range + 1): # \u904d\u5386\u5404\u4e2a\u53ef\u80fd\u7684n-gram\u957f\u5ea6 for i in range(len(new_list) - ngram_value + 1): # \u83b7\u5f97input_list\u4e2d\u7684n-gram\u8868\u793a ngram = tuple(new_list[i:i + ngram_value]) # \u5982\u679c\u5728token_indice\u4e2d\uff0c\u5219\u8ffd\u52a0\u76f8\u5e94\u7684\u6570\u503c\u7279\u5f81 if ngram in token_indice: new_list.append(token_indice[ngram]) new_sequences.append(new_list) return np.array(new_sequences) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u51fd\u6570create_ngram_set(input_list, ngram_value=2): \u8f93\u5165\u5b9e\u4f8b: input_list = [1, 4, 9, 4, 1, 4] \u8f93\u51fa\u6548\u679c: # 2-gram\u7279\u5f81\u7ec4\u6210\u7684\u96c6\u5408 {(4, 1), (9, 4), (4, 9), (1, 4)} \u51fd\u6570get_ti_and_nmf(x_train, ti_path, ngram_range): \u8f93\u5165\u5b9e\u4f8b: # \u6570\u636e\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u540e\u7684\u77e9\u9635x_train # token_indice\u7684\u4fdd\u5b58\u8def\u5f84 ti_path = \"./movie/token_indice\" \u8f93\u51fa\u6548\u679c: # token_indice 2-gram\u7279\u5f81\u5bf9\u5e94\u7684\u6570\u503c {(28, 1329): 143282, (413, 841): 143283, (8731, 6757): 143284, (4975, 68): 143285, (581, 9339): 143286, (744, 1819): 143287, (16, 1368): 143288, (17661, 4177): 143289, (20, 76): 143290, (495, 418): 143291, ...} # new_max_features \u65b0\u7684\u6700\u5927\u7279\u5f81\u6570 143307 \u51fd\u6570add_ngram(sequences, token_indice, ngram_range=2): \u8f93\u5165\u5b9e\u4f8b: # \u6570\u636e\u8fdb\u884c\u622a\u65ad\u5bf9\u9f50\u540e\u7684\u77e9\u9635x_train, \u4e5f\u5c31\u662f\u8f93\u5165sequences # \u7531\u51fd\u6570get_ti_and_nmf\u5f97\u5230\u7684token_indice \u8f93\u51fa\u6548\u679c: # \u6dfb\u52a0\u4e86n-gram\u7279\u5f81\u7684\u77e9\u9635x_train [list([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1296, 1086, 9, 2510, 2325, 1004, 668, 2990, 669, 482, 669, 335, 126063, 46370, 36768, 93632, 116281, 46593, 136403, 29955, 34254, 127711, 47353, 132158]) list([0, 0, 0, 0, 11, 4, 8280, 26, 2511, 2991, 528, 22, 411, 702, 11, 350, 8281, 604, 85, 1501, 468, 52, 11, 56, 3255, 104815, 38229, 35505, 67872, 28659, 50795, 140653, 113341, 65967, 78902, 57072, 108083, 29205, 115079, 61698, 48928, 42416, 46802, 110530, 99281, 40828]) ... ] \u4e3b\u8981\u6ce8\u91ca: # \u6839\u636e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570\u9009\u62e9\u6700\u5927\u7279\u5f81\u6570\uff0c\u5e94\u5927\u4e8e\u6837\u672c\u96c6\u6700\u5927\u8bcd\u6c47\u6570 # n-gram\u7279\u5f81\u7684\u8303\u56f4\uff0c\u4e00\u822c\u9009\u62e9\u4e3a2 \"\"\" \u4ece\u5217\u8868\u4e2d\u63d0\u53d6n-gram\u7279\u5f81 >>> create_ngram_set([1, 4, 9, 4, 1, 4], ngram_value=2) {(4, 9), (4, 1), (1, 4), (9, 4)} \"\"\" \"\"\"\u4ece\u8bad\u7ec3\u6570\u636e\u4e2d\u83b7\u5f97token_indice\u548c\u65b0\u7684max_features\"\"\" # >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} # \u521b\u5efa\u4e00\u4e2a\u76db\u88c5n-gram\u7279\u5f81\u7684\u96c6\u5408. # \u904d\u5386\u6bcf\u4e00\u4e2a\u6570\u503c\u6620\u5c04\u540e\u7684\u5217\u8868 # \u904d\u5386\u53ef\u80fd\u5b58\u57282-gram, 3-gram\u7b49 # \u83b7\u5f97\u5bf9\u5e94\u7684n-gram\u8868\u793a # \u66f4\u65b0n-gram\u96c6\u5408 # \u53bb\u9664\u6389(0, 0)\u8fd9\u4e2a2-gram\u7279\u5f81 # \u5c06n-gram\u7279\u5f81\u6620\u5c04\u6210\u6574\u6570. # \u4e3a\u4e86\u907f\u514d\u548c\u4e4b\u524d\u7684\u8bcd\u6c47\u7279\u5f81\u51b2\u7a81\uff0cn-gram\u4ea7\u751f\u7684\u7279\u5f81\u5c06\u4ecemax_features+1\u5f00\u59cb # \u5f97\u5230\u5bf9n-gram\u8868\u793a\u4e0e\u5bf9\u5e94\u7279\u5f81\u503c\u7684\u5b57\u5178 # \u5c06token_indice\u5199\u5165\u6587\u4ef6\u4ee5\u4fbf\u9884\u6d4b\u65f6\u4f7f\u7528 # token_indice\u7684\u53cd\u8f6c\u5b57\u5178\uff0c\u4e3a\u4e86\u6c42\u89e3\u65b0\u7684\u6700\u5927\u7279\u5f81\u6570 # \u83b7\u5f97\u52a0\u5165n-gram\u4e4b\u540e\u7684\u6700\u5927\u7279\u5f81\u6570 \"\"\" \u5c06n-gram\u7279\u5f81\u52a0\u5165\u5230\u8bad\u7ec3\u6570\u636e\u4e2d \u5982: adding bi-gram >>> sequences = [[1, 3, 4, 5], [1, 3, 7, 9, 2]] >>> token_indice = {(1, 3): 1337, (9, 2): 42, (4, 5): 2017} >>> add_ngram(sequences, token_indice, ngram_range=2) [[1, 3, 4, 5, 1337, 2017], [1, 3, 7, 9, 2, 1337, 42]] \"\"\" # \u904d\u5386\u5e8f\u5217\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3ainput_list, \u5373\u4ee3\u8868\u4e00\u4e2a\u53e5\u5b50\u7684\u5217\u8868 # copy\u4e00\u4e2anew_list # \u904d\u5386n-gram\u7684value\uff0c\u81f3\u5c11\u4ece2\u5f00\u59cb # \u904d\u5386\u5404\u4e2a\u53ef\u80fd\u7684n-gram\u957f\u5ea6 # \u83b7\u5f97input_list\u4e2d\u7684n-gram\u8868\u793a # \u5982\u679c\u5728token_indice\u4e2d\uff0c\u5219\u8ffd\u52a0\u76f8\u5e94\u7684\u6570\u503c\u7279\u5f81 \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: def align(x_train): \"\"\"\u7528\u4e8e\u5411\u91cf\u6309\u7167\u6700\u957f\u957f\u5ea6\u8fdb\u884c\u8865\u9f50\"\"\" # \u83b7\u5f97\u6240\u6709\u53e5\u5b50\u957f\u5ea6\u7684\u6700\u5927\u503c maxlen = max(list(map(lambda x: len(x), x_train))) # \u8c03\u7528padding\u51fd\u6570 x_train = padding(x_train, maxlen) return x_train, maxlen \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u7531\u51fd\u6570add_ngram\u8f93\u51fa\u7684\u77e9\u9635x_train \u8f93\u51fa\u6548\u679c: # \u8fdb\u884c\u4e86\u6700\u5927\u957f\u5ea6\u8865\u9f50\u7684\u77e9\u9635x_train [[ 0 0 0 ... 113541 36959 22941] [ 0 0 1682 ... 42518 59855 25524] [ 0 0 0 ... 75385 50810 68725] ... [ 0 0 0 ... 97401 34490 77114] [ 0 0 0 ... 21440 85555 32122] [ 0 0 0 ... 56394 95696 45331]] # \u8865\u9f50\u7684\u6700\u5927\u957f\u5ea6 119 \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u7528\u4e8e\u5411\u91cf\u6309\u7167\u6700\u957f\u957f\u5ea6\u8fdb\u884c\u8865\u9f50\"\"\" # \u83b7\u5f97\u6240\u6709\u53e5\u5b50\u957f\u5ea6\u7684\u6700\u5927\u503c # \u8c03\u7528padding\u51fd\u6570 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u7279\u5f81\u5904\u7406\u8fc7\u7a0b,\u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b, \u521b\u5efastar_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6, \u5e76\u6839\u636e\u6570\u636e\u5206\u6790\u7684\u7ed3\u679c\u5199\u51fa\u5b83\u4eec\u7684\u7279\u5f81\u5904\u7406\u6d41\u7a0b. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57. \u51fd\u6570: word_map \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad\u8865\u9f50: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\u8865\u9f50\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408. \u51fd\u6570: padding \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054. \u51fd\u6570: create_ngram_set \u51fd\u6570: get_ti_and_nmf \u51fd\u6570: add_ngram \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165. \u51fd\u6570: align","title":"3.3 \u7279\u5f81\u5904\u7406"},{"location":"3/#34","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1fasttext\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42\u5e76\u4f7f\u7528\u5b83\u4eec\u6784\u5efa\u6a21\u578b. fasttext\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6700\u5927\u7279\u5f81\u6570(new_max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a. \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u90fd\u662f\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fnew_max_features x embedding_dims. \u8f93\u5165\u53c2\u6570: new_max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6. \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb. GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784. \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408. Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid. \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570. \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570. \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c. \u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b\u7684\u4ee3\u7801\u5206\u6790: # \u9996\u5148\u5bfc\u5165keras\u6784\u5efa\u6a21\u578b\u7684\u5fc5\u5907\u5de5\u5177\u5305 from keras.models import Sequential from keras.layers import Dense from keras.layers import Embedding from keras.layers import GlobalAveragePooling1D # \u5b9a\u4e49\u8bcd\u5d4c\u5165\u7ef4\u5ea6\u4e3a50 embedding_dims = 50 def model_build(maxlen, new_max_features): \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u6a21\u578b\u7ed3\u6784\u6784\u5efa\"\"\" # \u5728\u51fd\u6570\u4e2d\uff0c\u9996\u5148\u521d\u59cb\u5316\u4e00\u4e2a\u5e8f\u5217\u6a21\u578b\u5bf9\u8c61 model = Sequential() # \u7136\u540e\u9996\u5c42\u4f7f\u7528Embedding\u5c42\u8fdb\u884c\u8bcd\u5411\u91cf\u6620\u5c04 model.add(Embedding(new_max_features, embedding_dims, input_length=maxlen)) # \u7136\u540e\u7528\u6784\u5efa\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42\uff0c\u51cf\u5c11\u6a21\u578b\u53c2\u6570\uff0c\u9632\u6b62\u8fc7\u62df\u5408 model.add(GlobalAveragePooling1D()) # \u6700\u540e\u6784\u5efa\u5168\u8fde\u63a5\u5c42 + sigmoid\u5c42\u6765\u8fdb\u884c\u5206\u7c7b. model.add(Dense(1, activation='sigmoid')) return model \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u6700\u5927\u5bf9\u9f50\u957f\u5ea6, \u5373\u8f93\u5165\u77e9\u9635\u4e2d\u6bcf\u6761\u5411\u91cf\u7684\u957f\u5ea6 maxlen = 119 # \u6700\u5927\u7279\u5f81\u6570, \u5373\u8f93\u5165\u77e9\u9635\u4e2d\u5143\u7d20\u7684\u6700\u5927\u503c new_max_features = 143307 # \u8bcd\u5d4c\u5165\u7684\u6570\u91cf, \u4f7f\u752850\u7ef4 embedding_dims = 50 \u8f93\u51fa\u6548\u679c: # keras sequential\u7684model\u5bf9\u8c61: <keras.engine.sequential.Sequential object at 0x7f67cc2bf208> \u4e3b\u8981\u6ce8\u91ca: # \u9996\u5148\u5bfc\u5165keras\u6784\u5efa\u6a21\u578b\u7684\u5fc5\u5907\u5de5\u5177\u5305 # \u5b9a\u4e49\u8bcd\u5d4c\u5165\u7ef4\u5ea6\u4e3a50 \"\"\"\u8be5\u51fd\u6570\u7528\u4e8e\u6a21\u578b\u7ed3\u6784\u6784\u5efa\"\"\" # \u5728\u51fd\u6570\u4e2d\uff0c\u9996\u5148\u521d\u59cb\u5316\u4e00\u4e2a\u5e8f\u5217\u6a21\u578b\u5bf9\u8c61 # \u7136\u540e\u9996\u5c42\u4f7f\u7528Embedding\u5c42\u8fdb\u884c\u8bcd\u5411\u91cf\u6620\u5c04 # \u7136\u540e\u7528\u6784\u5efa\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42\uff0c\u51cf\u5c11\u6a21\u578b\u53c2\u6570\uff0c\u9632\u6b62\u8fc7\u62df\u5408 # \u6700\u540e\u6784\u5efa\u5168\u8fde\u63a5\u5c42 + sigmoid\u5c42\u6765\u8fdb\u884c\u5206\u7c7b. \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u6a21\u578b\u6784\u5efa\u8fc7\u7a0b,\u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u6a21\u578b\u7ed3\u6784\u6784\u5efa\u51fd\u6570. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86fasttext\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 \u5b66\u4e60\u4e86Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6700\u5927\u7279\u5f81\u6570(new_max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a. \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u90fd\u662f\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fnew_max_features x embedding_dims. \u8f93\u5165\u53c2\u6570: new_max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6. \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb. \u5b66\u4e60\u4e86GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784. \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408. \u5b66\u4e60\u4e86Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid. \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570. \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570. \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b. \u51fd\u6570: model_build","title":"3.4 \u6784\u5efa\u6a21\u578b\u7ed3\u6784"},{"location":"3/#35","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5\u53ca\u5176\u5b9e\u73b0. fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f. \u5f62\u5f0f\uff1a \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61.\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5. \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282. \u5b9e\u73b0\u5728\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: def model_compile(model): \"\"\"\u7528\u4e8e\u9009\u53d6\u6a21\u578b\u7684\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\"\"\" # \u4f7f\u7528model\u81ea\u5e26\u7684compile\u65b9\u6cd5\uff0c\u9009\u62e9\u9884\u5b9a\u4e49\u597d\u7684\u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570\uff0cAdam\u4f18\u5316\u65b9\u6cd5\uff0c\u4ee5\u53ca\u51c6\u786e\u7387\u8bc4\u4f30\u6307\u6807. model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy']) return model \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u8f93\u5165\u5b9e\u4f8b: # \u7531model_build\u83b7\u5f97\u7684keras sequential\u7684model\u5bf9\u8c61 <keras.engine.sequential.Sequential object at 0x7f67cc2bf208> \u8f93\u51fa\u6548\u679c: # \u52a0\u5165\u4e86\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684keras sequential\u7684model\u5bf9\u8c61 <keras.engine.sequential.Sequential object at 0x7f3f09baf1d0> \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u7528\u4e8e\u9009\u53d6\u6a21\u578b\u7684\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\"\"\" # \u4f7f\u7528model\u81ea\u5e26\u7684compile\u65b9\u6cd5\uff0c\u9009\u62e9\u9884\u5b9a\u4e49\u597d\u7684\u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570\uff0cAdam\u4f18\u5316\u65b9\u6cd5\uff0c\u4ee5\u53ca\u51c6\u786e\u7387\u8bc4\u4f30\u6307\u6807. \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684\u8fc7\u7a0b, \u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684\u51fd\u6570. \u5c0f\u8282\u603b\u7ed3: fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f. \u5f62\u5f0f: \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61.\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5. \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5728\u6a21\u578b\u4e2d\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5. \u51fd\u6570: model_compile","title":"3.5 \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5"},{"location":"3/#36","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b. \u5b66\u4e60\u5982\u4f55\u6839\u636e\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\u53ca\u5176\u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408. \u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u4f5c\u56fe\u5de5\u5177\u5305matplotlib import matplotlib.pyplot as plt # batch_size\u662f\u6bcf\u6b21\u8fdb\u884c\u53c2\u6570\u66f4\u65b0\u7684\u6837\u672c\u6570\u91cf batch_size = 32 # epochs\u5c06\u5168\u90e8\u6570\u636e\u904d\u5386\u8bad\u7ec3\u7684\u6b21\u6570 epochs = 40 def model_fit(model, x_train, y_train): \"\"\"\u7528\u4e8e\u6a21\u578b\u8bad\u7ec3\"\"\" history = model.fit(x_train, y_train, batch_size=batch_size, epochs=epochs, # validation_split\u8868\u793a\u5c06\u5168\u90e8\u8bad\u7ec3\u6570\u636e\u7684\u591a\u5c11\u5212\u5206\u4e3a\u9a8c\u8bc1\u96c6. validation_split=0.1) return history def plot_loss_acc(history, acc_png_path, loss_png_path): \"\"\"\u7528\u4e8e\u7ed8\u5236\u6a21\u578b\u7684\u635f\u5931\u548cacc\u5bf9\u7167\u66f2\u7ebf, \u4ee5\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u4e3a\u53c2\u6570\"\"\" # \u9996\u5148\u83b7\u5f97\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u5b57\u5178\uff0c # \u5f62\u5982{'val_loss': [0.8132099324259264, ..., 0.8765081824927494], # 'val_acc': [0.029094827586206896,...,0.13038793103448276], # 'loss': [0.6650978644232184,..., 0.5267722122513928], # 'acc': [0.5803400383141762, ...,0.8469827586206896]} history_dict = history.history # \u53d6\u51fa\u9700\u8981\u7684\u7684\u5404\u4e2akey\u5bf9\u5e94\u7684value\uff0c\u51c6\u5907\u4f5c\u4e3a\u7eb5\u5750\u6807 acc = history_dict['acc'] val_acc = history_dict['val_acc'] loss = history_dict['loss'] val_loss = history_dict['val_loss'] # \u53d6epochs\u7684\u9012\u589e\u5217\u8868\u4f5c\u4e3a\u6a2a\u5750\u6807 epochs = range(1, len(acc) + 1) # \u7ed8\u5236\u8bad\u7ec3\u51c6\u786e\u7387\u7684\u70b9\u56fe plt.plot(epochs, acc, 'bo', label='Training acc') # \u7ed8\u5236\u9a8c\u8bc1\u51c6\u786e\u7387\u7684\u7ebf\u56fe plt.plot(epochs, val_acc, 'b', label='Validation acc') # \u589e\u52a0\u6807\u9898 plt.title('Training and validation accuracy') # \u589e\u52a0\u6a2a\u5750\u6807\u540d\u5b57 plt.xlabel('Epochs') # \u589e\u52a0\u7eb5\u5750\u6807\u540d\u5b57 plt.ylabel('Accuracy') # \u5c06\u4e0a\u9762\u7684\u56fe\u653e\u5728\u4e00\u5757\u753b\u677f\u4e2d plt.legend() # \u4fdd\u5b58\u56fe\u7247 plt.savefig(acc_png_path) # \u6e05\u7a7a\u9762\u677f plt.clf() # \u7ed8\u5236\u8bad\u7ec3\u635f\u5931\u7684\u70b9\u56fe plt.plot(epochs, loss, 'bo', label='Training loss') # \u7ed8\u5236\u9a8c\u8bc1\u635f\u5931\u7684\u7ebf\u56fe plt.plot(epochs, val_loss, 'b', label='Validation loss') # \u6dfb\u52a0\u6807\u9898 plt.title('Training and validation loss') # \u6dfb\u52a0\u6a2a\u5750\u6807\u540d\u5b57 plt.xlabel('Epochs') # \u6dfb\u52a0\u7eb5\u5750\u6807\u540d\u5b57 plt.ylabel('Loss') # \u628a\u4e24\u5f20\u56fe\u653e\u5728\u4e00\u8d77 plt.legend() # \u4fdd\u5b58\u56fe\u7247 plt.savefig(loss_png_path) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u51fd\u6570model_fit(model, x_train, y_train): \u8f93\u5165\u5b9e\u4f8b: # \u52a0\u5165\u4e86\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5\u7684keras sequential\u7684model\u5bf9\u8c61 <keras.engine.sequential.Sequential object at 0x7f3f09baf1d0> # \u7ecf\u8fc7\u7279\u5f81\u5904\u7406\u7684x_train\u4ee5\u53ca\u5bf9\u5e94y_train \u8f93\u51fa\u6548\u679c: # \u6a21\u578b\u8bad\u7ec3\u65e5\u5fd7 Epoch 3/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.4094 - acc: 0.7998 - val_loss: 0.9937 - val_acc: 0.1800 Epoch 4/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.3185 - acc: 0.8498 - val_loss: 0.8025 - val_acc: 0.3548 Epoch 5/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.2379 - acc: 0.9136 - val_loss: 0.7550 - val_acc: 0.4482 Epoch 6/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.1779 - acc: 0.9500 - val_loss: 0.6113 - val_acc: 0.5857 Epoch 7/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.1355 - acc: 0.9726 - val_loss: 0.5836 - val_acc: 0.6214 Epoch 8/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.1056 - acc: 0.9826 - val_loss: 0.4837 - val_acc: 0.6893 Epoch 9/40 5299/5299 [==============================] - 7s 1ms/step - loss: 0.0844 - acc: 0.9870 - val_loss: 0.5271 - val_acc: 0.6570 Epoch 10/40 4384/5299 [=======================>......] - ETA: 1s - loss: 0.0691 - acc: 0.991 # \u6a21\u578b\u8bad\u7ec3\u7684\u5386\u53f2\u5bf9\u8c61 <keras.callbacks.History object at 0x7f75135f55f8> \u51fd\u6570plot_loss_acc(history, acc_png_path, loss_png_path): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u8bad\u7ec3\u7684\u5386\u53f2\u5bf9\u8c61history # \u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5b58\u50a8\u8def\u5f84 acc_png_path = \"./movie/acc.png\" # \u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u5b58\u50a8\u8def\u5f84 loss_png_path = \"./movie/loss.png\" \u8f93\u51fa\u6548\u679c: # \u5728./movie/\u8def\u5f84\u4e0b\u4e24\u5f20\u56fe\u7247, acc.png\u548closs.png, \u5206\u522b\u662f\u8bad\u7ec3\u4e0e\u9a8c\u8bc1\u7684\u51c6\u786e\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf \u8bad\u7ec3\u4e0e\u9a8c\u8bc1\u7684\u635f\u5931\u5bf9\u7167\u66f2\u7ebf: \u901a\u8fc7\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u6a21\u578b\u662f\u5426\u6536\u655b\uff1a \u5f53\u53cc\u635f\u5931\u66f2\u7ebf\u90fd\u5728\u4e0b\u964d\u65f6,\u8bf4\u660e\u6a21\u578b\u6b63\u5728\u6536\u655b, \u5927\u90e8\u5206\u60c5\u51b5\u4e0b,\u6a21\u578b\u90fd\u4f1a\u6536\u655b. \u8bad\u7ec3\u4e0e\u9a8c\u8bc1\u7684\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf: \u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u5e73\u7f13\u6216\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61. \u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408: \u901a\u8fc7\u5bf9\u6bd4\u9a8c\u8bc1\u96c6\u4e0e\u8bad\u7ec3\u96c6\u51c6\u786e\u66f2\u7ebf\uff0c\u5728\u9a8c\u8bc1acc\u4e0d\u5728\u4e0a\u5347\u7684\u8f6e\u6570\u65f6\u505c\u6b62\u8bad\u7ec3. \u8fdb\u5165\u670d\u52a1\u5668\u4e2d\u4fee\u6539epochs\u7684\u503c\u4e3a10-20\u4e4b\u95f4\u6570\u503c, \u91cd\u65b0\u8bad\u7ec3\u5373\u53ef. \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u4f5c\u56fe\u5de5\u5177\u5305matplotlib # batch_size\u662f\u6bcf\u6b21\u8fdb\u884c\u53c2\u6570\u66f4\u65b0\u7684\u6837\u672c\u6570\u91cf # epochs\u5c06\u5168\u90e8\u6570\u636e\u904d\u5386\u8bad\u7ec3\u7684\u6b21\u6570 \"\"\"\u7528\u4e8e\u6a21\u578b\u8bad\u7ec3\"\"\" # validation_split\u8868\u793a\u5c06\u5168\u90e8\u8bad\u7ec3\u6570\u636e\u7684\u591a\u5c11\u5212\u5206\u4e3a\u9a8c\u8bc1\u96c6. \"\"\"\u7528\u4e8e\u7ed8\u5236\u6a21\u578b\u7684\u635f\u5931\u548cacc\u5bf9\u7167\u66f2\u7ebf, \u4ee5\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u4e3a\u53c2\u6570\"\"\" # \u9996\u5148\u83b7\u5f97\u6a21\u578b\u8bad\u7ec3\u5386\u53f2\u5b57\u5178\uff0c # \u5f62\u5982{'val_loss': [0.8132099324259264, ..., 0.8765081824927494], # 'val_acc': [0.029094827586206896,...,0.13038793103448276], # 'loss': [0.6650978644232184,..., 0.5267722122513928], # 'acc': [0.5803400383141762, ...,0.8469827586206896]} # \u53d6\u51fa\u9700\u8981\u7684\u7684\u5404\u4e2akey\u5bf9\u5e94\u7684value\uff0c\u51c6\u5907\u4f5c\u4e3a\u7eb5\u5750\u6807 # \u53d6epochs\u7684\u9012\u589e\u5217\u8868\u4f5c\u4e3a\u6a2a\u5750\u6807 # \u7ed8\u5236\u8bad\u7ec3\u51c6\u786e\u7387\u7684\u70b9\u56fe # \u7ed8\u5236\u9a8c\u8bc1\u51c6\u786e\u7387\u7684\u7ebf\u56fe # \u589e\u52a0\u6807\u9898 # \u589e\u52a0\u6a2a\u5750\u6807\u540d\u5b57 # \u589e\u52a0\u7eb5\u5750\u6807\u540d\u5b57 # \u5c06\u4e0a\u9762\u7684\u56fe\u653e\u5728\u4e00\u5757\u753b\u677f\u4e2d # \u4fdd\u5b58\u56fe\u7247 # \u6e05\u7a7a\u9762\u677f # \u7ed8\u5236\u8bad\u7ec3\u635f\u5931\u7684\u70b9\u56fe # \u7ed8\u5236\u9a8c\u8bc1\u635f\u5931\u7684\u7ebf\u56fe # \u6dfb\u52a0\u6807\u9898 # \u6dfb\u52a0\u6a2a\u5750\u6807\u540d\u5b57 # \u6dfb\u52a0\u7eb5\u5750\u6807\u540d\u5b57 # \u628a\u4e24\u5f20\u56fe\u653e\u5728\u4e00\u8d77 # \u4fdd\u5b58\u56fe\u7247 \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u6a21\u578b\u8bad\u7ec3\u8fc7\u7a0b, \u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\u51fd\u6570, \u5e76\u8fdb\u884c\u8bad\u7ec3, \u5f97\u5230\u635f\u5931\u4ee5\u53ca\u51c6\u786e\u7387\u5bf9\u6bd4\u66f2\u7ebf. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u786e\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b. \u51fd\u6570: model_fit \u51fd\u6570: plot_loss_acc \u5b66\u4e60\u4e86\u901a\u8fc7\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u6a21\u578b\u662f\u5426\u6536\u655b: \u5f53\u53cc\u635f\u5931\u66f2\u7ebf\u90fd\u5728\u4e0b\u964d\u65f6,\u8bf4\u660e\u6a21\u578b\u6b63\u5728\u6536\u655b, \u5927\u90e8\u5206\u60c5\u51b5\u4e0b,\u6a21\u578b\u90fd\u4f1a\u6536\u655b. \u5b66\u4e60\u4e86\u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u5e73\u7f13\u6216\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61. \u5b66\u4e60\u4e86\u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408: \u901a\u8fc7\u5bf9\u6bd4\u9a8c\u8bc1\u96c6\u4e0e\u8bad\u7ec3\u96c6\u51c6\u786e\u66f2\u7ebf\uff0c\u5728\u9a8c\u8bc1acc\u4e0d\u5728\u4e0a\u5347\u7684\u8f6e\u6570\u65f6\u505c\u6b62\u8bad\u7ec3.","title":"3.6 \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3"},{"location":"3/#37","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684\u8fc7\u7a0b. \u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: from keras.models import load_model def model_save(save_path, model): \"\"\"\u6a21\u578b\u4fdd\u5b58\u51fd\u6570\"\"\" # \u4f7f\u7528model.save\u5bf9\u6a21\u578b\u8fdb\u884c\u4fdd\u5b58. model.save(save_path) return def model_load(save_path, sample): \"\"\"\u6a21\u578b\u52a0\u8f7d\u4e0e\u9884\u6d4b\u51fd\u6570\"\"\" # \u4f7f\u7528load_model\u65b9\u6cd5\u8fdb\u884c\u52a0\u8f7d model = load_model(save_path) # \u4f7f\u7528predict\u65b9\u6cd5\u8fdb\u884c\u9884\u6d4b result = model.predict(sample) return result \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/movie_model_train.py\u4e2d. \u51fd\u6570model_save(save_path, model): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u7684\u4fdd\u5b58\u8def\u5f84 save_path = \"./movie/model.h5\" # \u8bad\u7ec3\u4e4b\u540e\u7684model\u5bf9\u8c61 \u8f93\u51fa\u6548\u679c: # \u5728./movie\u8def\u5f84\u4e0b, \u83b7\u5f97\u4e00\u4e2amodel.h5 \u51fd\u6570model_load(save_path, sample): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u4fdd\u5b58\u7684\u8def\u5f84 save_path = \"./movie/model.h5\" # \u4e00\u4e2a\u5b9e\u4f8b: \u8bad\u7ec3\u6570\u636e\u7684\u7b2c\u4e00\u6761 sample = np.array([x_train[0]]) \u8f93\u51fa\u6548\u679c: # \u4e00\u4e2a\u8bad\u7ec3\u5b9e\u4f8b\u7684\u9884\u6d4b\u7ed3\u679c [[0.9996284]] \u4e3b\u8981\u6ce8\u91ca: \"\"\"\u6a21\u578b\u4fdd\u5b58\u51fd\u6570\"\"\" # \u4f7f\u7528model.save\u5bf9\u6a21\u578b\u8fdb\u884c\u4fdd\u5b58. \"\"\"\u6a21\u578b\u52a0\u8f7d\u4e0e\u9884\u6d4b\u51fd\u6570\"\"\" # \u4f7f\u7528load_model\u65b9\u6cd5\u8fdb\u884c\u52a0\u8f7d # \u4f7f\u7528predict\u65b9\u6cd5\u8fdb\u884c\u9884\u6d4b \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u6839\u636e\u672c\u5c0f\u8282\u5b66\u4e60\u7684\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u8fc7\u7a0b, \u5728/data/django-uwsgi/text_labeled/model_train\u76ee\u5f55\u4e0b\u7684star_model_train.py, beauty_model_train.py, fashion_model_train.py\u4e09\u4e2a\u6587\u4ef6\u4e2d, \u5199\u51fa\u5b83\u4eec\u7684\u6a21\u578b\u4fdd\u5b58 \u4e0e\u52a0\u8f7d\u51fd\u6570, \u5f97\u5230\u5bf9\u5e94\u7684h5\u6a21\u578b. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4f1a\u4e86\u5b9e\u73b0\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684\u8fc7\u7a0b. \u51fd\u6570: model_save \u51fd\u6570: model_load","title":"3.7 \u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d"},{"location":"3/#_2","text":"\u7b2c1\u5c0f\u8282: \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599 \u5b66\u4e60\u4e86\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90. \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c. \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u5b66\u4e60\u4e86\u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0. \u5b66\u4e60\u4e86\u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599. \u7b2c2\u5c0f\u8282: \u8fdb\u884c\u6570\u636e\u5206\u6790 \u5b66\u4e60\u4e86\u6570\u636e\u5206\u6790\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u7b2c\u4e09\u6b65: \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u7b2c\u56db\u6b65: \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e. \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790\u4f5c\u6570\u636e\u51c6\u5907. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03. \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03. \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_features\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf. \u7b2c3\u5c0f\u8282: \u7279\u5f81\u5904\u7406 \u5b66\u4e60\u4e86\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u4e2d\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165. \u7b2c4\u5c0f\u8282: \u6784\u5efa\u6a21\u578b\u7ed3\u6784 \u5b66\u4e60\u4e86\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 \u5b66\u4e60\u4e86Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6709\u6548\u8bcd\u6c47\u603b\u6570(max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a. \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u4e00\u822c\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fmax_features x embedding_dims. \u8f93\u5165\u53c2\u6570: max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6. \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb. \u5b66\u4e60\u4e86GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784. \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408. \u5b66\u4e60\u4e86Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid. \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570. \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570. \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b. \u7b2c5\u5c0f\u8282: \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5 fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f. \u5f62\u5f0f: \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61.\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5. \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5728\u6a21\u578b\u4e2d\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5. \u7b2c6\u5c0f\u8282: \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b. \u5b66\u4e60\u4e86\u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61.","title":"\u672c\u7ae0\u603b\u7ed3"},{"location":"4/","text":"\u672c\u7ae0\u5bfc\u5b66 \u5b66\u4e60\u76ee\u6807: \u5b66\u4f1a\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fdb\u884c\u591a\u6a21\u578b\u8bad\u7ec3\u3002 \u5b66\u4f1a\u4f7f\u7528tensorflow-serving\u5c06\u6a21\u578b\u5c01\u88c5\u6210\u5fae\u670d\u52a1\uff0c\u5e76\u4f7f\u7528\u591a\u7ebf\u7a0b\u8c03\u7528\u3002 \u5f15\u5bfc\u5206\u6790: \u56e0\u4e3a\u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u5c06\u4f7f\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u7c7b\u522b\u9884\u6d4b\u4ee5\u63d0\u5347\u51c6\u786e\u7387, \u6240\u4ee5\u4f1a\u4ea7\u751f\u548c\u7ef4\u62a4\u5927\u91cf\u7684\u6a21\u578b\uff0c\u56e0\u6b64\u5982\u4f55\u5229\u7528\u73b0\u6709\u8d44\u6e90\u63d0\u5347\u6a21\u578b\u7684\u8bad\u7ec3\u6548\u7387\u6210\u4e3a\u4e00\u4e2a\u95ee\u9898\u3002\u800c\u5728python\u4e2d\uff0c\u591a\u8fdb\u7a0b\u662f\u89e3\u51b3\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\u5e76\u884c\u5316\u7684\u6700\u4f18\u65b9\u6cd5\u3002 \u540c\u6837\u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u7528\u6237\u7684\u6bcf\u6b21\u8bf7\u6c42\uff0c\u90fd\u6709\u53ef\u80fd\u8c03\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u800c\u4e32\u884c\u9884\u6d4b\u7684\u65b9\u5f0f\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u9884\u6d4b\u7684\u6027\u80fd\u8981\u6c42\u3002\u56e0\u6b64\u9884\u6d4b\u8fc7\u7a0b\u5fc5\u987b\u80fd\u591f\u5e76\u884c\u5316\uff0c\u5e76\u5f88\u5bb9\u6613\u7684\u6574\u5408\u5168\u90e8\u7684\u7ed3\u679c. \u4f7f\u7528\u591a\u7ebf\u7a0b\u53d1\u9001\u8bf7\u6c42\uff0c\u9884\u6d4b\u8fc7\u7a0b\u867d\u7136\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\uff0c\u4f46\u662f\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u662f\u5728\u6a21\u578b\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c\u7684\u3002 \u672c\u7ae0\u5c0f\u8282: 4.1 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3 \u5b66\u4e60\u5982\u4f55\u5145\u5206\u5229\u7528\u8ba1\u7b97\u8d44\u6e90\uff0c\u63d0\u5347\u6a21\u578b\u8bad\u7ec3\u6548\u7387, \u5c06\u4f7f\u7528\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8fdb\u884c\u8bad\u7ec3. 4.2 \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b \u5b66\u4e60\u5982\u4f55\u4ee5\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u8fdb\u884c\u8c03\u7528\u5c01\u88c5\u7684\u6a21\u578b\u5fae\u670d\u52a1. 4.1 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3 \u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0\u3002 \u638c\u63e1\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\u5e76\u5b9e\u73b0\u5b83\u3002 \u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 CPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff1a \u662f\u6307\u6211\u4eec\u7684CPU/\u5185\u5b58\u6b63\u5e38\u5de5\u4f5c\u65f6\u5360\u7528\u7387\uff0c\u6bd4\u8fd9\u4e2a\u503c\u5c0f\uff0c\u8bf4\u660e\u6211\u4eec\u7684CPU/\u5185\u5b58\u5de5\u4f5c\u5f88\u8f7b\u677e\uff0c\u6bd4\u8fd9\u4e2a\u503c\u5927\uff0c\u8bf4\u660e\u5de5\u4f5c\u8d77\u6765\u5df2\u7ecf\u5f88\u52b3\u7d2f\u4e86\uff0c\u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768455%\u3002 CPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c: \u662f\u6307\u6211\u4eec\u7684CPU/\u5185\u5b58\u5371\u9669\u5de5\u4f5c\u65f6\u7684\u5360\u7528\u7387\uff0c\u6bd4\u8fd9\u503c\u5c0f\uff0c\u7cfb\u7edf\u4e0d\u4f1a\u6302\u6389\u6216\u8005\u5f00\u542f\u81ea\u52a8\u4fdd\u62a4\u3002\u6bd4\u8fd9\u4e2a\u503c\u5927\uff0c\u7cfb\u7edf\u53ef\u80fd\u968f\u65f6\u4f1a\u6302\u6389\u6216\u5f00\u542f\u81ea\u52a8\u4fdd\u62a4\u3002\u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768495%\u3002 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: import time # \u7528\u4e8e\u5f00\u542f\u591a\u4e2a\u8fdb\u7a0b import subprocess # \u4f7f\u7528psutil\u8fdb\u884c\u8d44\u6e90\u76d1\u63a7\uff0c\u4e3b\u8981\u83b7\u53d6cpu\u4e0e\u5185\u5b58\u5360\u7528\u60c5\u51b5\u3002 import psutil # \u8bbe\u5b9aCPU\u4e0e\u5185\u5b58\u7684\u6b63\u5e38\u548c\u5371\u9669\u5360\u7528\u9608\u503c CPU_NOR_LIMIT = MEM_NOR_LIMIT = 55 CPU_DAN_LIMIT = MEM_DAN_LIMIT = 95 # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u5217\u8868 model_train_list = [\"python movie_model_train.py\", \"python beauty_model_train.py\"] # \u521b\u5efasubp\u7684\u5217\u8868\u5bb9\u5668\uff0c\u7528\u4e8e\u88c5\u8f7d\u5b50\u8fdb\u7a0b subp = [] def detect_cpu_mem(): \"\"\"\u68c0\u6d4bCPU\u548c\u5185\u5b58\u5360\u7528\u7387\"\"\" print(\"\u8fdb\u884cmem\u548ccpu\u68c0\u6d4b:\") # \u5185\u5b58\u68c0\u6d4b mem = psutil.virtual_memory().percent # psutil\u68c0\u6d4bcpu\u65f6\u95f4\u9694\u81f3\u5c113s\u4ee5\u4e0a cpu = psutil.cpu_percent(3) print(\"\u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:\" + str(mem) + \"%\") print(\"\u5f53\u524dCPU\u5360\u7528\u7387:\" + str(cpu) + \"%\") return mem, cpu def single_model_train(model): \"\"\"\u5f00\u542f\u5355\u4e2a\u6a21\u578b\u7684\u8bad\u7ec3\"\"\" p = subprocess.Popen(model, shell=True) # \u7b49\u5f853\u79d2\u9884\u4f30\u6a21\u578b\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\uff0c\u5373\u8d44\u6e90\u5360\u7528\u8d8b\u4e8e\u7a33\u5b9a\u3002 time.sleep(3) # \u8fdb\u884c\u8d44\u6e90\u68c0\u6d4b mem, cpu = detect_cpu_mem() # \u5185\u5b58\u548cCPU\u540c\u65f6\u5c0f\u4e8e\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u4efb\u5176\u7ee7\u7eed\u8fd0\u884c\uff0c\u5e76\u88c5\u5165\u5217\u8868 if mem < MEM_NOR_LIMIT and cpu < CPU_NOR_LIMIT: subp.append(p) print(\"\u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u5e76\u53ef\u4ee5\u5f00\u542f\u4e0b\u4e00\u6a21\u578b\u8bad\u7ec3\uff01\") else: # \u5224\u65ad\u662f\u5426\u5927\u4e8e\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u82e5\u5927\u4e8e\uff0c\u5c06kill\u8be5\u8fdb\u7a0b\uff0c # \u5426\u5219\u7b49\u5f85\u8be5\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u8fdb\u884c\u5176\u4ed6\u8bad\u7ec3\u4efb\u52a1\u3002 if mem > MEM_DAN_LIMIT or cpu > CPU_DAN_LIMIT: p.kill() print(\"\u8be5\u6a21\u578b\u6ca1\u6709\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b\uff01\") else: p.wait() print(\"\u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b, \u4f46\u4e0d\u8981\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3!\") def start_multiprocess_train(): \"\"\"\u5f00\u542f\u591a\u8fdb\u7a0b\u8bad\u7ec3\"\"\" print(\"\u542f\u52a8\u591a\u6a21\u578b\u8bad\u7ec3\uff1a\") # \u904d\u5386\u542f\u52a8\u6a21\u578b\u7684\u547d\u4ee4\uff0c\u51c6\u5907\u5faa\u73af\u5f00\u542f\u8bad\u7ec3\u8fdb\u7a0b for i, model in enumerate(model_train_list): print(\"__________________________\") print(\"\u6b63\u5728\u542f\u52a8\u7b2c\" + str(i+1) + \"\u4e2a\u6a21\u578b\uff1a\") # \u542f\u52a8\u6a21\u578b\u8bad\u7ec3 single_model_train(model) else: # \u6240\u6709\u88c5\u5165\u5217\u8868\u7684\u8fdb\u7a0b\u90fd\u4f1a\u7b49\u5f85\u5176\u81ea\u7136\u7ed3\u675f\u540e\u624d\u4f1a\u505c\u6b62\u8be5\u51fd\u6570\u6240\u5728\u7684\u8fdb\u7a0b print(\"\u6b63\u5728\u7b49\u5f85\u6240\u6709\u6a21\u578b\u8bad\u7ec3\u7ed3\u675f!\") list(map(lambda x: x.wait(), subp)) print(\"\u5b8c\u6210!\") \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multiprocess_train.py\u4e2d. \u51fd\u6570detect_cpu_mem(): \u8f93\u51fa\u6548\u679c: \u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:6.7% \u5f53\u524dCPU\u5360\u7528\u7387:0.5% \u51fd\u6570single_model_train(model): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u5217\u8868\u7684\u7b2c\u4e00\u9879 # \u76f8\u5f53\u4e8epython movie_model_train.py model = model_train_list[0] \u8f93\u51fa\u6548\u679c: # \u68c0\u6d4b\u5185\u5b58\u548ccpu\u5360\u7528\u7387, \u5e76\u6253\u5370\u811a\u672c\u6587\u4ef6movie_model_train.py\u7684\u6267\u884c\u5185\u5bb9. \u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:7.5% \u5f53\u524dCPU\u5360\u7528\u7387:25.1% \u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b, \u5e76\u53ef\u4ee5\u5f00\u542f\u4e0b\u4e00\u6a21\u578b\u8bad\u7ec3! Epoch 3/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.4098 - acc: 0.7996 - val_loss: 1.0321 - val_acc: 0.1647 Epoch 4/20 5299/5299 [==============================] - 7s 1ms/step - loss: 0.3190 - acc: 0.8517 - val_loss: 0.8503 - val_acc: 0.3124 Epoch 5/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.2384 - acc: 0.9109 - val_loss: 0.6873 - val_acc: 0.5025 Epoch 6/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.1781 - acc: 0.9504 - val_loss: 0.6238 - val_acc: 0.5756 Epoch 7/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.1359 - acc: 0.9711 - val_loss: 0.5465 - val_acc: 0.6401 \u51fd\u6570start_multiprocess_train(): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u6267\u884c\u547d\u4ee4\u5217\u8868 model_train_list = [\"python movie_model_train.py\", \"python beauty_model_train.py\"] \u8f93\u51fa\u6548\u679c: # \u68c0\u6d4b\u4e24\u4e2a\u6a21\u578b\u5171\u540c\u8bad\u7ec3\u662f\u7684\u5185\u5b58\u548ccpu\u5360\u7528\u60c5\u51b5 \u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:9.0% \u5f53\u524dCPU\u5360\u7528\u7387:93.1% ... \u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b, \u4f46\u4e0d\u8981\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3! \u6b63\u5728\u7b49\u5f85\u6240\u6709\u6a21\u578b\u8bad\u7ec3\u7ed3\u675f! \u5b8c\u6210! # \u4ea4\u66ff\u6253\u5370\u4e24\u4e2a\u6a21\u578b\u8bad\u7ec3\u6587\u4ef6\u7684\u6267\u884c\u5185\u5bb9 \u4e3b\u8981\u6ce8\u91ca: # \u7528\u4e8e\u5f00\u542f\u591a\u4e2a\u8fdb\u7a0b # \u4f7f\u7528psutil\u8fdb\u884c\u8d44\u6e90\u76d1\u63a7\uff0c\u4e3b\u8981\u83b7\u53d6cpu\u4e0e\u5185\u5b58\u5360\u7528\u60c5\u51b5\u3002 # \u8bbe\u5b9aCPU\u4e0e\u5185\u5b58\u7684\u6b63\u5e38\u548c\u5371\u9669\u5360\u7528\u9608\u503c # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u5217\u8868 # \u521b\u5efasubp\u7684\u5217\u8868\u5bb9\u5668\uff0c\u7528\u4e8e\u88c5\u8f7d\u5b50\u8fdb\u7a0b \"\"\"\u68c0\u6d4bCPU\u548c\u5185\u5b58\u5360\u7528\u7387\"\"\" # \u5185\u5b58\u68c0\u6d4b # psutil\u68c0\u6d4bcpu\u65f6\u95f4\u9694\u81f3\u5c113s\u4ee5\u4e0a \"\"\"\u5f00\u542f\u5355\u4e2a\u6a21\u578b\u7684\u8bad\u7ec3\"\"\" # \u7b49\u5f853\u79d2\u9884\u4f30\u6a21\u578b\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\uff0c\u5373\u8d44\u6e90\u5360\u7528\u8d8b\u4e8e\u7a33\u5b9a\u3002 # \u8fdb\u884c\u8d44\u6e90\u68c0\u6d4b # \u5185\u5b58\u548cCPU\u540c\u65f6\u5c0f\u4e8e\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u4efb\u5176\u7ee7\u7eed\u8fd0\u884c\uff0c\u5e76\u88c5\u5165\u5217\u8868 # \u5224\u65ad\u662f\u5426\u5927\u4e8e\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u82e5\u5927\u4e8e\uff0c\u5c06kill\u8be5\u8fdb\u7a0b\uff0c # \u5426\u5219\u7b49\u5f85\u8be5\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u8fdb\u884c\u5176\u4ed6\u8bad\u7ec3\u4efb\u52a1\u3002 \"\"\"\u5f00\u542f\u591a\u8fdb\u7a0b\u8bad\u7ec3\"\"\" # \u904d\u5386\u542f\u52a8\u6a21\u578b\u7684\u547d\u4ee4\uff0c\u51c6\u5907\u5faa\u73af\u5f00\u542f\u8bad\u7ec3\u8fdb\u7a0b # \u542f\u52a8\u6a21\u578b\u8bad\u7ec3 # \u6240\u6709\u88c5\u5165\u5217\u8868\u7684\u8fdb\u7a0b\u90fd\u4f1a\u7b49\u5f85\u5176\u81ea\u7136\u7ed3\u675f\u540e\u624d\u4f1a\u505c\u6b62\u8be5\u51fd\u6570\u6240\u5728\u7684\u8fdb\u7a0b \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u5c06star_model_train.py\u548cfashion_model_train.py\u7684\u6a21\u578b\u8bad\u7ec3\u811a\u672c\u547d\u4ee4\u653e\u5230model_train_list\u4e2d, \u518d\u8fdb\u884c\u4e00\u6b21\u591a\u8fdb\u7a0b\u5e76\u884c\u8bad\u7ec3, \u770b\u770b\u662f\u600e\u6837\u7684\u6548\u679c. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 \u5b66\u4e60\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a CPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c: \u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768455%\u3002 CPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c: \u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768495%\u3002 \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91: \u51fd\u6570: detect_cpu_mem \u51fd\u6570: single_model_train \u51fd\u6570: start_multiprocess_train 4.2 \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b \u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u8fdb\u884c\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u539f\u56e0. \u638c\u63e1\u5b9e\u73b0\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2. \u8fdb\u884c\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u539f\u56e0: \u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u7528\u6237\u7684\u6bcf\u6b21\u8bf7\u6c42\uff0c\u90fd\u6709\u53ef\u80fd\u8c03\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u800c\u4e32\u884c\u9884\u6d4b\u7684\u65b9\u5f0f\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u9884\u6d4b\u7684\u6027\u80fd\u8981\u6c42. \u8fd9\u5c31\u9700\u8981\u9884\u6d4b\u8fc7\u7a0b\u5fc5\u987b\u80fd\u591f\u5e76\u884c\u5316\uff0c\u5e76\u5f88\u5bb9\u6613\u7684\u6574\u5408\u5168\u90e8\u7684\u7ed3\u679c. \u6a21\u578b\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b, \u4e3a\u4ec0\u4e48\u6ca1\u6709\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd: \u867d\u7136\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\uff0c\u4f46\u662f\u6211\u4eec\u5bf9\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u8fdb\u884c\u4e86\u5c01\u88c5, \u4f7f\u5b83\u662f\u5728\u6a21\u578b\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c, \u800c\u6211\u4eec\u7ebf\u7a0b\u53ea\u662f\u8d1f\u8d23\u8c03\u7528\u670d\u52a1\u5e76\u6574\u5408\u7ed3\u679c\u800c\u5df2, \u56e0\u6b64\u4e0d\u4f1a\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd. \u5b9e\u73b0\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f. \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1. \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c. \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u8fc7\u7a0b\u7684\u4ee3\u7801: import time from keras import backend as K from keras.models import load_model from tensorflow.python.saved_model import builder as saved_model_builder from tensorflow.python.saved_model import signature_constants from tensorflow.python.saved_model import tag_constants from tensorflow.python.saved_model.signature_def_utils_impl import predict_signature_def def to_savedmodel(h5_model_path, pb_model_path): \"\"\"\u5c06h5\u6a21\u578b\u8f6c\u5316\u6210tensorflow\u7684pb\u683c\u5f0f\u6a21\u578b\"\"\" model = load_model(h5_model_path) builder = saved_model_builder.SavedModelBuilder(pb_model_path) signature = predict_signature_def( inputs={'input': model.inputs[0]}, outputs={'income': model.outputs[0]}) with K.get_session() as sess: builder.add_meta_graph_and_variables( sess=sess, tags=[tag_constants.SERVING], signature_def_map={ signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY: signature }) builder.save() \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py\u4e2d\u3002 \u8f93\u5165\u5b9e\u4f8b: # h5\u683c\u5f0f\u6a21\u578b\u4fdd\u5b58\u8def\u5f84 h5_model_path = \"./movie/model.h5\" # pb\u6a21\u578b\u5199\u5165\u8def\u5f84(\u5728\u4e00\u4e2a\u65f6\u95f4\u6233\u7684\u6587\u4ef6\u5939\u4e2d) time_ = str(int(time.time())) pb_model_path = \"./movie/\" + time_ \u8f93\u51fa\u6548\u679c: # \u5728./movie\u76ee\u5f55\u4e0b\u6709\u4e00\u4e2a\u65f6\u95f4\u6233\u6587\u4ef6\u5939, \u91cc\u9762\u662fpb\u6a21\u578b\u548c\u53c2\u6570\u6587\u4ef6 ./movie/1571482447 - saved_model.pb - ./variables \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5, \u5c06beauty, star, fashion\u4e2d\u5bf9\u5e94\u7684h5\u6a21\u578b\u8f6c\u5316\u4e3apb\u6a21\u578b, \u5728\u5bf9\u5e94\u7684\u6587\u4ef6\u4e2d\u751f\u6210\u4fdd\u5b58\u6a21\u578b\u7684\u65f6\u95f4\u6233\u6587\u4ef6\u5939. \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: MODEL_PATH=\"/data/django-uwsgi/text_labeled/model_train\" # \u4f7f\u7528docker run\u547d\u4ee4\u542f\u52a8\u5fae\u670d\u52a1 # \u542f\u52a8\u7b2c\u4e00\u4e2a\u6a21\u578b docker run -t --rm -p 8501:8501 \\ -v \"$MODEL_PATH/movie:/models/movie\" \\ -e MODEL_NAME=movie \\ tensorflow/serving & # \u540c\u7406\u542f\u52a8\uff0c \u542f\u52a8\u7b2c\u4e8c\u4e2a\u6a21\u578b docker run -t --rm -p 8502:8501 \\ -v \"$MODEL_PATH/beauty:/models/beauty\" \\ -e MODEL_NAME=beauty \\ tensorflow/serving & # \u66f4\u591a\u6a21\u578b\u4ee5\u6b64\u7c7b\u63a8 \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c, \u5199\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u3002 \u8bf7\u6c42\u5b9e\u4f8b: # \u4f7f\u7528curl\u547d\u4ee4\u5728\u7ec8\u7aef\u8fdb\u884c\u6d4b\u8bd5 curl -d '{\"instances\": [[1.0, 2.0, 5.0]]}' \\ -X POST http://localhost:8501/v1/models/movie:predict \u8f93\u51fa\u6548\u679c: # \u8be5\u6761\u6837\u672c\u4e3a\u6b63\u6837\u672c\u7684\u9884\u6d4b\u6982\u7387 { \"predictions\": [[1.0]] } \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u5fc5\u5907\u7684\u5de5\u5177\u5305 import json import threading import requests from sklearn.externals import joblib # \u4ece\u4efb\u610f\u7684\u6a21\u578b\u8bad\u7ec3\u6587\u4ef6\u4e2d\u5bfc\u5165add_ngram\u589e\u52a0n-gram\u7279\u5f81\u4ee5\u53capadding\u622a\u65ad\u51fd\u6570 from movie_model_train import add_ngram from movie_model_train import padding # \u5b9a\u4e49\u6a21\u578b\u914d\u7f6e\u8def\u5f84\uff0c\u5b83\u6307\u5411\u4e00\u4e2ajson\u6587\u4ef6 model_config_path = \"/data/django-uwsgi/text_labeled/model_train/model_config.json\" # model_config.json\u5f62\u5982 \uff1a # {\"\u5f71\u89c6\": [\"/data/django-uwsgi/text_labeled/model_train/movie/Tokenizer\", 60, 2, # \"/data/django-uwsgi/text_labeled/model_train/movie/token_indice\", 119, # \"http://localhost:8501/v1/models/movie:predict\"], # \"\u7f8e\u5986\": [\"/data/django-uwsgi/text_labeled/model_train/beauty/Tokenizer\", 75, 2, # \"/data/django-uwsgi/text_labeled/model_train/beauty/token_indice\", 119, # \"http://localhost:8502/v1/models/beauty:predict\"]} # json\u6587\u4ef6\u4e2d\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5b57\u5178\u4e2d\u7684\u6bcf\u4e2akey\u662f\u6211\u4eec\u6807\u7b7e\u7684\u4e2d\u6587\u5b57\u7b26\uff0c\u6bcf\u4e2avalue\u662f\u4e00\u4e2a\u5217\u8868\uff0c # \u5217\u8868\u7684\u7b2c\u4e00\u9879\u662f\u7279\u5f81\u5904\u7406\u8bcd\u6c47\u6620\u5c04\u5668\u7684\u5b58\u50a8\u5730\u5740 # \u7b2c\u4e8c\u9879\u662f\u7279\u5f81\u5904\u7406\u8bed\u6599\u7684\u622a\u65ad\u957f\u5ea6 # \u7b2c\u4e09\u9879\u662fn-gram\u53d6\u5f97n\u503c # \u7b2c\u56db\u9879\u662fn-gram\u7279\u5f81\u4e2dtoken_indice\u7684\u4fdd\u5b58\u8def\u5f84 # \u7b2c\u4e94\u9879\u662f\u6700\u540e\u7684\u6700\u5927\u7684\u5bf9\u9f50\u957f\u5ea6 # \u7b2c\u516d\u9879\u662f\u8be5\u6a21\u578b\u5bf9\u5e94\u7684\u5fae\u670d\u52a1\u5730\u5740 # \u6700\u7ec8\u7684\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868 model_prediction = [] def fea_process(word_list, config_list): \"\"\"\u5bf9\u8f93\u5165\u8fdb\u884c\u7c7b\u4f3c\u4e0e\u8bad\u7ec3\u524d\u7684\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\"\"\" # \u8bfb\u53d6\u8bbe\u5b9a\u597d\u7684\u914d\u7f6e tokenizer_path = config_list[0] cutlen = config_list[1] ngram_range = config_list[2] ti_path = config_list[3] maxlen = config_list[4] # \u52a0\u8f7d\u5206\u8bcd\u6620\u5c04\u5668 t = joblib.load(tokenizer_path) x_train = t.texts_to_sequences([word_list]) # \u8fdb\u884c\u622a\u65ad\u5bf9\u9f50 x_train = padding(x_train, cutlen) # \u83b7\u5f97n-gram\u6620\u5c04\u6587\u4ef6 with open(ti_path, \"r\") as f: token_indice = eval(f.read()) # \u6dfb\u52a0n-gram\u7279\u5f81 x_train = add_ngram(x_train, token_indice, ngram_range) # \u8fdb\u884c\u6700\u5927\u957f\u5ea6\u5bf9\u9f50 x_train = padding(x_train, maxlen) return x_train def pred(word_list, model): \"\"\"\u5411\u5355\u4e2a\u5fae\u670d\u52a1\u53d1\u9001\u9884\u6d4b\u8bf7\u6c42\"\"\" # \u5c06\u6301\u4e45\u5316\u7684\u6a21\u578b\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58 model_config = json.load(open(model_config_path, \"r\")) # \u6839\u636e\u540d\u5b57\u9009\u62e9\u5bf9\u5e94\u7684\u914d\u7f6e\u5217\u8868 config_list = model_config[model] # \u5bf9\u6570\u636e\u8fdb\u884c\u7279\u5f81\u5904\u7406 x_train = fea_process(word_list, config_list) # \u5c01\u88c5\u6210tf-serving\u9700\u8981\u7684\u6570\u636e\u4f53 data = {\"instances\": x_train.tolist()} # \u5411\u521a\u521a\u5c01\u88c5\u7684\u5fae\u670d\u52a1\u53d1\u9001\u8bf7\u6c42 res = requests.post(url=config_list[5], json=data) # \u5c06\u8be5\u7ebf\u7a0b\u4e2d\u83b7\u53d6\u7684\u7ed3\u679c\u653e\u5230\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868\u4e2d model_prediction.append([model, eval(res.text)[\"predictions\"][0][0]]) return res.text def request_model_serve(word_list, model_list): \"\"\"\u8be5\u51fd\u6570\u5f00\u542f\u591a\u7ebf\u7a0b\u8bf7\u6c42\u5c01\u88c5\u597d\u7684\u6a21\u578b\u5fae\u670d\u52a1\"\"\" def _start_thread(pred, x, y): \"\"\"\u5f00\u542f\u9884\u6d4b\u7ebf\u7a0b, \u4ee5\u7ebf\u7a0b\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\u548c\u51fd\u6570\u7684\u8f93\u5165\u4e3a\u53c2\u6570\"\"\" t = threading.Thread(target=pred, args=(x, y)) t.start() return t # \u904d\u5386model_list, \u8c03\u7528\u5f00\u542f\u7ebf\u7a0b\u51fd\u6570_start_thread\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u6240\u6709\u5f00\u542f\u540e\u7684\u7ebf\u7a0b\u5217\u8868 t_list = list(map(lambda model: _start_thread(pred, word_list, model), model_list)) # \u7ebf\u7a0b\u5c06\u9010\u4e00join\u64cd\u4f5c\u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u5b8c\u6210 t_list = list(map(lambda t: t.join(), t_list)) # \u6700\u540e\u8fc7\u6ee4\u6389\u6240\u6709\u6982\u7387\u9884\u6d4b\u5c0f\u4e8e0.5\u7684\u7c7b\u522b\uff0c\u8fd4\u56de\u7ed3\u679c result = list(filter(lambda x: x[1] >= 0.5, model_prediction)) return result \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py\u4e2d. \u51fd\u6570fea_process(word_list, config_list): \u8f93\u5165\u5b9e\u4f8b: # \u5206\u8bcd\u5217\u8868 word_list = [\"\u9738\u738b\u522b\u59ec\", \"\u662f\u4e00\u90e8\", \"\u975e\u5e38\", \"\u503c\u5f97\", \"\u770b\u7684\", \"\u7535\u5f71\"] config_list = [\"/data/django-uwsgi/text_labeled/model_train/movie/Tokenizer\", 60, 2, \"/data/django-uwsgi/text_labeled/model_train/movie/token_indice\", 119, \"http://localhost:8501/v1/models/movie:predict\"] \u8f93\u51fa\u6548\u679c: # \u901a\u8fc7\u7279\u5f81\u5904\u7406\u6d41\u7a0b\u7684\u77e9\u9635 [[ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 14196 23 748 1 40108]] \u51fd\u6570pred(word_list, model): \u8f93\u5165\u5b9e\u4f8b: # \u5206\u8bcd\u5217\u8868 word_list = [\"\u9738\u738b\u522b\u59ec\", \"\u662f\u4e00\u90e8\", \"\u975e\u5e38\", \"\u503c\u5f97\", \"\u770b\u7684\", \"\u7535\u5f71\"] # \u9884\u8bf7\u6c42\u7684\u6a21\u578b\u540d\u79f0 model = \"\u5f71\u89c6\" \u8f93\u51fa\u6548\u679c # \u53ea\u4f1a\u4ea7\u751f\u4e00\u4e2a\u5f71\u89c6\u7684\u6982\u7387 { \"predictions\": [[0.920291483]] } \u51fd\u6570request_model_serve(word_list, model_list): \u8f93\u5165\u5b9e\u4f8b: # \u5206\u8bcd\u5217\u8868 word_list = [\"\u9738\u738b\u522b\u59ec\", \"\u662f\u4e00\u90e8\", \"\u975e\u5e38\", \"\u503c\u5f97\", \"\u770b\u7684\", \"\u7535\u5f71\"] # \u9884\u8bf7\u6c42\u7684\u6a21\u578b\u5217\u8868 model_list = [\"\u5f71\u89c6\", \"\u7f8e\u5986\"] \u8f93\u51fa\u6548\u679c: # \u4f1a\u4ea7\u751f\u591a\u4e2a\u8bf7\u6c42\u6a21\u578b\u7684\u6982\u7387, \u4f46\u5c0f\u4e8e0.5\u6982\u7387\u7684\u4f1a\u88ab\u53bb\u9664 [['\u5f71\u89c6', 0.920291483]] \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u5fc5\u5907\u7684\u5de5\u5177\u5305 # \u4ece\u4efb\u610f\u7684\u6a21\u578b\u8bad\u7ec3\u6587\u4ef6\u4e2d\u5bfc\u5165add_ngram\u589e\u52a0n-gram\u7279\u5f81\u4ee5\u53capadding\u622a\u65ad\u51fd\u6570 # \u5b9a\u4e49\u6a21\u578b\u914d\u7f6e\u8def\u5f84\uff0c\u5b83\u6307\u5411\u4e00\u4e2ajson\u6587\u4ef6 # model_config.json\u5f62\u5982 \uff1a # {\"\u5f71\u89c6\": [\"/data/django-uwsgi/text_labeled/model_train/movie/Tokenizer\", 60, 2, # \"/data/django-uwsgi/text_labeled/model_train/movie/token_indice\", 119, # \"http://localhost:8501/v1/models/movie:predict\"], # \"\u7f8e\u5986\": [\"/data/django-uwsgi/text_labeled/model_train/beauty/Tokenizer\", 75, 2, # \"/data/django-uwsgi/text_labeled/model_train/beauty/token_indice\", 119, # \"http://localhost:8502/v1/models/beauty:predict\"]} # json\u6587\u4ef6\u4e2d\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5b57\u5178\u4e2d\u7684\u6bcf\u4e2akey\u662f\u6211\u4eec\u6807\u7b7e\u7684\u4e2d\u6587\u5b57\u7b26\uff0c\u6bcf\u4e2avalue\u662f\u4e00\u4e2a\u5217\u8868 # \u5217\u8868\u7684\u7b2c\u4e00\u9879\u662f\u7279\u5f81\u5904\u7406\u65f6\u8bcd\u6c47\u6620\u5c04\u5668\u7684\u5b58\u50a8\u5730\u5740 # \u7b2c\u4e8c\u9879\u662f\u7279\u5f81\u5904\u7406\u65f6\u8bed\u6599\u7684\u622a\u65ad\u957f\u5ea6 # \u7b2c\u4e09\u9879\u662fn-gram\u53d6\u5f97n\u503c # \u7b2c\u56db\u9879\u662fn-gram\u7279\u5f81\u4e2dtoken_indice\u7684\u4fdd\u5b58\u8def\u5f84 # \u7b2c\u4e94\u9879\u662f\u6700\u540e\u7684\u6700\u5927\u7684\u5bf9\u9f50\u957f\u5ea6 # \u7b2c\u516d\u9879\u662f\u8be5\u6a21\u578b\u5bf9\u5e94\u7684\u5fae\u670d\u52a1\u5730\u5740 # \u6700\u7ec8\u7684\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868 \"\"\"\u5bf9\u8f93\u5165\u8fdb\u884c\u7c7b\u4f3c\u4e0e\u8bad\u7ec3\u524d\u7684\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\"\"\" # \u8bfb\u53d6\u8bbe\u5b9a\u597d\u7684\u914d\u7f6e # \u52a0\u8f7d\u5206\u8bcd\u6620\u5c04\u5668 # \u8fdb\u884c\u622a\u65ad\u5bf9\u9f50 # \u83b7\u5f97n-gram\u6620\u5c04\u6587\u4ef6 # \u6dfb\u52a0n-gram\u7279\u5f81 # \u8fdb\u884c\u6700\u5927\u957f\u5ea6\u5bf9\u9f50 \"\"\"\u5411\u5355\u4e2a\u5fae\u670d\u52a1\u53d1\u9001\u9884\u6d4b\u8bf7\u6c42\"\"\" # \u5c06\u6301\u4e45\u5316\u7684\u6a21\u578b\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58 # \u6839\u636e\u540d\u5b57\u9009\u62e9\u5bf9\u5e94\u7684\u914d\u7f6e\u5217\u8868 # \u5bf9\u6570\u636e\u8fdb\u884c\u7279\u5f81\u5904\u7406 # \u5c01\u88c5\u6210tf-serving\u9700\u8981\u7684\u6570\u636e\u4f53 # \u5411\u521a\u521a\u5c01\u88c5\u7684\u5fae\u670d\u52a1\u53d1\u9001\u8bf7\u6c42 # \u5c06\u8be5\u7ebf\u7a0b\u4e2d\u83b7\u53d6\u7684\u7ed3\u679c\u653e\u5230\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868\u4e2d \"\"\"\u8be5\u51fd\u6570\u5f00\u542f\u591a\u7ebf\u7a0b\u8bf7\u6c42\u5c01\u88c5\u597d\u7684\u6a21\u578b\u5fae\u670d\u52a1\"\"\" \"\"\"\u5f00\u542f\u9884\u6d4b\u7ebf\u7a0b, \u4ee5\u7ebf\u7a0b\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\u548c\u51fd\u6570\u7684\u8f93\u5165\u4e3a\u53c2\u6570\"\"\" # \u904d\u5386model_list, \u8c03\u7528\u5f00\u542f\u7ebf\u7a0b\u51fd\u6570_start_thread\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u6240\u6709\u5f00\u542f\u540e\u7684\u7ebf\u7a0b\u5217\u8868 # \u7ebf\u7a0b\u5c06\u9010\u4e00join\u64cd\u4f5c\u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u5b8c\u6210 # \u6700\u540e\u8fc7\u6ee4\u6389\u6240\u6709\u6982\u7387\u9884\u6d4b\u5c0f\u4e8e0.5\u7684\u7c7b\u522b\uff0c\u8fd4\u56de\u7ed3\u679c \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u8fdb\u884c\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u539f\u56e0: \u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u7528\u6237\u7684\u6bcf\u6b21\u8bf7\u6c42\uff0c\u90fd\u6709\u53ef\u80fd\u8c03\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u800c\u4e32\u884c\u9884\u6d4b\u7684\u65b9\u5f0f\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u9884\u6d4b\u7684\u6027\u80fd\u8981\u6c42. \u8fd9\u5c31\u9700\u8981\u9884\u6d4b\u8fc7\u7a0b\u5fc5\u987b\u80fd\u591f\u5e76\u884c\u5316\uff0c\u5e76\u5f88\u5bb9\u6613\u7684\u6574\u5408\u5168\u90e8\u7684\u7ed3\u679c. \u6a21\u578b\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b, \u4e3a\u4ec0\u4e48\u6ca1\u6709\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd? \u867d\u7136\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\uff0c\u4f46\u662f\u6211\u4eec\u5bf9\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u8fdb\u884c\u4e86\u5c01\u88c5, \u4f7f\u5b83\u662f\u5728\u6a21\u578b\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c, \u800c\u6211\u4eec\u7ebf\u7a0b\u53ea\u662f\u8d1f\u8d23\u8c03\u7528\u670d\u52a1\u5e76\u6574\u5408\u7ed3\u679c\u800c\u5df2, \u56e0\u6b64\u4e0d\u4f1a\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u3002 \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u3002 \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u51fd\u6570: to_savedmodel \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1: docker run\u547d\u4ee4 \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c: \u51fd\u6570: fea_process \u51fd\u6570: pred \u51fd\u6570: request_model_serve \u672c\u7ae0\u603b\u7ed3 \u7b2c\u4e00\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 \u5b66\u4e60\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u7b2c\u4e8c\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u3002 \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u3002","title":"\u7b2c\u56db\u7ae0:\u591a\u6a21\u578b\u8bad\u7ec3\u4e0e\u9884\u6d4b"},{"location":"4/#_1","text":"\u5b66\u4e60\u76ee\u6807: \u5b66\u4f1a\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fdb\u884c\u591a\u6a21\u578b\u8bad\u7ec3\u3002 \u5b66\u4f1a\u4f7f\u7528tensorflow-serving\u5c06\u6a21\u578b\u5c01\u88c5\u6210\u5fae\u670d\u52a1\uff0c\u5e76\u4f7f\u7528\u591a\u7ebf\u7a0b\u8c03\u7528\u3002 \u5f15\u5bfc\u5206\u6790: \u56e0\u4e3a\u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u5c06\u4f7f\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u7c7b\u522b\u9884\u6d4b\u4ee5\u63d0\u5347\u51c6\u786e\u7387, \u6240\u4ee5\u4f1a\u4ea7\u751f\u548c\u7ef4\u62a4\u5927\u91cf\u7684\u6a21\u578b\uff0c\u56e0\u6b64\u5982\u4f55\u5229\u7528\u73b0\u6709\u8d44\u6e90\u63d0\u5347\u6a21\u578b\u7684\u8bad\u7ec3\u6548\u7387\u6210\u4e3a\u4e00\u4e2a\u95ee\u9898\u3002\u800c\u5728python\u4e2d\uff0c\u591a\u8fdb\u7a0b\u662f\u89e3\u51b3\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\u5e76\u884c\u5316\u7684\u6700\u4f18\u65b9\u6cd5\u3002 \u540c\u6837\u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u7528\u6237\u7684\u6bcf\u6b21\u8bf7\u6c42\uff0c\u90fd\u6709\u53ef\u80fd\u8c03\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u800c\u4e32\u884c\u9884\u6d4b\u7684\u65b9\u5f0f\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u9884\u6d4b\u7684\u6027\u80fd\u8981\u6c42\u3002\u56e0\u6b64\u9884\u6d4b\u8fc7\u7a0b\u5fc5\u987b\u80fd\u591f\u5e76\u884c\u5316\uff0c\u5e76\u5f88\u5bb9\u6613\u7684\u6574\u5408\u5168\u90e8\u7684\u7ed3\u679c. \u4f7f\u7528\u591a\u7ebf\u7a0b\u53d1\u9001\u8bf7\u6c42\uff0c\u9884\u6d4b\u8fc7\u7a0b\u867d\u7136\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\uff0c\u4f46\u662f\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u662f\u5728\u6a21\u578b\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c\u7684\u3002 \u672c\u7ae0\u5c0f\u8282: 4.1 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3 \u5b66\u4e60\u5982\u4f55\u5145\u5206\u5229\u7528\u8ba1\u7b97\u8d44\u6e90\uff0c\u63d0\u5347\u6a21\u578b\u8bad\u7ec3\u6548\u7387, \u5c06\u4f7f\u7528\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8fdb\u884c\u8bad\u7ec3. 4.2 \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b \u5b66\u4e60\u5982\u4f55\u4ee5\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u8fdb\u884c\u8c03\u7528\u5c01\u88c5\u7684\u6a21\u578b\u5fae\u670d\u52a1.","title":"\u672c\u7ae0\u5bfc\u5b66"},{"location":"4/#41","text":"\u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0\u3002 \u638c\u63e1\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\u5e76\u5b9e\u73b0\u5b83\u3002 \u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 CPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff1a \u662f\u6307\u6211\u4eec\u7684CPU/\u5185\u5b58\u6b63\u5e38\u5de5\u4f5c\u65f6\u5360\u7528\u7387\uff0c\u6bd4\u8fd9\u4e2a\u503c\u5c0f\uff0c\u8bf4\u660e\u6211\u4eec\u7684CPU/\u5185\u5b58\u5de5\u4f5c\u5f88\u8f7b\u677e\uff0c\u6bd4\u8fd9\u4e2a\u503c\u5927\uff0c\u8bf4\u660e\u5de5\u4f5c\u8d77\u6765\u5df2\u7ecf\u5f88\u52b3\u7d2f\u4e86\uff0c\u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768455%\u3002 CPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c: \u662f\u6307\u6211\u4eec\u7684CPU/\u5185\u5b58\u5371\u9669\u5de5\u4f5c\u65f6\u7684\u5360\u7528\u7387\uff0c\u6bd4\u8fd9\u503c\u5c0f\uff0c\u7cfb\u7edf\u4e0d\u4f1a\u6302\u6389\u6216\u8005\u5f00\u542f\u81ea\u52a8\u4fdd\u62a4\u3002\u6bd4\u8fd9\u4e2a\u503c\u5927\uff0c\u7cfb\u7edf\u53ef\u80fd\u968f\u65f6\u4f1a\u6302\u6389\u6216\u5f00\u542f\u81ea\u52a8\u4fdd\u62a4\u3002\u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768495%\u3002 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790\u8fc7\u7a0b: import time # \u7528\u4e8e\u5f00\u542f\u591a\u4e2a\u8fdb\u7a0b import subprocess # \u4f7f\u7528psutil\u8fdb\u884c\u8d44\u6e90\u76d1\u63a7\uff0c\u4e3b\u8981\u83b7\u53d6cpu\u4e0e\u5185\u5b58\u5360\u7528\u60c5\u51b5\u3002 import psutil # \u8bbe\u5b9aCPU\u4e0e\u5185\u5b58\u7684\u6b63\u5e38\u548c\u5371\u9669\u5360\u7528\u9608\u503c CPU_NOR_LIMIT = MEM_NOR_LIMIT = 55 CPU_DAN_LIMIT = MEM_DAN_LIMIT = 95 # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u5217\u8868 model_train_list = [\"python movie_model_train.py\", \"python beauty_model_train.py\"] # \u521b\u5efasubp\u7684\u5217\u8868\u5bb9\u5668\uff0c\u7528\u4e8e\u88c5\u8f7d\u5b50\u8fdb\u7a0b subp = [] def detect_cpu_mem(): \"\"\"\u68c0\u6d4bCPU\u548c\u5185\u5b58\u5360\u7528\u7387\"\"\" print(\"\u8fdb\u884cmem\u548ccpu\u68c0\u6d4b:\") # \u5185\u5b58\u68c0\u6d4b mem = psutil.virtual_memory().percent # psutil\u68c0\u6d4bcpu\u65f6\u95f4\u9694\u81f3\u5c113s\u4ee5\u4e0a cpu = psutil.cpu_percent(3) print(\"\u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:\" + str(mem) + \"%\") print(\"\u5f53\u524dCPU\u5360\u7528\u7387:\" + str(cpu) + \"%\") return mem, cpu def single_model_train(model): \"\"\"\u5f00\u542f\u5355\u4e2a\u6a21\u578b\u7684\u8bad\u7ec3\"\"\" p = subprocess.Popen(model, shell=True) # \u7b49\u5f853\u79d2\u9884\u4f30\u6a21\u578b\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\uff0c\u5373\u8d44\u6e90\u5360\u7528\u8d8b\u4e8e\u7a33\u5b9a\u3002 time.sleep(3) # \u8fdb\u884c\u8d44\u6e90\u68c0\u6d4b mem, cpu = detect_cpu_mem() # \u5185\u5b58\u548cCPU\u540c\u65f6\u5c0f\u4e8e\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u4efb\u5176\u7ee7\u7eed\u8fd0\u884c\uff0c\u5e76\u88c5\u5165\u5217\u8868 if mem < MEM_NOR_LIMIT and cpu < CPU_NOR_LIMIT: subp.append(p) print(\"\u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b\uff0c\u5e76\u53ef\u4ee5\u5f00\u542f\u4e0b\u4e00\u6a21\u578b\u8bad\u7ec3\uff01\") else: # \u5224\u65ad\u662f\u5426\u5927\u4e8e\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u82e5\u5927\u4e8e\uff0c\u5c06kill\u8be5\u8fdb\u7a0b\uff0c # \u5426\u5219\u7b49\u5f85\u8be5\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u8fdb\u884c\u5176\u4ed6\u8bad\u7ec3\u4efb\u52a1\u3002 if mem > MEM_DAN_LIMIT or cpu > CPU_DAN_LIMIT: p.kill() print(\"\u8be5\u6a21\u578b\u6ca1\u6709\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b\uff01\") else: p.wait() print(\"\u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b, \u4f46\u4e0d\u8981\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3!\") def start_multiprocess_train(): \"\"\"\u5f00\u542f\u591a\u8fdb\u7a0b\u8bad\u7ec3\"\"\" print(\"\u542f\u52a8\u591a\u6a21\u578b\u8bad\u7ec3\uff1a\") # \u904d\u5386\u542f\u52a8\u6a21\u578b\u7684\u547d\u4ee4\uff0c\u51c6\u5907\u5faa\u73af\u5f00\u542f\u8bad\u7ec3\u8fdb\u7a0b for i, model in enumerate(model_train_list): print(\"__________________________\") print(\"\u6b63\u5728\u542f\u52a8\u7b2c\" + str(i+1) + \"\u4e2a\u6a21\u578b\uff1a\") # \u542f\u52a8\u6a21\u578b\u8bad\u7ec3 single_model_train(model) else: # \u6240\u6709\u88c5\u5165\u5217\u8868\u7684\u8fdb\u7a0b\u90fd\u4f1a\u7b49\u5f85\u5176\u81ea\u7136\u7ed3\u675f\u540e\u624d\u4f1a\u505c\u6b62\u8be5\u51fd\u6570\u6240\u5728\u7684\u8fdb\u7a0b print(\"\u6b63\u5728\u7b49\u5f85\u6240\u6709\u6a21\u578b\u8bad\u7ec3\u7ed3\u675f!\") list(map(lambda x: x.wait(), subp)) print(\"\u5b8c\u6210!\") \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multiprocess_train.py\u4e2d. \u51fd\u6570detect_cpu_mem(): \u8f93\u51fa\u6548\u679c: \u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:6.7% \u5f53\u524dCPU\u5360\u7528\u7387:0.5% \u51fd\u6570single_model_train(model): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u5217\u8868\u7684\u7b2c\u4e00\u9879 # \u76f8\u5f53\u4e8epython movie_model_train.py model = model_train_list[0] \u8f93\u51fa\u6548\u679c: # \u68c0\u6d4b\u5185\u5b58\u548ccpu\u5360\u7528\u7387, \u5e76\u6253\u5370\u811a\u672c\u6587\u4ef6movie_model_train.py\u7684\u6267\u884c\u5185\u5bb9. \u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:7.5% \u5f53\u524dCPU\u5360\u7528\u7387:25.1% \u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b, \u5e76\u53ef\u4ee5\u5f00\u542f\u4e0b\u4e00\u6a21\u578b\u8bad\u7ec3! Epoch 3/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.4098 - acc: 0.7996 - val_loss: 1.0321 - val_acc: 0.1647 Epoch 4/20 5299/5299 [==============================] - 7s 1ms/step - loss: 0.3190 - acc: 0.8517 - val_loss: 0.8503 - val_acc: 0.3124 Epoch 5/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.2384 - acc: 0.9109 - val_loss: 0.6873 - val_acc: 0.5025 Epoch 6/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.1781 - acc: 0.9504 - val_loss: 0.6238 - val_acc: 0.5756 Epoch 7/20 5299/5299 [==============================] - 6s 1ms/step - loss: 0.1359 - acc: 0.9711 - val_loss: 0.5465 - val_acc: 0.6401 \u51fd\u6570start_multiprocess_train(): \u8f93\u5165\u5b9e\u4f8b: # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u6267\u884c\u547d\u4ee4\u5217\u8868 model_train_list = [\"python movie_model_train.py\", \"python beauty_model_train.py\"] \u8f93\u51fa\u6548\u679c: # \u68c0\u6d4b\u4e24\u4e2a\u6a21\u578b\u5171\u540c\u8bad\u7ec3\u662f\u7684\u5185\u5b58\u548ccpu\u5360\u7528\u60c5\u51b5 \u5f53\u524d\u5185\u5b58\u5360\u7528\u7387:9.0% \u5f53\u524dCPU\u5360\u7528\u7387:93.1% ... \u8be5\u6a21\u578b\u8fdb\u5165\u6b63\u5e38\u8bad\u7ec3\u8fc7\u7a0b, \u4f46\u4e0d\u8981\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3! \u6b63\u5728\u7b49\u5f85\u6240\u6709\u6a21\u578b\u8bad\u7ec3\u7ed3\u675f! \u5b8c\u6210! # \u4ea4\u66ff\u6253\u5370\u4e24\u4e2a\u6a21\u578b\u8bad\u7ec3\u6587\u4ef6\u7684\u6267\u884c\u5185\u5bb9 \u4e3b\u8981\u6ce8\u91ca: # \u7528\u4e8e\u5f00\u542f\u591a\u4e2a\u8fdb\u7a0b # \u4f7f\u7528psutil\u8fdb\u884c\u8d44\u6e90\u76d1\u63a7\uff0c\u4e3b\u8981\u83b7\u53d6cpu\u4e0e\u5185\u5b58\u5360\u7528\u60c5\u51b5\u3002 # \u8bbe\u5b9aCPU\u4e0e\u5185\u5b58\u7684\u6b63\u5e38\u548c\u5371\u9669\u5360\u7528\u9608\u503c # \u6a21\u578b\u8bad\u7ec3\u811a\u672c\u5217\u8868 # \u521b\u5efasubp\u7684\u5217\u8868\u5bb9\u5668\uff0c\u7528\u4e8e\u88c5\u8f7d\u5b50\u8fdb\u7a0b \"\"\"\u68c0\u6d4bCPU\u548c\u5185\u5b58\u5360\u7528\u7387\"\"\" # \u5185\u5b58\u68c0\u6d4b # psutil\u68c0\u6d4bcpu\u65f6\u95f4\u9694\u81f3\u5c113s\u4ee5\u4e0a \"\"\"\u5f00\u542f\u5355\u4e2a\u6a21\u578b\u7684\u8bad\u7ec3\"\"\" # \u7b49\u5f853\u79d2\u9884\u4f30\u6a21\u578b\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\uff0c\u5373\u8d44\u6e90\u5360\u7528\u8d8b\u4e8e\u7a33\u5b9a\u3002 # \u8fdb\u884c\u8d44\u6e90\u68c0\u6d4b # \u5185\u5b58\u548cCPU\u540c\u65f6\u5c0f\u4e8e\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u4efb\u5176\u7ee7\u7eed\u8fd0\u884c\uff0c\u5e76\u88c5\u5165\u5217\u8868 # \u5224\u65ad\u662f\u5426\u5927\u4e8e\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u82e5\u5927\u4e8e\uff0c\u5c06kill\u8be5\u8fdb\u7a0b\uff0c # \u5426\u5219\u7b49\u5f85\u8be5\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u8fdb\u884c\u5176\u4ed6\u8bad\u7ec3\u4efb\u52a1\u3002 \"\"\"\u5f00\u542f\u591a\u8fdb\u7a0b\u8bad\u7ec3\"\"\" # \u904d\u5386\u542f\u52a8\u6a21\u578b\u7684\u547d\u4ee4\uff0c\u51c6\u5907\u5faa\u73af\u5f00\u542f\u8bad\u7ec3\u8fdb\u7a0b # \u542f\u52a8\u6a21\u578b\u8bad\u7ec3 # \u6240\u6709\u88c5\u5165\u5217\u8868\u7684\u8fdb\u7a0b\u90fd\u4f1a\u7b49\u5f85\u5176\u81ea\u7136\u7ed3\u675f\u540e\u624d\u4f1a\u505c\u6b62\u8be5\u51fd\u6570\u6240\u5728\u7684\u8fdb\u7a0b \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u4eec\u5c06star_model_train.py\u548cfashion_model_train.py\u7684\u6a21\u578b\u8bad\u7ec3\u811a\u672c\u547d\u4ee4\u653e\u5230model_train_list\u4e2d, \u518d\u8fdb\u884c\u4e00\u6b21\u591a\u8fdb\u7a0b\u5e76\u884c\u8bad\u7ec3, \u770b\u770b\u662f\u600e\u6837\u7684\u6548\u679c. \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 \u5b66\u4e60\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a CPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c: \u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768455%\u3002 CPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c: \u4e00\u822c\u53d6CPU/\u5185\u5b58\u5360\u7528\u7387\u768495%\u3002 \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91: \u51fd\u6570: detect_cpu_mem \u51fd\u6570: single_model_train \u51fd\u6570: start_multiprocess_train","title":"4.1 \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3"},{"location":"4/#42","text":"\u5b66\u4e60\u76ee\u6807: \u77e5\u9053\u8fdb\u884c\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u539f\u56e0. \u638c\u63e1\u5b9e\u73b0\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2. \u8fdb\u884c\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u539f\u56e0: \u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u7528\u6237\u7684\u6bcf\u6b21\u8bf7\u6c42\uff0c\u90fd\u6709\u53ef\u80fd\u8c03\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u800c\u4e32\u884c\u9884\u6d4b\u7684\u65b9\u5f0f\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u9884\u6d4b\u7684\u6027\u80fd\u8981\u6c42. \u8fd9\u5c31\u9700\u8981\u9884\u6d4b\u8fc7\u7a0b\u5fc5\u987b\u80fd\u591f\u5e76\u884c\u5316\uff0c\u5e76\u5f88\u5bb9\u6613\u7684\u6574\u5408\u5168\u90e8\u7684\u7ed3\u679c. \u6a21\u578b\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b, \u4e3a\u4ec0\u4e48\u6ca1\u6709\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd: \u867d\u7136\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\uff0c\u4f46\u662f\u6211\u4eec\u5bf9\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u8fdb\u884c\u4e86\u5c01\u88c5, \u4f7f\u5b83\u662f\u5728\u6a21\u578b\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c, \u800c\u6211\u4eec\u7ebf\u7a0b\u53ea\u662f\u8d1f\u8d23\u8c03\u7528\u670d\u52a1\u5e76\u6574\u5408\u7ed3\u679c\u800c\u5df2, \u56e0\u6b64\u4e0d\u4f1a\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd. \u5b9e\u73b0\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f. \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1. \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c. \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u8fc7\u7a0b\u7684\u4ee3\u7801: import time from keras import backend as K from keras.models import load_model from tensorflow.python.saved_model import builder as saved_model_builder from tensorflow.python.saved_model import signature_constants from tensorflow.python.saved_model import tag_constants from tensorflow.python.saved_model.signature_def_utils_impl import predict_signature_def def to_savedmodel(h5_model_path, pb_model_path): \"\"\"\u5c06h5\u6a21\u578b\u8f6c\u5316\u6210tensorflow\u7684pb\u683c\u5f0f\u6a21\u578b\"\"\" model = load_model(h5_model_path) builder = saved_model_builder.SavedModelBuilder(pb_model_path) signature = predict_signature_def( inputs={'input': model.inputs[0]}, outputs={'income': model.outputs[0]}) with K.get_session() as sess: builder.add_meta_graph_and_variables( sess=sess, tags=[tag_constants.SERVING], signature_def_map={ signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY: signature }) builder.save() \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py\u4e2d\u3002 \u8f93\u5165\u5b9e\u4f8b: # h5\u683c\u5f0f\u6a21\u578b\u4fdd\u5b58\u8def\u5f84 h5_model_path = \"./movie/model.h5\" # pb\u6a21\u578b\u5199\u5165\u8def\u5f84(\u5728\u4e00\u4e2a\u65f6\u95f4\u6233\u7684\u6587\u4ef6\u5939\u4e2d) time_ = str(int(time.time())) pb_model_path = \"./movie/\" + time_ \u8f93\u51fa\u6548\u679c: # \u5728./movie\u76ee\u5f55\u4e0b\u6709\u4e00\u4e2a\u65f6\u95f4\u6233\u6587\u4ef6\u5939, \u91cc\u9762\u662fpb\u6a21\u578b\u548c\u53c2\u6570\u6587\u4ef6 ./movie/1571482447 - saved_model.pb - ./variables \u7ec3\u4e00\u7ec3: \u8bf7\u540c\u5b66\u6309\u7167\u4e0a\u9762\u7684\u65b9\u6cd5, \u5c06beauty, star, fashion\u4e2d\u5bf9\u5e94\u7684h5\u6a21\u578b\u8f6c\u5316\u4e3apb\u6a21\u578b, \u5728\u5bf9\u5e94\u7684\u6587\u4ef6\u4e2d\u751f\u6210\u4fdd\u5b58\u6a21\u578b\u7684\u65f6\u95f4\u6233\u6587\u4ef6\u5939. \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: MODEL_PATH=\"/data/django-uwsgi/text_labeled/model_train\" # \u4f7f\u7528docker run\u547d\u4ee4\u542f\u52a8\u5fae\u670d\u52a1 # \u542f\u52a8\u7b2c\u4e00\u4e2a\u6a21\u578b docker run -t --rm -p 8501:8501 \\ -v \"$MODEL_PATH/movie:/models/movie\" \\ -e MODEL_NAME=movie \\ tensorflow/serving & # \u540c\u7406\u542f\u52a8\uff0c \u542f\u52a8\u7b2c\u4e8c\u4e2a\u6a21\u578b docker run -t --rm -p 8502:8501 \\ -v \"$MODEL_PATH/beauty:/models/beauty\" \\ -e MODEL_NAME=beauty \\ tensorflow/serving & # \u66f4\u591a\u6a21\u578b\u4ee5\u6b64\u7c7b\u63a8 \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c, \u5199\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b\u3002 \u8bf7\u6c42\u5b9e\u4f8b: # \u4f7f\u7528curl\u547d\u4ee4\u5728\u7ec8\u7aef\u8fdb\u884c\u6d4b\u8bd5 curl -d '{\"instances\": [[1.0, 2.0, 5.0]]}' \\ -X POST http://localhost:8501/v1/models/movie:predict \u8f93\u51fa\u6548\u679c: # \u8be5\u6761\u6837\u672c\u4e3a\u6b63\u6837\u672c\u7684\u9884\u6d4b\u6982\u7387 { \"predictions\": [[1.0]] } \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: # \u5bfc\u5165\u5fc5\u5907\u7684\u5de5\u5177\u5305 import json import threading import requests from sklearn.externals import joblib # \u4ece\u4efb\u610f\u7684\u6a21\u578b\u8bad\u7ec3\u6587\u4ef6\u4e2d\u5bfc\u5165add_ngram\u589e\u52a0n-gram\u7279\u5f81\u4ee5\u53capadding\u622a\u65ad\u51fd\u6570 from movie_model_train import add_ngram from movie_model_train import padding # \u5b9a\u4e49\u6a21\u578b\u914d\u7f6e\u8def\u5f84\uff0c\u5b83\u6307\u5411\u4e00\u4e2ajson\u6587\u4ef6 model_config_path = \"/data/django-uwsgi/text_labeled/model_train/model_config.json\" # model_config.json\u5f62\u5982 \uff1a # {\"\u5f71\u89c6\": [\"/data/django-uwsgi/text_labeled/model_train/movie/Tokenizer\", 60, 2, # \"/data/django-uwsgi/text_labeled/model_train/movie/token_indice\", 119, # \"http://localhost:8501/v1/models/movie:predict\"], # \"\u7f8e\u5986\": [\"/data/django-uwsgi/text_labeled/model_train/beauty/Tokenizer\", 75, 2, # \"/data/django-uwsgi/text_labeled/model_train/beauty/token_indice\", 119, # \"http://localhost:8502/v1/models/beauty:predict\"]} # json\u6587\u4ef6\u4e2d\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5b57\u5178\u4e2d\u7684\u6bcf\u4e2akey\u662f\u6211\u4eec\u6807\u7b7e\u7684\u4e2d\u6587\u5b57\u7b26\uff0c\u6bcf\u4e2avalue\u662f\u4e00\u4e2a\u5217\u8868\uff0c # \u5217\u8868\u7684\u7b2c\u4e00\u9879\u662f\u7279\u5f81\u5904\u7406\u8bcd\u6c47\u6620\u5c04\u5668\u7684\u5b58\u50a8\u5730\u5740 # \u7b2c\u4e8c\u9879\u662f\u7279\u5f81\u5904\u7406\u8bed\u6599\u7684\u622a\u65ad\u957f\u5ea6 # \u7b2c\u4e09\u9879\u662fn-gram\u53d6\u5f97n\u503c # \u7b2c\u56db\u9879\u662fn-gram\u7279\u5f81\u4e2dtoken_indice\u7684\u4fdd\u5b58\u8def\u5f84 # \u7b2c\u4e94\u9879\u662f\u6700\u540e\u7684\u6700\u5927\u7684\u5bf9\u9f50\u957f\u5ea6 # \u7b2c\u516d\u9879\u662f\u8be5\u6a21\u578b\u5bf9\u5e94\u7684\u5fae\u670d\u52a1\u5730\u5740 # \u6700\u7ec8\u7684\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868 model_prediction = [] def fea_process(word_list, config_list): \"\"\"\u5bf9\u8f93\u5165\u8fdb\u884c\u7c7b\u4f3c\u4e0e\u8bad\u7ec3\u524d\u7684\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\"\"\" # \u8bfb\u53d6\u8bbe\u5b9a\u597d\u7684\u914d\u7f6e tokenizer_path = config_list[0] cutlen = config_list[1] ngram_range = config_list[2] ti_path = config_list[3] maxlen = config_list[4] # \u52a0\u8f7d\u5206\u8bcd\u6620\u5c04\u5668 t = joblib.load(tokenizer_path) x_train = t.texts_to_sequences([word_list]) # \u8fdb\u884c\u622a\u65ad\u5bf9\u9f50 x_train = padding(x_train, cutlen) # \u83b7\u5f97n-gram\u6620\u5c04\u6587\u4ef6 with open(ti_path, \"r\") as f: token_indice = eval(f.read()) # \u6dfb\u52a0n-gram\u7279\u5f81 x_train = add_ngram(x_train, token_indice, ngram_range) # \u8fdb\u884c\u6700\u5927\u957f\u5ea6\u5bf9\u9f50 x_train = padding(x_train, maxlen) return x_train def pred(word_list, model): \"\"\"\u5411\u5355\u4e2a\u5fae\u670d\u52a1\u53d1\u9001\u9884\u6d4b\u8bf7\u6c42\"\"\" # \u5c06\u6301\u4e45\u5316\u7684\u6a21\u578b\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58 model_config = json.load(open(model_config_path, \"r\")) # \u6839\u636e\u540d\u5b57\u9009\u62e9\u5bf9\u5e94\u7684\u914d\u7f6e\u5217\u8868 config_list = model_config[model] # \u5bf9\u6570\u636e\u8fdb\u884c\u7279\u5f81\u5904\u7406 x_train = fea_process(word_list, config_list) # \u5c01\u88c5\u6210tf-serving\u9700\u8981\u7684\u6570\u636e\u4f53 data = {\"instances\": x_train.tolist()} # \u5411\u521a\u521a\u5c01\u88c5\u7684\u5fae\u670d\u52a1\u53d1\u9001\u8bf7\u6c42 res = requests.post(url=config_list[5], json=data) # \u5c06\u8be5\u7ebf\u7a0b\u4e2d\u83b7\u53d6\u7684\u7ed3\u679c\u653e\u5230\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868\u4e2d model_prediction.append([model, eval(res.text)[\"predictions\"][0][0]]) return res.text def request_model_serve(word_list, model_list): \"\"\"\u8be5\u51fd\u6570\u5f00\u542f\u591a\u7ebf\u7a0b\u8bf7\u6c42\u5c01\u88c5\u597d\u7684\u6a21\u578b\u5fae\u670d\u52a1\"\"\" def _start_thread(pred, x, y): \"\"\"\u5f00\u542f\u9884\u6d4b\u7ebf\u7a0b, \u4ee5\u7ebf\u7a0b\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\u548c\u51fd\u6570\u7684\u8f93\u5165\u4e3a\u53c2\u6570\"\"\" t = threading.Thread(target=pred, args=(x, y)) t.start() return t # \u904d\u5386model_list, \u8c03\u7528\u5f00\u542f\u7ebf\u7a0b\u51fd\u6570_start_thread\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u6240\u6709\u5f00\u542f\u540e\u7684\u7ebf\u7a0b\u5217\u8868 t_list = list(map(lambda model: _start_thread(pred, word_list, model), model_list)) # \u7ebf\u7a0b\u5c06\u9010\u4e00join\u64cd\u4f5c\u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u5b8c\u6210 t_list = list(map(lambda t: t.join(), t_list)) # \u6700\u540e\u8fc7\u6ee4\u6389\u6240\u6709\u6982\u7387\u9884\u6d4b\u5c0f\u4e8e0.5\u7684\u7c7b\u522b\uff0c\u8fd4\u56de\u7ed3\u679c result = list(filter(lambda x: x[1] >= 0.5, model_prediction)) return result \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py\u4e2d. \u51fd\u6570fea_process(word_list, config_list): \u8f93\u5165\u5b9e\u4f8b: # \u5206\u8bcd\u5217\u8868 word_list = [\"\u9738\u738b\u522b\u59ec\", \"\u662f\u4e00\u90e8\", \"\u975e\u5e38\", \"\u503c\u5f97\", \"\u770b\u7684\", \"\u7535\u5f71\"] config_list = [\"/data/django-uwsgi/text_labeled/model_train/movie/Tokenizer\", 60, 2, \"/data/django-uwsgi/text_labeled/model_train/movie/token_indice\", 119, \"http://localhost:8501/v1/models/movie:predict\"] \u8f93\u51fa\u6548\u679c: # \u901a\u8fc7\u7279\u5f81\u5904\u7406\u6d41\u7a0b\u7684\u77e9\u9635 [[ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 14196 23 748 1 40108]] \u51fd\u6570pred(word_list, model): \u8f93\u5165\u5b9e\u4f8b: # \u5206\u8bcd\u5217\u8868 word_list = [\"\u9738\u738b\u522b\u59ec\", \"\u662f\u4e00\u90e8\", \"\u975e\u5e38\", \"\u503c\u5f97\", \"\u770b\u7684\", \"\u7535\u5f71\"] # \u9884\u8bf7\u6c42\u7684\u6a21\u578b\u540d\u79f0 model = \"\u5f71\u89c6\" \u8f93\u51fa\u6548\u679c # \u53ea\u4f1a\u4ea7\u751f\u4e00\u4e2a\u5f71\u89c6\u7684\u6982\u7387 { \"predictions\": [[0.920291483]] } \u51fd\u6570request_model_serve(word_list, model_list): \u8f93\u5165\u5b9e\u4f8b: # \u5206\u8bcd\u5217\u8868 word_list = [\"\u9738\u738b\u522b\u59ec\", \"\u662f\u4e00\u90e8\", \"\u975e\u5e38\", \"\u503c\u5f97\", \"\u770b\u7684\", \"\u7535\u5f71\"] # \u9884\u8bf7\u6c42\u7684\u6a21\u578b\u5217\u8868 model_list = [\"\u5f71\u89c6\", \"\u7f8e\u5986\"] \u8f93\u51fa\u6548\u679c: # \u4f1a\u4ea7\u751f\u591a\u4e2a\u8bf7\u6c42\u6a21\u578b\u7684\u6982\u7387, \u4f46\u5c0f\u4e8e0.5\u6982\u7387\u7684\u4f1a\u88ab\u53bb\u9664 [['\u5f71\u89c6', 0.920291483]] \u4e3b\u8981\u6ce8\u91ca: # \u5bfc\u5165\u5fc5\u5907\u7684\u5de5\u5177\u5305 # \u4ece\u4efb\u610f\u7684\u6a21\u578b\u8bad\u7ec3\u6587\u4ef6\u4e2d\u5bfc\u5165add_ngram\u589e\u52a0n-gram\u7279\u5f81\u4ee5\u53capadding\u622a\u65ad\u51fd\u6570 # \u5b9a\u4e49\u6a21\u578b\u914d\u7f6e\u8def\u5f84\uff0c\u5b83\u6307\u5411\u4e00\u4e2ajson\u6587\u4ef6 # model_config.json\u5f62\u5982 \uff1a # {\"\u5f71\u89c6\": [\"/data/django-uwsgi/text_labeled/model_train/movie/Tokenizer\", 60, 2, # \"/data/django-uwsgi/text_labeled/model_train/movie/token_indice\", 119, # \"http://localhost:8501/v1/models/movie:predict\"], # \"\u7f8e\u5986\": [\"/data/django-uwsgi/text_labeled/model_train/beauty/Tokenizer\", 75, 2, # \"/data/django-uwsgi/text_labeled/model_train/beauty/token_indice\", 119, # \"http://localhost:8502/v1/models/beauty:predict\"]} # json\u6587\u4ef6\u4e2d\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5b57\u5178\u4e2d\u7684\u6bcf\u4e2akey\u662f\u6211\u4eec\u6807\u7b7e\u7684\u4e2d\u6587\u5b57\u7b26\uff0c\u6bcf\u4e2avalue\u662f\u4e00\u4e2a\u5217\u8868 # \u5217\u8868\u7684\u7b2c\u4e00\u9879\u662f\u7279\u5f81\u5904\u7406\u65f6\u8bcd\u6c47\u6620\u5c04\u5668\u7684\u5b58\u50a8\u5730\u5740 # \u7b2c\u4e8c\u9879\u662f\u7279\u5f81\u5904\u7406\u65f6\u8bed\u6599\u7684\u622a\u65ad\u957f\u5ea6 # \u7b2c\u4e09\u9879\u662fn-gram\u53d6\u5f97n\u503c # \u7b2c\u56db\u9879\u662fn-gram\u7279\u5f81\u4e2dtoken_indice\u7684\u4fdd\u5b58\u8def\u5f84 # \u7b2c\u4e94\u9879\u662f\u6700\u540e\u7684\u6700\u5927\u7684\u5bf9\u9f50\u957f\u5ea6 # \u7b2c\u516d\u9879\u662f\u8be5\u6a21\u578b\u5bf9\u5e94\u7684\u5fae\u670d\u52a1\u5730\u5740 # \u6700\u7ec8\u7684\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868 \"\"\"\u5bf9\u8f93\u5165\u8fdb\u884c\u7c7b\u4f3c\u4e0e\u8bad\u7ec3\u524d\u7684\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\"\"\" # \u8bfb\u53d6\u8bbe\u5b9a\u597d\u7684\u914d\u7f6e # \u52a0\u8f7d\u5206\u8bcd\u6620\u5c04\u5668 # \u8fdb\u884c\u622a\u65ad\u5bf9\u9f50 # \u83b7\u5f97n-gram\u6620\u5c04\u6587\u4ef6 # \u6dfb\u52a0n-gram\u7279\u5f81 # \u8fdb\u884c\u6700\u5927\u957f\u5ea6\u5bf9\u9f50 \"\"\"\u5411\u5355\u4e2a\u5fae\u670d\u52a1\u53d1\u9001\u9884\u6d4b\u8bf7\u6c42\"\"\" # \u5c06\u6301\u4e45\u5316\u7684\u6a21\u578b\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58 # \u6839\u636e\u540d\u5b57\u9009\u62e9\u5bf9\u5e94\u7684\u914d\u7f6e\u5217\u8868 # \u5bf9\u6570\u636e\u8fdb\u884c\u7279\u5f81\u5904\u7406 # \u5c01\u88c5\u6210tf-serving\u9700\u8981\u7684\u6570\u636e\u4f53 # \u5411\u521a\u521a\u5c01\u88c5\u7684\u5fae\u670d\u52a1\u53d1\u9001\u8bf7\u6c42 # \u5c06\u8be5\u7ebf\u7a0b\u4e2d\u83b7\u53d6\u7684\u7ed3\u679c\u653e\u5230\u6a21\u578b\u9884\u6d4b\u7ed3\u679c\u5217\u8868\u4e2d \"\"\"\u8be5\u51fd\u6570\u5f00\u542f\u591a\u7ebf\u7a0b\u8bf7\u6c42\u5c01\u88c5\u597d\u7684\u6a21\u578b\u5fae\u670d\u52a1\"\"\" \"\"\"\u5f00\u542f\u9884\u6d4b\u7ebf\u7a0b, \u4ee5\u7ebf\u7a0b\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\u548c\u51fd\u6570\u7684\u8f93\u5165\u4e3a\u53c2\u6570\"\"\" # \u904d\u5386model_list, \u8c03\u7528\u5f00\u542f\u7ebf\u7a0b\u51fd\u6570_start_thread\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u6240\u6709\u5f00\u542f\u540e\u7684\u7ebf\u7a0b\u5217\u8868 # \u7ebf\u7a0b\u5c06\u9010\u4e00join\u64cd\u4f5c\u7b49\u5f85\u6240\u6709\u7ebf\u7a0b\u5b8c\u6210 # \u6700\u540e\u8fc7\u6ee4\u6389\u6240\u6709\u6982\u7387\u9884\u6d4b\u5c0f\u4e8e0.5\u7684\u7c7b\u522b\uff0c\u8fd4\u56de\u7ed3\u679c \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u4e86\u8fdb\u884c\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u539f\u56e0: \u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u7528\u6237\u7684\u6bcf\u6b21\u8bf7\u6c42\uff0c\u90fd\u6709\u53ef\u80fd\u8c03\u7528\u591a\u4e2a\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u800c\u4e32\u884c\u9884\u6d4b\u7684\u65b9\u5f0f\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u9884\u6d4b\u7684\u6027\u80fd\u8981\u6c42. \u8fd9\u5c31\u9700\u8981\u9884\u6d4b\u8fc7\u7a0b\u5fc5\u987b\u80fd\u591f\u5e76\u884c\u5316\uff0c\u5e76\u5f88\u5bb9\u6613\u7684\u6574\u5408\u5168\u90e8\u7684\u7ed3\u679c. \u6a21\u578b\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b, \u4e3a\u4ec0\u4e48\u6ca1\u6709\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd? \u867d\u7136\u9884\u6d4b\u8fc7\u7a0b\u4e5f\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\uff0c\u4f46\u662f\u6211\u4eec\u5bf9\u8fd9\u4e2a\u8ba1\u7b97\u8fc7\u7a0b\u8fdb\u884c\u4e86\u5c01\u88c5, \u4f7f\u5b83\u662f\u5728\u6a21\u578b\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c, \u800c\u6211\u4eec\u7ebf\u7a0b\u53ea\u662f\u8d1f\u8d23\u8c03\u7528\u670d\u52a1\u5e76\u6574\u5408\u7ed3\u679c\u800c\u5df2, \u56e0\u6b64\u4e0d\u4f1a\u53d7\u5230\u5168\u5c40\u89e3\u91ca\u9501\u7684\u5f71\u54cd. \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u3002 \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u3002 \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u51fd\u6570: to_savedmodel \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1: docker run\u547d\u4ee4 \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c: \u51fd\u6570: fea_process \u51fd\u6570: pred \u51fd\u6570: request_model_serve","title":"4.2 \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b"},{"location":"4/#_2","text":"\u7b2c\u4e00\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 \u5b66\u4e60\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u7b2c\u4e8c\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u3002 \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u3002","title":"\u672c\u7ae0\u603b\u7ed3"},{"location":"5/","text":"\u672c\u7ae0\u5bfc\u5b66 \u5b66\u4e60\u76ee\u6807: \u5b8c\u6210\u7cfb\u7edf\u7684\u5404\u4e2a\u73af\u8282\u7684\u8054\u8c03\uff0c\u4f7f\u5176\u6210\u4e3a\u4e00\u4e2a\u5b8c\u6574\u53ef\u8fd0\u884c\u7684\u540e\u7aef\u670d\u52a1\u3002 \u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u9875\u9762\uff0c\u4f7f\u5176\u80fd\u591f\u4e0e\u540e\u7aef\u7cfb\u7edf\u8fdb\u884c\u4ea4\u4e92\u3002 \u5f15\u5bfc\u5206\u6790: \u5fc5\u987b\u5b8c\u6210\u7cfb\u7edf\u5404\u4e2a\u73af\u8282\u7684\u8054\u8c03\u5de5\u4f5c\uff0c\u624d\u80fd\u4f7f\u5176\u6b63\u5e38\u8fd0\u884c\u548c\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002 \u4e00\u4e2a\u5b8c\u6574\u7684\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u5c55\u793a\u81ea\u5df1\u4f5c\u54c1\u6548\u679c\u3002 \u672c\u7ae0\u5c0f\u8282: 5.1 \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u5c06\u6574\u4e2a\u540e\u7aef\u670d\u52a1\u7684\u5404\u4e2a\u90e8\u5206\u8fde\u63a5\u8d77\u6765, \u80fd\u591f\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1. 5.2 \u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u642d\u5efa \u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u9875\u9762\u80fd\u591f\u8bf7\u6c42\u540e\u7aef\u670d\u52a1. 5.1 \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2\u3002 \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282. \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d. \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5. \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5bf9\u8f93\u5165\u7684\u6587\u672c\u505a\u957f\u5ea6\u9a8c\u8bc1, \u5206\u8bcd, \u53bb\u505c\u7528\u8bcd\u7b49\u5904\u7406\u64cd\u4f5c. \u56fe\u8c31\u5339\u914d \u4f7f\u7528\u8f93\u5165\u6587\u672c\u4e2d\u7684\u8bcd\u6c47\u8fdb\u5165\u5230\u56fe\u8c31\u4e2d\u8fdb\u884c\u5339\u914d, \u627e\u51fa\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u5339\u914d\u6b67\u4e49\u5224\u65ad \u4f7f\u7528\u6a21\u578b\u5bf9\u6240\u6709\u4e0d\u786e\u5b9a\u7684\u6807\u7b7e\u8fdb\u884c\u5224\u65ad, \u627e\u51fa\u6700\u5408\u9002\u7684\u6807\u7b7e. \u6982\u7387\u8c03\u6574 \u8c03\u6574\u6807\u7b7e\u7684\u6982\u7387, \u6ee1\u8db3\u968f\u7740\u76f8\u5173\u8bcd\u6c47\u589e\u591a, \u6982\u7387\u9010\u6e10\u589e\u5927 \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5bf9\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406, \u5e76\u68c0\u7d22\u5339\u914d\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868. \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: from django.http import HttpResponse from rest_framework import viewsets from rest_framework.response import Response from rest_framework.decorators import api_view from rest_framework.permissions import IsAuthenticated from rest_framework.decorators import authentication_classes from rest_framework.decorators import permission_classes import json # \u4ecetext_labeled\u5bfc\u5165api\u6587\u4ef6 from text_labeled import api # \u63a5\u6536POST\u7c7b\u578b\u7684\u8bf7\u6c42 @api_view(['POST']) def get_label(request): # \u63a5\u6536POST\u8bf7\u6c42\uff0c\u5e76\u53d6\u6570\u636e\u4e2d\u7684\"text\"\u5bf9\u5e94\u7684\u503c text = request.POST.get(\"text\") # \u5f00\u59cb\u8c03\u7528text_labeled\u76ee\u5f55\u4e0b\u7684api.py\u4e2d\u7684\u51fd\u6570: # \u8c03\u7528\u8f93\u5165\u9884\u5904\u7406 word_list = api.handle_cn_text(text) # \u8c03\u7528\u56fe\u8c31\u5339\u914d index_map_label = api.get_index_map_label(word_list) # \u8c03\u7528\u5339\u914d\u6b67\u4e49\u5224\u65ad index_map_label_ = api.weight_update(word_list, index_map_label) if index_map_label_: # \u8c03\u7528\u6982\u7387\u8c03\u6574 df_ = api.control_increase(index_map_label_) # \u8c03\u7528\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 result = api.father_label_and_normalized(df_) else: result = [] # \u7136\u540e\u5c01\u88c5\u6210\u54cd\u5e94\u4f53\u8fd4\u56de\u7ed3\u679c return HttpResponse(json.dumps(result, ensure_ascii=False)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/api/views.py\u4e2d\u3002 \u6587\u4ef6\u8def\u5f84\u8c03\u6574: # \u5728/data/django-uwsgi/text_labeled/api.py\u4e2d\u6dfb\u52a0\u7cfb\u7edf\u8def\u5f84\u8bc6\u522b import sys sys.path.append(\"/data/django-uwsgi/text_labeled/\") # \u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py import sys sys.path.append(\"/data/django-uwsgi/text_labeled/model_train/\") \u4e3b\u8981\u6ce8\u91ca: # \u63a5\u6536POST\u8bf7\u6c42\uff0c\u5e76\u53d6\u6570\u636e\u4e2d\u7684\"text\"\u5bf9\u5e94\u7684\u503c # \u5f00\u59cb\u8c03\u7528text_labeled\u76ee\u5f55\u4e0b\u7684api.py\u4e2d\u7684\u51fd\u6570: # \u8c03\u7528\u8f93\u5165\u9884\u5904\u7406 # \u8c03\u7528\u56fe\u8c31\u5339\u914d # \u8c03\u7528\u5339\u914d\u6b67\u4e49\u5224\u65ad # \u8c03\u7528\u6982\u7387\u8c03\u6574 # \u8c03\u7528\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 # \u7136\u540e\u5c01\u88c5\u6210\u54cd\u5e94\u4f53\u8fd4\u56de\u7ed3\u679c \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5: # \u4fee\u6539test.py\u6587\u4ef6\u4e2d\u7684\u8f93\u5165\u5185\u5bb9: \u5c06\u8f93\u5165\u6587\u672c\u6539\u4e3a: {\"text\": \"\u886c\u886b\u3001\u88e4\u5b50\u3001\u5916\u5957\u3001\u5e3d\u5b50\uff1a\u5747\u4e3aWan Hung, \u978b\uff1aSamo, \u9879\u94fe\uff1aCrazy Rhythmm, \u8033\u9489\uff1aYvmin!\"} \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5199\u5728/data/django-uwsgi/test.py\u4e2d. # \u91cd\u542f\u670d\u52a1 supervisorctl restart all # \u8fd0\u884c\u6d4b\u8bd5\u811a\u672c python test.py \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c, \u5199\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b. \u8f93\u51fa\u6548\u679c: # \u6700\u7ec8\u7684\u7ed3\u679c\u6837\u5f0f [{\"label\": \"\u65f6\u5c1a\", \"score\": 0.991, \"related\": []}] \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282\u3002 \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u3002 \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\u3002 \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5bf9\u8f93\u5165\u7684\u6587\u672c\u505a\u957f\u5ea6\u9a8c\u8bc1, \u5206\u8bcd, \u53bb\u505c\u7528\u8bcd\u7b49\u5904\u7406\u64cd\u4f5c. \u56fe\u8c31\u5339\u914d \u4f7f\u7528\u8f93\u5165\u6587\u672c\u4e2d\u7684\u8bcd\u6c47\u8fdb\u5165\u5230\u56fe\u8c31\u4e2d\u8fdb\u884c\u5339\u914d, \u627e\u51fa\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u5339\u914d\u6b67\u4e49\u5224\u65ad \u4f7f\u7528\u6a21\u578b\u5bf9\u6240\u6709\u4e0d\u786e\u5b9a\u7684\u6807\u7b7e\u8fdb\u884c\u5224\u65ad, \u627e\u51fa\u6700\u5408\u9002\u7684\u6807\u7b7e. \u6982\u7387\u8c03\u6574 \u8c03\u6574\u6807\u7b7e\u7684\u6982\u7387, \u6ee1\u8db3\u968f\u7740\u76f8\u5173\u8bcd\u6c47\u589e\u591a, \u6982\u7387\u9010\u6e10\u589e\u5927 \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5bf9\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406, \u5e76\u68c0\u7d22\u5339\u914d\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868. \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d: \u51fd\u6570: get_label \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5: \u6587\u4ef6\u8def\u5f84\u8c03\u6574 \u91cd\u542f\u670d\u52a1 \u8fd0\u884c\u811a\u672ctest.py 5.2 \u642d\u5efa\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762 \u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u642d\u5efa\u4e00\u4e2a\u4e0e\u540e\u7aef\u4ea4\u4e92\u7684\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2\u3002 \u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2ahtml\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002 \u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2ahtml\u9875\u9762\u7684\u4ee3\u7801\u5206\u6790: <!DOCTYPE html> <html lang=\"zh-CN\"> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /> <!\u2014 \u5bfc\u5165bootstrap3 css\u90e8\u5206\u7528\u4e8e\u6587\u672c\u8f93\u5165\u6846\u6309\u94ae\u7b49\u63a7\u4ef6\u7684\u7f8e\u5316\u3002\u2014> <link href=\"./bootstrap-3.3.7-dist/css/bootstrap.min.css\" rel=\"stylesheet\"> <!-- \u5bfc\u5165jquery\u7528\u4e8e\u53d1\u9001ajax\u8bf7\u6c42--> <script src=\"./js/jquery-2.1.1.min.js\"></script> <!-- \u5bfc\u5165bootstrap3 js\u90e8\u5206\u7528\u4e8e\u63a7\u4ef6\u4e2d\u7684\u6548\u679c--> <script src=\"./bootstrap-3.3.7-dist/js/bootstrap.min.js\"></script> <!-- \u5bfc\u5165\u6211\u4eec\u81ea\u5df1\u7684js\u90e8\u5206\u7528\u4e8e\u63a7\u4ef6\u4e2d\u7684\u6548\u679c--> <script type=\"text/javascript\" src=\"./js/try.js\"></script> <script type=\"text/javascript\">$(init);</script> <script type=\"text/javascript\">$.ajaxSetup({ data: {csrfmiddlewaretoken: '6tuXkYOS6uhRbDX1BSC2wbZ5d3Js9DKpdBf9v3NlSfS8qXVI0BtGWH3LAV7AX98E' },});</script> <!-- \u7b49\u5f85\u56fe\u6807 --> <div id=\"loading\"> <p><img src=\"./img/loading.gif\" /></p> </div> <!-- \u56fe\u6807\u6837\u5f0f --> <style> #loading{ display:none; position:fixed; left:47%; top:68%; z-index: 99;} </style> <hr/> <!-- \u8bd5\u7528\u533a\u7684\u6807\u9898 --> <h3 align=\"center\"><span class=\"label label-primary\"> \u8bd5\u7528\u533a</span></h3> <br> <!-- \u8f93\u5165\u6587\u672c\u6846 --> <div> <form class=\"bs-example bs-example-form\" role=\"form\"> <div class=\"input-group\"> <span class=\"input-group-addon\">\u8f93\u5165</span> <textarea id=\"text-content\" class=\"form-control\" placeholder=\"\u5728\u8fd9\u91cc\u8f93\u5165\u60a8\u60f3\u8981\u8bc6\u522b\u6807\u7b7e\u7684\u6587\u672c\u4fe1\u606f\uff0c\u53ef\u4ee5\u662f\u6587\u7ae0\u7684\u6807\u9898\u6216\u5185\u5bb9\uff0c\u8bc4\u8bba\u4ee5\u53ca\u76f8\u5173\u7684\u5bf9\u8bdd\u3002\u6211\u4eec\u5c06\u901a\u8fc7\u6807\u51c6NLP\u6d41\u7a0b\uff0c\u5174\u8da3\u77e5\u8bc6\u7f51\u7edc\uff0c\u548c\u4e00\u4e9b\u673a\u5668\u5b66\u4e60\u6a21\u578b\u4e3a\u60a8\u63d0\u4f9b\u6807\u7b7e\u8bc6\u522b\u670d\u52a1\u3002\" rows=\"10\" cols=\"80\"></textarea> </div> <br><br> <!-- \u8bf7\u6c42\u6309\u94ae --> <div class=\"button-div\"> <button type=\"button\" class=\"btn btn-success btn-block\" id=\"label-button\">\u83b7\u53d6\u6807\u7b7e</button> </div> <br><br> <!-- \u8f93\u51fa\u6587\u672c\u6846 --> <div class=\"input-group\"> <span class=\"input-group-addon\">\u8f93\u51fa</span> <textarea id=\"label-result\" class=\"form-control\" type=\"text\" placeholder='\u60a8\u5c06\u5f97\u5230json\u683c\u5f0f\u7684\u8f93\u51fa\uff0c\u5982\uff1a[{\"label\":\"\u738b\u8005\u519c\u836f\", \"score\": 0.700987, \"related\":[\"\u6e38\u620f\"]}] \u5176\u4e2dscore\u662flabel\u7684\u7f6e\u4fe1\u6253\u5206\uff0crelated\u662flabel\u7684\u6240\u6709\u7236\u7ea7\u6807\u7b7e\u5217\u8868\u3002' rows=\"10\" cols=\"80\"></textarea> </div> </form> </div> <br/> </html> \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/html/index.html\u4e2d\u3002 \u67e5\u770b\u5730\u5740: http://47.92.175.143:8087/text_labeled/html/index.html \u8f93\u51fa\u6548\u679c: \u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: ////////\u5c55\u793aloading\u56fe\u6807////////// function showLoading() { $(\"#loading\").show(); } ////////\u9690\u85cfloading\u56fe\u6807////////// function hideLoading() { $(\"#loading\").hide(); } function init(){ $(\"#label-button\").click(function(){ label_processing(); }); } ////////\u53d1\u9001\u8bd5\u7528\u8bf7\u6c42////////// function label_processing(){ showLoading(); var content = $(\"#text-content\").val(); $.ajax({ type:\"POST\", url:\"http://47.92.175.143:8087/api/get_label/\", data: {\"text\":content,}, success:function(result){ var obj = JSON.parse(result); var pretty = JSON.stringify(obj, undefined, 4); $(\"#label-result\").val(pretty); hideLoading();} }); } \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/html/js/index.js\u4e2d\u3002 \u8f93\u5165\u6587\u672c: \u886c\u886b\u3001\u88e4\u5b50\u3001\u5916\u5957\u3001\u5e3d\u5b50\uff1a\u5747\u4e3aWan Hung, \u978b\uff1aSamo, \u9879\u94fe\uff1aCrazy Rhythmm, \u8033\u9489\uff1aYvmin! \u6700\u7ec8\u6548\u679c\u6f14\u793a: \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a\u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2ahtml\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002 \u672c\u7ae0\u603b\u7ed3 \u7b2c\u4e00\u5c0f\u8282: \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u5b66\u4e60\u5e76\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282\u3002 \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u3002 \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u56fe\u8c31\u5339\u914d \u5339\u914d\u6b67\u4e49\u5224\u65ad \u6982\u7387\u8c03\u6574 \u6982\u7387\u6807\u7b7e\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u7b2c\u4e8c\u5c0f\u8282: \u642d\u5efa\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a\u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2a\u53ef\u89c6\u5316\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002","title":"\u7b2c\u4e94\u7ae0:\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5"},{"location":"5/#_1","text":"\u5b66\u4e60\u76ee\u6807: \u5b8c\u6210\u7cfb\u7edf\u7684\u5404\u4e2a\u73af\u8282\u7684\u8054\u8c03\uff0c\u4f7f\u5176\u6210\u4e3a\u4e00\u4e2a\u5b8c\u6574\u53ef\u8fd0\u884c\u7684\u540e\u7aef\u670d\u52a1\u3002 \u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u9875\u9762\uff0c\u4f7f\u5176\u80fd\u591f\u4e0e\u540e\u7aef\u7cfb\u7edf\u8fdb\u884c\u4ea4\u4e92\u3002 \u5f15\u5bfc\u5206\u6790: \u5fc5\u987b\u5b8c\u6210\u7cfb\u7edf\u5404\u4e2a\u73af\u8282\u7684\u8054\u8c03\u5de5\u4f5c\uff0c\u624d\u80fd\u4f7f\u5176\u6b63\u5e38\u8fd0\u884c\u548c\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002 \u4e00\u4e2a\u5b8c\u6574\u7684\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u5c55\u793a\u81ea\u5df1\u4f5c\u54c1\u6548\u679c\u3002 \u672c\u7ae0\u5c0f\u8282: 5.1 \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u5c06\u6574\u4e2a\u540e\u7aef\u670d\u52a1\u7684\u5404\u4e2a\u90e8\u5206\u8fde\u63a5\u8d77\u6765, \u80fd\u591f\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1. 5.2 \u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u642d\u5efa \u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u9875\u9762\u80fd\u591f\u8bf7\u6c42\u540e\u7aef\u670d\u52a1.","title":"\u672c\u7ae0\u5bfc\u5b66"},{"location":"5/#51","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2\u3002 \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282. \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d. \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5. \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5bf9\u8f93\u5165\u7684\u6587\u672c\u505a\u957f\u5ea6\u9a8c\u8bc1, \u5206\u8bcd, \u53bb\u505c\u7528\u8bcd\u7b49\u5904\u7406\u64cd\u4f5c. \u56fe\u8c31\u5339\u914d \u4f7f\u7528\u8f93\u5165\u6587\u672c\u4e2d\u7684\u8bcd\u6c47\u8fdb\u5165\u5230\u56fe\u8c31\u4e2d\u8fdb\u884c\u5339\u914d, \u627e\u51fa\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u5339\u914d\u6b67\u4e49\u5224\u65ad \u4f7f\u7528\u6a21\u578b\u5bf9\u6240\u6709\u4e0d\u786e\u5b9a\u7684\u6807\u7b7e\u8fdb\u884c\u5224\u65ad, \u627e\u51fa\u6700\u5408\u9002\u7684\u6807\u7b7e. \u6982\u7387\u8c03\u6574 \u8c03\u6574\u6807\u7b7e\u7684\u6982\u7387, \u6ee1\u8db3\u968f\u7740\u76f8\u5173\u8bcd\u6c47\u589e\u591a, \u6982\u7387\u9010\u6e10\u589e\u5927 \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5bf9\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406, \u5e76\u68c0\u7d22\u5339\u914d\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868. \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: from django.http import HttpResponse from rest_framework import viewsets from rest_framework.response import Response from rest_framework.decorators import api_view from rest_framework.permissions import IsAuthenticated from rest_framework.decorators import authentication_classes from rest_framework.decorators import permission_classes import json # \u4ecetext_labeled\u5bfc\u5165api\u6587\u4ef6 from text_labeled import api # \u63a5\u6536POST\u7c7b\u578b\u7684\u8bf7\u6c42 @api_view(['POST']) def get_label(request): # \u63a5\u6536POST\u8bf7\u6c42\uff0c\u5e76\u53d6\u6570\u636e\u4e2d\u7684\"text\"\u5bf9\u5e94\u7684\u503c text = request.POST.get(\"text\") # \u5f00\u59cb\u8c03\u7528text_labeled\u76ee\u5f55\u4e0b\u7684api.py\u4e2d\u7684\u51fd\u6570: # \u8c03\u7528\u8f93\u5165\u9884\u5904\u7406 word_list = api.handle_cn_text(text) # \u8c03\u7528\u56fe\u8c31\u5339\u914d index_map_label = api.get_index_map_label(word_list) # \u8c03\u7528\u5339\u914d\u6b67\u4e49\u5224\u65ad index_map_label_ = api.weight_update(word_list, index_map_label) if index_map_label_: # \u8c03\u7528\u6982\u7387\u8c03\u6574 df_ = api.control_increase(index_map_label_) # \u8c03\u7528\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 result = api.father_label_and_normalized(df_) else: result = [] # \u7136\u540e\u5c01\u88c5\u6210\u54cd\u5e94\u4f53\u8fd4\u56de\u7ed3\u679c return HttpResponse(json.dumps(result, ensure_ascii=False)) \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/api/views.py\u4e2d\u3002 \u6587\u4ef6\u8def\u5f84\u8c03\u6574: # \u5728/data/django-uwsgi/text_labeled/api.py\u4e2d\u6dfb\u52a0\u7cfb\u7edf\u8def\u5f84\u8bc6\u522b import sys sys.path.append(\"/data/django-uwsgi/text_labeled/\") # \u5728/data/django-uwsgi/text_labeled/model_train/multithread_predict.py import sys sys.path.append(\"/data/django-uwsgi/text_labeled/model_train/\") \u4e3b\u8981\u6ce8\u91ca: # \u63a5\u6536POST\u8bf7\u6c42\uff0c\u5e76\u53d6\u6570\u636e\u4e2d\u7684\"text\"\u5bf9\u5e94\u7684\u503c # \u5f00\u59cb\u8c03\u7528text_labeled\u76ee\u5f55\u4e0b\u7684api.py\u4e2d\u7684\u51fd\u6570: # \u8c03\u7528\u8f93\u5165\u9884\u5904\u7406 # \u8c03\u7528\u56fe\u8c31\u5339\u914d # \u8c03\u7528\u5339\u914d\u6b67\u4e49\u5224\u65ad # \u8c03\u7528\u6982\u7387\u8c03\u6574 # \u8c03\u7528\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 # \u7136\u540e\u5c01\u88c5\u6210\u54cd\u5e94\u4f53\u8fd4\u56de\u7ed3\u679c \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5: # \u4fee\u6539test.py\u6587\u4ef6\u4e2d\u7684\u8f93\u5165\u5185\u5bb9: \u5c06\u8f93\u5165\u6587\u672c\u6539\u4e3a: {\"text\": \"\u886c\u886b\u3001\u88e4\u5b50\u3001\u5916\u5957\u3001\u5e3d\u5b50\uff1a\u5747\u4e3aWan Hung, \u978b\uff1aSamo, \u9879\u94fe\uff1aCrazy Rhythmm, \u8033\u9489\uff1aYvmin!\"} \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5199\u5728/data/django-uwsgi/test.py\u4e2d. # \u91cd\u542f\u670d\u52a1 supervisorctl restart all # \u8fd0\u884c\u6d4b\u8bd5\u811a\u672c python test.py \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c, \u5199\u5728/data/django-uwsgi/\u76ee\u5f55\u4e0b. \u8f93\u51fa\u6548\u679c: # \u6700\u7ec8\u7684\u7ed3\u679c\u6837\u5f0f [{\"label\": \"\u65f6\u5c1a\", \"score\": 0.991, \"related\": []}] \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282\u3002 \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u3002 \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\u3002 \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5bf9\u8f93\u5165\u7684\u6587\u672c\u505a\u957f\u5ea6\u9a8c\u8bc1, \u5206\u8bcd, \u53bb\u505c\u7528\u8bcd\u7b49\u5904\u7406\u64cd\u4f5c. \u56fe\u8c31\u5339\u914d \u4f7f\u7528\u8f93\u5165\u6587\u672c\u4e2d\u7684\u8bcd\u6c47\u8fdb\u5165\u5230\u56fe\u8c31\u4e2d\u8fdb\u884c\u5339\u914d, \u627e\u51fa\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e. \u5339\u914d\u6b67\u4e49\u5224\u65ad \u4f7f\u7528\u6a21\u578b\u5bf9\u6240\u6709\u4e0d\u786e\u5b9a\u7684\u6807\u7b7e\u8fdb\u884c\u5224\u65ad, \u627e\u51fa\u6700\u5408\u9002\u7684\u6807\u7b7e. \u6982\u7387\u8c03\u6574 \u8c03\u6574\u6807\u7b7e\u7684\u6982\u7387, \u6ee1\u8db3\u968f\u7740\u76f8\u5173\u8bcd\u6c47\u589e\u591a, \u6982\u7387\u9010\u6e10\u589e\u5927 \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5bf9\u6982\u7387\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406, \u5e76\u68c0\u7d22\u5339\u914d\u6807\u7b7e\u7684\u7236\u7ea7\u6807\u7b7e\u5217\u8868. \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d: \u51fd\u6570: get_label \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5: \u6587\u4ef6\u8def\u5f84\u8c03\u6574 \u91cd\u542f\u670d\u52a1 \u8fd0\u884c\u811a\u672ctest.py","title":"5.1 \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5"},{"location":"5/#52","text":"\u5b66\u4e60\u76ee\u6807: \u638c\u63e1\u642d\u5efa\u4e00\u4e2a\u4e0e\u540e\u7aef\u4ea4\u4e92\u7684\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2\u3002 \u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2ahtml\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002 \u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2ahtml\u9875\u9762\u7684\u4ee3\u7801\u5206\u6790: <!DOCTYPE html> <html lang=\"zh-CN\"> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /> <!\u2014 \u5bfc\u5165bootstrap3 css\u90e8\u5206\u7528\u4e8e\u6587\u672c\u8f93\u5165\u6846\u6309\u94ae\u7b49\u63a7\u4ef6\u7684\u7f8e\u5316\u3002\u2014> <link href=\"./bootstrap-3.3.7-dist/css/bootstrap.min.css\" rel=\"stylesheet\"> <!-- \u5bfc\u5165jquery\u7528\u4e8e\u53d1\u9001ajax\u8bf7\u6c42--> <script src=\"./js/jquery-2.1.1.min.js\"></script> <!-- \u5bfc\u5165bootstrap3 js\u90e8\u5206\u7528\u4e8e\u63a7\u4ef6\u4e2d\u7684\u6548\u679c--> <script src=\"./bootstrap-3.3.7-dist/js/bootstrap.min.js\"></script> <!-- \u5bfc\u5165\u6211\u4eec\u81ea\u5df1\u7684js\u90e8\u5206\u7528\u4e8e\u63a7\u4ef6\u4e2d\u7684\u6548\u679c--> <script type=\"text/javascript\" src=\"./js/try.js\"></script> <script type=\"text/javascript\">$(init);</script> <script type=\"text/javascript\">$.ajaxSetup({ data: {csrfmiddlewaretoken: '6tuXkYOS6uhRbDX1BSC2wbZ5d3Js9DKpdBf9v3NlSfS8qXVI0BtGWH3LAV7AX98E' },});</script> <!-- \u7b49\u5f85\u56fe\u6807 --> <div id=\"loading\"> <p><img src=\"./img/loading.gif\" /></p> </div> <!-- \u56fe\u6807\u6837\u5f0f --> <style> #loading{ display:none; position:fixed; left:47%; top:68%; z-index: 99;} </style> <hr/> <!-- \u8bd5\u7528\u533a\u7684\u6807\u9898 --> <h3 align=\"center\"><span class=\"label label-primary\"> \u8bd5\u7528\u533a</span></h3> <br> <!-- \u8f93\u5165\u6587\u672c\u6846 --> <div> <form class=\"bs-example bs-example-form\" role=\"form\"> <div class=\"input-group\"> <span class=\"input-group-addon\">\u8f93\u5165</span> <textarea id=\"text-content\" class=\"form-control\" placeholder=\"\u5728\u8fd9\u91cc\u8f93\u5165\u60a8\u60f3\u8981\u8bc6\u522b\u6807\u7b7e\u7684\u6587\u672c\u4fe1\u606f\uff0c\u53ef\u4ee5\u662f\u6587\u7ae0\u7684\u6807\u9898\u6216\u5185\u5bb9\uff0c\u8bc4\u8bba\u4ee5\u53ca\u76f8\u5173\u7684\u5bf9\u8bdd\u3002\u6211\u4eec\u5c06\u901a\u8fc7\u6807\u51c6NLP\u6d41\u7a0b\uff0c\u5174\u8da3\u77e5\u8bc6\u7f51\u7edc\uff0c\u548c\u4e00\u4e9b\u673a\u5668\u5b66\u4e60\u6a21\u578b\u4e3a\u60a8\u63d0\u4f9b\u6807\u7b7e\u8bc6\u522b\u670d\u52a1\u3002\" rows=\"10\" cols=\"80\"></textarea> </div> <br><br> <!-- \u8bf7\u6c42\u6309\u94ae --> <div class=\"button-div\"> <button type=\"button\" class=\"btn btn-success btn-block\" id=\"label-button\">\u83b7\u53d6\u6807\u7b7e</button> </div> <br><br> <!-- \u8f93\u51fa\u6587\u672c\u6846 --> <div class=\"input-group\"> <span class=\"input-group-addon\">\u8f93\u51fa</span> <textarea id=\"label-result\" class=\"form-control\" type=\"text\" placeholder='\u60a8\u5c06\u5f97\u5230json\u683c\u5f0f\u7684\u8f93\u51fa\uff0c\u5982\uff1a[{\"label\":\"\u738b\u8005\u519c\u836f\", \"score\": 0.700987, \"related\":[\"\u6e38\u620f\"]}] \u5176\u4e2dscore\u662flabel\u7684\u7f6e\u4fe1\u6253\u5206\uff0crelated\u662flabel\u7684\u6240\u6709\u7236\u7ea7\u6807\u7b7e\u5217\u8868\u3002' rows=\"10\" cols=\"80\"></textarea> </div> </form> </div> <br/> </html> \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/html/index.html\u4e2d\u3002 \u67e5\u770b\u5730\u5740: http://47.92.175.143:8087/text_labeled/html/index.html \u8f93\u51fa\u6548\u679c: \u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u8fc7\u7a0b\u7684\u4ee3\u7801\u5206\u6790: ////////\u5c55\u793aloading\u56fe\u6807////////// function showLoading() { $(\"#loading\").show(); } ////////\u9690\u85cfloading\u56fe\u6807////////// function hideLoading() { $(\"#loading\").hide(); } function init(){ $(\"#label-button\").click(function(){ label_processing(); }); } ////////\u53d1\u9001\u8bd5\u7528\u8bf7\u6c42////////// function label_processing(){ showLoading(); var content = $(\"#text-content\").val(); $.ajax({ type:\"POST\", url:\"http://47.92.175.143:8087/api/get_label/\", data: {\"text\":content,}, success:function(result){ var obj = JSON.parse(result); var pretty = JSON.stringify(obj, undefined, 4); $(\"#label-result\").val(pretty); hideLoading();} }); } \u4ee3\u7801\u4f4d\u7f6e: \u4ee3\u7801\u5c06\u5199\u5728/data/django-uwsgi/text_labeled/html/js/index.js\u4e2d\u3002 \u8f93\u5165\u6587\u672c: \u886c\u886b\u3001\u88e4\u5b50\u3001\u5916\u5957\u3001\u5e3d\u5b50\uff1a\u5747\u4e3aWan Hung, \u978b\uff1aSamo, \u9879\u94fe\uff1aCrazy Rhythmm, \u8033\u9489\uff1aYvmin! \u6700\u7ec8\u6548\u679c\u6f14\u793a: \u5c0f\u8282\u603b\u7ed3: \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a\u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2ahtml\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002","title":"5.2 \u642d\u5efa\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762"},{"location":"5/#_2","text":"\u7b2c\u4e00\u5c0f\u8282: \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u5b66\u4e60\u5e76\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282\u3002 \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u3002 \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u56fe\u8c31\u5339\u914d \u5339\u914d\u6b67\u4e49\u5224\u65ad \u6982\u7387\u8c03\u6574 \u6982\u7387\u6807\u7b7e\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u7b2c\u4e8c\u5c0f\u8282: \u642d\u5efa\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a\u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2a\u53ef\u89c6\u5316\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002","title":"\u672c\u7ae0\u603b\u7ed3"},{"location":"6/","text":"\u7b2c\u4e00\u7ae0\u603b\u7ed3 \u7b2c1\u5c0f\u8282: \u540e\u7aef\u670d\u52a1\u642d\u5efa \u5b66\u4e60\u4e86\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528\uff1a \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282\uff0c\u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684API\uff0c\u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u56db\u6b65\u66f2\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2\u3002 \u7b2c2\u5c0f\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5b66\u4e60\u4e86\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027\uff0c\u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2\u3002 \u7b2c3\u5c0f\u8282: \u56fe\u8c31\u5339\u914d \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31: \u5b83\u662f\u7531\u6807\u7b7e\u8282\u70b9\u548c\u8bcd\u6c47\u8282\u70b9\u4ee5\u53ca\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\u7ec4\u6210\u7684\u4e00\u5f20\u6811\u72b6\u56fe\u3002 \u5b66\u4e60\u4e86\u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528\uff1a \u901a\u8fc7\u5339\u914d\u8bcd\u6c47\u53ec\u56de\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b\u3002 \u7b2c4\u5c0f\u8282: \u5339\u914d\u6b67\u4e49\u5224\u65ad \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e\uff0c\u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49\u3002 \u5b66\u4e60\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528\uff1a \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6\uff0c\u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b\u3002 \u7b2c5\u5c0f\u8282: \u6982\u7387\u8c03\u6574 \u5b66\u4e60\u4e86\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a\uff0c\u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b\u3002 \u7b2c6\u5c0f\u8282: \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5b66\u4e60\u4e86\u6982\u7387\u5f52\u4e00\u5316\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185\u3002 \u5b66\u4e60\u4e86\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868\uff0c\u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b\u3002 \u7b2c\u4e8c\u7ae0\u603b\u7ed3 \u7b2c1\u5c0f\u8282: \u8bbe\u8ba1\u6807\u7b7e\u6811 \u5b66\u4e60\u4e86\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219\u3002 \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e\u3002 \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u8bbe\u8ba1\u539f\u5219: * \u4e1a\u52a1\u5bfc\u5411\u539f\u5219 * \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219 \u5b66\u4e60\u4e86\u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e\u3002 \u5b66\u4e60\u4e86\u6807\u7b7e\u5b58\u50a8: * \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784\u3002 \u7b2c2\u5c0f\u8282: \u6784\u5efa\u6807\u7b7e\u6811 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9\u3002 \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178\u3002 \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue\uff0c\u6839\u636ekey\uff0cMERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9\u3002 \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868\uff0c\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb\u3002 \u7b2c3\u5c0f\u8282: \u83b7\u53d6\u539f\u59cb\u6570\u636e \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546\uff0c\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599\u3002 \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6837\u5f0f\u3002 \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027\u3002 \u7b2c4\u5c0f\u8282: \u83b7\u53d6\u8bcd\u6c47\u96c6 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58\u3002 \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4\u3002 \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u4e4b\u4e2d\u3002 \u7b2c5\u5c0f\u8282: \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff0c\u5220\u9664\u6240\u6709\u4e0e\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65\uff0c\u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6\u3002 \u7b2c\u4e09\u6b65\uff0c\u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u521b\u5efa\u8282\u70b9\uff0c\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb\u3002 \u7b2c\u4e09\u7ae0\u603b\u7ed3 \u7b2c1\u5c0f\u8282: \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599 \u5b66\u4e60\u4e86\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90\u3002 \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c\u3002 \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0\u3002 \u5b66\u4e60\u4e86\u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599\u3002 \u7b2c2\u5c0f\u8282: \u8fdb\u884c\u6570\u636e\u5206\u6790 \u5b66\u4e60\u4e86\u6570\u636e\u5206\u6790\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e\u3002 \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03\u3002 \u7b2c\u4e09\u6b65: \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u3002 \u7b2c\u56db\u6b65: \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e\u3002 \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790\u4f5c\u6570\u636e\u51c6\u5907\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03\u3002 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u3002 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u3002 \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_feature\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf\u3002 \u7b2c3\u5c0f\u8282: \u7279\u5f81\u5904\u7406 \u5b66\u4e60\u4e86\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u4e2d\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165\u3002 \u7b2c4\u5c0f\u8282: \u6784\u5efa\u6a21\u578b\u7ed3\u6784 \u5b66\u4e60\u4e86\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 \u5b66\u4e60\u4e86Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6709\u6548\u8bcd\u6c47\u603b\u6570(max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a\u3002 \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u4e00\u822c\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fmax_features x embedding_dims\u3002 \u8f93\u5165\u53c2\u6570: max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6\u3002 \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u5b66\u4e60\u4e86GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784\u3002 \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408\u3002 \u5b66\u4e60\u4e86Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid\u3002 \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570\u3002 \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570\u3002 \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b\u3002 \u7b2c5\u5c0f\u8282: \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5 fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f\u3002 \u5f62\u5f0f: \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61\u3002\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5\u3002 \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5728\u6a21\u578b\u4e2d\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5\u3002 \u7b2c6\u5c0f\u8282: \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b\u3002 \u5b66\u4e60\u4e86\u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61\u3002 \u5b66\u4e60\u4e86\u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408: \u901a\u8fc7\u5bf9\u6bd4\u9a8c\u8bc1\u96c6\u4e0e\u8bad\u7ec3\u96c6\u51c6\u786e\u66f2\u7ebf\uff0c\u5728\u9a8c\u8bc1acc\u4e0d\u5728\u4e0a\u5347\u7684\u8f6e\u6570\u65f6\u505c\u6b62\u8bad\u7ec3\u3002 \u7b2c7\u5c0f\u8282: \u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d \u5b66\u4f1a\u4e86\u5b9e\u73b0\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684\u8fc7\u7a0b\u3002 \u7b2c\u56db\u7ae0\u603b\u7ed3 \u7b2c\u4e00\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 \u5b66\u4e60\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u7b2c\u4e8c\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u3002 \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u3002 \u7b2c\u4e94\u7ae0\u603b\u7ed3 \u7b2c\u4e00\u5c0f\u8282: \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u5b66\u4e60\u5e76\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282\u3002 \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u3002 \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u56fe\u8c31\u5339\u914d \u5339\u914d\u6b67\u4e49\u5224\u65ad \u6982\u7387\u8c03\u6574 \u6982\u7387\u6807\u7b7e\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u7b2c\u4e8c\u5c0f\u8282: \u642d\u5efa\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a\u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2a\u53ef\u89c6\u5316\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002","title":"\u5168\u6587\u603b\u7ed3"},{"location":"6/#_1","text":"\u7b2c1\u5c0f\u8282: \u540e\u7aef\u670d\u52a1\u642d\u5efa \u5b66\u4e60\u4e86\u540e\u7aef\u670d\u52a1\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e3b\u8981\u4f5c\u7528\uff1a \u5c01\u88c5\u6240\u6709\u7684\u6587\u672c\u5904\u7406\u73af\u8282\uff0c\u5bf9\u5916\u63d0\u4f9b\u53ef\u4ee5\u8c03\u7528\u7684API\uff0c\u8ba9\u5176\u4ed6\u90e8\u95e8\u7684\u540c\u4e8b\u6216\u8005\u4e0d\u4e86\u89e3\u5185\u90e8\u7ec6\u8282\u7684\u4eba\u5458\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5b8c\u6574\u7684django\u670d\u52a1\u6846\u67b6\u56db\u6b65\u66f2\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u670d\u52a1\u5185\u90e8\u7684\u4e09\u4e2apython\u6587\u4ef6\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u7684demo\u7684\u4e09\u6b65\u66f2\u3002 \u7b2c2\u5c0f\u8282: \u8f93\u5165\u9884\u5904\u7406 \u5b66\u4e60\u4e86\u8f93\u5165\u9884\u5904\u7406\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u7528\u6237\u8f93\u5165\u7684\u5408\u7406\u6027\uff0c\u907f\u514d\u7cfb\u7edf\u56e0\u4e3a\u63a5\u53d7\u5f02\u5e38\u6570\u636e\u800c\u8fc7\u8f7d\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8f93\u5165\u9884\u5904\u7406\u7684\u4e09\u6b65\u66f2\u3002 \u7b2c3\u5c0f\u8282: \u56fe\u8c31\u5339\u914d \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u6807\u7b7e\u8bcd\u6c47\u56fe\u8c31: \u5b83\u662f\u7531\u6807\u7b7e\u8282\u70b9\u548c\u8bcd\u6c47\u8282\u70b9\u4ee5\u53ca\u8282\u70b9\u4e4b\u95f4\u7684\u8fb9\u7ec4\u6210\u7684\u4e00\u5f20\u6811\u72b6\u56fe\u3002 \u5b66\u4e60\u4e86\u56fe\u8c31\u5339\u914d\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528\uff1a \u901a\u8fc7\u5339\u914d\u8bcd\u6c47\u53ec\u56de\u6240\u6709\u53ef\u80fd\u7684\u6807\u7b7e\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b\u3002 \u7b2c4\u5c0f\u8282: \u5339\u914d\u6b67\u4e49\u5224\u65ad \u5b66\u4e60\u4e86\u4ec0\u4e48\u662f\u5339\u914d\u6b67\u4e49: \u5728\u56fe\u8c31\u5339\u914d\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u8bcd\u6c47\u53ef\u80fd\u4e00\u8d77\u5339\u914d\u5230\u591a\u4e2a\u6807\u7b7e\uff0c\u8fd9\u65f6\u8bf4\u660e\u6211\u4eec\u7684\u8bcd\u6c47\u51fa\u73b0\u4e86\u6b67\u4e49\u73b0\u8c61\uff0c\u8fd9\u5c31\u662f\u5339\u914d\u6b67\u4e49\u3002 \u5b66\u4e60\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528\uff1a \u5728\u8bcd\u6c47\u51fa\u73b0\u6b67\u4e49\u65f6\uff0c\u901a\u8fc7\u6a21\u578b\u91cd\u65b0\u8ba1\u7b97\u6240\u5c5e\u6807\u7b7e\u7684\u6982\u7387\uff0c\u4ece\u8bed\u4e49\u5c42\u9762\u83b7\u5f97\u66f4\u771f\u5b9e\u7684\u6807\u7b7e\u6982\u7387\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5339\u914d\u6b67\u4e49\u5224\u65ad\u7684\u8fc7\u7a0b\u3002 \u7b2c5\u5c0f\u8282: \u6982\u7387\u8c03\u6574 \u5b66\u4e60\u4e86\u6982\u7387\u8c03\u6574\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4fdd\u8bc1\u968f\u7740\u67d0\u4e00\u7c7b\u522b\u8bcd\u6c47\u51fa\u73b0\u7684\u6b21\u6570\u589e\u591a\uff0c\u8fd9\u4e2a\u7c7b\u522b\u7684\u6982\u7387\u4f1a\u968f\u4e4b\u589e\u52a0\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u56fe\u8c31\u5339\u914d\u7684\u8fc7\u7a0b\u3002 \u7b2c6\u5c0f\u8282: \u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u5b66\u4e60\u4e86\u6982\u7387\u5f52\u4e00\u5316\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u4f7f\u6807\u7b7e\u6982\u7387\u7684\u7ed3\u679c\u5728\uff080\u52301\uff09\u7684\u6982\u7387\u503c\u57df\u5185\u3002 \u5b66\u4e60\u4e86\u7236\u6807\u7b7e\u68c0\u7d22\u5728\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528: \u627e\u5230\u5f53\u524d\u6807\u7b7e\u7684\u7236\u6807\u7b7e\u5217\u8868\uff0c\u4e30\u5bcc\u7cfb\u7edf\u7684\u8fd4\u56de\u7ed3\u679c\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6982\u7387\u5f52\u4e00\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22\u7684\u8fc7\u7a0b\u3002","title":"\u7b2c\u4e00\u7ae0\u603b\u7ed3"},{"location":"6/#_2","text":"\u7b2c1\u5c0f\u8282: \u8bbe\u8ba1\u6807\u7b7e\u6811 \u5b66\u4e60\u4e86\u8bbe\u8ba1\u6807\u7b7e\u6811\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u8bbe\u8ba1\u539f\u5219\u3002 \u7b2c\u4e8c\u6b65: \u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e\u3002 \u7b2c\u4e09\u6b65: \u6807\u7b7e\u6811\u5b58\u50a8\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u8bbe\u8ba1\u539f\u5219: * \u4e1a\u52a1\u5bfc\u5411\u539f\u5219 * \u6700\u5c0f\u53ef\u884c\u5316\u539f\u5219 \u5b66\u4e60\u4e86\u786e\u5b9a\u4e00\u7ea7\u548c\u4e8c\u7ea7\u6807\u7b7e\u3002 \u5b66\u4e60\u4e86\u6807\u7b7e\u5b58\u50a8: * \u5fc5\u987b\u4f7f\u7528\u6241\u5e73\u5316\u7684\u5b58\u50a8\u7ed3\u6784\u3002 \u7b2c2\u5c0f\u8282: \u6784\u5efa\u6807\u7b7e\u6811 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u6784\u5efa\u6807\u7b7e\u6811\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5220\u9664\u4e4b\u524d\u7684\u4e0e\u6807\u7b7e\u76f8\u5173\u7684\u8282\u70b9\u548c\u8fb9\u3002 \u7b2c\u4e8c\u6b65: \u904d\u5386\u6807\u7b7e\u7ed3\u6784\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u5178\u3002 \u7b2c\u4e09\u6b65: \u904d\u5386\u5b57\u5178\u4e2d\u7684\u6bcf\u4e00\u7ec4key\u548cvalue\uff0c\u6839\u636ekey\uff0cMERGE\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u7236\u6807\u7b7e\u8282\u70b9\u3002 \u7b2c\u56db\u6b65: \u904d\u5386value\u5217\u8868\uff0c\u521b\u5efa\u6bcf\u4e00\u4e2a\u7b49\u7ea7\u7684\u5b50\u6807\u7b7e\u8282\u70b9\u53ca\u5176\u5173\u7cfb\u3002 \u7b2c3\u5c0f\u8282: \u83b7\u53d6\u539f\u59cb\u6570\u636e \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u4f5c\u4e3a\u5185\u5bb9\u751f\u4ea7\u5546\uff0c\u6709\u5404\u79cd\u7c7b\u578b\u5185\u5bb9\u7684\u751f\u4ea7\u5c0f\u7ec4\uff0c\u63d0\u4f9b\u5404\u79cd\u6587\u672c\u8bed\u6599\u3002 \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u6837\u5f0f\u3002 \u5b66\u4e60\u4e86\u539f\u59cb\u6570\u636e\u7684\u57fa\u672c\u5c5e\u6027\u3002 \u7b2c4\u5c0f\u8282: \u83b7\u53d6\u8bcd\u6c47\u96c6 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u8bcd\u6c47\u96c6\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8bfb\u53d6\u539f\u59cb\u6570\u636e\u5230\u5185\u5b58\u3002 \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u53e5\u5b50\u4e2d\u7684\u540d\u8bcd\u5e76\u8fdb\u884c\u957f\u5ea6\u8fc7\u6ee4\u3002 \u7b2c\u4e09\u6b65: \u5c06\u8bcd\u6c47\u5199\u5165\u5230csv\u6587\u4ef6\u4e4b\u4e2d\u3002 \u7b2c5\u5c0f\u8282: \u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u8bcd\u6c47\u96c6\u5bfc\u5165\u56fe\u8c31\u8fc7\u7a0b\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff0c\u5220\u9664\u6240\u6709\u4e0e\u8bcd\u6c47\u8282\u70b9\u53ca\u5176\u76f8\u5173\u7684\u8fb9 \u7b2c\u4e8c\u6b65\uff0c\u904d\u5386labels\u6587\u4ef6\u5939\u4e0b\u7684\u8bcd\u6c47csv\u6587\u4ef6\u3002 \u7b2c\u4e09\u6b65\uff0c\u904d\u5386csv\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u8bcd\u6c47\u521b\u5efa\u8282\u70b9\uff0c\u5e76\u4e0e\u5bf9\u5e94\u7684\u6807\u7b7e\u5efa\u7acb\u5173\u7cfb\u3002","title":"\u7b2c\u4e8c\u7ae0\u603b\u7ed3"},{"location":"6/#_3","text":"\u7b2c1\u5c0f\u8282: \u83b7\u53d6\u8bad\u7ec3\u8bed\u6599 \u5b66\u4e60\u4e86\u83b7\u53d6\u8bad\u7ec3\u8bed\u6599\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a \u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90\u3002 \u7b2c\u4e8c\u6b65\uff1a \u5b9a\u4e49\u6b63\u8d1f\u6837\u672c\u3002 \u7b2c\u4e09\u6b65\uff1a \u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u539f\u59cb\u6570\u636e\u6765\u6e90: \u516c\u53f8\u5185\u5bb9\u751f\u4ea7\u5c0f\u7ec4\u63d0\u4f9b\u7684\u5404\u79cd\u7c7b\u578b\u7684\u6587\u7ae0\u3002 \u5b66\u4e60\u4e86\u5b9a\u4e49\u6b63\u8d1f\u6837\u672c: \u5c06\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8be5\u7c7b\u522b\u7684\u6b63\u6837\u672c\uff1b \u5c06\u5176\u4ed6\u7c7b\u522b\u6587\u7ae0\u4e2d\u7684\u6bcf\u4e00\u6761\u53e5\u5b50\u4f5c\u4e3a\u8d1f\u6837\u672c\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u63d0\u53d6\u6b63\u8d1f\u6837\u672c: \u5148\u63d0\u53d6\u6b63\u6837\u672c\u8bed\u6599\uff0c\u518d\u5728\u6b63\u6837\u672c\u57fa\u7840\u4e0a\uff0c\u63d0\u53d6\u6b63\u8d1f\u6837\u672c\u8bed\u6599\u3002 \u7b2c2\u5c0f\u8282: \u8fdb\u884c\u6570\u636e\u5206\u6790 \u5b66\u4e60\u4e86\u6570\u636e\u5206\u6790\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e\u3002 \u7b2c\u4e8c\u6b65: \u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03\u3002 \u7b2c\u4e09\u6b65: \u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u3002 \u7b2c\u56db\u6b65: \u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6837\u672c\u7684\u5206\u8bcd\u5217\u8868\u548c\u5bf9\u5e94\u7684\u6807\u7b7e\u3002 \u4f5c\u7528: \u4e3a\u8fdb\u884c\u53ef\u89c6\u5316\u6570\u636e\u5206\u6790\u4f5c\u6570\u636e\u51c6\u5907\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u6b63\u8d1f\u6807\u7b7e\u6570\u91cf\u5206\u5e03\u3002 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u8c03\u6574\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u53e5\u5b50\u957f\u5ea6\u5206\u5e03\u3002 \u4f5c\u7528: \u7528\u4e8e\u5e2e\u52a9\u5224\u65ad\u53e5\u5b50\u5408\u7406\u7684\u622a\u65ad\u957f\u5ea6\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u83b7\u53d6\u5e38\u89c1\u8bcd\u9891\u5206\u5e03\u3002 \u4f5c\u7528: \u6307\u5bfc\u4e4b\u540e\u6a21\u578b\u8d85\u53c2\u6570max_feature\u7684\u9009\u62e9\u548c\u521d\u6b65\u8bc4\u4f30\u6570\u636e\u8d28\u91cf\u3002 \u7b2c3\u5c0f\u8282: \u7279\u5f81\u5904\u7406 \u5b66\u4e60\u4e86\u7279\u5f81\u5904\u7406\u8fc7\u7a0b\u7684\u56db\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u8fdb\u884c\u8bcd\u6c47\u6620\u5c04 \u7b2c\u4e8c\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad \u7b2c\u4e09\u6b65: \u52a0\u5165n-gram\u7279\u5f81 \u7b2c\u56db\u6b65: \u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u8fdb\u884c\u8bcd\u6c47\u6620\u5c04: \u4f5c\u7528: \u5c06\u5206\u8bcd\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u6620\u5c04\u6210\u6570\u5b57\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u5408\u9002\u622a\u65ad: \u4f5c\u7528: \u5c06\u6620\u5c04\u540e\u7684\u53e5\u5b50\u5411\u91cf\u8fdb\u884c\u622a\u65ad\uff0c\u4ee5\u964d\u4f4e\u6a21\u578b\u8f93\u5165\u7684\u7279\u5f81\u7ef4\u5ea6\uff0c\u6765\u9632\u6b62\u8fc7\u62df\u5408\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u52a0\u5165n-gram\u7279\u5f81: \u4f5c\u7528: \u5c06n-gram\u8868\u793a\u4f5c\u4e3a\u7279\u5f81\uff0c\u80fd\u591f\u8865\u5145\u7279\u5f81\u4e2d\u6ca1\u6709\u4e0a\u4e0b\u6587\u4e2d\u5173\u8054\u7684\u7f3a\u70b9\uff0c\u5c06\u6709\u6548\u5e2e\u52a9\u6a21\u578b\u6355\u6349\u4e0a\u4e0b\u6587\u7684\u8bed\u4e49\u5173\u8054\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5c06\u5411\u91cf\u8fdb\u884c\u6700\u957f\u8865\u9f50: \u4f5c\u7528: \u4e3a\u4e86\u4e0d\u635f\u5931n-gram\u7279\u5f81\uff0c\u4f7f\u5411\u91cf\u80fd\u591f\u4ee5\u77e9\u9635\u5f62\u5f0f\u4f5c\u4e3a\u6a21\u578b\u8f93\u5165\u3002 \u7b2c4\u5c0f\u8282: \u6784\u5efa\u6a21\u578b\u7ed3\u6784 \u5b66\u4e60\u4e86\u6a21\u578b\u7ed3\u6784\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u5c42: Embedding\u5c42 GAP\u5c42(\u5168\u5c40\u5e73\u5747\u6c60\u5316\u5c42) Dense + sigmoid\u5c42 \u5b66\u4e60\u4e86Embedding\u5c42: \u5c42\u7ed3\u6784: \u7ed3\u6784\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u8bed\u6599\u7684\u6709\u6548\u8bcd\u6c47\u603b\u6570(max_features)\u4e58\u4ee5\u6211\u4eec\u9884\u5b9a\u4e49\u7684embedding_dims\uff0c\u8fd9\u4e2a\u77e9\u9635\u5c31\u76f8\u5f53\u4e8e\u662f\u7531\u6bcf\u4e00\u4e2a\u7279\u5f81\u62d3\u5c55\u6210embedding_dims\u540e\u7684\u8868\u793a\u3002 \u5c42\u53c2\u6570: \u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\uff0c\u4e00\u822c\u6a21\u578b\u9700\u8981\u6c42\u89e3\u7684\u53c2\u6570\uff0c\u56e0\u6b64Embedding\u5c42\u7684\u53c2\u6570\u603b\u91cf\u662fmax_features x embedding_dims\u3002 \u8f93\u5165\u53c2\u6570: max_features\u5373\u6700\u5927\u7279\u5f81\u6570, embedding_dims\u5373\u8bcd\u5d4c\u5165\u7ef4\u5ea6, input_length\u5373\u53e5\u5b50\u7684\u6700\u5927\u957f\u5ea6\u3002 \u8f93\u5165\u5f62\u72b6: [None, input_length] \u8f93\u51fa\u5f62\u72b6: [None, input_length, embedding_dims] \u4f5c\u7528: \u7528\u5411\u91cf\u8868\u793a\u6bcf\u4e00\u4e2a\u7279\u5f81\uff0c\u5728\u66f4\u9ad8\u7ef4\u5ea6\u7684\u6620\u5c04\u7a7a\u95f4\u6355\u6349\u8bcd\u4e0e\u8bcd\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 \u5b66\u4e60\u4e86GAP\u5c42: \u5c42\u7ed3\u6784: \u672c\u8d28\u4e0a\u662f\u5bf9\u77e9\u9635\u7684\u4e00\u79cd\u8ba1\u7b97\u65b9\u6cd5\uff0c\u65e0\u7ed3\u6784\u3002 \u5c42\u53c2\u6570: \u65e0 \u8f93\u5165\u53c2\u6570: \u65e0 \u8f93\u5165\u5f62\u72b6: [None, input_length, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, embedding_dims] \u4f5c\u7528: \u6d88\u51cf\u6a21\u578b\u53c2\u6570\u603b\u91cf\uff0c\u9632\u6b62\u8fc7\u62df\u5408\u3002 \u5b66\u4e60\u4e86Dense + sigmoid\u5c42: \u5c42\u7ed3\u6784: \u5177\u6709\u4e2a1\u4e2a\u8282\u70b9\u7684\u4e00\u5c42\u5168\u8fde\u63a5\u7f51\u7edc\uff0c\u6700\u540e\u7684\u6fc0\u6d3b\u51fd\u6570\u4f7f\u7528sigmoid\u3002 \u5c42\u53c2\u6570: \u8be5\u8282\u70b9\u4e2d\u7684w\u5411\u91cf\u517150\u7ef4\uff0c\u52a0\u4e0a\u4e00\u4e2a\u504f\u7f6eb\uff0c\u517151\u4e2a\u53c2\u6570\u3002 \u8f93\u5165\u53c2\u6570: \u5206\u522b\u662f\u8be5\u5c42\u7684\u8282\u70b9\u6570\u4ee5\u53ca\u4f7f\u7528\u7684sigmoid\u51fd\u6570\u3002 \u8f93\u5165\u5f62\u72b6: [None, embedding_dims] \u8f93\u51fa\u5f62\u72b6: [None, 1] \u4f5c\u7528: \u5c06\u62bd\u8c61\u7684\u7279\u5f81\u8868\u793a\u5f52\u4e00\u5230\u6307\u5b9a\u7684\u7c7b\u522b\u4e0a\uff0c\u80fd\u591f\u8f93\u51fa\u6211\u4eec\u60f3\u8981\u76840\u6216\u80051\u7684\u7ed3\u679c\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u4f7f\u7528\u4e0a\u9762\u4e09\u4e2a\u5c42\u6784\u5efafasttext\u6a21\u578b\u3002 \u7b2c5\u5c0f\u8282: \u9009\u53d6\u635f\u5931\u51fd\u6570\u548c\u4f18\u5316\u65b9\u6cd5 fasttext\u6a21\u578b\u9009\u53d6\u7684\u635f\u5931\u51fd\u6570: \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931\u51fd\u6570 fasttext\u6a21\u578b\u9009\u53d6\u7684\u4f18\u5316\u65b9\u6cd5: Adam \u4e8c\u5206\u7c7b\u4ea4\u53c9\u71b5\u635f\u5931: \u4f5c\u7528: \u7528\u4e8e\u63cf\u8ff0\u6a21\u578b\u9884\u6d4b\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u5dee\u8ddd\u5927\u5c0f\u3002 \u5f62\u5f0f: \u4f18\u52bf: \u4f5c\u4e3a\u4e00\u79cd\u4f18\u5316\u540e\u7684\u635f\u5931\u51fd\u6570\uff0c\u80fd\u591f\u907f\u514d\u5747\u65b9\u8bef\u5dee\u635f\u5931\u7684\u5728\u5904\u7406sigmoid\u51fd\u6570\u65f6\u6536\u655b\u5230\u8d8b\u4e8e1\u65f6\uff0c\u68af\u5ea6\u975e\u5e38\u5e73\u7f13\uff0c\u53c8\u56e0\u4e3a\u4f7f\u7528\u7684\u4f18\u5316\u65b9\u6cd5\u5f80\u5f80\u57fa\u4e8e\u68af\u5ea6\u4e0b\u964d\uff0c\u6240\u4ee5\u51fa\u73b0\u201d\u5b66\u4e60\u8fdf\u7f13\u201d\u7684\u73b0\u8c61\u3002\u4e3a\u4e86\u907f\u514d\u8be5\u73b0\u8c61\uff0c\u4ea4\u53c9\u71b5\u7684\u5f62\u5f0f\u5e94\u8fd0\u800c\u751f\u3002 Adam\u4f18\u5316\u65b9\u6cd5: \u4f5c\u7528: \u6c42\u635f\u5931\u51fd\u6570\u6700\u4f18\u89e3\u7684\u65b9\u6cd5\u3002 \u4f18\u52bf: \u7ed3\u5408Adagrad\u4e0eRSMProp\u7684\u7b97\u6cd5\u7279\u70b9\uff0c \u5bf9\u68af\u5ea6\u7684\u4e00\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u5747\u503c\uff09\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff08\u5373\u68af\u5ea6\u7684\u672a\u4e2d\u5fc3\u5316\u7684\u65b9\u5dee\uff09\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u8ba1\u7b97\u51fa\u66f4\u65b0\u6b65\u957f. \u5b66\u4e60\u7387\u53ef\u81ea\u7531\u8c03\u8282\u3002 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u5728\u6a21\u578b\u4e2d\u9009\u53d6\u635f\u5931\u51fd\u6570\u4e0e\u4f18\u5316\u65b9\u6cd5\u3002 \u7b2c6\u5c0f\u8282: \u8fdb\u884c\u6a21\u578b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u5b9e\u73b0\u6a21\u578b\u8bad\u7ec3\u548c\u7ed8\u5236\u51c6\u66f2\u7387\u548c\u635f\u5931\u5bf9\u7167\u66f2\u7ebf\u7684\u8fc7\u7a0b\u3002 \u5b66\u4e60\u4e86\u901a\u8fc7\u51c6\u786e\u7387\u5bf9\u7167\u66f2\u7ebf\u5224\u65ad\u8fc7\u62df\u5408\uff1a \u5f53\u8bad\u7ec3\u51c6\u786e\u7387\u4e0a\u5347\u800c\u9a8c\u8bc1\u51c6\u786e\u7387\u5f00\u59cb\u5e73\u7f13\u6216\u4e0b\u964d\u65f6\uff0c\u5728\u8fd9\u4e2a\u70b9\u5904\u5f00\u59cb\u51fa\u73b0\u8fc7\u62df\u5408\u73b0\u8c61\u3002 \u5b66\u4e60\u4e86\u5982\u4f55\u9632\u6b62\u8fc7\u62df\u5408: \u901a\u8fc7\u5bf9\u6bd4\u9a8c\u8bc1\u96c6\u4e0e\u8bad\u7ec3\u96c6\u51c6\u786e\u66f2\u7ebf\uff0c\u5728\u9a8c\u8bc1acc\u4e0d\u5728\u4e0a\u5347\u7684\u8f6e\u6570\u65f6\u505c\u6b62\u8bad\u7ec3\u3002 \u7b2c7\u5c0f\u8282: \u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d \u5b66\u4f1a\u4e86\u5b9e\u73b0\u6a21\u578b\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u7684\u8fc7\u7a0b\u3002","title":"\u7b2c\u4e09\u7ae0\u603b\u7ed3"},{"location":"6/#_4","text":"\u7b2c\u4e00\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u8bad\u7ec3 \u5b66\u4e60\u4e86\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u539f\u56e0: \u5728python\u8fd9\u95e8\u8bed\u8a00\u4e2d\uff0c\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u89e3\u91ca\u9501\uff0c\u5b83\u4f7f\u7cfb\u7edf\u7684\u591a\u4e2a\u7ebf\u7a0b\u65e0\u6cd5\u4e00\u540c\u4f7f\u7528CPU\u8d44\u6e90\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u7528\u591a\u8fdb\u7a0b\u65b9\u5f0f\u5e76\u884c\u5316\uff0c\u800c\u6211\u4eec\u7684\u6a21\u578b\u8bad\u7ec3\uff0c\u6b63\u662f\u6700\u5178\u578b\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91cc\u9762\u6db5\u76d6\u5927\u91cf\u7684\u77e9\u9635\u8ba1\u7b97\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u591a\u8fdb\u7a0b\u8bad\u7ec3\u3002 \u5b66\u4e60\u4e86\u591a\u6a21\u578b\u591a\u8fdb\u7a0b\u7684\u8bad\u7ec3\u903b\u8f91\uff1a \u5f00\u542f\u7b2c\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\uff0c\u8fdb\u5165\u8bad\u7ec3\u72b6\u6001\u540e\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\u3002\u5c0f\u4e8eCPU/\u5185\u5b58\u6b63\u5e38\u8d1f\u8f7d\u503c\uff0c\u5219\u5f00\u542f\u7b2c\u4e8c\u4e2a\u6a21\u578b\u8bad\u7ec3\u4efb\u52a1\u3002\u5426\u5219\uff0c\u5f00\u59cb\u68c0\u6d4b\u5360\u7528\u8d44\u6e90\u662f\u5426\u5927\u4e8eCPU/\u5185\u5b58\u5371\u9669\u8d1f\u8f7d\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u5219kill\u6389\u8fd9\u4e2a\u8fdb\u7a0b\uff0c\u5426\u5219\uff0c\u8bf4\u660e\u5360\u7528\u7387\u5904\u5728\u6b63\u5e38\u8d1f\u8f7d\u503c\u4e0e\u5371\u9669\u8d1f\u8f7d\u503c\u4e4b\u95f4\uff0c\u6b64\u65f6\uff0c\u7b49\u5f85\u8be5\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u7ed3\u675f\uff0c\u518d\u81ea\u52a8\u5f00\u542f\u4e0b\u4e00\u4e2a\u6a21\u578b\u8bad\u7ec3\u8fdb\u7a0b\u3002 \u7b2c\u4e8c\u5c0f\u8282: \u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u591a\u6a21\u578b\u591a\u7ebf\u7a0b\u9884\u6d4b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u5c06h5\u683c\u5f0f\u7684\u6a21\u578b\u8f6c\u5316\u6210pb\u683c\u5f0f\u3002 \u7b2c\u4e8c\u6b65: \u4f7f\u7528docker\u542f\u52a8tensorflow-serving\u5fae\u670d\u52a1\u3002 \u7b2c\u4e09\u6b65: \u591a\u7ebf\u7a0b\u8c03\u7528\u5fae\u670d\u52a1\u5e76\u5904\u7406\u7ed3\u679c\u3002","title":"\u7b2c\u56db\u7ae0\u603b\u7ed3"},{"location":"6/#_5","text":"\u7b2c\u4e00\u5c0f\u8282: \u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5 \u5b66\u4e60\u5e76\u5b9e\u73b0\u7cfb\u7edf\u8054\u8c03\u4e0e\u6d4b\u8bd5\u8fc7\u7a0b\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65: \u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282\u3002 \u7b2c\u4e8c\u6b65: \u5c06\u8fd9\u4e94\u4e2a\u73af\u8282\u5b9e\u73b0\u5728django\u670d\u52a1\u7684views.py\u51fd\u6570\u4e2d\u3002 \u7b2c\u4e09\u6b65: \u4f7f\u7528\u6d4b\u8bd5\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\u3002 \u5b66\u4e60\u4e86\u660e\u786e\u7cfb\u7edf\u5904\u7406\u8bf7\u6c42\u7684\u4e94\u4e2a\u73af\u8282: \u8f93\u5165\u9884\u5904\u7406 \u56fe\u8c31\u5339\u914d \u5339\u914d\u6b67\u4e49\u5224\u65ad \u6982\u7387\u8c03\u6574 \u6982\u7387\u6807\u7b7e\u5316\u4e0e\u7236\u6807\u7b7e\u68c0\u7d22 \u7b2c\u4e8c\u5c0f\u8282: \u642d\u5efa\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762 \u5b66\u4e60\u5e76\u5b9e\u73b0\u4e86\u642d\u5efa\u4e00\u4e2a\u524d\u7aef\u53ef\u89c6\u5316\u9875\u9762\u7684\u4e09\u6b65\u66f2: \u7b2c\u4e00\u6b65\uff1a\u4f7f\u7528bootstrap3\u642d\u5efa\u4e00\u4e2a\u53ef\u89c6\u5316\u9875\u9762\u3002 \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528jquery\u5411\u540e\u7aef\u53d1\u9001ajax\u8bf7\u6c42\u5e76\u663e\u793a\u7ed3\u679c\u3002 \u7b2c\u4e09\u6b65: \u5728\u9875\u9762\u4e2d\u8f93\u5165\u6587\u672c\u8fdb\u884c\u8bf7\u6c42\u6d4b\u8bd5\u3002","title":"\u7b2c\u4e94\u7ae0\u603b\u7ed3"},{"location":"7/","text":"\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7cfb\u7edf\u5b89\u88c5\u90e8\u7f72\u624b\u518c \u6ce8\u610f\u4e8b\u9879: \u8fd9\u4e2a\u5b89\u88c5\u624b\u518c\u53ea\u9002\u7528\u4e8e\u64cd\u4f5c\u7cfb\u7edf: centos7 \u5b89\u88c5\u90e8\u7f72\u6b65\u9aa4: 0, \u62f7\u8d1d\u5fc5\u5907\u6587\u4ef6: 1, \u5b89\u88c5Anconda\u79d1\u5b66\u8ba1\u7b97\u73af\u5883\uff0c \u5b83\u5305\u62ecpython3\uff0c pip\uff0cpandas\uff0c numpy\u7b49\u79d1\u5b66\u8ba1\u7b97\u5305\u3002 cd /root curl -O https://repo.anaconda.com/archive/Anaconda3-5.2.0-Linux-x86_64.sh sh Anaconda3-2019.07-Linux-x86_64.sh # \u914d\u7f6e~/.bashrc, \u6dfb\u52a0\u4e00\u884c: export PATH=/root/anaconda/bin/:$PATH 2, \u5b89\u88c5\u5fc5\u5907\u7ec4\u4ef6supervisor, nginx yum install supervisor -y yum install nginx -y 3, \u5b89\u88c5\u9879\u76ee\u9700\u8981\u7684python\u5de5\u5177\u5305\uff0cuwsgi\uff0ctensorflow\uff0ckeras\uff0cdjango\u7b49\uff0c\u6211\u4eec\u4f7f\u7528requirements.txt\u4e00\u540c\u5b89\u88c5\u3002 cd /data/django-uwsgi/ pip install requirements.txt -r 4, \u5b89\u88c5\u56fe\u6570\u636e\u5e93neo4j # \u751f\u6210yum\u955c\u50cf rpm --import http://debian.neo4j.org/neotechnology.gpg.key cat <<EOF> /etc/yum.repos.d/neo4j.repo [neo4j] name=Neo4j RPM Repository baseurl=http://yum.neo4j.org/stable enabled=1 gpgcheck=1 EOF # \u5b89\u88c5neo4j yum install neo4j-3.3.5 ` # \u4f7f\u7528\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6 cp /data/django-uwsgi/util/neo4j.conf /etc/neo4j/neo4j.conf 5, \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u72b6\u6001 # \u542f\u52a8 neo4j start # \u67e5\u770b\u72b6\u6001 neo4j status 6, \u4f7f\u7528\u811a\u672c\u751f\u6210\u56fe\u8c31 python /data/django-uswgi/text_labeled/create_graph/build.py 7, \u4f7f\u7528\u591a\u8fdb\u7a0b\u811a\u672c\u8bad\u7ec3\u6a21\u578b cd /data/django-uwsgi/text_labeled/model_train/ python multiprocess_train.py 8, \u5b89\u88c5docker\u5e76\u5c01\u88c5\u6a21\u578b\u5fae\u670d\u52a1 # \u5b89\u88c5docker yum install docker # \u4f7f\u7528docker\u62c9\u53d6tensorflow-serving\u955c\u50cf\u3002 docker pull tensorflow/serving MODEL_PATH=\"/data/django-uwsgi/text_labeled/model_train\" # \u4f7f\u7528docker run\u547d\u4ee4\u542f\u52a8\u5fae\u670d\u52a1 # \u542f\u52a8\u7b2c\u4e00\u4e2a\u6a21\u578b docker run -t --rm -p 8501:8501 \\ -v \"$MODEL_PATH/movie:/models/movie\" \\ -e MODEL_NAME=movie \\ tensorflow/serving & # \u540c\u7406\u542f\u52a8\uff0c \u542f\u52a8\u7b2c\u4e8c\u4e2a\u6a21\u578b docker run -t --rm -p 8501:8502 \\ -v \"$MODEL_PATH/beauty:/models/beauty\" \\ -e MODEL_NAME=beauty \\ tensorflow/serving & # \u66f4\u591a\u6a21\u578b\u4ee5\u6b64\u7c7b\u63a8 # \u4f7f\u7528curl\u547d\u4ee4\u5728\u7ec8\u7aef\u8fdb\u884c\u6d4b\u8bd5\u3002 curl -d '{\"instances\": [[1.0, 2.0, 5.0]]}' \\ -X POST http://localhost:8501/v1/models/movie:predict 9, \u4f7f\u7528supervisor\u542f\u52a8nginx\u548cuwsgi\u4e3b\u670d\u52a1 cd /data/django-uwsgi/text_labeled/ # \u542f\u52a8\u4e3b\u670d\u52a1 supervisord -c supervisor.conf # \u67e5\u770b\u72b6\u6001 supervisorctl status all 10, \u4f7f\u7528\u811a\u672c\u53d1\u9001\u8bf7\u6c42\u8fdb\u884c\u6d4b\u8bd5 python /data/django-uwsgi/test.py","title":"\u9644\u5f55-\u73af\u5883\u5b89\u88c5\u90e8\u7f72\u624b\u518c"},{"location":"7/#_1","text":"\u6ce8\u610f\u4e8b\u9879: \u8fd9\u4e2a\u5b89\u88c5\u624b\u518c\u53ea\u9002\u7528\u4e8e\u64cd\u4f5c\u7cfb\u7edf: centos7 \u5b89\u88c5\u90e8\u7f72\u6b65\u9aa4: 0, \u62f7\u8d1d\u5fc5\u5907\u6587\u4ef6: 1, \u5b89\u88c5Anconda\u79d1\u5b66\u8ba1\u7b97\u73af\u5883\uff0c \u5b83\u5305\u62ecpython3\uff0c pip\uff0cpandas\uff0c numpy\u7b49\u79d1\u5b66\u8ba1\u7b97\u5305\u3002 cd /root curl -O https://repo.anaconda.com/archive/Anaconda3-5.2.0-Linux-x86_64.sh sh Anaconda3-2019.07-Linux-x86_64.sh # \u914d\u7f6e~/.bashrc, \u6dfb\u52a0\u4e00\u884c: export PATH=/root/anaconda/bin/:$PATH 2, \u5b89\u88c5\u5fc5\u5907\u7ec4\u4ef6supervisor, nginx yum install supervisor -y yum install nginx -y 3, \u5b89\u88c5\u9879\u76ee\u9700\u8981\u7684python\u5de5\u5177\u5305\uff0cuwsgi\uff0ctensorflow\uff0ckeras\uff0cdjango\u7b49\uff0c\u6211\u4eec\u4f7f\u7528requirements.txt\u4e00\u540c\u5b89\u88c5\u3002 cd /data/django-uwsgi/ pip install requirements.txt -r 4, \u5b89\u88c5\u56fe\u6570\u636e\u5e93neo4j # \u751f\u6210yum\u955c\u50cf rpm --import http://debian.neo4j.org/neotechnology.gpg.key cat <<EOF> /etc/yum.repos.d/neo4j.repo [neo4j] name=Neo4j RPM Repository baseurl=http://yum.neo4j.org/stable enabled=1 gpgcheck=1 EOF # \u5b89\u88c5neo4j yum install neo4j-3.3.5 ` # \u4f7f\u7528\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6 cp /data/django-uwsgi/util/neo4j.conf /etc/neo4j/neo4j.conf 5, \u542f\u52a8\u56fe\u6570\u636e\u5e93\u5e76\u67e5\u770b\u72b6\u6001 # \u542f\u52a8 neo4j start # \u67e5\u770b\u72b6\u6001 neo4j status 6, \u4f7f\u7528\u811a\u672c\u751f\u6210\u56fe\u8c31 python /data/django-uswgi/text_labeled/create_graph/build.py 7, \u4f7f\u7528\u591a\u8fdb\u7a0b\u811a\u672c\u8bad\u7ec3\u6a21\u578b cd /data/django-uwsgi/text_labeled/model_train/ python multiprocess_train.py 8, \u5b89\u88c5docker\u5e76\u5c01\u88c5\u6a21\u578b\u5fae\u670d\u52a1 # \u5b89\u88c5docker yum install docker # \u4f7f\u7528docker\u62c9\u53d6tensorflow-serving\u955c\u50cf\u3002 docker pull tensorflow/serving MODEL_PATH=\"/data/django-uwsgi/text_labeled/model_train\" # \u4f7f\u7528docker run\u547d\u4ee4\u542f\u52a8\u5fae\u670d\u52a1 # \u542f\u52a8\u7b2c\u4e00\u4e2a\u6a21\u578b docker run -t --rm -p 8501:8501 \\ -v \"$MODEL_PATH/movie:/models/movie\" \\ -e MODEL_NAME=movie \\ tensorflow/serving & # \u540c\u7406\u542f\u52a8\uff0c \u542f\u52a8\u7b2c\u4e8c\u4e2a\u6a21\u578b docker run -t --rm -p 8501:8502 \\ -v \"$MODEL_PATH/beauty:/models/beauty\" \\ -e MODEL_NAME=beauty \\ tensorflow/serving & # \u66f4\u591a\u6a21\u578b\u4ee5\u6b64\u7c7b\u63a8 # \u4f7f\u7528curl\u547d\u4ee4\u5728\u7ec8\u7aef\u8fdb\u884c\u6d4b\u8bd5\u3002 curl -d '{\"instances\": [[1.0, 2.0, 5.0]]}' \\ -X POST http://localhost:8501/v1/models/movie:predict 9, \u4f7f\u7528supervisor\u542f\u52a8nginx\u548cuwsgi\u4e3b\u670d\u52a1 cd /data/django-uwsgi/text_labeled/ # \u542f\u52a8\u4e3b\u670d\u52a1 supervisord -c supervisor.conf # \u67e5\u770b\u72b6\u6001 supervisorctl status all 10, \u4f7f\u7528\u811a\u672c\u53d1\u9001\u8bf7\u6c42\u8fdb\u884c\u6d4b\u8bd5 python /data/django-uwsgi/test.py","title":"\u667a\u80fd\u6587\u672c\u5206\u7c7b\u7cfb\u7edf\u5b89\u88c5\u90e8\u7f72\u624b\u518c"}]}