<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Mask RCNN分割案例1 | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-expandable-chapters/expandable-chapters.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-splitter/splitter.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../imageSegmentation/section8.html" />
    
    
    <link rel="prev" href="../imageSegmentation/section6.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="6.5"
        data-chapter-title="Mask RCNN分割案例1"
        data-filepath="imageSegmentation/section7.md"
        data-basepath=".."
        data-revision="Sun Oct 11 2020 09:58:20 GMT+0800 (中国标准时间)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        计算机视觉与深度学习课程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="introduction/index.html">
            
                
                    <a href="../introduction/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        计算机视觉简介
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="introduction/section1.html">
            
                
                    <a href="../introduction/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        计算机视觉概念
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="introduction/section2.html">
            
                
                    <a href="../introduction/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        计算机视觉任务
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="tensorFlow/index.html">
            
                
                    <a href="../tensorFlow/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        tensorflow入门
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="tensorFlow/section1.html">
            
                
                    <a href="../tensorFlow/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        TensorFlow和Keras简介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="tensorFlow/section2.html">
            
                
                    <a href="../tensorFlow/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        快速入门模型
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="deeplearning/index.html">
            
                
                    <a href="../deeplearning/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        深度神经网络
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="deeplearning/section1.html">
            
                
                    <a href="../deeplearning/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        神经网络简介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="deeplearning/section2.html">
            
                
                    <a href="../deeplearning/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        常见的损失函数
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="deeplearning/section3.html">
            
                
                    <a href="../deeplearning/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        深度学习的优化方法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="deeplearning/section4.html">
            
                
                    <a href="../deeplearning/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        深度学习的正则化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="deeplearning/section5.html">
            
                
                    <a href="../deeplearning/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        神经网络案例
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="deeplearning/section6.html">
            
                
                    <a href="../deeplearning/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        卷积神经网络CNN
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="imageClassification/index.html">
            
                
                    <a href="../imageClassification/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        图像分类
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="imageClassification/section1.html">
            
                
                    <a href="../imageClassification/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        图像分类简介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="imageClassification/section2.html">
            
                
                    <a href="../imageClassification/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        AlexNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="imageClassification/section3.html">
            
                
                    <a href="../imageClassification/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        VGG
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="imageClassification/section4.html">
            
                
                    <a href="../imageClassification/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        GoogLeNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="imageClassification/section5.html">
            
                
                    <a href="../imageClassification/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        ResNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="imageClassification/section6.html">
            
                
                    <a href="../imageClassification/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        图像增强方法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="imageClassification/section7.html">
            
                
                    <a href="../imageClassification/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        模型微调
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="objectdection/index.html">
            
                
                    <a href="../objectdection/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        目标检测(Object Detection)
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="objectdection/section1.html">
            
                
                    <a href="../objectdection/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        目标检测概述
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="objectdection/section2.html">
            
                
                    <a href="../objectdection/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="objectdection/section3.html">
            
                
                    <a href="../objectdection/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        SPPNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="objectdection/section4.html">
            
                
                    <a href="../objectdection/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Fast R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="objectdection/section5.html">
            
                
                    <a href="../objectdection/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Faster R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="objectdection/section6.html">
            
                
                    <a href="../objectdection/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Faster RCNN接口分析
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="objectdection/section7.html">
            
                
                    <a href="../objectdection/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        YOLO算法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="objectdection/section8.html">
            
                
                    <a href="../objectdection/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        YOLOV2&amp;V3
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="objectdection/section9.html">
            
                
                    <a href="../objectdection/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        SSD算法原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="objectdection/section10.html">
            
                
                    <a href="../objectdection/section10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        案例：KITTI人、车检测案例-数据集处理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="objectdection/section11.html">
            
                
                    <a href="../objectdection/section11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        案例：KITTI人、车检测案例-训练、检测
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="imageSegmentation/index.html">
            
                
                    <a href="../imageSegmentation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        目标分割(Object Segmentation)
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="imageSegmentation/section1.html">
            
                
                    <a href="../imageSegmentation/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        目标分割介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="imageSegmentation/section2.html">
            
                
                    <a href="../imageSegmentation/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        FCN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="imageSegmentation/section3.html">
            
                
                    <a href="../imageSegmentation/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        SegNet与U-Net
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="imageSegmentation/section6.html">
            
                
                    <a href="../imageSegmentation/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Mask RCNN
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="6.5" data-path="imageSegmentation/section7.html">
            
                
                    <a href="../imageSegmentation/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Mask RCNN分割案例1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="imageSegmentation/section8.html">
            
                
                    <a href="../imageSegmentation/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        Mask RCNN分割案例2
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="68-mask-rcnn&#x5206;&#x5272;&#x6848;&#x4F8B;">6.8 Mask RCNN&#x5206;&#x5272;&#x6848;&#x4F8B;</h1>
<h3 id="&#x5B66;&#x4E60;&#x76EE;&#x6807;">&#x5B66;&#x4E60;&#x76EE;&#x6807;</h3>
<ul>
<li>&#x76EE;&#x6807;<ul>
<li>&#x77E5;&#x9053;&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;&#x7684;&#x8BFB;&#x53D6;&#x5904;&#x7406;&#x65B9;&#x5F0F;</li>
</ul>
</li>
<li>&#x5E94;&#x7528;<ul>
<li>&#x5E94;&#x7528;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x96C6;&#x5185;&#x5BB9;&#x6807;&#x7B7E;&#x7ED3;&#x679C;&#x7684;&#x8BFB;&#x53D6;</li>
</ul>
</li>
</ul>
<h3 id="681-&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;&#x4ECB;&#x7ECD;&#x6C14;&#x7403;&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;">6.8.1 &#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;&#x4ECB;&#x7ECD;-&#x6C14;&#x7403;&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;</h3>
<p>&#x6C14;&#x7403;&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x578B;&#x7684;&#x5206;&#x5272;&#x4EFB;&#x52A1;&#x6570;&#x636E;&#x3002;&#x76EE;&#x7684;&#x662F;&#x5C06;&#x6C14;&#x7403;&#x4ECE;&#x56FE;&#x7247;&#x6216;&#x8005;&#x89C6;&#x9891;&#x4E2D;&#x5206;&#x5272;&#x51FA;&#x6765;&#x3002;&#x6570;&#x636E;&#x96C6;&#x6709;&#x8BAD;&#x7EC3;&#x96C6;&#x548C;&#x9A8C;&#x8BC1;&#x96C6;</p>
<p>&#x76EE;&#x5F55;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="../images/&#x6C14;&#x7403;&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;.jpg" style="zoom:70%;"></p>
<ul>
<li>&#x8BAD;&#x7EC3;&#x9A8C;&#x8BC1;&#x90FD;&#x542B;&#x6709;.json&#x6807;&#x6CE8;&#x6587;&#x4EF6;&#x4EE5;&#x53CA;jpg&#x6587;&#x4EF6;<ul>
<li>&#x5927;&#x591A;&#x6570;&#x5206;&#x5272;&#x901A;&#x8FC7;VIA tool&#x6807;&#x6CE8;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;&#x7684;mask&#x7ED3;&#x679C;</li>
<li>&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x7684;&#x6807;&#x6CE8;&#x6570;&#x636E;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x68C0;&#x6D4B;&#x6846;&#x7684;&#x6807;&#x6CE8;&#x4FE1;&#x606F;&#xFF0C;&#x540E;&#x671F;&#x68C0;&#x6D4B;&#x6846;&#x7684;&#x751F;&#x6210;&#x662F;&#x52A8;&#x6001;&#x6839;&#x636E;mask&#x7ED3;&#x679C;&#x751F;&#x6210;&#x7684;<ul>
<li>voc,coco&#x7B49;&#x6570;&#x636E;&#x96C6;&#x4E2D;&#x4F1A;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x8005;&#x6807;&#x6CE8;&#x7ED3;&#x679C;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&#x5176;&#x4E2D;json&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x6807;&#x6CE8;&#x683C;&#x5F0F;&#x5305;&#x542B;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-json">{
# &#x7B2C;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x7269;&#x4F53;&#x6807;&#x8BB0;&#x7ED3;&#x679C;
&quot;24631331976_defa3bb61f_k.jpg668058&quot;:{&quot;fileref&quot;:&quot;&quot;,
&quot;size&quot;:668058,&quot;filename&quot;:&quot;24631331976_defa3bb61f_k.jpg&quot;,
&quot;base64_img_data&quot;:&quot;&quot;,&quot;file_attributes&quot;:{},
&quot;regions&quot;:{&quot;0&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[916,913,905,889,868,836,809,792,789,784,777,769,767,777,786,791,769,739,714,678,645,615,595,583,580,584,595,614,645,676,716,769,815,849,875,900,916,916],&quot;all_points_y&quot;:[515,583,616,656,696,737,753,767,777,785,785,778,768,766,760,755,755,743,728,702,670,629,588,539,500,458,425,394,360,342,329,331,347,371,398,442,504,515]},&quot;region_attributes&quot;:{}}}},
# &#x7B2C;&#x4E8C;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x7269;&#x4F53;&#x6807;&#x8BB0;
&quot;16335852991_f55de7958d_k.jpg1767935&quot;:{&quot;fileref&quot;:&quot;&quot;,&quot;size&quot;:1767935,&quot;filename&quot;:&quot;16335852991_f55de7958d_k.jpg&quot;,&quot;base64_img_data&quot;:&quot;&quot;,&quot;file_attributes&quot;:{},
&quot;regions&quot;:{
  &quot;0&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[588,617,649,673,692,708,722,730,737,718,706,699,697,676,650,613,580,552,534,520,513,513,521,526,541,560,588],&quot;all_points_y&quot;:[173,168,172,182,197,216,237,260,283,312,341,367,390,369,349,337,337,347,361,332,296,266,243,225,205,187,173]},&quot;region_attributes&quot;:{}},
  &quot;1&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[845,861,880,892,902,910,889,869,844,813,785,762,745,739,731,746,767,790,821,845],&quot;all_points_y&quot;:[219,229,242,260,275,299,277,263,254,250,255,265,279,283,258,241,225,216,213,219]},&quot;region_attributes&quot;:{}},
  &quot;2&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[931,928,920,913,897,872,840,811,789,768,754,730,726,724,718,698,698,707,721,734,746,769,794,822,845,865,889,910,921,929,931],&quot;all_points_y&quot;:[378,402,435,454,475,460,450,449,450,460,469,489,486,459,426,390,367,335,306,290,278,261,252,250,254,261,277,299,323,354,378]},&quot;region_attributes&quot;:{}},
  &quot;3&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[927,946,968,989,992,985,975,957,937,913,889,862,852,876,897,910,925,933,939,939,935,927,910,900,927],&quot;all_points_y&quot;:[486,498,516,553,593,630,649,668,686,700,707,707,708,691,675,656,635,610,587,562,538,512,492,480,486]},&quot;region_attributes&quot;:{}},
  &quot;4&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[704,692,690,691,699,711,723,742,766,785,807,839,865,887,904,923,933,939,939,931,920,905,885,861,839,808,786,769,754,748,746,738,738,729,722,718,704],&quot;all_points_y&quot;:[664,631,604,580,545,521,498,480,461,452,449,449,457,469,484,506,532,565,584,620,643,662,682,701,713,719,723,728,733,731,738,737,729,720,708,690,664]},&quot;region_attributes&quot;:{}},
  &quot;5&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[526,509,497,493,490,493,501,512,526,546,573,603,626,662,688,709,721,724,724,719,704,694,691,691,682,683,687,688,684,682,679,676,664,648,620,587,564,548,526],&quot;all_points_y&quot;:[551,526,498,470,444,422,398,381,365,351,340,338,340,357,381,408,438,466,493,504,531,568,584,604,609,612,610,617,625,625,619,616,620,619,609,599,585,573,551]},&quot;region_attributes&quot;:{}},
  &quot;6&quot;:{&quot;shape_attributes&quot;:{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[594,579,567,563,564,568,579,605,631,656,671,676,682,684,687,687,684,684,691,691,694,702,711,719,722,729,737,738,746,749,756,765,757,728,714,683,654,623,594],&quot;all_points_y&quot;:[735,712,691,659,631,612,596,605,613,621,618,616,625,625,616,612,612,608,605,619,637,656,678,692,706,719,727,737,739,731,734,730,741,762,766,772,769,757,735]},&quot;region_attributes&quot;:{}}
}},
...
...
...
</code></pre>
<p>&#x5176;&#x4E2D;&#xFF1A;&quot;all_points_x&quot;:[588,617,649,673,692,708,722,730,737,718,706,699,697,676,650,613,580,552,534,520,513,513,521,526,541,560,588],&quot;all_points_y&quot;:[173,168,172,182,197,216,237,260,283,312,341,367,390,369,349,337,337,347,361,332,296,266,243,225,205,187,173]}</p>
<p>&#x8868;&#x793A;&#x8BE5;&#x88AB;&#x6807;&#x6CE8;&#x7269;&#x4F53;&#x6240;&#x6709;&#x50CF;&#x7D20;&#x70B9;&#x7684;&#x5750;&#x6807;&#x3002;</p>
<h3 id="682-&#x6A21;&#x578B;&#x4ECB;&#x7ECD;">6.8.2 &#x6A21;&#x578B;&#x4ECB;&#x7ECD;</h3>
<p>&#x9009;&#x7528;maskrcnn&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x5206;&#x5272;&#x6848;&#x4F8B;&#x3002;maskrcnn&#x7684;&#x6E90;&#x7801;&#x7248;&#x672C;&#x4E2D;&#x9009;&#x62E9;&#x6700;&#x65B0;&#x7684;2.0&#x7248;&#x672C;&#x3002;</p>
<h5 id="github&#x9AD8;&#x661F;&#x5B9E;&#x73B0;&#x7248;&#x672C;">github&#x9AD8;&#x661F;&#x5B9E;&#x73B0;&#x7248;&#x672C;</h5>
<ul>
<li>&#x9AD8;&#x661F;&#x7248;&#x672C;&#xFF1A;<strong><a href="https://github.com/matterport/Mask_RCNN" target="_blank">MaskRCNN</a></strong>&#x3002;<ul>
<li>TensorFlow&#x4E0E;keras&#x5B9E;&#x73B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x4EE3;&#x7801;&#x53EA;&#x80FD;&#x5728;1.x&#x7248;&#x672C;&#x8FD0;&#x884C;&#xFF0C;&#x9700;&#x8981;&#x540C;&#x65F6;keras&#x548C;TensorFlow&#x4E24;&#x4E2A;&#x5E93;&#x624D;&#x80FD;&#x8FD0;&#x884C;</li>
</ul>
</li>
</ul>
<p><strong>&#x4F7F;&#x7528;&#x7248;&#x672C;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x4FEE;&#x6539;&#x4E4B;&#x540E;&#x80FD;&#x5728;2.0&#x73AF;&#x5883;&#x4E0B;&#x8FD0;&#x884C;&#x7684;maskrcnn&#x6E90;&#x7801;&#x3002;</strong></p>
<p>&#x5E76;&#x4E14;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/fchollet/deep-learning-models/releases/v0.2/" target="_blank">maskrcnn&#x8FC1;&#x79FB;&#x5B66;&#x4E60;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;</a>&#x3002;</p>
<ul>
<li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x79CD;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#xFF0C;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;Imagenet&#x6570;&#x636E;&#x96C6;&#x8BAD;&#x7EC3;&#x7684;&#x8FC1;&#x79FB;&#x6A21;&#x578B;</li>
</ul>
<p><img src="../images/maskrcnn&#x8FC1;&#x79FB;&#x6A21;&#x578B;.jpg" style="zoom:50%;"></p>
<h3 id="683-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;">6.8.3 &#x9879;&#x76EE;&#x4ECB;&#x7ECD;</h3>
<h4 id="1&#x3001;&#x5206;&#x5272;&#x6548;&#x679C;&#x6F14;&#x793A;&#xFF1A;">1&#x3001;&#x5206;&#x5272;&#x6548;&#x679C;&#x6F14;&#x793A;&#xFF1A;</h4>
<p>1&#x3001;&#x56FE;&#x7247;&#x6548;&#x679C;</p>
<p>&#x5206;&#x5272;&#x56FE;&#x7247;</p>
<p><img src="../images/2917282960_06beee649a_b.jpg" style="zoom:50%;"></p>
<p>&#x5206;&#x5272;&#x6548;&#x679C;</p>
<p><img src="../images/segment_2917282960_06beee649a_b.jpg" style="zoom:50%;"></p>
<p>&#x6CE8;&#xFF1A;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x505A;&#x7684;&#x662F;&#x76F4;&#x63A5;&#x5C06;&#x5206;&#x5272;&#x7684;&#x7ED3;&#x679C;&#x663E;&#x793A;&#x539F;&#x8272;&#xFF0C;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x53D8;&#x6210;&#x7070;&#x5EA6;&#x56FE;&#x3002;</p>
<h4 id="2&#x3001;&#x9879;&#x76EE;&#x6A21;&#x5757;&#x4ECB;&#x7ECD;">2&#x3001;&#x9879;&#x76EE;&#x6A21;&#x5757;&#x4ECB;&#x7ECD;</h4>
<p><img src="../images/maskrcnn&#x9879;&#x76EE;.jpg" style="zoom:80%;"></p>
<ul>
<li>ballon_dataset:&#x9879;&#x76EE;&#x7684;&#x6570;&#x636E;&#x96C6;</li>
<li>logs:&#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x4FDD;&#x5B58;&#x7ED3;&#x679C;</li>
<li>mrcnn:&#x6A21;&#x578B;&#x7ED3;&#x6784;&#x4EE5;&#x53CA;&#x914D;&#x7F6E;&#x4EE3;&#x7801;</li>
<li>balloon_main:&#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x4EE5;&#x53CA;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;</li>
</ul>
<p>&#x5176;&#x4E2D;Images:&#x6D4B;&#x8BD5;&#x68C0;&#x6D4B;&#x7684;&#x56FE;&#x7247;&#x6216;&#x89C6;&#x9891;&#x4EE5;&#x53CA;&#x8F93;&#x51FA;&#x7ED3;&#x679C;</p>
<h3 id="684-&#x9879;&#x76EE;&#x8BAD;&#x7EC3;&#x8FC7;&#x7A0B;&#x5B9E;&#x73B0;">6.8.4 &#x9879;&#x76EE;&#x8BAD;&#x7EC3;&#x8FC7;&#x7A0B;&#x5B9E;&#x73B0;</h3>
<ul>
<li>&#x6B65;&#x9AA4;<ul>
<li>1&#x3001;&#x6570;&#x636E;&#x96C6;&#x8BFB;&#x53D6;&#x5904;&#x7406;&#x548C;&#x51C6;&#x5907;<ul>
<li>maskrcnn&#x6A21;&#x578B;&#x6E90;&#x7801;&#x4E2D;Sequence&#x5C01;&#x88C5;&#x6570;&#x636E;&#x96C6;&#x7C7B;&#x4F7F;&#x7528;</li>
<li>&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x6807;&#x7B7E;&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x53D6;</li>
</ul>
</li>
<li>2&#x3001;&#x6A21;&#x578B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x89E3;&#x6790;&#x4E0E;&#x4FEE;&#x6539;&#x3001;&#x6A21;&#x578B;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x52A0;&#x8F7D;&#x3001;&#x6A21;&#x578B;&#x6784;&#x5EFA;<ul>
<li>maskrcnn&#x914D;&#x7F6E;&#x4ECB;&#x7ECD;</li>
<li>&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x8FC7;&#x7A0B;&#x4F7F;&#x7528;&#x6E90;&#x7801;&#x89E3;&#x6790;</li>
</ul>
</li>
<li>3&#x3001;&#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x8FC7;&#x7A0B;&#x5B9E;&#x73B0;<ul>
<li>&#x8BAD;&#x7EC3;&#x4EE3;&#x7801;&#x5C01;&#x88C5;&#x4ECB;&#x7ECD;</li>
</ul>
</li>
<li>4&#x3001;&#x6A21;&#x578B;&#x6D4B;&#x8BD5;&#x8FC7;&#x7A0B;&#x5B9E;&#x73B0;<ul>
<li>&#x56FE;&#x7247;&#x9884;&#x6D4B;&#x7ED3;&#x679C;&#x5904;&#x7406;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="6841-&#x6570;&#x636E;&#x96C6;&#x7684;&#x8BFB;&#x53D6;&#x5904;&#x7406;">6.8.4.1 &#x6570;&#x636E;&#x96C6;&#x7684;&#x8BFB;&#x53D6;&#x5904;&#x7406;</h4>
<p><img src="../images/maskrcnn&#x6E90;&#x7801;&#x6A21;&#x5757;.jpg" alt=""></p>
<p>maskrcnn&#x6E90;&#x7801;&#x4E2D;utils.py&#x6587;&#x4EF6;&#x5C01;&#x88C5;&#x4E86;Dataset&#x7C7B;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x600E;&#x4E48;&#x83B7;&#x53D6;&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;&#x4EE5;&#x53CA;&#x5404;&#x5F0F;&#x5982;&#x4F55;&#x5B58;&#x50A8;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dataset</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;The base class for dataset classes.
    To use it, create a new class that adds functions specific to the dataset
    you want to use. For example:

    See COCODataset and ShapesDataset as examples.
    &quot;&quot;&quot;</span>
</code></pre>
<blockquote>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F16;&#x5199;&#x81EA;&#x5DF1;&#x7684;Dataset&#x7C7B;&#x4EE5;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#x96C6;&#x8FDB;&#x5165;&#x7684;&#x4EFB;&#x4F55;&#x683C;&#x5F0F;&#x3002;</p>
</blockquote>
<p>&#x5176;&#x4E2D;&#x5404;&#x4E2A;&#x65B9;&#x6CD5;&#x89E3;&#x91CA;&#x5982;&#x4E0B;</p>
<ul>
<li><p>def add_class(self, source, class_id, class_name):</p>
<ul>
<li>&#x6DFB;&#x52A0;&#x7C7B;&#x522B;&#x4FE1;&#x606F;&#xFF0C;&#x9ED8;&#x8BA4;&#x80CC;&#x666F;&#x7C7B;&#x522B;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;&#x8BB0;&#x5F55;&#x5728;class_info&#x4E2D;</li>
<li>self.class_info = [{&quot;source&quot;: &quot;&quot;, &quot;id&quot;: 0, &quot;name&quot;: &quot;BG&quot;}]</li>
</ul>
</li>
<li><p>def add_image(self, source, image_id, path, **kwargs):</p>
<ul>
<li>&#x6DFB;&#x52A0;&#x56FE;&#x7247;&#x4FE1;&#x606F;</li>
<li>self.image_info = { &quot;id&quot;: image_id,&quot;source&quot;: source,&quot;path&quot;: path,}</li>
</ul>
</li>
<li><p>def load_image(self, image_id): return image</p>
<ul>
<li>&#x52A0;&#x8F7D;&#x6307;&#x5B9A;&#x56FE;&#x7247;id&#x5230;[H,W,3]&#x7684;numpy&#x6570;&#x7EC4;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;</li>
</ul>
</li>
<li>load_mask&#x901A;&#x8FC7;&#x7ED8;&#x5236;&#x591A;&#x8FB9;&#x5F62;&#x4E3A;&#x56FE;&#x50CF;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x751F;&#x6210;&#x4F4D;&#x56FE;&#x8499;&#x7248;(hitmap masks)&#x3002;<ul>
<li>&#x52A0;&#x8F7D;&#x56FE;&#x7247;id&#x5BF9;&#x5E94;&#x7684;mask&#xFF0C;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x7269;&#x4F53;&#x7684;mask [height, width, instance count]</li>
<li>&#x4EE5;&#x53CA;&#x7269;&#x4F53;&#x7C7B;&#x522B;id  1D array</li>
</ul>
</li>
<li>def prepare(self, class_map=None):<ul>
<li>&#x51C6;&#x5907;Dataset&#x7C7B;&#x6570;&#x636E;&#x4F7F;&#x7528;</li>
</ul>
</li>
</ul>
<blockquote>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;image_reference&#x53EA;&#x662F;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6807;&#x8BC6;&#x56FE;&#x50CF;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x4EE5;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;&#x3002;&#x53EA;&#x662F;&#x8FD4;&#x56DE;&#x56FE;&#x50CF;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A;&#x7A7A;</p>
</blockquote>
<h4 id="1&#x3001;dataset&#x7684;&#x4F7F;&#x7528;">1&#x3001;Dataset&#x7684;&#x4F7F;&#x7528;</h4>
<ul>
<li>&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;</li>
</ul>
<p>&#x5982;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x7EE7;&#x627F;&#x91CD;&#x5199;load_mask&#x65B9;&#x6CD5;&#xFF0C;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x8BFB;&#x53D6;&#x6211;&#x4EEC;&#x7684;&#x6C14;&#x7403;&#x6570;&#x636E;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6DFB;&#x52A0;&#x5230;image_info&#x5F53;&#x4E2D;</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CatsAndDogsDataset</span><span class="hljs-params">(Dataset)</span>:</span>
  <span class="hljs-string">&quot;&quot;&quot;
  &quot;&quot;&quot;</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_cats_and_dogs</span><span class="hljs-params">()</span>:</span>
    ...
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_mask</span><span class="hljs-params">(self, image_id)</span>:</span>
    ...
</code></pre>
<blockquote>
<p>&#x6CE8;&#xFF1A;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x8BFB;&#x53D6;&#x5904;&#x7406;&#x7684;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x683C;&#x5F0F;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E9B;&#x65B9;&#x4FBF;&#x7684;&#x901A;&#x7528;&#x5DE5;&#x5177;&#x4E5F;&#x53EF;&#x4EE5;&#x501F;&#x9274;&#x4F7F;&#x7528;</p>
</blockquote>
<ul>
<li>&#x6BD4;&#x5982;&#xFF1A;load_balloons&#x8BFB;&#x53D6;JSON&#x6587;&#x4EF6;&#xFF0C;&#x63D0;&#x53D6;&#x6CE8;&#x91CA;&#xFF0C;&#x5E76;&#x8FED;&#x4EE3;&#x8C03;&#x7528;&#x5185;&#x90E8;&#x7684;add_class&#x548C;add_image&#x51FD;&#x6570;&#x4EE5;&#x6784;&#x5EFA;&#x6570;&#x636E;&#x96C6;&#x3002;</li>
<li>load_mask:</li>
</ul>
<h4 id="2&#x3001;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x5C55;&#x793A;&#x6570;&#x636E;">2&#x3001;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x5C55;&#x793A;&#x6570;&#x636E;</h4>
<p>&#x4E0B;&#x9762;&#x662F;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x8FC7;&#x7A0B;&#x548C;&#x7ED3;&#x679C;</p>
<pre><code class="lang-python">dataset = balloon.BalloonDataset()
<span class="hljs-comment"># &#x83B7;&#x53D6;&#x56FE;&#x7247;&#x7C7B;&#x522B;&#x548C;&#x56FE;&#x7247;&#x5176;&#x4ED6;&#x4FE1;&#x606F;</span>
dataset.load_balloon(BALLOON_DIR, <span class="hljs-string">&quot;train&quot;</span>)
<span class="hljs-comment"># &#x51C6;&#x5907;&#x56FE;&#x7247;&#x7684;dataset&#x6570;&#x636E;</span>
dataset.prepare()

print(<span class="hljs-string">&quot;&#x56FE;&#x7247; &#x6570;&#x91CF;: {}&quot;</span>.format(len(dataset.image_ids)))
print(<span class="hljs-string">&quot;&#x7C7B;&#x522B; &#x6570;&#x91CF;: {}&quot;</span>.format(dataset.num_classes))
<span class="hljs-keyword">for</span> i, info <span class="hljs-keyword">in</span> enumerate(dataset.class_info):
    print(<span class="hljs-string">&quot;{:3}. {:50}&quot;</span>.format(i, info[<span class="hljs-string">&apos;name&apos;</span>]))
</code></pre>
<p>Image Count: 61 </p>
<p>Class Count: 2  </p>
<p>0.BG</p>
<p>1.balloon     </p>
<h5 id="&#x5C55;&#x793A;&#x6837;&#x672C;&#x7684;mask">&#x5C55;&#x793A;&#x6837;&#x672C;&#x7684;mask</h5>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6A21;&#x578B;&#x4E2D;&#x7684;visualize.display_top_masks(image, mask, class_ids, dataset.class_names)</p>
<pre><code class="lang-python">image = dataset.load_image(image_id)
mask, class_ids = dataset.load_mask(image_id)
visualize.display_top_masks(image, mask, class_ids, dataset.class_names)
</code></pre>
<p><img src="../images/&#x753B;&#x51FA;mask.jpg" style="zoom:80%;"></p>
<h5 id="&#x5C55;&#x793A;&#x6837;&#x672C;&#x7684;bbox&#x4EE5;&#x53CA;mask">&#x5C55;&#x793A;&#x6837;&#x672C;&#x7684;bbox&#x4EE5;&#x53CA;mask</h5>
<p>&#x6CA1;&#x6709;bbox&#x6807;&#x8BB0;&#xFF0C;&#x901A;&#x8FC7;utils.extract_bboxes&#x5BF9;&#x56FE;&#x7247;&#x4E2D;&#x7684;mask,&#x8BA1;&#x7B97;&#x51FA;bbox&#x4F4D;&#x7F6E;</p>
<ul>
<li>1&#x3001;utils.extract_bboxes(mask)&#xFF1A;<ul>
<li>mask: [height, width, num_instances].mask&#x7684;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x6210; 1 or 0.</li>
<li>Returns: bbox array [num_instances, (y1, x1, y2, x2)].</li>
</ul>
</li>
</ul>
<pre><code class="lang-python">image = dataset.load_image(image_id)
mask, class_ids = dataset.load_mask(image_id)
<span class="hljs-comment"># &#x8BA1;&#x7B97; Bounding box</span>
bbox = utils.extract_bboxes(mask)

print(<span class="hljs-string">&quot;image_id &quot;</span>, image_id, dataset.image_reference(image_id))
<span class="hljs-comment"># model&#x4E2D;log&#x65B9;&#x6CD5;</span>
log(<span class="hljs-string">&quot;image&quot;</span>, image)
log(<span class="hljs-string">&quot;mask&quot;</span>, mask)
log(<span class="hljs-string">&quot;class_ids&quot;</span>, class_ids)
log(<span class="hljs-string">&quot;bbox&quot;</span>, bbox)


<span class="hljs-comment"># &#x7ED3;&#x679C;</span>
image_id  <span class="hljs-number">1</span> /deepmatter/libs/mask_rcnn/datasets/balloon/train/<span class="hljs-number">25899693952</span>_7c8b8b9edc_k.jpg
image                    shape: (<span class="hljs-number">1365</span>, <span class="hljs-number">2048</span>, <span class="hljs-number">3</span>)       min:    <span class="hljs-number">0.00000</span>  max:  <span class="hljs-number">255.00000</span>
mask                     shape: (<span class="hljs-number">1365</span>, <span class="hljs-number">2048</span>, <span class="hljs-number">1</span>)       min:    <span class="hljs-number">0.00000</span>  max:    <span class="hljs-number">1.00000</span>
class_ids                shape: (<span class="hljs-number">1</span>,)                  min:    <span class="hljs-number">1.00000</span>  max:    <span class="hljs-number">1.00000</span>
bbox                     shape: (<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)                min:  <span class="hljs-number">116.00000</span>  max:  <span class="hljs-number">965.00000</span>
</code></pre>
<p>&#x901A;&#x8FC7;visualize.display_instances(image, bbox, mask, class_ids, dataset.class_names)&#x5C55;&#x793A;</p>
<p><img src="../images/&#x5C55;&#x793A;mask&#x548C;bbox.jpg" style="zoom:60%;"></p>
<ul>
<li>2&#x3001;&#x901A;&#x8FC7;modellib.load_image_gt&#xFF1A;&#x4F20;&#x5165;dataset,&#x914D;&#x7F6E;&#x3001;&#x56FE;&#x7247;id</li>
</ul>
<pre><code>image, image_meta, class_ids, bbox, mask = modellib.load_image_gt(
    dataset, config, image_id, use_mini_mask=False)

print(&quot;image&quot;, image)
print(&quot;image_meta&quot;, image_meta)
print(&quot;class_ids&quot;, class_ids)
print(&quot;bbox&quot;, bbox)
print(&quot;mask&quot;, mask)

mage                    shape: (1024, 1024, 3)       min:    0.00000  max:  255.00000
image_meta               shape: (10,)                 min:    0.00000  max: 1024.00000
class_ids                shape: (2,)                  min:    1.00000  max:    1.00000
bbox                     shape: (2, 4)                min:  181.00000  max: 1024.00000
mask                     shape: (1024, 1024, 2)       min:    0.00000  max:    1.00000
</code></pre><p><img src="../images/&#x4E24;&#x4E2A;mask.jpg" alt=""></p>
<h4 id="6842--&#x6570;&#x636E;&#x96C6;balloondataset&#x5B9E;&#x73B0;">6.8.4.2  &#x6570;&#x636E;&#x96C6;BalloonDataset&#x5B9E;&#x73B0;</h4>
<ul>
<li>&#x6B65;&#x9AA4;<ul>
<li>&#x7EE7;&#x627F;dataset&#x7C7B;&#x522B;</li>
<li>&#x5B9E;&#x73B0;load_balloon&#x65B9;&#x6CD5;</li>
<li>&#x5B9E;&#x73B0;load_mask&#x65B9;&#x6CD5;</li>
</ul>
</li>
</ul>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;utils&#x6587;&#x4EF6;&#x5939;&#x4F5C;&#x4E3A;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;&#x8BFB;&#x53D6;&#x5DE5;&#x5177;&#xFF0C;&#x5176;&#x4E2D;&#x7F16;&#x5199;&#x4E00;&#x4E2A;balloon_dataset.py&#x6587;&#x4EF6;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
sys.path.append(<span class="hljs-string">&quot;../&quot;</span>)
<span class="hljs-keyword">from</span> mrcnn <span class="hljs-keyword">import</span> utils, visualize
<span class="hljs-keyword">import</span> skimage

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BalloonDataset</span><span class="hljs-params">(utils.Dataset)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;&#x6C14;&#x7403;&#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;&#x83B7;&#x53D6;&#x7C7B;
    &quot;&quot;&quot;</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_balloon</span><span class="hljs-params">(self, dataset_dir, subset)</span>:</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_mask</span><span class="hljs-params">(self, image_id)</span>:</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<p>1&#x3001;&#x5B9E;&#x73B0;load_balloon&#x65B9;&#x6CD5;</p>
<ul>
<li>&#x76EE;&#x7684;&#xFF1A;&#x6DFB;&#x52A0;&#x6BCF;&#x5F20;&#x56FE;&#x7247;&#x7684;id&#x3001;&#x8DEF;&#x5F84;&#x3001;&#x957F;&#x3001;&#x5BBD;&#x3001;&#x6807;&#x6CE8;&#x4FE1;&#x606F;&#x5230;selfi.mage_info&#x5B57;&#x5178;&#x4E2D;<ul>
<li>1&#x3001;&#x8BFB;&#x53D6;&#x6807;&#x6CE8;json&#x6587;&#x4EF6;</li>
<li>2&#x3001;&#x83B7;&#x53D6;&#x6807;&#x6CE8;&#x533A;&#x57DF;</li>
<li>3&#x3001;&#x5BF9;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;&#xFF0C;&#x4FDD;&#x5B58;&#x5176;&#x4E2D;&#x5404;&#x4E2A;&#x533A;&#x57DF;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x56FE;&#x7247;&#x8DEF;&#x5F84;&#x3001;&#x957F;&#x5BBD;&#x3001;filename</li>
</ul>
</li>
</ul>
<pre><code class="lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_balloon</span><span class="hljs-params">(self, dataset_dir, subset)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;
        &#x52A0;&#x8F7D;&#x6570;&#x636E;&#x96C6;
        :param dataset_dir: &#x6570;&#x636E;&#x96C6;&#x76EE;&#x5F55;
        :param subset: &#x8BAD;&#x7EC3;&#x96C6;&#x8FD8;&#x662F;&#x6D4B;&#x8BD5;&#x673A;
        :return:
        &quot;&quot;&quot;</span>
        <span class="hljs-comment"># &#x6DFB;&#x52A0;&#x6570;&#x636E;&#x96C6;&#x7C7B;&#x522B;&#x6570;&#x91CF;</span>
        self.add_class(<span class="hljs-string">&quot;balloon&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;balloon&quot;</span>)

        <span class="hljs-comment"># &#x662F;&#x5426;&#x63D0;&#x4F9B;&#x5728;&#x8BAD;&#x7EC3;&#x6216;&#x8005;&#x9A8C;&#x8BC1;&#x96C6;&#x5B57;&#x7B26;&#x4E32;</span>
        <span class="hljs-keyword">assert</span> subset <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;train&quot;</span>, <span class="hljs-string">&quot;val&quot;</span>]
        dataset_dir = os.path.join(dataset_dir, subset)
        <span class="hljs-comment"># Load annotations</span>
        <span class="hljs-comment"># { &apos;filename&apos;: &apos;28503151_5b5b7ec140_b.jpg&apos;,</span>
        <span class="hljs-comment">#   &apos;regions&apos;: {</span>
        <span class="hljs-comment">#       &apos;0&apos;: {</span>
        <span class="hljs-comment">#           &apos;region_attributes&apos;: {},</span>
        <span class="hljs-comment">#           &apos;shape_attributes&apos;: {</span>
        <span class="hljs-comment">#               &apos;all_points_x&apos;: [...],</span>
        <span class="hljs-comment">#               &apos;all_points_y&apos;: [...],</span>
        <span class="hljs-comment">#               &apos;name&apos;: &apos;polygon&apos;}},</span>
        <span class="hljs-comment">#       ... more regions ...</span>
        <span class="hljs-comment">#   },</span>
        <span class="hljs-comment"># }</span>
        <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x6807;&#x6CE8;&#x533A;&#x57DF;&#xFF1A;</span>
        annotations = json.load(open(os.path.join(dataset_dir, <span class="hljs-string">&quot;via_region_data.json&quot;</span>)))
        annotations = list(annotations.values())

        <span class="hljs-comment"># &#x5982;&#x679C;annotations&#x4E0D;&#x5B58;&#x5728;&#x76F4;&#x63A5;&#x8DF3;&#x8FC7;</span>
        annotations = [a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> annotations <span class="hljs-keyword">if</span> a[<span class="hljs-string">&apos;regions&apos;</span>]]
        <span class="hljs-comment"># &#x6DFB;&#x52A0;&#x6BCF;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x5750;&#x6807;</span>
        <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> annotations:
            <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6240;&#x6709;&#x591A;&#x8FB9;&#x5F62;&#x7684;x, y &#x7684;&#x6240;&#x6709;&#x70B9;&#x5750;&#x6807;,&#x5B58;&#x50A8;&#x5728;shape_attributes</span>
            <span class="hljs-comment"># &#x5224;&#x65AD;&#x5176;&#x4E2D;&#x7C7B;&#x578B;&#x662F;&#x5426;&#x662F;&#x5B57;&#x5178;&#xFF0C;&#x82E5;&#x679C;&#x5B57;&#x5178;</span>
            <span class="hljs-keyword">if</span> isinstance(a[<span class="hljs-string">&apos;regions&apos;</span>], dict):
                polygons = [r[<span class="hljs-string">&apos;shape_attributes&apos;</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> a[<span class="hljs-string">&apos;regions&apos;</span>].values()]
            <span class="hljs-keyword">else</span>:
                polygons = [r[<span class="hljs-string">&apos;shape_attributes&apos;</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> a[<span class="hljs-string">&apos;regions&apos;</span>]]

            <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x56FE;&#x7247;&#x5185;&#x5BB9;&#x83B7;&#x53D6;&#x957F;&#x5BBD;</span>
            image_path = os.path.join(dataset_dir, a[<span class="hljs-string">&apos;filename&apos;</span>])
            image = skimage.io.imread(image_path)
            height, width = image.shape[:<span class="hljs-number">2</span>]

            <span class="hljs-comment"># &#x52A0;&#x5165;&#x5230;image_info&#x5B57;&#x5178;&#x5F53;&#x4E2D;</span>
            self.add_image(
                <span class="hljs-string">&quot;balloon&quot;</span>,
                image_id=a[<span class="hljs-string">&apos;filename&apos;</span>],
                path=image_path,
                width=width, height=height,
                polygons=polygons)
</code></pre>
<blockquote>
<p>&#x6CE8;&#xFF1A;&#x6E90;&#x7801;&#x4E2D;&#x5927;&#x91CF;&#x4F7F;&#x7528;skimage&#x6A21;&#x5757;&#x505A;&#x56FE;&#x7247;&#x8BFB;&#x53D6;&#x5904;&#x7406;</p>
<ul>
<li>&#x5176;&#x4E2D;pil&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x8BFB;&#x53D6;&#x7ED3;&#x679C;&#x9ED8;&#x8BA4;sRGB&#x683C;&#x5F0F;&#xFF0C;&#x4E0D;&#x662F;rgb&#x7684;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8F6C;&#x6362;&#x6210;&#x6570;&#x7EC4;</li>
</ul>
<p>image = pil.Image.open(&quot;&quot;)</p>
<p>image =  image.convert(&apos;RGB&apos;)</p>
<p>arr = np.array(image)</p>
<ul>
<li>skimage.io.read()&#x76F4;&#x63A5;&#x8F6C;&#x6362;&#x6210;array&#x6570;&#x7EC4;</li>
</ul>
</blockquote>
<p>2&#x3001;&#x5B9E;&#x73B0;load_mask&#x65B9;&#x6CD5;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_mask</span><span class="hljs-params">(self, image_id)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#x4E2D;&#x7684;mask&#x8FD4;&#x56DE;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;&#x7684;mask&#x53CA;&#x5176;id
    :param image_id: &#x56FE;&#x7247;ID
    :return: masks: &#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x7684;&#x5E03;&#x5C14;&#x5F62;&#x72B6; [height, width, instance count]
    class_ids: &#x7C7B;&#x522B;&#x7684; 1D &#x6570;&#x7EC4;
    &quot;&quot;&quot;</span>
    <span class="hljs-comment"># &#x5982;&#x679C;&#x4E0D;&#x662F;balloon&#x7C7B;&#x522B;&#x7684;&#x56FE;&#x7247;&#x6570;&#x636E;&#xFF0C;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;&#x7A7A;</span>
    image_info = self.image_info[image_id]
    <span class="hljs-keyword">if</span> image_info[<span class="hljs-string">&quot;source&quot;</span>] != <span class="hljs-string">&quot;balloon&quot;</span>:
        <span class="hljs-keyword">return</span> super(self.__class__, self).load_mask(image_id)

    <span class="hljs-comment"># &#x5C06;&#x5750;&#x6807;&#x8F6C;&#x6362;&#x6210;bitmap [height, width, instance_count]</span>
    info = self.image_info[image_id]
    mask = np.zeros([info[<span class="hljs-string">&quot;height&quot;</span>], info[<span class="hljs-string">&quot;width&quot;</span>], len(info[<span class="hljs-string">&quot;polygons&quot;</span>])],
                    dtype=np.uint8)
    <span class="hljs-keyword">for</span> i, p <span class="hljs-keyword">in</span> enumerate(info[<span class="hljs-string">&quot;polygons&quot;</span>]):
        <span class="hljs-comment"># Get indexes of pixels inside the polygon and set them to 1</span>
        <span class="hljs-comment"># &#x83B7;&#x53D6;&#x56FE;&#x7247;&#x50CF;&#x7D20;&#x4E2D;&#x7684;&#x8FD9;&#x4E2A;mask&#x591A;&#x8FB9;&#x5F62;&#x533A;&#x57DF;&#x4E2D;&#x50CF;&#x7D20;&#x4E0B;&#x6807;&#xFF0C;&#x5C06;&#x5176;&#x6807;&#x8BB0;&#x4E3A;1</span>
        rr, cc = skimage.draw.polygon(p[<span class="hljs-string">&apos;all_points_y&apos;</span>], p[<span class="hljs-string">&apos;all_points_x&apos;</span>])
        mask[rr, cc, i] = <span class="hljs-number">1</span>

    <span class="hljs-comment"># &#x8FD4;&#x56DE;mask&#x533A;&#x57DF;&#x6807;&#x8BB0; [height, width, instance count]</span>
    <span class="hljs-comment"># &#x4EE5;&#x53CA;mask&#x7269;&#x4F53;&#x7684;&#x4E2A;&#x6570;</span>
    <span class="hljs-keyword">return</span> mask.astype(np.bool), np.ones([mask.shape[-<span class="hljs-number">1</span>]], dtype=np.int32)
</code></pre>
<p>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:
    dataset_train = BalloonDataset()
    dataset_train.load_balloon(<span class="hljs-string">&quot;../balloon_dataset/&quot;</span>, <span class="hljs-string">&quot;train&quot;</span>)
    dataset_train.prepare()
</code></pre>
<h4 id="&#x53EF;&#x4EE5;&#x505A;&#x4E0A;&#x8FF0;&#x7684;&#x6D4B;&#x8BD5;">&#x53EF;&#x4EE5;&#x505A;&#x4E0A;&#x8FF0;&#x7684;&#x6D4B;&#x8BD5;</h4>
<p>&#x6253;&#x5370;&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code class="lang-python">print(<span class="hljs-string">&quot;&#x56FE;&#x7247;&#x6570;&#x91CF;: {}&quot;</span>.format(len(dataset_train.image_ids)))
print(<span class="hljs-string">&quot;&#x7C7B;&#x522B;&#x6570;&#x91CF;: {}&quot;</span>.format(dataset_train.num_classes))
<span class="hljs-keyword">for</span> i, info <span class="hljs-keyword">in</span> enumerate(dataset_train.class_info):
    print(<span class="hljs-string">&quot;{}. {}&quot;</span>.format(i, info[<span class="hljs-string">&apos;name&apos;</span>]))
</code></pre>
<p>1&#x3001;&#x5C55;&#x793A;mask</p>
<pre><code class="lang-python"> <span class="hljs-comment"># 1&#x3001;&#x968F;&#x673A;&#x9009;&#x62E9;&#x90E8;&#x5206;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x5C55;&#x793A;mask&#x533A;&#x57DF;</span>
  image_id = np.random.choice(dataset_train.image_ids, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]
  image = dataset_train.load_image(image_id)
  mask, class_ids = dataset_train.load_mask(image_id)
  visualize.display_top_masks(image, mask, class_ids, dataset_train.class_names)
</code></pre>
<p>2&#x3001;&#x901A;&#x8FC7;mask&#x8BA1;&#x7B97;bbox&#x533A;&#x57DF;,&#x5E76;&#x8FDB;&#x884C;&#x5C55;&#x793A;</p>
<pre><code class="lang-python"><span class="hljs-comment"># &#x8BA1;&#x7B97;bbox</span>
bbox = utils.extract_bboxes(mask)
<span class="hljs-keyword">from</span> mrcnn.model <span class="hljs-keyword">import</span> log
log(<span class="hljs-string">&quot;image&quot;</span>, image)
log(<span class="hljs-string">&quot;mask&quot;</span>, mask)
log(<span class="hljs-string">&quot;class_ids&quot;</span>, class_ids)
log(<span class="hljs-string">&quot;bbox&quot;</span>, bbox)
<span class="hljs-comment"># &#x663E;&#x793A;mask,&#x4EE5;&#x53CA;bbox</span>
visualize.display_instances(image, bbox, mask, class_ids, dataset_train.class_names)
</code></pre>
<p>&#x7ED3;&#x679C;</p>
<pre><code class="lang-python">&#x56FE;&#x7247;&#x6570;&#x91CF;: <span class="hljs-number">61</span>
&#x7C7B;&#x522B;&#x6570;&#x91CF;: <span class="hljs-number">2</span>
<span class="hljs-number">0.</span> BG
<span class="hljs-number">1.</span> balloon
image                    shape: (<span class="hljs-number">681</span>, <span class="hljs-number">1024</span>, <span class="hljs-number">3</span>)        min:    <span class="hljs-number">0.00000</span>  max:  <span class="hljs-number">255.00000</span>  uint8
mask                     shape: (<span class="hljs-number">681</span>, <span class="hljs-number">1024</span>, <span class="hljs-number">2</span>)        min:    <span class="hljs-number">0.00000</span>  max:    <span class="hljs-number">1.00000</span>  bool
class_ids                shape: (<span class="hljs-number">2</span>,)                  min:    <span class="hljs-number">1.00000</span>  max:    <span class="hljs-number">1.00000</span>  int32
bbox                     shape: (<span class="hljs-number">2</span>, <span class="hljs-number">4</span>)                min:  <span class="hljs-number">191.00000</span>  max: <span class="hljs-number">1024.00000</span>  int32
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../imageSegmentation/section6.html" class="navigation navigation-prev " aria-label="Previous page: Mask RCNN"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../imageSegmentation/section8.html" class="navigation navigation-next " aria-label="Next page: Mask RCNN分割案例2"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-splitter/splitter.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"expandable-chapters":{},"katex":{},"splitter":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
