<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>案例：KITTI人、车检测案例-数据集处理 | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-expandable-chapters/expandable-chapters.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-splitter/splitter.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../objectdection/section11.html" />
    
    
    <link rel="prev" href="../objectdection/section9.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="5.10"
        data-chapter-title="案例：KITTI人、车检测案例-数据集处理"
        data-filepath="objectdection/section10.md"
        data-basepath=".."
        data-revision="Sun Oct 11 2020 09:58:20 GMT+0800 (中国标准时间)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        计算机视觉与深度学习课程
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="introduction/index.html">
            
                
                    <a href="../introduction/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        计算机视觉简介
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="introduction/section1.html">
            
                
                    <a href="../introduction/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        计算机视觉概念
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="introduction/section2.html">
            
                
                    <a href="../introduction/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        计算机视觉任务
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="tensorFlow/index.html">
            
                
                    <a href="../tensorFlow/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        tensorflow入门
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="tensorFlow/section1.html">
            
                
                    <a href="../tensorFlow/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        TensorFlow和Keras简介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="tensorFlow/section2.html">
            
                
                    <a href="../tensorFlow/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        快速入门模型
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="deeplearning/index.html">
            
                
                    <a href="../deeplearning/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        深度神经网络
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="deeplearning/section1.html">
            
                
                    <a href="../deeplearning/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        神经网络简介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="deeplearning/section2.html">
            
                
                    <a href="../deeplearning/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        常见的损失函数
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="deeplearning/section3.html">
            
                
                    <a href="../deeplearning/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        深度学习的优化方法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="deeplearning/section4.html">
            
                
                    <a href="../deeplearning/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        深度学习的正则化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="deeplearning/section5.html">
            
                
                    <a href="../deeplearning/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        神经网络案例
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="deeplearning/section6.html">
            
                
                    <a href="../deeplearning/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        卷积神经网络CNN
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="imageClassification/index.html">
            
                
                    <a href="../imageClassification/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        图像分类
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="imageClassification/section1.html">
            
                
                    <a href="../imageClassification/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        图像分类简介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="imageClassification/section2.html">
            
                
                    <a href="../imageClassification/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        AlexNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="imageClassification/section3.html">
            
                
                    <a href="../imageClassification/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        VGG
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="imageClassification/section4.html">
            
                
                    <a href="../imageClassification/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        GoogLeNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="imageClassification/section5.html">
            
                
                    <a href="../imageClassification/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        ResNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="imageClassification/section6.html">
            
                
                    <a href="../imageClassification/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        图像增强方法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="imageClassification/section7.html">
            
                
                    <a href="../imageClassification/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        模型微调
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="objectdection/index.html">
            
                
                    <a href="../objectdection/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        目标检测(Object Detection)
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="objectdection/section1.html">
            
                
                    <a href="../objectdection/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        目标检测概述
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="objectdection/section2.html">
            
                
                    <a href="../objectdection/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="objectdection/section3.html">
            
                
                    <a href="../objectdection/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        SPPNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="objectdection/section4.html">
            
                
                    <a href="../objectdection/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Fast R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="objectdection/section5.html">
            
                
                    <a href="../objectdection/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Faster R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="objectdection/section6.html">
            
                
                    <a href="../objectdection/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Faster RCNN接口分析
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="objectdection/section7.html">
            
                
                    <a href="../objectdection/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        YOLO算法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="objectdection/section8.html">
            
                
                    <a href="../objectdection/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        YOLOV2&amp;V3
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="objectdection/section9.html">
            
                
                    <a href="../objectdection/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        SSD算法原理
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="5.10" data-path="objectdection/section10.html">
            
                
                    <a href="../objectdection/section10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        案例：KITTI人、车检测案例-数据集处理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="objectdection/section11.html">
            
                
                    <a href="../objectdection/section11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        案例：KITTI人、车检测案例-训练、检测
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="imageSegmentation/index.html">
            
                
                    <a href="../imageSegmentation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        目标分割(Object Segmentation)
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="imageSegmentation/section1.html">
            
                
                    <a href="../imageSegmentation/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        目标分割介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="imageSegmentation/section2.html">
            
                
                    <a href="../imageSegmentation/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        FCN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="imageSegmentation/section3.html">
            
                
                    <a href="../imageSegmentation/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        SegNet与U-Net
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="imageSegmentation/section6.html">
            
                
                    <a href="../imageSegmentation/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Mask RCNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="imageSegmentation/section7.html">
            
                
                    <a href="../imageSegmentation/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Mask RCNN分割案例1
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="imageSegmentation/section8.html">
            
                
                    <a href="../imageSegmentation/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        Mask RCNN分割案例2
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="510-&#x6848;&#x4F8B;&#xFF1A;kitti-&#x4EBA;&#x3001;&#x8F66;&#x7269;&#x4F53;&#x68C0;&#x6D4B;">5.10 &#x6848;&#x4F8B;&#xFF1A;KITTI &#x4EBA;&#x3001;&#x8F66;&#x7269;&#x4F53;&#x68C0;&#x6D4B;</h1>
<h3 id="&#x5B66;&#x4E60;&#x76EE;&#x6807;">&#x5B66;&#x4E60;&#x76EE;&#x6807;</h3>
<ul>
<li>&#x76EE;&#x6807;<ul>
<li>&#x638C;&#x63E1;YOLO&#x7ED3;&#x6784;&#x7684;&#x5C01;&#x88C5;&#x63A5;&#x53E3;&#x4EE5;&#x53CA;&#x7ED3;&#x6784;</li>
<li>&#x638C;&#x63E1;TFRecord&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x53D6;&#x548C;&#x5B58;&#x50A8;</li>
<li>&#x638C;&#x63E1;KITTI&#x6570;&#x636E;&#x96C6;&#x7684;TFRecord&#x683C;&#x5F0F;&#x5B58;&#x50A8;</li>
</ul>
</li>
<li>&#x5E94;&#x7528;<ul>
<li>&#x5E94;&#x7528;&#x5B8C;&#x6210;KITTI&#x81EA;&#x52A8;&#x9A7E;&#x9A76;&#x6570;&#x636E;&#x96C6;&#x7684;&#x683C;&#x5F0F;&#x8F6C;&#x6362;</li>
</ul>
</li>
</ul>
<h3 id="5101-kitti-&#x6570;&#x636E;&#x96C6;&#x4ECB;&#x7ECD;">5.10.1 KITTI &#x6570;&#x636E;&#x96C6;&#x4ECB;&#x7ECD;</h3>
<p>KITTI&#x6570;&#x636E;&#x96C6;&#x7531;&#x5FB7;&#x56FD;&#x5361;&#x5C14;&#x65AF;&#x9C81;&#x5384;&#x7406;&#x5DE5;&#x5B66;&#x9662;&#x548C;&#x4E30;&#x7530;&#x7F8E;&#x56FD;&#x6280;&#x672F;&#x7814;&#x7A76;&#x9662;&#x8054;&#x5408;&#x521B;&#x529E;&#xFF0C;&#x662F;&#x76EE;&#x524D;&#x56FD;&#x9645;&#x4E0A;&#x6700;&#x5927;&#x7684;&#x81EA;&#x52A8;&#x9A7E;&#x9A76;&#x573A;&#x666F;&#x4E0B;&#x7684;&#x8BA1;&#x7B97;&#x673A;&#x89C6;&#x89C9;&#x7B97;&#x6CD5;&#x8BC4;&#x6D4B;&#x6570;&#x636E;&#x96C6;&#x3002;<strong>&#x8BE5;&#x6570;&#x636E;&#x96C6;&#x7528;&#x4E8E;&#x8BC4;&#x6D4B;&#x7ACB;&#x4F53;&#x56FE;&#x50CF;(stereo)&#xFF0C;&#x5149;&#x6D41;(optical flow)&#xFF0C;&#x89C6;&#x89C9;&#x6D4B;&#x8DDD;(visual odometry)&#xFF0C;3D&#x7269;&#x4F53;&#x68C0;&#x6D4B;(object detection)&#x548C;3D&#x8DDF;&#x8E2A;(tracking)&#x7B49;&#x8BA1;&#x7B97;&#x673A;&#x89C6;&#x89C9;&#x6280;&#x672F;&#x5728;&#x8F66;&#x8F7D;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x6027;&#x80FD;&#x3002;</strong>KITTI&#x5305;&#x542B;&#x5E02;&#x533A;&#x3001;&#x4E61;&#x6751;&#x548C;&#x9AD8;&#x901F;&#x516C;&#x8DEF;&#x7B49;&#x573A;&#x666F;&#x91C7;&#x96C6;&#x7684;&#x771F;&#x5B9E;&#x56FE;&#x50CF;&#x6570;&#x636E;&#xFF0C;<strong>&#x6BCF;&#x5F20;&#x56FE;&#x50CF;&#x4E2D;&#x6700;&#x591A;&#x8FBE;15&#x8F86;&#x8F66;&#x548C;30&#x4E2A;&#x884C;&#x4EBA;&#xFF0C;&#x8FD8;&#x6709;&#x5404;&#x79CD;&#x7A0B;&#x5EA6;&#x7684;&#x906E;&#x6321;&#x4E0E;&#x622A;&#x65AD;&#x3002;</strong></p>
<p>&#x5730;&#x5740;&#xFF1A;<a href="http://www.cvlibs.net/datasets/kitti/" target="_blank">http://www.cvlibs.net/datasets/kitti/</a></p>
<h4 id="1&#x3001;kitti&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#xFF08;object-detection&#xFF09;2d&#x6570;&#x636E;&#x96C6;"><strong>1&#x3001;kitti&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#xFF08;object detection&#xFF09;2D&#x6570;&#x636E;&#x96C6;</strong></h4>
<p><img src="../images/KITTI2D&#x6570;&#x636E;&#x96C6;.jpg" style="zoom:40%;"></p>
<p>2D&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x662F;&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x6240;&#x63A5;&#x89E6;&#x7684;&#x68C0;&#x6D4B;&#x5E38;&#x7528;&#x5C06;&#x7269;&#x4F53;&#x4F7F;&#x7528;&#x5E73;&#x9762;&#x6846;&#x6846;&#x8D77;&#x6765;&#x7684;&#x5F62;&#x5F0F;&#x6570;&#x636E;&#x3002;&#x6570;&#x636E;&#x548C;&#x6807;&#x7B7E;&#x6587;&#x4EF6;&#x4EE5;&#x53CA;&#x63CF;&#x8FF0;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#xFF1A;</p>
<p><img src="../images/KITTI&#x63CF;&#x8FF0;&#x6587;&#x4EF6;.jpg" style="zoom:45%;"></p>
<h5 id="&#x6570;&#x636E;&#x96C6;&#x5185;&#x5BB9;&#x4ECB;&#x7ECD;">&#x6570;&#x636E;&#x96C6;&#x5185;&#x5BB9;&#x4ECB;&#x7ECD;</h5>
<p>TXT&#x6587;&#x4EF6;&#x4E2D;&#x5305;&#x542B;&#x7740;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;&#x7684;&#x6807;&#x6CE8;&#x4FE1;&#x606F;&#xFF0C;KITTI&#x6570;&#x636E;&#x96C6;&#x4E3A;&#x6444;&#x50CF;&#x673A;&#x89C6;&#x91CE;&#x5185;&#x7684;&#x8FD0;&#x52A8;&#x7269;&#x4F53;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;3D&#x8FB9;&#x6846;&#x6807;&#x6CE8;&#xFF08;&#x4F7F;&#x7528;&#x6FC0;&#x5149;&#x96F7;&#x8FBE;&#x7684;&#x5750;&#x6807;&#x7CFB;&#xFF09;&#x3002;&#x8BE5;&#x6570;&#x636E;&#x96C6;&#x7684;&#x6807;&#x6CE8;&#x4E00;&#x5171;&#x5206;&#x4E3A;8&#x4E2A;&#x7C7B;&#x522B;&#xFF1A;&#x2019;Car&#x2019;, &#x2019;Van&#x2019;, &#x2019;Truck&#x2019;, &#x2019;Pedestrian&#x2019;, &#x2019;Person (sit- ting)&#x2019;, &#x2019;Cyclist&#x2019;, &#x2019;Tram&#x2019; &#x548C;&#x2019;Misc&#x2019;&#x6216;&#x8005;&apos;DontCare&apos;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&apos;DontCare&apos; &#x6807;&#x7B7E;&#x8868;&#x793A;&#x8BE5;&#x533A;&#x57DF;&#x6CA1;&#x6709;&#x88AB;&#x6807;&#x6CE8;&#x3002;</p>
<p>&#x6807;&#x6CE8;&#x89E3;&#x91CA;&#xFF08;value&#x8868;&#x793A;&#x5B57;&#x7B26;&#x4E2A;&#x6570;&#xFF09;,&#x6309;&#x7167;&#x6807;&#x6CE8;&#x6587;&#x4EF6;&#x5206;&#x5272;&#x5982;&#x4E0B;&#xFF0C;&#x4E0B;&#x56FE;&#x662F;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x7684;label&#x6CE8;&#x91CA;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x8F7D;&#x8D27;&#x6C7D;&#x8F66;&#xFF0C;&#x6C7D;&#x8F66;&#xFF0C;&#x81EA;&#x884C;&#x8F66;&#xFF1A;</p>
<p><img src="../images/&#x6807;&#x6CE8;&#x89E3;&#x91CA;.jpg" alt=""></p>
<ul>
<li>type(&#x7C7B;&#x578B;)&#xFF1A;&#x6709;&apos;Car&apos;-&#x6C7D;&#x8F66;, &apos;Van&apos;-&#x53A2;&#x5F0F;&#x8D27;&#x8F66;, &apos;Truck&apos;-&#x8F7D;&#x8D27;&#x5361;&#x8F66;, &apos;Pedestrian&apos;-&#x884C;&#x4EBA;, &apos;Person_sitting&apos;, &apos;Cyclist&apos;-&#x9A91;&#x8F66;&#x4EBA;, &apos;Tram&apos;-&#x7535;&#x8F66;, &apos;Misc&apos; or &apos;DontCare&apos;&#x8FD9;&#x51E0;&#x79CD;&#x7C7B;&#x578B;&#xFF0C;&#x5176;&#x4E2D;&apos;Misc&apos;&#x548C;&apos;DontCare&apos;&#x8868;&#x793A;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;</li>
<li>truncated(&#x662F;&#x5426;&#x622A;&#x65AD;)&#xFF1A;0-1&#x4E4B;&#x95F4;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x5F20;&#x56FE;&#x7247;&#x4E3A;0.00&#x6CA1;&#x6709;&#x622A;&#x65AD;&#x3002;(&#x622A;&#x65AD;&#x5C31;&#x662F;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x5728;&#x91C7;&#x96C6;&#x56FE;&#x50CF;&#x7684;&#x8FB9;&#x7F18;&#x88AB;&#x622A;&#x65AD;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x5B8C;&#x6574;&#x7684;&#xFF09;</li>
<li>occluded(&#x88AB;&#x906E;&#x6321;&#x7A0B;&#x5EA6;)&#xFF1A;0&#x8868;&#x793A;&#x6CA1;&#x6709;&#x906E;&#x6321;&#xFF0C;1&#x8868;&#x793A;&#x90E8;&#x5206;&#x906E;&#x6321;&#xFF0C;2&#x8868;&#x793A;&#x5927;&#x9762;&#x79EF;&#x906E;&#x6321;&#xFF0C;3&#x8868;&#x793A;&#x4E0D;&#x6E05;&#x695A;&#x3002;</li>
<li>alpha(&#x6444;&#x50CF;&#x673A;&#x7684;&#x504F;&#x8F6C;&#x89C6;&#x89D2;)&#xFF1A;&#x4E0D;&#x505A;&#x5206;&#x6790;</li>
<li>bbox(&#x76EE;&#x6807;&#x5728;&#x56FE;&#x50CF;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x5750;&#x6807;)&#xFF1A;4&#x4E2A;&#x6570;&#x5B57;&#x5206;&#x522B;&#x4E3A;599.41&#x3001;156.40&#xFF08;&#x5DE6;&#x4E0A;&#xFF09;&#x3001;629.75&#x3001;189.25&#xFF08;&#x53F3;&#x4E0B;&#xFF09;&#xFF1A;<ul>
<li>xmin&#x3001;ymin&#x3001;xmax&#x3001;ymax</li>
<li>&#x6CE8;&#x610F;YOLO&#x9700;&#x8981;&#x7684;bounding box&#x683C;&#x5F0F;&#x662F;(center_x, center_y, width, height)&#xFF0C;&#x540E;&#x9762;&#x7684;&#x5904;&#x7406;&#x4F1A;&#x8BF4;&#x660E;</li>
</ul>
</li>
<li>dimensions+location/rotation_y(&#x56FE;&#x50CF;&#x7684;&#x4E09;&#x7EF4;&#x5750;&#x6807;)&#xFF1A;&#x8FD9;&#x91CC;&#x4E0D;&#x505A;&#x5206;&#x6790;&#x3002;</li>
</ul>
<h4 id="2&#x3001;&#x6570;&#x636E;&#x96C6;&#x4E0B;&#x8F7D;">2&#x3001;&#x6570;&#x636E;&#x96C6;&#x4E0B;&#x8F7D;</h4>
<p>&#x53BB;&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;&#x4E4B;&#x540E;&#x7684;&#x4E24;&#x4E2A;data_object_label_2.zip 5.6M&#x548C;data_object_image_2.zip 12.57G&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x89E3;&#x538B;&#x4E4B;&#x540E;&#x5982;&#x4E0B;&#xFF1A;&#x56FE;&#x7247;&#x4E0B;&#x9762;&#x6709;&#x8BAD;&#x7EC3;&#x548C;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x4E2A;training&#x5C31;&#x662F;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;&#x7684;&#x76EE;&#x6807;&#x503C;&#x5B58;&#x653E;&#x6587;&#x4EF6;&#x91CC;&#x9762;&#x4E3A;*.txt&#x6587;&#x4EF6;</p>
<p><img src="../images/KITTI&#x89E3;&#x538B;.jpg" style="zoom:50%;"></p>
<h3 id="5102-yolov3&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x5206;&#x6790;">5.10.2 YOLOV3&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x5206;&#x6790;</h3>
<h4 id="51021-&#x6E90;&#x7801;&#x6A21;&#x578B;&#x4E0B;&#x8F7D;">5.10.2.1 &#x6E90;&#x7801;&#x6A21;&#x578B;&#x4E0B;&#x8F7D;</h4>
<h5 id="1&#x3001;&#x5B98;&#x65B9;&#x81EA;&#x5E26;&#x5F00;&#x6E90;">1&#x3001;&#x5B98;&#x65B9;&#x81EA;&#x5E26;&#x5F00;&#x6E90;</h5>
<p>&#x7531;&#x8BBA;&#x6587;&#x4F5C;&#x8005;&#xFF0C;&#x7EA6;&#x745F;&#x592B;&#xB7;&#x5207;&#x7279;&#xB7;&#x96F7;&#x5FB7;&#x8499;&#x5F00;&#x6E90;&#x7684;&#x79F0;&#x4E4B;&#x4E3A;DarkNet&#xFF0C;C&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x5F00;&#x6E90;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;github&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/pjreddie/darknet&#x3002;&#x5B98;&#x65B9;&#x5B9E;&#x73B0;&#x7684;&#x7279;&#x70B9;&#x662F;&#xFF0C;&#x601D;&#x8DEF;&#x5C31;&#x662F;&#x539F;&#x8BBA;&#x6587;&#x601D;&#x8DEF;&#xFF0C;&#x6D4B;&#x8BD5;&#x7CBE;&#x5EA6;&#x548C;&#x901F;&#x5EA6;&#x65E0;&#x592A;&#x5927;&#x5DEE;&#x5F02;&#xFF0C;**&#x4F46;&#x662F;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x7F3A;&#x70B9;&#x6BD4;&#x5982;&#x5B9E;&#x73B0;&#x7684;&#x8BED;&#x8A00;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x64C5;&#x957F;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x5B9E;&#x73B0;&#x7684;&#x601D;&#x8DEF;&#x6BD4;&#x8F83;&#x96BE;&#x61C2;&#x3002;**" target="_blank">https://github.com/pjreddie/darknet&#x3002;&#x5B98;&#x65B9;&#x5B9E;&#x73B0;&#x7684;&#x7279;&#x70B9;&#x662F;&#xFF0C;&#x601D;&#x8DEF;&#x5C31;&#x662F;&#x539F;&#x8BBA;&#x6587;&#x601D;&#x8DEF;&#xFF0C;&#x6D4B;&#x8BD5;&#x7CBE;&#x5EA6;&#x548C;&#x901F;&#x5EA6;&#x65E0;&#x592A;&#x5927;&#x5DEE;&#x5F02;&#xFF0C;**&#x4F46;&#x662F;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x7F3A;&#x70B9;&#x6BD4;&#x5982;&#x5B9E;&#x73B0;&#x7684;&#x8BED;&#x8A00;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x64C5;&#x957F;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x5B9E;&#x73B0;&#x7684;&#x601D;&#x8DEF;&#x6BD4;&#x8F83;&#x96BE;&#x61C2;&#x3002;**</a></p>
<h5 id="2&#x3001;github&#x9AD8;&#x661F;&#x5B9E;&#x73B0;&#x7248;&#x672C;">2&#x3001;github&#x9AD8;&#x661F;&#x5B9E;&#x73B0;&#x7248;&#x672C;</h5>
<p>&#x9664;&#x4E86;&#x5B98;&#x65B9;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4E5F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x673A;&#x6784;&#x6216;&#x4E2A;&#x4EBA;&#x5F00;&#x6E90;&#x7684;&#x719F;&#x6089;&#x7684;&#x5982;TensorFlow&#x3001;Pytorch&#x7684;&#x7248;&#x672C;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x540E;&#x9762;&#x505A;&#x7684;&#x6848;&#x4F8B;&#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x3002;</p>
<ul>
<li>&#x6700;&#x65E9;&#x5B9E;&#x73B0;&#x7684;&#x9AD8;&#x661F;&#x7248;&#x672C;&#xFF1A;<strong><a href="https://github.com/qqwweee/keras-yolo3" target="_blank">keras-yolo3</a></strong>&#x3002;<ul>
<li>TensorFlow&#x5B9E;&#x73B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x76F8;&#x6BD4;&#x5B98;&#x65B9;&#x7248;&#x672C;&#xFF0C;&#x4F18;&#x70B9;&#x5C31;&#x662F;&#x6E90;&#x7801;&#x7B80;&#x5355;&#x6613;&#x8BFB;&#x5DF2;&#x590D;&#x73B0;&#xFF0C;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684;&#x7F3A;&#x70B9;&#xFF0C;&#x901F;&#x5EA6;&#x6027;&#x80FD;&#x4E0A;&#x4E0E;C&#x5B9E;&#x73B0;&#x7684;&#x7248;&#x672C;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5DEE;&#x5F02;&#x3002;</li>
</ul>
</li>
</ul>
<p><strong>&#x5B9E;&#x73B0;&#x4E0D;&#x662F;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x522B;&#x4EBA;&#x7684;&#x5173;&#x952E;&#x4EE3;&#x7801;&#xFF0C;&#x590D;&#x5236;&#x8FDB;&#x81EA;&#x5DF1;&#x7684;&#x9879;&#x76EE;&#x3002;</strong></p>
<p><strong>&#x590D;&#x73B0;&#x6B65;&#x9AA4;&#xFF1A;1&#x3001;&#x719F;&#x6089;&#x7B97;&#x6CD5;&#x601D;&#x60F3; 2&#x3001;&#x4ECB;&#x7ECD;&#x76F8;&#x5173;&#x5E94;&#x7528; 3&#x3001;&#x5206;&#x6A21;&#x5757;&#x8FDB;&#x884C;&#x5B9E;&#x6218;&#x7EC3;&#x4E60;</strong></p>
<p>3&#x3001;YOLO&#x5B98;&#x7F51;&#x4E0A;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;YOLO v3&#x7684;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;</p>
<p>&#x5730;&#x5740;&#xFF1A;<a href="https://link.zhihu.com/?target=https%3A//pjreddie.com/darknet/yolo/" target="_blank">https://pjreddie.com/darknet/yolo/</a>&#x3002;<strong>&#x5927;&#x591A;&#x65F6;&#x5019;&#x601D;&#x7EF4;&#x662F;&#x57FA;&#x4E8E;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x81EA;&#x5DF1;&#x9700;&#x8981;&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x6BD4;&#x5982;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x4E2D;&#x5176;&#x5B9E;&#x5305;&#x62EC;&#x4E86;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x5927;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x518D;&#x7EC6;&#x5206;&#x6B64;&#x7C7B;&#xFF0C;&#x90A3;&#x9700;&#x8981;&#x5EFA;&#x7ACB;&#x81EA;&#x5DF1;&#x7684;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x5E76;&#x5F00;&#x5C55;&#x8BAD;&#x7EC3;&#x3002;&#x4E0D;&#x8FC7;&#x5F53;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x4E0D;&#x7406;&#x60F3;&#x6216;&#x8BAD;&#x7EC3;&#x65F6;&#x95F4;&#x4E0D;&#x5145;&#x5206;&#x65F6;&#xFF0C;&#x4E8C;&#x6B21;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x5728;&#x5927;&#x7C7B;&#x8FA8;&#x522B;&#x57FA;&#x7840;&#x4E0A;&#x5E76;&#x4E0D;&#x53CA;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BD5;&#x8BD5;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x7684;&#x6548;&#x679C;&#x3002;</strong></p>
<h4 id="51022-yolov3tensorflow20&#x6E90;&#x7801;&#x5206;&#x6790;">5.10.2.2 YOLOV3-Tensorflow2.0&#x6E90;&#x7801;&#x5206;&#x6790;</h4>
<h4 id="1&#x3001;v3&#x6574;&#x4F53;&#x7ED3;&#x6784;">1&#x3001;V3&#x6574;&#x4F53;&#x7ED3;&#x6784;</h4>
<p>YOLOv3&#x5F15;&#x5165;&#x4E86;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#xFF0C;&#x5E76;&#x8FDB;&#x4E00;&#x6B65;&#x52A0;&#x6DF1;&#x4E86;&#x7F51;&#x7EDC;&#xFF0C;&#x6539;&#x8FDB;&#x540E;&#x7684;&#x7F51;&#x7EDC;&#x6709;53&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#xFF0C;&#x547D;&#x540D;&#x4E3A;Darknet-53&#x3002;YOLOv3&#x501F;&#x9274;&#x4E86;FPN&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x4ECE;&#x4E0D;&#x540C;&#x5C3A;&#x5EA6;&#x63D0;&#x53D6;&#x7279;&#x5F81;&#x3002;</p>
<p><img src="../images/darknet53.jpg" style="zoom:45%;"></p>
<p>YOLOV3&#x7684;&#x8BE6;&#x7EC6;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="../images/YOLOV3&#x8BE6;&#x7EC6;&#x7ED3;&#x6784;.jpg" style="zoom:45%;"></p>
<p>YOLOv3 &#x7684;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x7531;&#x57FA;&#x7840;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7F51;&#x7EDC;&#x3001;multi-scale&#x7279;&#x5F81;&#x878D;&#x5408;&#x5C42;&#x548C;&#x8F93;&#x51FA;&#x5C42;&#x7EC4;&#x6210;&#x3002;</p>
<ul>
<li><p>&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7F51;&#x7EDC;&#xFF1A;<strong>YOLOv3&#x4F7F;&#x7528;DarkNet53&#x4F5C;&#x4E3A;&#x7279;&#x5F81;&#x63D0;&#x53D6;&#x7F51;&#x7EDC;&#xFF1A;DarkNet53 &#x57FA;&#x672C;&#x91C7;&#x7528;&#x4E86;&#x5168;&#x5377;&#x79EF;&#x7F51;&#x7EDC;&#xFF0C;&#x7528;&#x6B65;&#x957F;&#x4E3A;2&#x7684;&#x5377;&#x79EF;&#x64CD;&#x4F5C;&#x66FF;&#x4EE3;&#x4E86;&#x6C60;&#x5316;&#x5C42;&#xFF0C;&#x540C;&#x65F6;&#x6DFB;&#x52A0;&#x4E86; Residual &#x5355;&#x5143;&#xFF0C;&#x907F;&#x514D;&#x5728;&#x7F51;&#x7EDC;&#x5C42;&#x6570;&#x8FC7;&#x6DF1;&#x65F6;&#x53D1;&#x751F;&#x68AF;&#x5EA6;&#x5F25;&#x6563;&#x3002;</strong></p>
</li>
<li><p>&#x7279;&#x5F81;&#x878D;&#x5408;&#x5C42;&#xFF1A;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x4E4B;&#x524D;YOLO&#x7248;&#x672C;&#x5BF9;&#x5C0F;&#x76EE;&#x6807;&#x4E0D;&#x654F;&#x611F;&#x7684;&#x95EE;&#x9898;&#xFF0C;<strong>YOLOv3&#x91C7;&#x7528;&#x4E86;3&#x4E2A;&#x4E0D;&#x540C;&#x5C3A;&#x5EA6;&#x7684;&#x7279;&#x5F81;&#x56FE;&#x6765;&#x8FDB;&#x884C;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#xFF0C;&#x5206;&#x522B;&#x4E3A;13x13,26x26,52x52,&#x7528;&#x6765;&#x68C0;&#x6D4B;&#x5927;&#x3001;&#x4E2D;&#x3001;&#x5C0F;&#x4E09;&#x79CD;&#x76EE;&#x6807;&#x3002;</strong>&#x7279;&#x5F81;&#x878D;&#x5408;&#x5C42;&#x9009;&#x53D6; DarkNet &#x4EA7;&#x51FA;&#x7684;&#x4E09;&#x79CD;&#x5C3A;&#x5EA6;&#x7279;&#x5F81;&#x56FE;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#xFF0C;&#x501F;&#x9274;&#x4E86;FPN(feature pyramid networks)&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5377;&#x79EF;&#x5C42;&#x548C;&#x4E0A;&#x91C7;&#x6837;&#x5BF9;&#x5404;&#x5C3A;&#x5EA6;&#x7684;&#x7279;&#x5F81;&#x56FE;&#x8FDB;&#x884C;&#x878D;&#x5408;&#x3002;</p>
</li>
<li><p>&#x8F93;&#x51FA;&#x5C42;&#xFF1A;&#x540C;&#x6837;&#x4F7F;&#x7528;&#x4E86;&#x5168;&#x5377;&#x79EF;&#x7ED3;&#x6784;&#xFF0C;&#x5176;&#x4E2D;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x5377;&#x79EF;&#x6838;&#x4E2A;&#x6570;&#x662F;255&#xFF1A;3x(20+4+1)=75&#x8868;&#x793A;&#x4E00;&#x4E2A;grid cell&#x5305;&#x542B;3&#x4E2A;bounding box&#xFF0C;4&#x8868;&#x793A;&#x6846;&#x7684;4&#x4E2A;&#x5750;&#x6807;&#x4FE1;&#x606F;&#xFF0C;1&#x8868;&#x793A;Confidence Score&#xFF0C;20&#x8868;&#x793A;VOC&#x6570;&#x636E;&#x96C6;&#x4E2D;80&#x4E2A;&#x7C7B;&#x522B;&#x7684;&#x6982;&#x7387;&#x3002;&#x5982;&#x679C;&#x6362;&#x7528;&#x522B;&#x7684;&#x6570;&#x636E;&#x96C6;&#xFF0C;20&#x53EF;&#x4EE5;&#x66F4;&#x6539;&#x4E3A;&#x5B9E;&#x9645;&#x7C7B;&#x522B;&#x6570;&#x91CF;&#x3002;</p>
</li>
</ul>
<h4 id="2&#x3001;&#x6E90;&#x7801;&#x4E3B;&#x6A21;&#x578B;">2&#x3001;&#x6E90;&#x7801;&#x4E3B;&#x6A21;&#x578B;</h4>
<ul>
<li><p>YOLOV3&#x7684;&#x7B51;&#x7ED3;&#x6784;&#xFF1A;</p>
<ul>
<li><p>1&#x3001;Darknet</p>
</li>
<li><p>2&#x3001;3&#x5C42;YoloConv&#x8FDB;&#x884C;&#x62FC;&#x63A5;&#x7136;&#x540E;&#x5377;&#x79EF;&#x64CD;&#x4F5C;&#x5F97;&#x5230;&#x4E09;&#x5C42;&#x8F93;&#x51FA;output_0&#xFF0C;output_1&#xFF0C;output_2&#xFF08;&#x7531;&#x6DF1;&#x5230;&#x6D45;&#xFF09;</p>
</li>
<li>3&#x3001;&#x5982;&#x679C;&#x662F;&#x9884;&#x6D4B;<ul>
<li>&#x4E09;&#x5C42;&#x8F93;&#x51FA;&#x76F4;&#x63A5;&#x901A;&#x8FC7;yolo_boxes&#x8BA1;&#x7B97;&#x5F97;&#x5230;bbox, objectness, class_probs, pred_box</li>
<li>&#x7136;&#x540E;&#x5408;&#x5E76;&#x8FDB;&#x884C;yolo_nms&#x8FC7;&#x6EE4;&#x8F93;&#x51FA;&#x9884;&#x6D4B;&#x7ED3;&#x679C;</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">YoloV3</span><span class="hljs-params">(size=None, channels=<span class="hljs-number">3</span>, anchors=yolo_anchors,
           masks=yolo_anchor_masks, classes=<span class="hljs-number">80</span>, training=False)</span>:</span>
    x = inputs = Input([size, size, channels])

    x_36, x_61, x = Darknet(name=<span class="hljs-string">&apos;yolo_darknet&apos;</span>)(x)

    <span class="hljs-comment"># &#x4E0B;&#x9762;&#x901A;&#x8FC7;YOLO&#x7684;&#x540E;&#x7EED;</span>
    x = YoloConv(<span class="hljs-number">512</span>, name=<span class="hljs-string">&apos;yolo_conv_0&apos;</span>)(x)
    output_0 = YoloOutput(<span class="hljs-number">512</span>, len(masks[<span class="hljs-number">0</span>]), classes, name=<span class="hljs-string">&apos;yolo_output_0&apos;</span>)(x)

    x = YoloConv(<span class="hljs-number">256</span>, name=<span class="hljs-string">&apos;yolo_conv_1&apos;</span>)((x, x_61))
    output_1 = YoloOutput(<span class="hljs-number">256</span>, len(masks[<span class="hljs-number">1</span>]), classes, name=<span class="hljs-string">&apos;yolo_output_1&apos;</span>)(x)

    x = YoloConv(<span class="hljs-number">128</span>, name=<span class="hljs-string">&apos;yolo_conv_2&apos;</span>)((x, x_36))
    output_2 = YoloOutput(<span class="hljs-number">128</span>, len(masks[<span class="hljs-number">2</span>]), classes, name=<span class="hljs-string">&apos;yolo_output_2&apos;</span>)(x)

    <span class="hljs-keyword">if</span> training:
        <span class="hljs-keyword">return</span> Model(inputs, (output_0, output_1, output_2), name=<span class="hljs-string">&apos;yolov3&apos;</span>)

    boxes_0 = Lambda(<span class="hljs-keyword">lambda</span> x: yolo_boxes(x, anchors[masks[<span class="hljs-number">0</span>]], classes),
                     name=<span class="hljs-string">&apos;yolo_boxes_0&apos;</span>)(output_0)
    boxes_1 = Lambda(<span class="hljs-keyword">lambda</span> x: yolo_boxes(x, anchors[masks[<span class="hljs-number">1</span>]], classes),
                     name=<span class="hljs-string">&apos;yolo_boxes_1&apos;</span>)(output_1)
    boxes_2 = Lambda(<span class="hljs-keyword">lambda</span> x: yolo_boxes(x, anchors[masks[<span class="hljs-number">2</span>]], classes),
                     name=<span class="hljs-string">&apos;yolo_boxes_2&apos;</span>)(output_2)

    outputs = Lambda(<span class="hljs-keyword">lambda</span> x: yolo_nms(x, anchors, masks, classes),
                     name=<span class="hljs-string">&apos;yolo_nms&apos;</span>)((boxes_0[:<span class="hljs-number">3</span>], boxes_1[:<span class="hljs-number">3</span>], boxes_2[:<span class="hljs-number">3</span>]))

    <span class="hljs-keyword">return</span> Model(inputs, outputs, name=<span class="hljs-string">&apos;yolov3&apos;</span>)
</code></pre>
<ul>
<li>YOLOV3Tiny&#x7ED3;&#x6784;</li>
</ul>
<p>&#x540C;&#x6837;&#x662F;YOLOV3&#x7684;&#x539F;&#x4F5C;&#x8005;&#x63D0;&#x51FA;&#x6765;&#x7684;&#x4E00;&#x4E2A;&#x901F;&#x5EA6;&#x66F4;&#x5FEB;&#x4F46;&#x7CBE;&#x5EA6;&#x7A0D;&#x4F4E;&#x7684;&#x5D4C;&#x5165;&#x5F0F;&#x7248;&#x672C;&#x7CFB;&#x5217;&#x2014;&#x2014;Tiny-YOLO&#x3002;&#x5BF9;&#x4E8E;&#x901F;&#x5EA6;&#x8981;&#x6C42;&#x6BD4;&#x8F83;&#x9AD8;&#x7684;&#x9879;&#x76EE;&#xFF0C;YOLOV3-tiny&#x4F1A;&#x662F;&#x9996;&#x8981;&#x9009;&#x62E9;&#x3002;&#x5220;&#x9664;&#x4E00;&#x4E9B;&#x7279;&#x5F81;&#x5C42;&#x5E76;&#x4E14;&#x8F93;&#x51FA;&#x53EA;&#x6709;&#x4E24;&#x5C42;&#x7279;&#x5F81;&#x505A;&#x7B5B;&#x9009;&#x3002;</p>
<p>&#x6CE8;&#xFF1A;&#x8FD8;&#x6709;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x8F7B;&#x91CF;&#x7EA7;&#x9AA8;&#x5E72;&#x7F51;&#x7EDC;&#x7684;YOLO&#x53D8;&#x79CD;&#xFF0C;&#x5982;MobileNet-YOLOv3&#x7B49;&#x3002;</p>
<p><img src="../images/tinyyolo.jpg" style="zoom:30%;"></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">YoloV3Tiny</span><span class="hljs-params">(size=None, channels=<span class="hljs-number">3</span>, anchors=yolo_tiny_anchors,
               masks=yolo_tiny_anchor_masks, classes=<span class="hljs-number">80</span>, training=False)</span>:</span>
    x = inputs = Input([size, size, channels])

    x_8, x = DarknetTiny(name=<span class="hljs-string">&apos;yolo_darknet&apos;</span>)(x)

    x = YoloConvTiny(<span class="hljs-number">256</span>, name=<span class="hljs-string">&apos;yolo_conv_0&apos;</span>)(x)
    output_0 = YoloOutput(<span class="hljs-number">256</span>, len(masks[<span class="hljs-number">0</span>]), classes, name=<span class="hljs-string">&apos;yolo_output_0&apos;</span>)(x)

    x = YoloConvTiny(<span class="hljs-number">128</span>, name=<span class="hljs-string">&apos;yolo_conv_1&apos;</span>)((x, x_8))
    output_1 = YoloOutput(<span class="hljs-number">128</span>, len(masks[<span class="hljs-number">1</span>]), classes, name=<span class="hljs-string">&apos;yolo_output_1&apos;</span>)(x)

    <span class="hljs-keyword">if</span> training:
        <span class="hljs-keyword">return</span> Model(inputs, (output_0, output_1), name=<span class="hljs-string">&apos;yolov3&apos;</span>)

    boxes_0 = Lambda(<span class="hljs-keyword">lambda</span> x: yolo_boxes(x, anchors[masks[<span class="hljs-number">0</span>]], classes),
                     name=<span class="hljs-string">&apos;yolo_boxes_0&apos;</span>)(output_0)
    boxes_1 = Lambda(<span class="hljs-keyword">lambda</span> x: yolo_boxes(x, anchors[masks[<span class="hljs-number">1</span>]], classes),
                     name=<span class="hljs-string">&apos;yolo_boxes_1&apos;</span>)(output_1)
    outputs = Lambda(<span class="hljs-keyword">lambda</span> x: yolo_nms(x, anchors, masks, classes),
                     name=<span class="hljs-string">&apos;yolo_nms&apos;</span>)((boxes_0[:<span class="hljs-number">3</span>], boxes_1[:<span class="hljs-number">3</span>]))
    <span class="hljs-keyword">return</span> Model(inputs, outputs, name=<span class="hljs-string">&apos;yolov3_tiny&apos;</span>)
</code></pre>
<ul>
<li>&#x4E24;&#x8005;&#x4E3B;&#x7ED3;&#x6784;Darknet&#x4E0E;DarknetTiny&#x7684;&#x5BF9;&#x6BD4;<ul>
<li>1&#x3001;YOLOV3&#x91CD;&#x590D;&#x82E5;&#x5E72;&#x5C42;DarknetBlock&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#xFF0C;&#x8F93;&#x51FA;&#x5305;&#x542B;&#x4E09;&#x5C42;&#x7279;&#x5F81;</li>
<li>2&#x3001;YOLOV3-Tiny&#x5B9E;&#x73B0;&#x5220;&#x9664;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#xFF0C;&#x8FDB;&#x884C;&#x82E5;&#x5E72;&#x5C42;&#x91C7;&#x6837;&#xFF0C;&#x5E76;&#x4E14;&#x8F93;&#x51FA;&#x53EA;&#x6709;&#x4E24;&#x5C42;&#x7279;&#x5F81;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># 1&#x3001;&#x91CD;&#x590D;&#x82E5;&#x5E72;&#x5C42;DarknetBlock&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#xFF0C;&#x8F93;&#x51FA;&#x5305;&#x542B;&#x4E09;&#x5C42;&#x7279;&#x5F81;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Darknet</span><span class="hljs-params">(name=None)</span>:</span>
    x = inputs = Input([<span class="hljs-keyword">None</span>, <span class="hljs-keyword">None</span>, <span class="hljs-number">3</span>])
    x = DarknetConv(x, <span class="hljs-number">32</span>, <span class="hljs-number">3</span>)
    x = DarknetBlock(x, <span class="hljs-number">64</span>, <span class="hljs-number">1</span>)
    x = DarknetBlock(x, <span class="hljs-number">128</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment"># skip connection</span>
    x = x_36 = DarknetBlock(x, <span class="hljs-number">256</span>, <span class="hljs-number">8</span>)  <span class="hljs-comment"># skip connection</span>
    x = x_61 = DarknetBlock(x, <span class="hljs-number">512</span>, <span class="hljs-number">8</span>)
    x = DarknetBlock(x, <span class="hljs-number">1024</span>, <span class="hljs-number">4</span>)
    <span class="hljs-keyword">return</span> tf.keras.Model(inputs, (x_36, x_61, x), name=name)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">DarknetBlock</span><span class="hljs-params">(x, filters, blocks)</span>:</span>
    x = DarknetConv(x, filters, <span class="hljs-number">3</span>, strides=<span class="hljs-number">2</span>)
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(blocks):
        x = DarknetResidual(x, filters)
    <span class="hljs-keyword">return</span> x

<span class="hljs-comment"># 2&#x3001;&#x5B9E;&#x73B0;&#x5220;&#x9664;&#x6B8B;&#x5DEE;&#x6A21;&#x5757;&#xFF0C;&#x8FDB;&#x884C;&#x82E5;&#x5E72;&#x5C42;&#x91C7;&#x6837;&#xFF0C;&#x5E76;&#x4E14;&#x8F93;&#x51FA;&#x53EA;&#x6709;&#x4E24;&#x5C42;&#x7279;&#x5F81;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">DarknetTiny</span><span class="hljs-params">(name=None)</span>:</span>
    x = inputs = Input([<span class="hljs-keyword">None</span>, <span class="hljs-keyword">None</span>, <span class="hljs-number">3</span>])
    x = DarknetConv(x, <span class="hljs-number">16</span>, <span class="hljs-number">3</span>)
    x = MaxPool2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&apos;same&apos;</span>)(x)
    x = DarknetConv(x, <span class="hljs-number">32</span>, <span class="hljs-number">3</span>)
    x = MaxPool2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&apos;same&apos;</span>)(x)
    x = DarknetConv(x, <span class="hljs-number">64</span>, <span class="hljs-number">3</span>)
    x = MaxPool2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&apos;same&apos;</span>)(x)
    x = DarknetConv(x, <span class="hljs-number">128</span>, <span class="hljs-number">3</span>)
    x = MaxPool2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&apos;same&apos;</span>)(x)
    x = x_8 = DarknetConv(x, <span class="hljs-number">256</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment"># skip connection</span>
    x = MaxPool2D(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&apos;same&apos;</span>)(x)
    x = DarknetConv(x, <span class="hljs-number">512</span>, <span class="hljs-number">3</span>)
    x = MaxPool2D(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&apos;same&apos;</span>)(x)
    x = DarknetConv(x, <span class="hljs-number">1024</span>, <span class="hljs-number">3</span>)
    <span class="hljs-keyword">return</span> tf.keras.Model(inputs, (x_8, x), name=name)
</code></pre>
<h4 id="3&#x3001;&#x4F7F;&#x7528;&#x6A21;&#x578B;">3&#x3001;&#x4F7F;&#x7528;&#x6A21;&#x578B;</h4>
<pre><code class="lang-python"><span class="hljs-comment"># &#x521D;&#x59CB;&#x5316;&#x6A21;&#x578B;</span>
model = YoloV3Tiny(args.size, training=<span class="hljs-keyword">True</span>,classes=args.num_classes)

model = YoloV3(args.size, training=<span class="hljs-keyword">True</span>, classes=args.num_classes)
</code></pre>
<h3 id="5103-kitti&#x4EBA;&#x8F66;&#x68C0;&#x6D4B;&#x9879;&#x76EE;">5.10.3 KITTI&#x4EBA;&#x8F66;&#x68C0;&#x6D4B;&#x9879;&#x76EE;</h3>
<h4 id="51031-&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x4E0E;&#x6A21;&#x5757;">5.10.3.1 &#x9879;&#x76EE;&#x76EE;&#x5F55;&#x4E0E;&#x6A21;&#x5757;</h4>
<p><img src="../images/&#x6A21;&#x578B;&#x76EE;&#x5F55;.jpg" style="zoom:50%;"></p>
<ul>
<li>data:&#x5305;&#x542B;&#x6240;&#x6709;&#x6570;&#x636E;&#x76EE;&#x5F55;</li>
<li>utils:&#x6570;&#x636E;&#x96C6;&#x8F6C;&#x6362;&#x7B49;&#x5DE5;&#x5177;&#x76EE;&#x5F55;</li>
<li>yolov3-tf2:TensorFlow2.0&#x5B9E;&#x73B0;&#x7684;YOLO&#x591A;&#x79CD;&#x6A21;&#x578B;&#x76EE;&#x5F55;</li>
</ul>
<h4 id="51032-&#x9879;&#x76EE;&#x6B65;&#x9AA4;&#x5206;&#x6790;">5.10.3.2 &#x9879;&#x76EE;&#x6B65;&#x9AA4;&#x5206;&#x6790;</h4>
<p>&#x6211;&#x4EEC;&#x5229;&#x7528;&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x597D;&#x7684;&#x6570;&#x636E;&#x96C6;&#x548C;&#x5B9E;&#x73B0;&#x597D;&#x7684;YOLO&#x6A21;&#x578B;&#xFF0C;&#x53BB;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;KITTI&#x573A;&#x666F;&#x4E0B;&#x7684;&#x7269;&#x4F53;&#x68C0;&#x6D4B;&#xFF0C;&#x5305;&#x62EC;&#x4EBA;&#xFF0C;&#x8F66;&#x7B49;&#x591A;&#x79CD;&#x7269;&#x4F53;&#x3002;</p>
<ul>
<li>1&#x3001;&#x6570;&#x636E;&#x96C6;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF0C;KITTI&#x8F6C;&#x6362;&#x6210;TFRecords&#x6587;&#x4EF6;</li>
<li>2&#x3001;KITTI&#x6848;&#x4F8B;&#x8BAD;&#x7EC3;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</li>
<li>3&#x3001;&#x56FE;&#x7247;&#x548C;&#x89C6;&#x9891;&#x7684;&#x68C0;&#x6D4B;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</li>
</ul>
<h3 id="5104-&#x6570;&#x636E;&#x96C6;&#x7C7B;&#x578B;&#x8F6C;&#x6362;kitti&#x6570;&#x636E;&#x96C6;&#x8F6C;&#x6362;&#x6210;tfrecords&#x6587;&#x4EF6;">5.10.4 &#x6570;&#x636E;&#x96C6;&#x7C7B;&#x578B;&#x8F6C;&#x6362;-KITTI&#x6570;&#x636E;&#x96C6;&#x8F6C;&#x6362;&#x6210;TFRecords&#x6587;&#x4EF6;</h3>
<h4 id="51041-tfrecordtensorflow-&#x6570;&#x636E;&#x96C6;&#x5B58;&#x50A8;&#x683C;&#x5F0F;">5.10.4.1 TFRecord-TensorFlow &#x6570;&#x636E;&#x96C6;&#x5B58;&#x50A8;&#x683C;&#x5F0F;</h4>
<p>TFRecord &#x662F; TensorFlow &#x4E2D;&#x7684;&#x6570;&#x636E;&#x96C6;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#x3002;<strong>&#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x6570;&#x636E;&#x96C6;&#x6574;&#x7406;&#x6210; TFRecord &#x683C;&#x5F0F;&#x540E;&#xFF0C;TensorFlow &#x5C31;&#x53EF;&#x4EE5;&#x9AD8;&#x6548;&#x5730;&#x8BFB;&#x53D6;&#x548C;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x4ECE;&#x800C;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x8FDB;&#x884C;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x3002;</strong></p>
<ul>
<li>&#x683C;&#x5F0F;&#xFF1A;TFRecord &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x7CFB;&#x5217;&#x5E8F;&#x5217;&#x5316;&#x7684; <code>tf.train.Example</code> &#x5143;&#x7D20;&#x6240;&#x7EC4;&#x6210;&#x7684;&#x5217;&#x8868;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x6BCF;&#x4E00;&#x4E2A; <code>tf.train.Example</code> &#x53C8;&#x7531;&#x82E5;&#x5E72;&#x4E2A; <code>tf.train.Feature</code> &#x7684;&#x5B57;&#x5178;&#x7EC4;&#x6210;&#x3002;&#x5F62;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<pre><code class="lang-python">[
    {   <span class="hljs-comment"># example 1 (tf.train.Example)</span>
        <span class="hljs-string">&apos;feature_1&apos;</span>: tf.train.Feature,
        ...
        <span class="hljs-string">&apos;feature_k&apos;</span>: tf.train.Feature
    },
    ...
    {   <span class="hljs-comment"># example N (tf.train.Example)</span>
        <span class="hljs-string">&apos;feature_1&apos;</span>: tf.train.Feature,
        ...
        <span class="hljs-string">&apos;feature_k&apos;</span>: tf.train.Feature
    }
]
<span class="hljs-comment"># &#x5B57;&#x5178;&#x7ED3;&#x6784;&#x5982;</span>
feature = {
                <span class="hljs-string">&apos;image&apos;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[image])),  <span class="hljs-comment"># &#x56FE;&#x7247;&#x662F;&#x4E00;&#x4E2A; Bytes &#x5BF9;&#x8C61;</span>
                <span class="hljs-string">&apos;label&apos;</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[label]))  <span class="hljs-comment"># &#x6807;&#x7B7E;&#x662F;&#x4E00;&#x4E2A; Int &#x5BF9;&#x8C61;</span>
            }
</code></pre>
<h4 id="1&#x3001;&#x4FDD;&#x5B58;tfrecord">1&#x3001;&#x4FDD;&#x5B58;TFRecord</h4>
<p>&#x4E3A;&#x4E86;&#x5C06;&#x5F62;&#x5F0F;&#x5404;&#x6837;&#x7684;&#x6570;&#x636E;&#x96C6;&#x6574;&#x7406;&#x4E3A; TFRecord &#x683C;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;&#x6570;&#x636E;&#x96C6;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>1&#x3001;&#x8BFB;&#x53D6;&#x8BE5;&#x6570;&#x636E;&#x5143;&#x7D20;&#x5230;&#x5185;&#x5B58;</li>
<li>2&#x3001;&#x5C06;&#x8BE5;&#x5143;&#x7D20;&#x8F6C;&#x6362;&#x4E3A; <code>tf.train.Example</code> &#x5BF9;&#x8C61;&#xFF08;&#x6BCF;&#x4E00;&#x4E2A; <code>tf.train.Example</code> &#x7531;&#x82E5;&#x5E72;&#x4E2A; <code>tf.train.Feature</code> &#x7684;&#x5B57;&#x5178;&#x7EC4;&#x6210;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5148;&#x5EFA;&#x7ACB; Feature &#x7684;&#x5B57;&#x5178;&#xFF09;&#xFF1B;</li>
<li>3&#x3001;&#x5C06;&#x8BE5; <code>tf.train.Example</code> &#x5BF9;&#x8C61;&#x5E8F;&#x5217;&#x5316;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x9884;&#x5148;&#x5B9A;&#x4E49;&#x7684; <code>tf.io.TFRecordWriter</code> &#x5199;&#x5165; TFRecord &#x6587;&#x4EF6;&#x3002;</li>
</ul>
<h4 id="2&#x3001;&#x8BFB;&#x53D6;-tfrecord-&#x6570;&#x636E;">2&#x3001;&#x8BFB;&#x53D6; TFRecord &#x6570;&#x636E;</h4>
<p>&#x5219;&#x53EF;&#x6309;&#x7167;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>1&#x3001;&#x901A;&#x8FC7; <code>tf.data.TFRecordDataset</code> &#x8BFB;&#x5165;&#x539F;&#x59CB;&#x7684; TFRecord &#x6587;&#x4EF6;&#xFF08;&#x6B64;&#x65F6;&#x6587;&#x4EF6;&#x4E2D;&#x7684; <code>tf.train.Example</code> &#x5BF9;&#x8C61;&#x5C1A;&#x672A;&#x88AB;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF09;&#xFF0C;&#x83B7;&#x5F97;&#x4E00;&#x4E2A; <code>tf.data.Dataset</code> &#x6570;&#x636E;&#x96C6;&#x5BF9;&#x8C61;&#xFF1B;</li>
<li>2&#x3001;&#x901A;&#x8FC7; <code>Dataset.map</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x8BE5;&#x6570;&#x636E;&#x96C6;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5316;&#x7684; <code>tf.train.Example</code> &#x5B57;&#x7B26;&#x4E32;&#x6267;&#x884C; <code>tf.io.parse_single_example</code> &#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x3002;</li>
</ul>
<h4 id="3&#x3001;&#x5B9E;&#x4F8B;">3&#x3001;&#x5B9E;&#x4F8B;</h4>
<p>&#x5C06;&#x5BF9;<a href="https://www.floydhub.com/fastai/datasets/cats-vs-dogs" target="_blank">cats_vs_dogs</a>&#x4E8C;&#x5206;&#x7C7B;&#x6570;&#x636E;&#x96C6;&#x7684;&#x8BAD;&#x7EC3;&#x96C6;&#x90E8;&#x5206;&#x8F6C;&#x6362;&#x4E3A; TFRecord &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8BFB;&#x53D6;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x56E0;&#x4E3A;&#x56FE;&#x7247;&#x8FC7;&#x591A;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3A;&#x4E86;&#x5FEB;&#x901F;&#x770B;&#x5230;&#x6548;&#x679C;&#xFF0C;&#x9009;&#x62E9;&#x4E86;sample&#x76EE;&#x5F55;&#x4E0B;&#x7684;train&#x6570;&#x636E;&#x96C6;&#x51E0;&#x5F20;&#x56FE;&#x7247;&#x3002;</p>
<p>1&#x3001;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x7684;&#x6570;&#x636E;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> os
os.environ[<span class="hljs-string">&quot;TF_CPP_MIN_LOG_LEVEL&quot;</span>] = <span class="hljs-string">&quot;2&quot;</span>

train_cats_dir = <span class="hljs-string">&apos;./cats_vs_dogs/train/cats/&apos;</span>
train_dogs_dir = <span class="hljs-string">&apos;./cats_vs_dogs/train/dogs/&apos;</span>
tfrecord_file = <span class="hljs-string">&apos;./cats_vs_dogs/train.tfrecords&apos;</span>

train_cat_filenames = [train_cats_dir + filename <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(train_cats_dir)]
train_dog_filenames = [train_dogs_dir + filename <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(train_dogs_dir)]
train_filenames = train_cat_filenames + train_dog_filenames
train_labels = [<span class="hljs-number">0</span>] * len(train_cat_filenames) + [<span class="hljs-number">1</span>] * len(train_dog_filenames)  <span class="hljs-comment"># &#x5C06; cat &#x7C7B;&#x7684;&#x6807;&#x7B7E;&#x8BBE;&#x4E3A;0&#xFF0C;dog &#x7C7B;&#x7684;&#x6807;&#x7B7E;&#x8BBE;&#x4E3A;1</span>
</code></pre>
<p>2&#x3001;&#x8FED;&#x4EE3;&#x8BFB;&#x53D6;&#x6BCF;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x5EFA;&#x7ACB; <code>tf.train.Feature</code> &#x5B57;&#x5178;&#x548C; <code>tf.train.Example</code> &#x5BF9;&#x8C61;&#xFF0C;&#x5E8F;&#x5217;&#x5316;&#x5E76;&#x5199;&#x5165; TFRecord &#x6587;&#x4EF6;&#x3002;</p>
<pre><code class="lang-python">    <span class="hljs-keyword">with</span> tf.io.TFRecordWriter(tfrecord_file) <span class="hljs-keyword">as</span> writer:
        <span class="hljs-keyword">for</span> filename, label <span class="hljs-keyword">in</span> zip(train_filenames, train_labels):
            <span class="hljs-comment"># 1&#x3001;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x96C6;&#x56FE;&#x7247;&#x5230;&#x5185;&#x5B58;&#xFF0C;image &#x4E3A;&#x4E00;&#x4E2A; Byte &#x7C7B;&#x578B;&#x7684;&#x5B57;&#x7B26;&#x4E32;</span>
            image = open(filename, <span class="hljs-string">&apos;rb&apos;</span>).read()
            <span class="hljs-comment"># 2&#x3001;&#x5EFA;&#x7ACB; tf.train.Feature &#x5B57;&#x5178;</span>
            feature = {
                <span class="hljs-string">&apos;image&apos;</span>: tf.train.Feature(bytes_list=tf.train.BytesList(value=[image])),  <span class="hljs-comment"># &#x56FE;&#x7247;&#x662F;&#x4E00;&#x4E2A; Bytes &#x5BF9;&#x8C61;</span>
                <span class="hljs-string">&apos;label&apos;</span>: tf.train.Feature(int64_list=tf.train.Int64List(value=[label]))  <span class="hljs-comment"># &#x6807;&#x7B7E;&#x662F;&#x4E00;&#x4E2A; Int &#x5BF9;&#x8C61;</span>
            }
            <span class="hljs-comment"># 3&#x3001;&#x901A;&#x8FC7;&#x5B57;&#x5178;&#x5EFA;&#x7ACB; Example</span>
            example = tf.train.Example(features=tf.train.Features(feature=feature))
            <span class="hljs-comment"># 4\&#x5C06;Example&#x5E8F;&#x5217;&#x5316;&#x5E76;&#x5199;&#x5165; TFRecord &#x6587;&#x4EF6;</span>
            writer.write(example.SerializeToString())
</code></pre>
<p><img src="../images/&#x732B;&#x72D7;&#x76EE;&#x5F55;.jpg" style="zoom:50%;"></p>
<blockquote>
<p>tfrecords&#x7684;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x4F1A;&#x7F29;&#x5C0F;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x91CC;&#x6570;&#x636E;&#x53CA;&#x672C;&#x8EAB;&#x4E0D;&#x5927;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x5BF9;&#x6BD4;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x7684;KITTI&#x6570;&#x636E;&#x96C6;&#x751F;&#x6210;&#x7684;&#x5927;&#x5C0F;&#x4F1A;&#x5C0F;&#x5F88;&#x591A;&#x3002;</p>
</blockquote>
<p>&#x6CE8;&#x610F;&#xFF1A;tf.train.Feature&#x53EA;&#x652F;&#x6301;&#x4E09;&#x79CD;&#x6570;&#x636E;&#x683C;&#x5F0F;&#xFF1A;</p>
<ul>
<li><code>tf.train.BytesList</code> &#xFF1A;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x539F;&#x59CB; Byte &#x6587;&#x4EF6;&#xFF08;&#x5982;&#x56FE;&#x7247;&#xFF09;&#xFF0C;&#x901A;&#x8FC7; <code>bytes_list</code> &#x53C2;&#x6570;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x7531;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x7EC4;&#x521D;&#x59CB;&#x5316;&#x7684; <code>tf.train.BytesList</code> &#x5BF9;&#x8C61;</li>
<li><code>tf.train.FloatList</code> &#xFF1A;&#x6D6E;&#x70B9;&#x6570;&#xFF0C;&#x901A;&#x8FC7; <code>float_list</code> &#x53C2;&#x6570;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x7531;&#x6D6E;&#x70B9;&#x6570;&#x6570;&#x7EC4;&#x521D;&#x59CB;&#x5316;&#x7684;tf.train.FloatList&#x5BF9;&#x8C61;</li>
<li><code>tf.train.Int64List</code> &#xFF1A;&#x6574;&#x6570;&#xFF0C;&#x901A;&#x8FC7; <code>int64_list</code> &#x53C2;&#x6570;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x7531;&#x6574;&#x6570;&#x6570;&#x7EC4;&#x521D;&#x59CB;&#x5316;&#x7684; <code>tf.train.Int64List</code> &#x5BF9;&#x8C61;&#x3002;</li>
</ul>
<h4 id="3&#x3001;&#x8BFB;&#x53D6;-tfrecord-&#x6587;&#x4EF6;">3&#x3001;&#x8BFB;&#x53D6; TFRecord &#x6587;&#x4EF6;</h4>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#xFF0C;&#x8BFB;&#x53D6;&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x7684; <code>train.tfrecords</code> &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x901A;&#x8FC7; <code>Dataset.map</code> &#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528; <code>tf.io.parse_single_example</code> &#x51FD;&#x6570;&#x5BF9;&#x6570;&#x636E;&#x96C6;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5316;&#x7684; <code>tf.train.Example</code> &#x5BF9;&#x8C61;&#x89E3;&#x7801;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># 1&#x3001;&#x8BFB;&#x53D6; TFRecord &#x6587;&#x4EF6;</span>
    raw_dataset = tf.data.TFRecordDataset(tfrecord_file)

    <span class="hljs-comment"># 2&#x3001;&#x5B9A;&#x4E49;Feature&#x7ED3;&#x6784;&#xFF0C;&#x544A;&#x8BC9;&#x89E3;&#x7801;&#x5668;&#x6BCF;&#x4E2A;Feature&#x7684;&#x7C7B;&#x578B;&#x662F;&#x4EC0;&#x4E48;</span>
    feature_description = {
        <span class="hljs-string">&apos;image&apos;</span>: tf.io.FixedLenFeature([], tf.string),
        <span class="hljs-string">&apos;label&apos;</span>: tf.io.FixedLenFeature([], tf.int64),
    }

    <span class="hljs-comment"># 3&#x3001;&#x5C06; TFRecord &#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x5316;&#x7684; tf.train.Example &#x89E3;&#x7801;</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_parse_example</span><span class="hljs-params">(example_string)</span>:</span>
        feature_dict = tf.io.parse_single_example(example_string, feature_description)
        feature_dict[<span class="hljs-string">&apos;image&apos;</span>] = tf.io.decode_jpeg(feature_dict[<span class="hljs-string">&apos;image&apos;</span>])  <span class="hljs-comment"># &#x89E3;&#x7801;JPEG&#x56FE;&#x7247;</span>
        <span class="hljs-keyword">return</span> feature_dict[<span class="hljs-string">&apos;image&apos;</span>], feature_dict[<span class="hljs-string">&apos;label&apos;</span>]

    dataset = raw_dataset.map(_parse_example)

    <span class="hljs-keyword">for</span> image, label <span class="hljs-keyword">in</span> dataset:
        print(image, label)
</code></pre>
<ul>
<li><p>&#x8FD9;&#x91CC;&#x7684; <code>feature_description</code> &#x7C7B;&#x4F3C;&#x4E8E;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x96C6;&#x7684; &#x201C;&#x63CF;&#x8FF0;&#x6587;&#x4EF6;&#x201D;&#xFF0C;<strong>&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7531;&#x952E;&#x503C;&#x5BF9;&#x7EC4;&#x6210;&#x7684;&#x5B57;&#x5178;&#xFF0C;&#x544A;&#x77E5; <code>tf.io.parse_single_example</code> &#x51FD;&#x6570;&#x6BCF;&#x4E2A; <code>tf.train.Example</code> &#x6570;&#x636E;&#x9879;&#x6709;&#x54EA;&#x4E9B; Feature&#xFF0C;&#x4EE5;&#x53CA;&#x8FD9;&#x4E9B; Feature &#x7684;&#x7C7B;&#x578B;&#x3001;&#x5F62;&#x72B6;&#x7B49;&#x5C5E;&#x6027;&#x3002;</strong></p>
<ul>
<li><code>tf.io.FixedLenFeature</code> &#x7684;&#x4E09;&#x4E2A;&#x8F93;&#x5165;&#x53C2;&#x6570; <code>shape</code> &#x3001; <code>dtype</code> &#x548C; <code>default_value</code> &#xFF08;&#x53EF;&#x7701;&#x7565;&#xFF09;&#x4E3A;&#x6BCF;&#x4E2A; Feature &#x7684;&#x5F62;&#x72B6;&#x3001;&#x7C7B;&#x578B;&#x548C;&#x9ED8;&#x8BA4;&#x503C;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x9879;&#x90FD;&#x662F;&#x5355;&#x4E2A;&#x7684;&#x6570;&#x503C;&#x6216;&#x8005;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6240;&#x4EE5; <code>shape</code> &#x4E3A;&#x7A7A;&#x6570;&#x7EC4;&#x3002;</li>
</ul>
</li>
</ul>
<h4 id="51042-kitti&#x6570;&#x636E;&#x96C6;&#x8F6C;&#x6362;&#x6210;tfrecords&#x6587;&#x4EF6;">5.10.4.2 KITTI&#x6570;&#x636E;&#x96C6;&#x8F6C;&#x6362;&#x6210;TFRecords&#x6587;&#x4EF6;</h4>
<ul>
<li>&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#xFF1A;<ul>
<li>create_kitti_tf_record.py&#xFF1A;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x4E3B;&#x8981;&#x5B58;&#x50A8;&#x903B;&#x8F91;</li>
<li></li>
</ul>
</li>
</ul>
<p><img src="../images/kitti&#x6570;&#x636E;&#x8F6C;&#x6362;&#x7ED3;&#x6784;.jpg" style="zoom:50%;"></p>
<ul>
<li>&#x6B65;&#x9AA4;&#xFF1A;<ul>
<li>1&#x3001;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x4E3B;&#x903B;&#x8F91;&#x51FD;&#x6570;&#x8FC7;&#x7A0B;&#x7F16;&#x5199;&#xFF0C;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x4F20;&#x9012;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;</li>
<li>2&#x3001;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x6807;&#x51C6;&#x4FE1;&#x606F;&#x3001;&#x8FC7;&#x6EE4;&#x6807;&#x6CE8;&#x4FE1;&#x606F;&#x3001;&#x8FDB;&#x884C;&#x6784;&#x9020;example&#x7684;feature&#x5B57;&#x5178;</li>
</ul>
</li>
</ul>
<p>1&#x3001;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x4E3B;&#x903B;&#x8F91;&#x51FD;&#x6570;&#x8FC7;&#x7A0B;&#x7F16;&#x5199;&#xFF0C;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x4F20;&#x9012;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;</p>
<ul>
<li>&#x5B9A;&#x4E49;convert_kitti_to_tfrecords&#xFF0C;&#x8865;&#x5145;&#x5B8C;&#x6574;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;</li>
<li><p>&#x521B;&#x5EFA;KITTI&#x8BAD;&#x7EC3;&#x548C;&#x9A8C;&#x8BC1;&#x96C6;&#x7684;tfrecord&#x4F4D;&#x7F6E;</p>
</li>
<li><p>&#x5217;&#x51FA;&#x6240;&#x6709;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x8FDB;&#x884C;&#x6BCF;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5BB9;&#x548C;&#x6807;&#x6CE8;&#x4FE1;&#x606F;&#x7684;&#x83B7;&#x53D6;&#xFF0C;&#x5199;&#x5165;&#x5230;tfrecords&#x6587;&#x4EF6;</p>
</li>
</ul>
<p>&#x5176;&#x4E2D;&#x5BFC;&#x5165;&#x76F8;&#x5173;&#x5305;&#x548C;&#x547D;&#x4EE4;&#x884C;&#x53C2;&#x6570;&#x5982;&#x4E0B;&#x8BBE;&#x7F6E;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> PIL.Image <span class="hljs-keyword">as</span> pil
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf

<span class="hljs-keyword">import</span> feature_parse
<span class="hljs-keyword">from</span> IoU <span class="hljs-keyword">import</span> iou
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> sys

parser = argparse.ArgumentParser()
parser.add_argument(<span class="hljs-string">&apos;--data_dir&apos;</span>, type=str, default=<span class="hljs-string">&apos;../data/kitti/&apos;</span>,
                    help=<span class="hljs-string">&apos;kitti&#x6570;&#x636E;&#x96C6;&#x7684;&#x4F4D;&#x7F6E;&apos;</span>)
parser.add_argument(<span class="hljs-string">&apos;--output_path&apos;</span>, type=str, default=<span class="hljs-string">&apos;../data/kitti_tfrecords/&apos;</span>,
                    help=<span class="hljs-string">&apos;TFRecord&#x6587;&#x4EF6;&#x7684;&#x8F93;&#x51FA;&#x4F4D;&#x7F6E;&apos;</span>)
parser.add_argument(<span class="hljs-string">&apos;--classes_to_use&apos;</span>, default=<span class="hljs-string">&apos;car ,van ,truck ,pedestrian ,cyclist ,tram&apos;</span>, help=<span class="hljs-string">&apos;KITTI&#x4E2D;&#x9700;&#x8981;&#x68C0;&#x6D4B;&#x7684;&#x7C7B;&#x522B;&apos;</span>)
parser.add_argument(<span class="hljs-string">&apos;--validation_set_size&apos;</span>, type=int, default=<span class="hljs-number">500</span>,
                    help=<span class="hljs-string">&apos;&#x9A8C;&#x8BC1;&#x96C6;&#x6570;&#x636E;&#x96C6;&#x4F7F;&#x7528;&#x5927;&#x5C0F;&apos;</span>)
</code></pre>
<p>&#x7F16;&#x5199;&#x7684;&#x4E3B;&#x51FD;&#x6570;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">convert_kitti_to_tfrecords</span><span class="hljs-params">(data_dir, output_path, classes_to_use,
                               validation_set_size)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    &#x5C06;KITTI detection &#x8F6C;&#x6362;&#x6210;TFRecords.
    :param data_dir: &#x6E90;&#x6570;&#x636E;&#x76EE;&#x5F55;
    :param output_path: &#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x76EE;&#x5F55;
    :param classes_to_use: &#x9009;&#x62E9;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x7C7B;&#x522B;
    :param validation_set_size: &#x9A8C;&#x8BC1;&#x96C6;&#x5927;&#x5C0F;
    :return:
    &quot;&quot;&quot;</span>
    train_count = <span class="hljs-number">0</span>
    val_count = <span class="hljs-number">0</span>

    <span class="hljs-comment"># 1&#x3001;&#x521B;&#x5EFA;KITTI&#x8BAD;&#x7EC3;&#x548C;&#x9A8C;&#x8BC1;&#x96C6;&#x7684;tfrecord&#x4F4D;&#x7F6E;</span>
    <span class="hljs-comment"># &#x6807;&#x6CE8;&#x4FE1;&#x606F;&#x4F4D;&#x7F6E;</span>
    annotation_dir = os.path.join(data_dir,
                                  <span class="hljs-string">&apos;training&apos;</span>,
                                  <span class="hljs-string">&apos;label_2&apos;</span>)

    <span class="hljs-comment"># &#x56FE;&#x7247;&#x4F4D;&#x7F6E;</span>
    image_dir = os.path.join(data_dir,
                             <span class="hljs-string">&apos;data_object_image_2&apos;</span>,
                             <span class="hljs-string">&apos;training&apos;</span>,
                             <span class="hljs-string">&apos;image_2&apos;</span>)

    train_writer = tf.io.TFRecordWriter(output_path + <span class="hljs-string">&apos;train.tfrecord&apos;</span>)
    val_writer = tf.io.TFRecordWriter(output_path + <span class="hljs-string">&apos;val.tfrecord&apos;</span>)

    <span class="hljs-comment"># 2&#x3001;&#x5217;&#x51FA;&#x6240;&#x6709;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x8FDB;&#x884C;&#x6BCF;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x5185;&#x5BB9;&#x548C;&#x6807;&#x6CE8;&#x4FE1;&#x606F;&#x7684;&#x83B7;&#x53D6;&#xFF0C;&#x5199;&#x5165;&#x5230;tfrecords&#x6587;&#x4EF6;</span>
    images = sorted(os.listdir(image_dir))
    <span class="hljs-keyword">for</span> img_name <span class="hljs-keyword">in</span> images:

        <span class="hljs-comment"># &#xFF08;1&#xFF09;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x56FE;&#x7247;&#x7684;&#x7F16;&#x53F7;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x62FC;&#x63A5;&#x8BFB;&#x53D6;&#x76F8;&#x5E94;&#x6807;&#x6CE8;&#x6587;&#x4EF6;</span>
        img_num = int(img_name.split(<span class="hljs-string">&apos;.&apos;</span>)[<span class="hljs-number">0</span>])

        <span class="hljs-comment"># &#xFF08;2&#xFF09;&#x8BFB;&#x53D6;&#x6807;&#x7B7E;&#x6587;&#x4EF6;&#x51FD;&#x6570;</span>
        <span class="hljs-comment"># &#x6574;&#x6570;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x586B;&#x5145;&#x6210;&#x4E0E;&#x6807;&#x7B7E;&#x6587;&#x4EF6;&#x76F8;&#x540C;&#x7684;6&#x4F4D;&#x5B57;&#x7B26;&#x4E32;</span>
        img_anno = read_annotation_file(os.path.join(annotation_dir,
                                                     str(img_num).zfill(<span class="hljs-number">6</span>) + <span class="hljs-string">&apos;.txt&apos;</span>))

        <span class="hljs-comment"># &#xFF08;3&#xFF09;&#x8FC7;&#x6EE4;&#x6807;&#x7B7E;&#x51FD;&#x6570;</span>
        <span class="hljs-comment"># &#x5F53;&#x524D;&#x56FE;&#x7247;&#x7684;&#x6807;&#x6CE8;&#x4E2D; &#x8FC7;&#x6EE4;&#x6389;&#x4E00;&#x4E9B;&#x6CA1;&#x6709;&#x7528;&#x7684;&#x7C7B;&#x522B;&#x548C;dontcare&#x533A;&#x57DF;&#x7684;annotations</span>
        annotation_for_image = filter_annotations(img_anno, classes_to_use)

        <span class="hljs-comment"># &#xFF08;4&#xFF09;&#x5199;&#x5165;&#x8BAD;&#x7EC3;&#x548C;&#x9A8C;&#x8BC1;&#x96C6;&#x5408;TFRecord&#x6587;&#x4EF6;</span>
        <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x62FC;&#x63A5;&#x7684;&#x56FE;&#x7247;&#x8DEF;&#x5F84;&#xFF0C;&#x7136;&#x540E;&#x4E0E;&#x8FC7;&#x6EE4;&#x4E4B;&#x540E;&#x7684;&#x6807;&#x6CE8;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x5230;&#x4E00;&#x4E2A;example&#x4E2D;</span>
        image_path = os.path.join(image_dir, img_name)
        example = prepare_example(image_path, annotation_for_image)
        <span class="hljs-comment"># &#x5982;&#x679C;&#x5C0F;&#x4E8E;&#x9A8C;&#x8BC1;&#x96C6;&#x6570;&#x91CF;&#x5927;&#x5C0F;&#x5C31;&#x76F4;&#x63A5;&#x5199;&#x5165;&#x9A8C;&#x8BC1;&#x96C6;&#xFF0C;&#x5426;&#x5219;&#x5199;&#x5165;&#x8BAD;&#x7EC3;&#x96C6;</span>
        is_validation_img = img_num &lt; validation_set_size
        <span class="hljs-keyword">if</span> is_validation_img:
            val_writer.write(example.SerializeToString())
            val_count += <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            train_writer.write(example.SerializeToString())
            train_count += <span class="hljs-number">1</span>

    train_writer.close()
    val_writer.close()


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(args)</span>:</span>

    convert_kitti_to_tfrecords(
        data_dir=args.data_dir,
        output_path=args.output_path,
        classes_to_use=args.classes_to_use.split(<span class="hljs-string">&apos;,&apos;</span>),
        validation_set_size=args.validation_set_size)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:

    args = parser.parse_args(sys.argv[<span class="hljs-number">1</span>:])
    main(args)
</code></pre>
<p>&#xFF08;2&#xFF09;&#x8BFB;&#x53D6;&#x8BFB;&#x53D6;&#x6807;&#x7B7E;&#x6587;&#x4EF6;&#x51FD;&#x6570;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_annotation_file</span><span class="hljs-params">(filename)</span>:</span>

    <span class="hljs-keyword">with</span> open(filename) <span class="hljs-keyword">as</span> f:
        content = f.readlines()
    <span class="hljs-comment"># &#x5206;&#x5272;&#x89E3;&#x6790;&#x5185;&#x5BB9;</span>
    content = [x.strip().split(<span class="hljs-string">&apos; &apos;</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content]
    <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x5185;&#x5BB9;&#x5230;&#x5B57;&#x5178;&#x7ED3;&#x6784;</span>
    anno = dict()
    anno[<span class="hljs-string">&apos;type&apos;</span>] = np.array([x[<span class="hljs-number">0</span>].lower() <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])
    anno[<span class="hljs-string">&apos;truncated&apos;</span>] = np.array([float(x[<span class="hljs-number">1</span>]) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])
    anno[<span class="hljs-string">&apos;occluded&apos;</span>] = np.array([int(x[<span class="hljs-number">2</span>]) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])
    anno[<span class="hljs-string">&apos;alpha&apos;</span>] = np.array([float(x[<span class="hljs-number">3</span>]) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])

    anno[<span class="hljs-string">&apos;2d_bbox_left&apos;</span>] = np.array([float(x[<span class="hljs-number">4</span>]) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])
    anno[<span class="hljs-string">&apos;2d_bbox_top&apos;</span>] = np.array([float(x[<span class="hljs-number">5</span>]) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])
    anno[<span class="hljs-string">&apos;2d_bbox_right&apos;</span>] = np.array([float(x[<span class="hljs-number">6</span>]) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])
    anno[<span class="hljs-string">&apos;2d_bbox_bottom&apos;</span>] = np.array([float(x[<span class="hljs-number">7</span>]) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> content])
    <span class="hljs-keyword">return</span> anno
</code></pre>
<p>&#xFF08;3&#xFF09;&#x8FC7;&#x6EE4;&#x6807;&#x7B7E;&#x51FD;&#x6570;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filter_annotations</span><span class="hljs-params">(img_all_annotations, used_classes)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    &#x8FC7;&#x6EE4;&#x6389;&#x4E00;&#x4E9B;&#x6CA1;&#x6709;&#x7528;&#x7684;&#x7C7B;&#x522B;&#x548C;dontcare&#x533A;&#x57DF;&#x7684;annotations
    :param img_all_annotations: &#x56FE;&#x7247;&#x7684;&#x6240;&#x6709;&#x6807;&#x6CE8;
    :param used_classes: &#x9700;&#x8981;&#x7559;&#x4E0B;&#x8BB0;&#x5F55;&#x7684;&#x5217;&#x522B;
    :return:
    &quot;&quot;&quot;</span>
    img_filtered_annotations = {}

    <span class="hljs-comment"># 1&#x3001;&#x8FC7;&#x6EE4;&#x8FD9;&#x4E2A;&#x56FE;&#x7247;&#x4E2D;&#x6807;&#x6CE8;&#x7684;&#x6211;&#x4EEC;&#x8BAD;&#x7EC3;&#x6307;&#x5B9A;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x7C7B;&#x522B;&#xFF0C;&#x628A;&#x7D22;&#x5F15;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;</span>
    <span class="hljs-comment"># &#x65B9;&#x4FBF;&#x540E;&#x9762;&#x5728;&#x5904;&#x7406;&#x5BF9;&#x5E94;&#x7684;&#x4E00;&#x4E9B;&#x5750;&#x6807;&#x65F6;&#x5019;&#x4F7F;&#x7528;</span>
    relevant_annotation_indices = [
        i <span class="hljs-keyword">for</span> i, x <span class="hljs-keyword">in</span> enumerate(img_all_annotations[<span class="hljs-string">&apos;type&apos;</span>]) <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> used_classes
    ]

    <span class="hljs-comment"># 2&#x3001;&#x83B7;&#x53D6;&#x8FC7;&#x6EE4;&#x540E;&#x7684;&#x4E0B;&#x6807;&#x5BF9;&#x5E94;&#x67D0;&#x4E2A;&#x6807;&#x8BB0;&#x7269;&#x4F53;&#x7684;&#x5176;&#x5B83;&#x4FE1;&#x606F;</span>
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> img_all_annotations.keys():
        img_filtered_annotations[key] = (
            img_all_annotations[key][relevant_annotation_indices])

    <span class="hljs-comment"># 3&#x3001;&#x5982;&#x679C;dontcare&#x5728;&#x6211;&#x4EEC;&#x8981;&#x83B7;&#x53D6;&#x7684;&#x7C7B;&#x522B;&#x91CC;&#x9762;&#xFF0C;&#x4E5F;&#x8FDB;&#x884C;&#x7EC4;&#x5408;&#x83B7;&#x53D6;&#xFF0C;&#x7136;&#x540E;&#x8FC7;&#x6EE4;&#x76F8;&#x5173;&#x7684;bboxes&#x4E0D;&#x7B26;&#x5408;&#x8981;&#x6C42;&#x7684;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;dontcare&apos;</span> <span class="hljs-keyword">in</span> used_classes:
        dont_care_indices = [i <span class="hljs-keyword">for</span> i,
                             x <span class="hljs-keyword">in</span> enumerate(img_filtered_annotations[<span class="hljs-string">&apos;type&apos;</span>])
                             <span class="hljs-keyword">if</span> x == <span class="hljs-string">&apos;dontcare&apos;</span>]

        <span class="hljs-comment"># bounding box&#x7684;&#x683C;&#x5F0F;[y_min, x_min, y_max, x_max]</span>
        all_boxes = np.stack([img_filtered_annotations[<span class="hljs-string">&apos;2d_bbox_top&apos;</span>],
                              img_filtered_annotations[<span class="hljs-string">&apos;2d_bbox_left&apos;</span>],
                              img_filtered_annotations[<span class="hljs-string">&apos;2d_bbox_bottom&apos;</span>],
                              img_filtered_annotations[<span class="hljs-string">&apos;2d_bbox_right&apos;</span>]],
                             axis=<span class="hljs-number">1</span>)

        <span class="hljs-comment"># &#x8BA1;&#x7B97;bboxesIOU&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x6837;&#x7684;</span>
        <span class="hljs-comment"># Truck 0.00 0 -1.57 599.41 156.40 629.75 189.25 2.85 2.63 12.34 0.47 1.49 69.44 -1.56</span>
        <span class="hljs-comment"># DontCare -1 -1 -10 503.89 169.71 590.61 190.13 -1 -1 -1 -1000 -1000 -1000 -10</span>
        <span class="hljs-comment"># DontCare -1 -1 -10 511.35 174.96 527.81 187.45 -1 -1 -1 -1000 -1000 -1000 -10</span>
        <span class="hljs-comment"># DontCare -1 -1 -10 532.37 176.35 542.68 185.27 -1 -1 -1 -1000 -1000 -1000 -10</span>
        <span class="hljs-comment"># DontCare -1 -1 -10 559.62 175.83 575.40 183.15 -1 -1 -1 -1000 -1000 -1000 -10</span>
        ious = iou(boxes1=all_boxes,
                   boxes2=all_boxes[dont_care_indices])

        <span class="hljs-comment"># &#x5220;&#x9664;&#x6240;&#x6709; bounding boxes &#x4E0E; dontcare region &#x91CD;&#x53E0;&#x7684;&#x533A;&#x57DF;</span>
        <span class="hljs-keyword">if</span> ious.size &gt; <span class="hljs-number">0</span>:
            <span class="hljs-comment"># &#x627E;&#x51FA;&#x4E0B;&#x6807;</span>
            boxes_to_remove = np.amax(ious, axis=<span class="hljs-number">1</span>) &gt; <span class="hljs-number">0.0</span>
            <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> img_all_annotations.keys():
                img_filtered_annotations[key] = (
                    img_filtered_annotations[key][np.logical_not(boxes_to_remove)])

    <span class="hljs-keyword">return</span> img_filtered_annotations
</code></pre>
<p>2&#x3001;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x6807;&#x51C6;&#x4FE1;&#x606F;&#x3001;&#x8FC7;&#x6EE4;&#x6807;&#x6CE8;&#x4FE1;&#x606F;&#x3001;&#x8FDB;&#x884C;&#x6784;&#x9020;example&#x7684;feature&#x5B57;&#x5178;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prepare_example</span><span class="hljs-params">(image_path, annotations)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    &#x5BF9;&#x4E00;&#x4E2A;&#x56FE;&#x7247;&#x7684;Annotations&#x8F6C;&#x6362;&#x6210;tf.Example proto.
    :param image_path:
    :param annotations:
    :return:
    &quot;&quot;&quot;</span>
    <span class="hljs-comment"># 1&#x3001;&#x8BFB;&#x53D6;&#x56FE;&#x7247;&#x5185;&#x5BB9;&#xFF0C;&#x8F6C;&#x6362;&#x6210;&#x6570;&#x7EC4;&#x683C;&#x5F0F;</span>
    <span class="hljs-keyword">with</span> open(image_path, <span class="hljs-string">&apos;rb&apos;</span>) <span class="hljs-keyword">as</span> fid:
        encoded_png = fid.read()
    encoded_png_io = io.BytesIO(encoded_png)
    image = pil.open(encoded_png_io)
    image = np.asarray(image)

    <span class="hljs-comment"># 2&#x3001;&#x6784;&#x9020;&#x534F;&#x8BAE;&#x4E2D;&#x9700;&#x8981;&#x7684;&#x5B57;&#x5178;&#x952E;&#x7684;&#x503C;</span>
    <span class="hljs-comment"># sha256&#x52A0;&#x5BC6;&#x7ED3;&#x679C;</span>
    key = hashlib.sha256(encoded_png).hexdigest()

    <span class="hljs-comment"># &#x8FDB;&#x884C;&#x5750;&#x6807;&#x5904;&#x7406;</span>
    width = int(image.shape[<span class="hljs-number">1</span>])
    height = int(image.shape[<span class="hljs-number">0</span>])
    <span class="hljs-comment"># &#x5B58;&#x50A8;&#x6781;&#x5750;&#x6807;&#x5F52;&#x4E00;&#x5316;&#x683C;&#x5F0F;</span>
    xmin_norm = annotations[<span class="hljs-string">&apos;2d_bbox_left&apos;</span>] / float(width)
    ymin_norm = annotations[<span class="hljs-string">&apos;2d_bbox_top&apos;</span>] / float(height)
    xmax_norm = annotations[<span class="hljs-string">&apos;2d_bbox_right&apos;</span>] / float(width)
    ymax_norm = annotations[<span class="hljs-string">&apos;2d_bbox_bottom&apos;</span>] / float(height)

    <span class="hljs-comment"># &#x5176;&#x4ED6;&#x4FE1;&#x606F;&#xFF0C;&#x96BE;&#x5EA6;&#x4EE5;&#x53CA;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x522B;</span>
    difficult_obj = [<span class="hljs-number">0</span>] * len(xmin_norm)
    classes_text = [x.encode(<span class="hljs-string">&apos;utf8&apos;</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> annotations[<span class="hljs-string">&apos;type&apos;</span>]]

    <span class="hljs-comment"># 3&#x3001;&#x6784;&#x9020;&#x534F;&#x8BAE;example</span>
    example = tf.train.Example(features=tf.train.Features(feature={
        <span class="hljs-string">&apos;image/height&apos;</span>: feature_parse.int64_feature(height),
        <span class="hljs-string">&apos;image/width&apos;</span>: feature_parse.int64_feature(width),
        <span class="hljs-string">&apos;image/filename&apos;</span>: feature_parse.bytes_feature(image_path.encode(<span class="hljs-string">&apos;utf8&apos;</span>)),
        <span class="hljs-string">&apos;image/source_id&apos;</span>: feature_parse.bytes_feature(image_path.encode(<span class="hljs-string">&apos;utf8&apos;</span>)),
        <span class="hljs-string">&apos;image/key/sha256&apos;</span>: feature_parse.bytes_feature(key.encode(<span class="hljs-string">&apos;utf8&apos;</span>)),
        <span class="hljs-string">&apos;image/encoded&apos;</span>: feature_parse.bytes_feature(encoded_png),
        <span class="hljs-string">&apos;image/format&apos;</span>: feature_parse.bytes_feature(<span class="hljs-string">&apos;png&apos;</span>.encode(<span class="hljs-string">&apos;utf8&apos;</span>)),
        <span class="hljs-string">&apos;image/object/bbox/xmin&apos;</span>: feature_parse.float_list_feature(xmin_norm),
        <span class="hljs-string">&apos;image/object/bbox/xmax&apos;</span>: feature_parse.float_list_feature(xmax_norm),
        <span class="hljs-string">&apos;image/object/bbox/ymin&apos;</span>: feature_parse.float_list_feature(ymin_norm),
        <span class="hljs-string">&apos;image/object/bbox/ymax&apos;</span>: feature_parse.float_list_feature(ymax_norm),
        <span class="hljs-string">&apos;image/object/class/text&apos;</span>: feature_parse.bytes_list_feature(classes_text),
        <span class="hljs-string">&apos;image/object/difficult&apos;</span>: feature_parse.int64_list_feature(difficult_obj),
        <span class="hljs-string">&apos;image/object/truncated&apos;</span>: feature_parse.float_list_feature(
            annotations[<span class="hljs-string">&apos;truncated&apos;</span>])
    }))

    <span class="hljs-keyword">return</span> example
</code></pre>
<p>&#x6700;&#x7EC8;&#x8FD0;&#x884C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x5BF9;&#x5E94;&#x7684;&#x76EE;&#x5F55;&#x8F93;&#x51FA;TFRecord&#x6587;&#x4EF6;&#xFF1A;</p>
<ul>
<li>trian.tfrecord</li>
<li>val.tfrecord</li>
</ul>
<p>&#x90A3;&#x4E48;&#x4ED4;&#x7EC6;&#x53BB;&#x89C2;&#x5BDF;&#x4E4B;&#x540E;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;<strong>&#x603B;&#x5171;&#x5927;&#x5C0F;5.5G&#x8BAD;&#x7EC3;+396M&#x9A8C;&#x8BC1;&#x96C6;&#xFF0C;&#x8981;&#x6BD4;data_object_image_2.zip 12.57G&#x5C11;&#x4E86;&#x5C06;&#x8FD1;&#x4E00;&#x500D;&#x3002;</strong></p>
<h3 id="5105-&#x5C0F;&#x7ED3;">5.10.5 &#x5C0F;&#x7ED3;</h3>
<ul>
<li>&#x638C;&#x63E1;YOLO&#x7ED3;&#x6784;&#x7684;&#x5C01;&#x88C5;&#x63A5;&#x53E3;&#x4EE5;&#x53CA;&#x7ED3;&#x6784;</li>
<li>&#x638C;&#x63E1;TFRecord&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x53D6;&#x548C;&#x5B58;&#x50A8;</li>
<li>&#x638C;&#x63E1;KITTI&#x6570;&#x636E;&#x96C6;&#x7684;TFRecord&#x683C;&#x5F0F;&#x5B58;&#x50A8;</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../objectdection/section9.html" class="navigation navigation-prev " aria-label="Previous page: SSD算法原理"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../objectdection/section11.html" class="navigation navigation-next " aria-label="Next page: 案例：KITTI人、车检测案例-训练、检测"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-splitter/splitter.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"expandable-chapters":{},"katex":{},"splitter":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
